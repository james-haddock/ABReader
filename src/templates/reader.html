<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Your Book Title</title>
    <link href="{{ url_for('static', filename='static/css/main.css') }}" rel="stylesheet">
    <style>
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 10;
        }
    </style>
</head>

<body style="overflow: hidden; margin: 0; padding: 0;">

    <iframe id="contentFrame" scrolling="no"></iframe>

    <div id="navButtons" style="position: fixed; bottom: 0; left: 0; width: 100%; backdrop-filter: backdrop-blur-md; background-color: rgba(255, 255, 255, 0.3); box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; padding: 16px; z-index: 50; transition: opacity 1s; opacity: 1;">
        <button id="prevButton" style="background-color: #f0f0f0; padding: 8px 16px; border-radius: 4px; font-size: 14px;">Previous</button>
        <a href='{{ url_for("library") }}'><button style="font-size: 14px; font-weight: bold; padding: 8px 16px; border-radius: 4px;">Return to Library</button></a>
        <button id="nextButton" style="background-color: #f0f0f0; padding: 8px 16px; border-radius: 4px; font-size: 14px;">Next</button>
    </div>

    <script>
        let UUID = '{{ UUID }}';
        let currentPage = 1;
        let totalPages = 1;

        window.onload = function() {
            fetchContentUrl('initial');
            window.addEventListener('resize', updatePagination);
        }

        document.getElementById('nextButton').addEventListener('click', function() {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            } else {
                fetchContentUrl('next');
            }
        });

        document.getElementById('prevButton').addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            } else {
                fetchContentUrl('previous');
            }
        });

        function updatePagination() {
          let frame = document.getElementById('contentFrame');
          let contentDocument = frame.contentDocument;
          let contentHeight = contentDocument.body.scrollHeight;
          let viewportHeight = frame.clientHeight;
      
          totalPages = Math.ceil(contentHeight / viewportHeight);
      
          if (currentPage < totalPages) {

              let yOffset = viewportHeight * (currentPage - 1);
              frame.contentWindow.scrollTo(0, yOffset);
      

              let spacer = contentDocument.getElementById('spacer');
              if (spacer) spacer.remove();
          } else if (currentPage === totalPages) {

              let lastPageContentHeight = contentHeight - (viewportHeight * (currentPage - 1));
              let spacerHeight = viewportHeight - lastPageContentHeight;
              
              let spacer = contentDocument.getElementById('spacer');
              if (!spacer) {
                  spacer = contentDocument.createElement('div');
                  spacer.id = 'spacer';
                  contentDocument.body.appendChild(spacer);
              }
              spacer.style.height = `${spacerHeight}px`;
      
              let yOffset = contentHeight - viewportHeight + spacerHeight;
              frame.contentWindow.scrollTo(0, yOffset);
          }
      }
      
      
      
      

        function fetchContentUrl(action) {
            fetch(`/get_url?action=${action}&UUID=${UUID}`)
                .then(response => response.json())
                .then(data => {
                    if (data.url) {
                        document.getElementById('contentFrame').src = data.url;
                        currentPage = 1;
                        setTimeout(updatePagination, 100);  
                    } else {
                        console.error('Received invalid URL from backend');
                    }
                })
                .catch(error => {
                    console.error('Error fetching content URL:', error);
                });
        }
    </script>

</body>
</html>
