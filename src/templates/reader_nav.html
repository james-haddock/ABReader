<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>{{ book_title }}</title>

  <style>
    #navButtons {
      backdrop-filter: blur(4px);
      transition: opacity 1s ease-in-out;
      opacity: 0;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      backdrop-filter: backdrop-blur-md;
      background-color: rgba(255, 255, 255, 0.9); 
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      z-index: 50;
      
    }
    #libraryButtonContainer {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      
    }
    #libraryButton, #resetTextButton, #decreaseTextButton, #increaseTextButton {
      background: none; 
      border: none;     
      padding: 0;       
      font-size: inherit; 
      cursor: pointer;   
    }
    
    #libraryButton:hover, #resetTextButton:hover, #decreaseTextButton:hover, #increaseTextButton:hover {
      color: #666;     
    }
    
    #zoomControls {
        display: flex;
        gap: 10px; 
        padding-right: 25px;
        margin-left: auto;
      }
      #increaseTextButton, #decreaseTextButton {
        padding: 5px 10px; 
        margin: 0;
        font-size: 16px; 
        cursor: pointer;
      }
    #navTrigger {
      background: none; 
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 50px; 
      z-index: 49;
    }
    #libraryButton {
      font-size: 14px;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 4px;
      text-align: center;}

      :root {
        --text-color: #000;
        --background-color: #fff;
      }
      @media  {
        :root {
          --text-color: #fff;
          --background-color: #000;
        }
      }

@media (prefers-color-scheme: dark) {
  html {
    background-color: var(--background-color) !important;
  }
    * {
      color: var(--text-color) !important;
      background-color: var(--background-color) !important;
    }
   a {
        color: #bb86fc !important;
    }
    svg text {
        fill: #ffffff !important;
    }

     input, textarea, button, select {
        background-color: #333 !important;
        border: 1px solid #555!important;
        color: #ddd !important;
    }

    table {
        border-color: #555 !important;
    }
 th, td {
        border-color: #555 !important;
    }
    }
    img {
        opacity: 0;
    transition: opacity 0.5s ease-in-out;
    }

    img.loaded {
    opacity: 1;
    }
    @media (prefers-color-scheme: dark) {
      #navTrigger {
        opacity: 0;
        background-color:none !important;
      }
      #navButtons {
        background-color: rgba(50, 50, 50, 0.9) !important;
        color: white !important; 
      }
      #libraryButtonContainer, #libraryButtonContainer *, #zoomControls, #zoomControls * {
        background: none !important; 
        color: white !important; 
        border: none !important;
      }
      #libraryButton:hover, #resetTextButton:hover, #decreaseTextButton:hover, #increaseTextButton:hover {
        color: #bbb !important;
      }
    }
  </style>
</head>
<body>
  <main class='book_content'><div id='book_content'></div></main>
  <div id="navTrigger"></div> 
  <div id="navButtons">
    <a href='{{ url_for("library") }}' id="libraryButtonContainer">
      <button id="libraryButton">Return to Library</button>
    </a>
    <div id="zoomControls">
      <button id="resetTextButton">â†º</button>
      <button id="decreaseTextButton">-</button>
      <button id="increaseTextButton">+</button>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {

    
      var nav = document.getElementById('navButtons');
      var navTrigger = document.getElementById('navTrigger');
      var fadeOutTime = 5000;
      var navVisible = false;
      var book = document.getElementById('book_content');
      var defaultFontSize;

      fetch('/content/' + '{{ UUID }}') 
      .then(response => response.text())
      .then(html => {
          var tempContainer = document.createElement('div');
          tempContainer.innerHTML = html;
    
          var stylesheets = tempContainer.querySelectorAll('link[rel="stylesheet"]');
    
          var head = document.head;
          var firstChild = head.firstChild;
          stylesheets.forEach(function(sheet) {
              head.insertBefore(sheet, firstChild);
          });
    
          var bookContent = document.getElementById('book_content');
          bookContent.innerHTML = tempContainer.innerHTML; 
    
          var images = bookContent.getElementsByTagName('img');
          for (var i = 0; i < images.length; i++) {
              if (images[i].complete) {
                  images[i].classList.add('loaded');
              } else {
                  images[i].onload = function() {
                      this.classList.add('loaded');
                  };
              }
          }
      })
      .catch(error => console.error('Error loading content:', error));
    
    


      var bookContent = document.getElementById('book_content');
      var defaultFontSize = 16;

      function fadeOutNav() {
        if (navVisible) {
          nav.style.opacity = '0';
          setTimeout(() => { nav.style.visibility = 'hidden'; navVisible = false; }, 1000);
        }
      }
    
      function fadeInNav() {
        if (!navVisible) {
          nav.style.visibility = 'visible';
          nav.style.opacity = '1';
          navVisible = true;
        }
      }
    
      var inactivityTimeout;
    
      function resetInactivityTimeout() {
        clearTimeout(inactivityTimeout);
        inactivityTimeout = setTimeout(fadeOutNav, fadeOutTime);
      }
    
      navTrigger.addEventListener('mouseenter', function() {
        fadeInNav();
        resetInactivityTimeout();
      });
    
      nav.addEventListener('mouseleave', function() {
        fadeOutNav();
        resetInactivityTimeout();
      });
    
      navTrigger.addEventListener('touchstart', function(event) {
        fadeInNav();
        resetInactivityTimeout();
        event.preventDefault();
      });
    
      setTimeout(fadeInNav, 100);
      resetInactivityTimeout();
    


      function changeBookTextSize(delta) {
        var currentSize = parseInt(window.getComputedStyle(bookContent, null).getPropertyValue('font-size'));
        if (delta === 'reset') {
          bookContent.style.fontSize = defaultFontSize + 'px';
        } else {
          bookContent.style.fontSize = (currentSize + delta) + 'px';
        }
      }

      document.getElementById('increaseTextButton').addEventListener('click', function() {
        changeBookTextSize(1);
      });

      document.getElementById('decreaseTextButton').addEventListener('click', function() {
        changeBookTextSize(-1);
      });

      document.getElementById('resetTextButton').addEventListener('click', function() {
        changeBookTextSize('reset');
      });
      });
    {{ save_book_session_js }}
  
  </script>
</body>
</html>

