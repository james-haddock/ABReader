<html><head><link href="../Styles/style0001.css" rel="stylesheet"/></head><body><body>
<div>
<svg height="100%" preserveaspectratio="xMidYMid meet" version="1.1" viewbox="0 0 864 1000" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<image height="1000" width="864" xlink:href="../Images/cover01342.jpeg"/>
</svg>
</div>
</body><body><div class="book" id="part0000_head_first_design_patterns"><div class="titlepage"><div><div><h1 class="title">Head First: Design Patterns</h1></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Eric Freeman</span></h3></div></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Elisabeth Robson</span></h3></div></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Bert Bates</span></h3></div></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Kathy Sierra</span></h3></div></div><div class="locations"><div class="informalfigure"><div class="mediaobject"><img alt="image with no caption" hisrc="oreilly_large.png.jpg" src="../Images/image00487.jpeg"/></div></div><p class="cities">Beijing • Boston • Farnham • Sebastopol • Tokyo</p></div></div></div></div></body><body><section class="preface" epub:type="preface" id="part0001_dedication"><div class="titlepage"><div><div><h2 class="title"></h2></div></div></div><div class="blockquote"><blockquote class="blockquote"><div>To the Gang of Four, whose insight and expertise in capturing and communicating Design Patterns has changed the face of software design forever, and bettered the lives of developers throughout the world.</div><div>But <span class="emphasis"><em>seriously</em></span>, when are we going to see a second edition? After all, it’s been only <span class="emphasis"><em><span class="strikethrough">ten</span> twenty years</em></span>.</div></blockquote></div></section></body><body><section class="preface" epub:type="preface" id="part0002_praise_for_head_first_design_patterns"><div class="titlepage"><div><div><h2 class="title">Praise for <span class="emphasis"><em>Head First Design Patterns</em></span></h2></div></div></div><div class="blockquote"><blockquote class="blockquote"><div>“I received the book yesterday and started to read it on the way home... and I couldn’t stop. I took it to the gym and I expect people saw me smiling a lot while I was exercising and reading. This is très ‘cool’. It is fun, but they cover a lot of ground and they are right to the point. I’m really impressed.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Erich Gamma, IBM Distinguished Engineer, and coauthor of <span class="emphasis"><em>Design Patterns</em></span> with the rest of the Gang of Four — Richard Helm, Ralph Johnson and John Vlissides</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“<span class="emphasis"><em>Head First Design Patterns</em></span> manages to mix fun, belly-laughs, insight, technical depth, and great practical advice in one entertaining and thought-provoking read. Whether you are new to design patterns, or have been using them for years, you are sure to get something from visiting Objectville.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Richard Helm, coauthor of <span class="emphasis"><em>Design Patterns</em></span> with rest of the Gang of Four — Erich Gamma, Ralph Johnson and John Vlissides</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“I feel like a thousand pounds of books have just been lifted off of my head.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Ward Cunningham, inventor of the Wiki and founder of the Hillside Group</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“This book is close to perfect, because of the way it combines expertise and readability. It speaks with authority and it reads beautifully. It’s one of the very few software books I’ve ever read that strikes me as indispensable. (I’d put maybe 10 books in this category, at the outside.)”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>David Gelernter, Professor of Computer Science, Yale University, and author of <span class="emphasis"><em>Mirror Worlds</em></span> and <span class="emphasis"><em>Machine Beauty</em></span></strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“A Nose Dive into the realm of patterns, a land where complex things become simple, but where simple things can also become complex. I can think of no better tour guides than Eric and Elisabeth.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Miko Matsumura, Industry Analyst, The Middleware Company Former Chief Java Evangelist, Sun Microsystems</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“I laughed, I cried, it moved me.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Daniel Steinberg, Editor-in-Chief, java.net</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“My first reaction was to roll on the floor laughing. After I picked myself up, I realized that not only is the book technically accurate, it is the easiest-to-understand introduction to design patterns that I have seen.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Dr. Timothy A. Budd, Associate Professor of Computer Science at Oregon State University and author of more than a dozen books, including <span class="emphasis"><em>C++ for Java Programmers</em></span></strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“Jerry Rice runs patterns better than any receiver in the NFL, but Eric and Elisabeth have out run him. Seriously...this is one of the funniest and smartest books on software design I’ve ever read.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Aaron LaBerge, SVP Technology &amp; Product Development, ESPN</strong></span></span></div></div></blockquote></div></section></body><body><section class="preface" epub:type="preface" id="part0003_more_praise_for_head_first_design_patter"><div class="titlepage"><div><div><h2 class="title">More Praise for <span class="emphasis"><em>Head First Design Patterns</em></span></h2></div></div></div><div class="blockquote"><blockquote class="blockquote"><div>“Great code design is, first and foremost, great information design. A code designer is teaching a computer how to do something, and it is no surprise that a great teacher of computers should turn out to be a great teacher of programmers. This book’s admirable clarity, humor, and substantial doses of clever make it the sort of book that helps even non-programmers think well about problem-solving.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Cory Doctorow, co-editor of Boing Boing and author of <span class="emphasis"><em>Down and Out in the Magic Kingdom</em></span> and <span class="emphasis"><em>Someone Comes to Town, Someone Leaves Town</em></span></strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“There’s an old saying in the computer and videogame business — well, it can’t be that old because the discipline is not all that old — and it goes something like this: Design is Life. What’s particularly curious about this phrase is that even today almost no one who works at the craft of creating electronic games can agree on what it means to ‘design’ a game. Is the designer a software engineer? An art director? A storyteller? An architect or a builder? A pitch person or a visionary? Can an individual indeed be in part all of these? And most importantly, who the %$!#&amp;* cares?</div><div>It has been said that the ‘designed by’ credit in interactive entertainment is akin to the ‘directed by’ credit in filmmaking, which in fact allows it to share DNA with perhaps the single most controversial, overstated, and too often entirely lacking in humility credit grab ever propagated on commercial art. Good company, eh? Yet if Design is Life, then perhaps it is time we spent some quality cycles thinking about what it is.</div><div>Eric Freeman and Elisabeth Robson have intrepidly volunteered to look behind the code curtain for us in <span class="emphasis"><em>Head First Design Patterns</em></span>. I’m not sure either of them cares all that much about the PlayStation or X-Box, nor should they. Yet they do address the notion of design at a significantly honest level such that anyone looking for ego reinforcement of his or her own brilliant auteurship is best advised not to go digging here where truth is stunningly revealed. Sophists and circus barkers need not apply. Next-generation literati, please come equipped with a pencil.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Ken Goldstein, Executive Vice President &amp; Managing Director, Disney Online</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“Just the right tone for the geeked-out, casual-cool guru coder in all of us. The right reference for practical development strategies — gets my brain going without having to slog through a bunch of tired, stale professor-speak.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Travis Kalanick, CEO and cofounder of Uber and Member of the MIT TR100</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“This book combines good humor, great examples, and in-depth knowledge of Design Patterns in such a way that makes learning fun. Being in the entertainment technology industry, I am intrigued by the Hollywood Principle and the home theater Facade Pattern, to name a few. The understanding of Design Patterns not only helps us create reusable and maintainable quality software, but also helps sharpen our problem-solving skills across all problem domains. This book is a must-read for all computer professionals and students.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Newton Lee, Founder and Editor-in-Chief, Association for Computing Machinery’s (ACM) Computers in Entertainment (acmcie.org)</strong></span></span></div></div></blockquote></div></section></body><body><section class="preface" epub:type="preface" id="part0004_praise_for_other_books_by_eric_freeman_a"><div class="titlepage"><div><div><h2 class="title">Praise for other books by Eric Freeman and Elisabeth Robson</h2></div></div></div><div class="blockquote"><blockquote class="blockquote"><div>“I literally love this book. In fact, I kissed this book in front of my wife.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Satish Kumar</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“<span class="emphasis"><em>Head First HTML and CSS</em></span> is a thoroughly modern introduction to forward-looking practices in web page markup and presentation. It correctly anticipates readers’ puzzlements and handles them just in time. The highly graphic and incremental approach precisely mimics the best way to learn this stuff: make a small change and see it in the browser to understand what each new item means.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Danny Goodman, author of <span class="emphasis"><em>Dynamic HTML: The Definitive Guide</em></span></strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“The Web would be a much better place if every HTML author started off by reading this book.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>L. David Baron, Technical Lead, Layout &amp; CSS, Mozilla Corporation <span class="emphasis"><em><a class="ulink" href="http://dbaron.org/" target="_top">http://dbaron.org/</a></em></span></strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“My wife stole the book. She’s never done any web design, so she needed a book like <span class="emphasis"><em>Head First HTML and CSS</em></span> to take her from beginning to end. She now has a list of websites she wants to build — for our son’s class, our family...If I’m lucky, I’ll get the book back when she’s done.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>David Kaminsky, Master Inventor, IBM</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“This book takes you behind the scenes of JavaScript and leaves you with a deep understanding of how this remarkable programming language works.”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Chris Fuselier, Engineering Consultant</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“I wish I’d had <span class="emphasis"><em>Head First JavaScript Programming</em></span> when I was starting out!”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Chris Fuselier, Engineering Consultant</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“The <span class="emphasis"><em>Head First</em></span> series utilizes elements of modern learning theory, including constructivism, to bring readers up to speed quickly. The authors have proven with this book that expert-level content can be taught quickly and efficiently. Make no mistake here, this is a serious JavaScript book, and yet, fun reading!”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Frank Moore, Web designer and developer</strong></span></span></div></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div>“Looking for a book that will keep you interested (and laughing) but teach you some serious programming skills? <span class="emphasis"><em>Head First JavaScript Programming</em></span> is it!”</div><div class="attribution"><div> — <span class="attribution"><span class="strong"><strong>Tim Williams, software entrepreneur</strong></span></span></div></div></blockquote></div><p><span class="strong"><strong>Other O’Reilly books by Eric Freeman and Elisabeth Robson</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Head First JavaScript Programming</li><li class="listitem" style="list-style-type: none">Head First HTML and CSS</li><li class="listitem" style="list-style-type: none">Head First HTML5 Programming</li></ul></div><p><span class="strong"><strong>Other related books from O’Reilly</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Head First Java</li><li class="listitem" style="list-style-type: none">Head First EJB</li><li class="listitem" style="list-style-type: none">Head First Servlets &amp; JSP</li><li class="listitem" style="list-style-type: none">Learning Java</li><li class="listitem" style="list-style-type: none">Java in a Nutshell</li><li class="listitem" style="list-style-type: none">Java Enterprise in a Nutshell</li><li class="listitem" style="list-style-type: none">Java Examples in a Nutshell</li><li class="listitem" style="list-style-type: none">Java Cookbook</li><li class="listitem" style="list-style-type: none">J2EE Design Patterns</li></ul></div></section></body><body><section class="preface" epub:type="preface" id="part0005_authors_of_head_first_design_patterns"><div class="titlepage"><div><div><h2 class="title">Authors of Head First Design Patterns</h2></div></div></div><div class="informalfigure"><a id="part0005_med_id00002a"></a><div class="mediaobject"><a id="part0005_med_id00002"></a><img alt="image with no caption" hisrc="figs/web/viiifig01.png.jpg" src="../Images/image00488.jpeg"/></div></div><p><span class="strong"><strong>Eric</strong></span> is described by Head First series co-creator Kathy Sierra as “one of those rare individuals fluent in the language, practice, and culture of multiple domains from hipster hacker, corporate VP, engineer, think tank.”</p><p>Professionally, Eric recently ended nearly a decade as a media company executive — having held the position of CTO of Disney Online &amp; Disney.com at The Walt Disney Company. Eric is now devoting his time to WickedlySmart, a startup he co-created with Elisabeth.</p><p>By training, Eric is a computer scientist, having studied with industry luminary David Gelernter during his Ph.D. work at Yale University. His dissertation is credited as the seminal work in alternatives to the desktop metaphor, and also as the first implementation of activity streams, a concept he and Dr. Gelernter developed.</p><p>In his spare time, Eric is deeply involved with music; you’ll find Eric’s latest project, a collaboration with ambient music pioneer Steve Roach, available on the iPhone app store under the name Immersion Station.</p><p>Eric lives with his wife and young daughter in Austin, Texas. His daughter is a frequent vistor to Eric’s studio, where she loves to turn the knobs of his synths and audio effects.</p><p>Write to Eric at <code class="literal">eric@wickedlysmart.com</code> or visit his site at <code class="literal">ericfreeman.com</code>.</p><div class="informalfigure"><a id="part0005_med_id00003a"></a><div class="mediaobject"><a id="part0005_med_id00003"></a><img alt="image with no caption" hisrc="figs/web/viiifig02.png.jpg" src="../Images/image00489.jpeg"/></div></div><p><span class="strong"><strong>Elisabeth</strong></span> is a software engineer, writer, and trainer. She has been passionate about technology since her days as a student at Yale University, where she earned a Masters of Science in Computer Science and designed a concurrent, visual programming language and software architecture.</p><p>Elisabeth’s been involved with the Internet since the early days; she co-created the award-winning web site, The Ada Project, one of the first web sites designed to help women in computer science find career and mentorship information online.</p><p>She’s currently co-founder of WickedlySmart, an online education experience centered on web technologies, where she creates books, articles, videos, and more. Previously, as Director of Special Projects at O’Reilly Media, Elisabeth produced in-person workshops and online courses on a variety of technical topics and developed her passion for creating learning experiences to help people understand technology. Prior to her work with O’Reilly, Elisabeth spent time spreading fairy dust at The Walt Disney Company, where she led research and development efforts in digital media.</p><p>When not in front of her computer, you’ll find Elisabeth hiking, cycling, or kayaking in the great outdoors, with her camera nearby, or cooking vegetarian meals.</p><p>You can send her email at <code class="literal">beth@wickedlysmart.com</code> or visit her blog at <code class="literal">elisabethrobson.com</code>.</p></section></body><body><section class="preface" epub:type="preface" id="part0006_creators_of_the_head_first_series_left_p"><div class="titlepage"><div><div><h2 class="title">Creators of the Head First series (and co-conspirators on this book)</h2></div></div></div><div class="informalfigure"><a id="part0006_med_id00004a"></a><div class="mediaobject"><a id="part0006_med_id00004"></a><img alt="image with no caption" hisrc="figs/web/0ixfig01.png.jpg" src="../Images/image00490.jpeg"/></div></div><p><span class="strong"><strong>Kathy</strong></span> has been interested in learning theory since her days as a game designer (she wrote games for Virgin, MGM, and Amblin’). She developed much of the Head First format while teaching New Media Authoring for UCLA Extension’s Entertainment Studies program. More recently, she’s been a master trainer for Sun Microsystems, teaching Sun’s Java instructors how to teach the latest Java technologies, and developing several of Sun’s certification exams. Together with Bert Bates, she has been actively using the Head First concepts to teach throusands of developers. Kathy is the founder of javaranch.com, which won a 2003 and 2004 Software Development magazine Jolt Cola Productivity Award. You might catch her teaching Java on the Java Jam Geek Cruise (geekcruises.com).</p><p>Likes: running, skiing, skateboarding, playing with her Icelandic horses, and weird science. Dislikes: entropy.</p><p>You can find her on javaranch, or occasionally blogging at <code class="literal">seriouspony.com</code>. Write to her at <code class="literal">kathy@wickedlysmart.com</code>.</p><p><span class="strong"><strong>Bert</strong></span> is a long-time software developer and architect, but a decade-long stint in artificial intelligence drove his interest in learning theory and technology-based training. He’s been helping clients become better programmers ever since. Recently, he’s been heading up the development team for several of Sun’s Java Certification exams.</p><p>He spent the first decade of his software career travelling the world to help broadcast clients like Radio New Zealand, the Weather Channel, and the Arts &amp; Entertainment Network (A &amp; E). One of his all-time favorite projects was building a full rail system simulation for Union Pacific Railroad.</p><p>Bert is a long-time, hopelessly addicted <span class="emphasis"><em>go</em></span> player, and has been working on a <span class="emphasis"><em>go</em></span> program for way too long. He’s a fair guitar player and is now trying his hand at banjo.</p><p>Look for him on javaranch, on the IGS go server, or you can write to him at <code class="literal">terrapin@wickedlysmart.com</code>.</p></section></body><body><section class="preface" epub:type="preface" id="part0007_how_to_use_this_book_intro"><div class="titlepage" id="part0007_aid-6LJU2"><div><div><h2 class="title">How to Use This Book: Intro</h2></div></div></div><div class="informalfigure"><a id="part0007_med_id00005a"></a><div class="mediaobject"><a id="part0007_med_id00005"></a><img alt="image with no caption" hisrc="figs/web/xxvfig01.png.jpg" src="../Images/image00491.jpeg"/><div class="caption"><p>In this section, we answer the burning question: “So, why DID they put that in a design patterns book?”</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_who_is_this_book_forquestion_mark" style="clear: both">Who is this book for?</h2></div></div></div><p>If you can answer “yes” to all of these:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Do you know <span class="strong"><strong>Java</strong></span>? (You don’t need to be a guru.)<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0007_pref06note01"></a>Note</h3><p>You’ll probably be okay if you know C# instead.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none">② Do you want to <span class="strong"><strong>learn</strong></span>, <span class="strong"><strong>understand</strong></span>, <span class="strong"><strong>remember</strong></span>, and <span class="bolditalic">apply</span> design patterns, including the OO design principles upon which design patterns are based?</li><li class="listitem" style="list-style-type: none">③ Do you prefer <span class="strong"><strong>stimulating dinner party conversation</strong></span> to dry, dull, academic lectures?</li></ul></div><p>this book is for you.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0007_who_should_probably_back_away_from_this">Who should probably back away from this book?</h3></div></div></div><p>If you can answer “yes” to any one of these:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Are you completely new to Java?</strong></span><br/>(You don’t need to be advanced, and even if you don’t know Java, but you know C#, you’ll probably understand at least 80% of the code examples. You also might be okay with just a C++ background.)</li><li class="listitem" style="list-style-type: none">② Are you a kick-butt OO designer/developer looking for a <span class="bolditalic">reference</span> <span class="strong"><strong>book</strong></span>?</li><li class="listitem" style="list-style-type: none">③ Are you an architect looking for <span class="bolditalic">enterprise</span> design patterns?</li><li class="listitem" style="list-style-type: none">④ Are you <span class="strong"><strong>afraid to try something different</strong></span>? Would you rather have a root canal than mix stripes with plaid? Do you believe that a technical book can’t be serious if Java components are anthropomorphized?</li></ul></div><p>this book is not for you.</p><div class="informalfigure"><a id="part0007_med_id00006a"></a><div class="mediaobject"><a id="part0007_med_id00006"></a><img alt="image with no caption" hisrc="figs/web/xxvifig01.png.jpg" src="../Images/image00492.jpeg"/><div class="caption"><p>[note from marketing: this book is for anyone with a credit card.]</p></div></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_we_know_what_youapostrophere_thinkingdot" style="clear: both">We know what you’re thinking.</h2></div></div></div><p>“How can this be a serious programming book?”</p><p>“What’s with all the graphics?”</p><p>“Can I actually learn it this way?”</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_and_we_know_what_your_brain_is_thinkingd" style="clear: both">And we know what your brain is thinking.</h2></div></div></div><p>Your brain craves novelty. It’s always searching, scanning, <span class="emphasis"><em>waiting</em></span> for something unusual. It was built that way, and it helps you stay alive.</p><p>Today, you’re less likely to be a tiger snack. But your brain’s still looking. You just never know.</p><p>So what does your brain do with all the routine, ordinary, normal things you encounter? Everything it <span class="emphasis"><em>can</em></span> to stop them from interfering with the brain’s <span class="emphasis"><em>real</em></span> job — recording things that matter. It doesn’t bother saving the boring things; they never make it past the “this is obviously not important” filter.</p><p>How does your brain <span class="emphasis"><em>know</em></span> what’s important? Suppose you’re out for a day hike and a tiger jumps in front of you, what happens inside your head and body?</p><p>Neurons fire. Emotions crank up. <span class="emphasis"><em>Chemicals surge</em></span>.</p><p>And that’s how your brain knows...</p><div class="informalfigure"><a id="part0007_med_id00007a"></a><div class="mediaobject"><a id="part0007_med_id00007"></a><img alt="image with no caption" hisrc="figs/web/xxviifig01.png.jpg" src="../Images/image00493.jpeg"/></div></div><p><span class="strong"><strong>This must be important! Don’t forget it!</strong></span></p><p>But imagine you’re at home, or in a library. It’s a safe, warm, tiger-free zone. You’re studying. Getting ready for an exam. Or trying to learn some tough technical topic your boss thinks will take a week, ten days at the most.</p><p>Just one problem. Your brain’s trying to do you a big favor. It’s trying to make sure that this <span class="emphasis"><em>obviously</em></span> non-important content doesn’t clutter up scarce resources. Resources that are better spent storing the really big things. Like tigers. Like the danger of fire. Like how you should never again snowboard in shorts.</p><p>And there’s no simple way to tell your brain, “Hey brain, thank you very much, but no matter how dull this book is, and how little I’m registering on the emotional Richter scale right now, I really do want you to keep this stuff around.”</p><div class="informalfigure"><a id="part0007_med_id00008a"></a><div class="mediaobject"><a id="part0007_med_id00008"></a><img alt="image with no caption" hisrc="figs/web/xxviifig02.png.jpg" src="../Images/image00494.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0007_we_think_of_a_quotation_markhead_firstqu"></a><h3 class="title">We think of a “Head First” reader as a <span class="underline">learner</span></h3><p><a class="indexterm" id="part0007_iddle1726"></a><span class="strong"><strong>So what does it take to <span class="emphasis"><em>learn</em></span> something? First, you have to <span class="emphasis"><em>get</em></span> it, then make sure you don’t <span class="emphasis"><em>forget</em></span> it. It’s not about pushing facts into your head. Based on the latest research in cognitive science, neurobiology, and educational psychology, <span class="emphasis"><em>learning</em></span> takes a lot more than text on a page. We know what turns your brain on.</strong></span></p><p><span class="strong"><strong>Some of the Head First learning principles:</strong></span></p><p><span class="title"><strong><span class="strong"><strong>Make it visual.</strong></span></strong></span> Images are far more memorable than words alone, and make learning much more effective (up to 89% improvement in recall and transfer studies). It also makes things more understandable. <span class="strong"><strong>Put the words within or near the graphics</strong></span> they relate to, rather than on the bottom or on another page, and learners will be up to <span class="emphasis"><em>twice</em></span> as likely to solve problems related to the content.</p><div class="informalfigure"><a id="part0007_med_id00009a"></a><div class="mediaobject"><a id="part0007_med_id00009"></a><img alt="image with no caption" hisrc="figs/web/xxviiifig02.png.jpg" src="../Images/image00495.jpeg"/></div></div><p><span class="title"><strong><span class="strong"><strong>Use a conversational and personalized style.</strong></span></strong></span> In recent studies, students performed up to 40% better on post-learning tests if the content spoke directly to the reader, using a first-person, conversational style rather than taking a formal tone. Tell stories instead of lecturing. Use casual language. Don’t take yourself too seriously. Which would <span class="emphasis"><em>you</em></span> pay more attention to: a stimulating dinner party companion, or a lecture?</p><p><span class="title"><strong><span class="strong"><strong>Get the learner to think more deeply.</strong></span></strong></span> In other words, unless you actively flex your neurons, nothing much happens in your head. A reader has to be motivated, engaged, curious, and inspired to solve problems, draw conclusions, and generate new knowledge. And for that, you need challenges, exercises, and thought-provoking questions, and activities that involve both sides of the brain, and multiple senses.</p><div class="informalfigure"><a id="part0007_med_id00010a"></a><div class="mediaobject"><a id="part0007_med_id00010"></a><img alt="image with no caption" hisrc="figs/web/xxviiifig01.png.jpg" src="../Images/image00496.jpeg"/></div></div><p><span class="title"><strong><span class="strong"><strong>Get — and keep — the reader’s attention.</strong></span></strong></span> We’ve all had the “I really want to learn this but I can’t stay awake past page one” experience. Your brain pays attention to things that are out of the ordinary, interesting, strange, eye-catching, unexpected. Learning a new, tough, technical topic doesn’t have to be boring. Your brain will learn much more quickly if it’s not.</p><div class="informalfigure"><a id="part0007_med_id00011a"></a><div class="mediaobject"><a id="part0007_med_id00011"></a><img alt="image with no caption" hisrc="figs/web/xxviiifig03.png.jpg" src="../Images/image00497.jpeg"/></div></div><p><span class="title"><strong><span class="strong"><strong>Touch their emotions.</strong></span></strong></span> We now know that your ability to remember something is largely dependent on its emotional content. You remember what you <span class="emphasis"><em>care</em></span> about. You remember when you <span class="emphasis"><em>feel</em></span> something. No, we’re not talking heart-wrenching stories about a boy and his dog. We’re talking emotions like surprise, curiosity, fun, “what the...?” , and the feeling of “I Rule!” that comes when you solve a puzzle, learn something everybody else thinks is hard, or realize you know something that “I’m more technical than thou” Bob from engineering <span class="emphasis"><em>doesn’t</em></span>.</p><div class="informalfigure"><a id="part0007_med_id00012a"></a><div class="mediaobject"><a id="part0007_med_id00012"></a><img alt="image with no caption" hisrc="figs/web/xxviiifig04.png.jpg" src="../Images/image00498.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_metacognition_thinking_about_thinking" style="clear: both">Metacognition: thinking about thinking</h2></div></div></div><p>If you really want to learn, and you want to learn more quickly and more deeply, pay attention to how you pay attention. Think about how you think. Learn how you learn.</p><p>Most of us did not take courses on metacognition or learning theory when we were growing up. We were <span class="emphasis"><em>expected</em></span> to learn, but rarely <span class="emphasis"><em>taught</em></span> to learn.</p><p>But we assume that if you’re holding this book, you really want to learn design patterns. And you probably don’t want to spend a lot of time. And you want to <span class="emphasis"><em>remember</em></span> what you read, and be able to apply it. And for that, you’ve got to <span class="emphasis"><em>understand</em></span> it. To get the most from this book, or <span class="emphasis"><em>any</em></span> book or learning experience, take responsibility for your brain. Your brain on <span class="emphasis"><em>this</em></span> content.</p><p>The trick is to get your brain to see the new material you’re learning as Really Important. Crucial to your well-being. As important as a tiger. Otherwise, you’re in for a constant battle, with your brain doing its best to keep the new content from sticking.</p><div class="informalfigure"><a id="part0007_med_id00013a"></a><div class="mediaobject"><a id="part0007_med_id00013"></a><img alt="image with no caption" hisrc="figs/web/xxixfig01.png.jpg" src="../Images/image00499.jpeg"/></div></div><p><span class="strong"><strong>So how DO you get your brain to think Design Patterns are as important as a tiger?</strong></span></p><p>There’s the slow, tedious way, or the faster, more effective way. The slow way is about sheer repetition. You obviously know that you <span class="emphasis"><em>are</em></span> able to learn and remember even the dullest of topics, if you keep pounding on the same thing. With enough repetition, your brain says, “This doesn’t <span class="emphasis"><em>feel</em></span> important to him, but he keeps looking at the same thing <span class="emphasis"><em>over</em></span> and <span class="emphasis"><em>over</em></span> and <span class="emphasis"><em>over</em></span>, so I suppose it must be.”</p><p>The faster way is to do <span class="bolditalic">anything that increases brain activity</span>, especially different <span class="emphasis"><em>types</em></span> of brain activity. The things on the previous page are a big part of the solution, and they’re all things that have been proven to help your brain work in your favor. For example, studies show that putting words <span class="emphasis"><em>within</em></span> the pictures they describe (as opposed to somewhere else in the page, like a caption or in the body text) causes your brain to try to makes sense of how the words and picture relate, and this causes more neurons to fire. More neurons firing = more chances for your brain to <span class="emphasis"><em>get</em></span> that this is something worth paying attention to, and possibly recording.</p><p>A conversational style helps because people tend to pay more attention when they perceive that they’re in a conversation, since they’re expected to follow along and hold up their end. The amazing thing is, your brain doesn’t necessarily <span class="emphasis"><em>care</em></span> that the “conversation” is between you and a book! On the other hand, if the writing style is formal and dry, your brain perceives it the same way you experience being lectured to while sitting in a roomful of passive attendees. No need to stay awake.</p><p>But pictures and conversational style are just the beginning.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_hereapostrophes_what_we_did" style="clear: both">Here’s what WE did</h2></div></div></div><p>We used <span class="bolditalic">pictures</span>, because your brain is tuned for visuals, not text. As far as your brain’s concerned, a picture really is worth 1,024 words. And when text and pictures work together, we embedded the text in the pictures because your brain works more effectively when the text is within the thing the text refers to, as opposed to in a caption or buried in the text somewhere.</p><div class="informalfigure"><a id="part0007_med_id00014a"></a><div class="mediaobject"><a id="part0007_med_id00014"></a><img alt="image with no caption" hisrc="figs/web/xxxfig01.png.jpg" src="../Images/image00500.jpeg"/></div></div><p>We used <span class="bolditalic">redundancy</span>, saying the same thing in <span class="emphasis"><em>different</em></span> ways and with different media types, and <span class="emphasis"><em>multiple senses</em></span>, to increase the chance that the content gets coded into more than one area of your brain.</p><p>We used concepts and pictures in <span class="bolditalic">unexpected</span> ways because your brain is tuned for novelty, and we used pictures and ideas with at least <span class="emphasis"><em>some</em></span> <span class="bolditalic">emotional</span> <span class="emphasis"><em>content</em></span>, because your brain is tuned to pay attention to the biochemistry of emotions. That which causes you to <span class="emphasis"><em>feel</em></span> something is more likely to be remembered, even if that feeling is nothing more than a little <span class="bolditalic">humor</span>, <span class="bolditalic">surprise</span>, or <span class="bolditalic">interest</span>.</p><p>We used a personalized, <span class="bolditalic">conversational style</span>, because your brain is tuned to pay more attention when it believes you’re in a conversation than if it thinks you’re passively listening to a presentation. Your brain does this even when you’re <span class="emphasis"><em>reading</em></span>.</p><div class="informalfigure"><a id="part0007_med_id00015a"></a><div class="mediaobject"><a id="part0007_med_id00015"></a><img alt="image with no caption" hisrc="figs/web/xxxfig02.png.jpg" src="../Images/image00501.jpeg"/></div></div><p>We included more than 40 <span class="bolditalic">activities</span>, because your brain is tuned to learn and remember more when you <span class="bolditalic">do</span> things than when you read about things. And we made the exercises challenging-yet-do-able, because that’s what most <span class="emphasis"><em>people</em></span> prefer.</p><p>We used <span class="bolditalic">multiple learning styles</span>, because <span class="emphasis"><em>you</em></span> might prefer step-by-step procedures, while someone else wants to understand the big picture first, while someone else just wants to see a code example. But regardless of your own learning preference, <span class="emphasis"><em>everyone</em></span> benefits from seeing the same content represented in multiple ways.</p><div class="informalfigure"><a id="part0007_med_id00016a"></a><div class="mediaobject"><a id="part0007_med_id00016"></a><img alt="image with no caption" hisrc="figs/web/xxxfig03.png.jpg" src="../Images/image00502.jpeg"/></div></div><p>We include content for <span class="bolditalic">both sides of your brain</span>, because the more of your brain you engage, the more likely you are to learn and remember, and the longer you can stay focused. Since working one side of the brain often means giving the other side a chance to rest, you can be more productive at learning for a longer period of time.</p><div class="informalfigure"><a id="part0007_med_id00017a"></a><div class="mediaobject"><a id="part0007_med_id00017"></a><img alt="image with no caption" hisrc="figs/web/xxxfig04.png.jpg" src="../Images/image00503.jpeg"/></div></div><p>And we included <span class="bolditalic">stories</span> and exercises that present <span class="bolditalic">more than one point of view</span>, because your brain is tuned to learn more deeply when it’s forced to make evaluations and judgements.</p><p>We included <span class="bolditalic">challenges</span>, with exercises, and by asking <span class="bolditalic">questions</span> that don’t always have a straight answer, because your brain is tuned to learn and remember when it has to <span class="emphasis"><em>work</em></span> at something. Think about it — you can’t get your <span class="emphasis"><em>body</em></span> in shape just by <span class="emphasis"><em>watching</em></span> people at the gym. But we did our best to make sure that when you’re working hard, it’s on the <span class="emphasis"><em>right</em></span> things. That <span class="bolditalic">you’re not spending one extra dendrite</span> processing a hard-to-understand example, or parsing difficult, jargon-laden, or overly terse text.</p><p>We used <span class="bolditalic">people</span>. In stories, examples, pictures, etc., because, well, because <span class="emphasis"><em>you’re</em></span> a person. And your brain pays more attention to <span class="emphasis"><em>people</em></span> than it does to <span class="emphasis"><em>things</em></span>.</p><p>We used an <span class="bolditalic">80/20</span> approach. We assume that if you’re going for a PhD in software design, this won’t be your only book. So we don’t talk about <span class="emphasis"><em>everything</em></span>. Just the stuff you’ll actually <span class="emphasis"><em>need</em></span>.</p><div class="informalfigure"><a id="part0007_med_id00018a"></a><div class="mediaobject"><a id="part0007_med_id00018"></a><img alt="image with no caption" hisrc="figs/web/xxxfig05.png.jpg" src="../Images/image00504.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_hereapostrophes_what_you_can_do_to_bend" style="clear: both">Here’s what YOU can do to bend your brain into submission</h2></div></div></div><p>So, we did our part. The rest is up to you. These tips are a starting point; listen to your brain and figure out what works for you and what doesn’t. Try new things.</p><div class="informalfigure"><a id="part0007_med_id00019a"></a><div class="mediaobject"><a id="part0007_med_id00019"></a><img alt="image with no caption" hisrc="figs/web/common.png.jpg" src="../Images/image00505.jpeg"/><div class="caption"><p>Cut this out and stick it on your refrigerator.</p></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Slow down. The more you understand, the less you have to memorize.</strong></span><br/>Don’t just <span class="emphasis"><em>read</em></span>. Stop and think. When the book asks you a question, don’t just skip to the answer. Imagine that someone really is asking the question. The more deeply you force your brain to think, the better chance you have of learning and remembering.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Do the exercises. Write your own notes.</strong></span><br/>We put them in, but if we did them for you, that would be like having someone else do your workouts for you. And don’t just <span class="emphasis"><em>look</em></span> at the exercises. <span class="strong"><strong>Use a pencil</strong></span>. There’s plenty of evidence that physical activity <span class="emphasis"><em>while</em></span> learning can increase the learning.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Read the “There Are No Dumb Questions”</strong></span><br/>That means all of them. They’re not optional side-bars — <span class="bolditalic">they’re part of the core content</span>! Don’t skip them.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Make this the last thing you read before bed. Or at least the last <span class="emphasis"><em>challenging</em></span> thing.</strong></span><br/>Part of the learning (especially the transfer to long-term memory) happens <span class="emphasis"><em>after</em></span> you put the book down. Your brain needs time on its own, to do more processing. If you put in something new during that processing-time, some of what you just learned will be lost.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ Drink water. Lots of it.</strong></span><br/>Your brain works best in a nice bath of fluid. Dehydration (which can happen before you ever feel thirsty) decreases cognitive function.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑥ Talk about it. Out loud.</strong></span><br/>Speaking activates a different part of the brain. If you’re trying to understand something, or increase your chance of remembering it later, say it out loud. Better still, try to explain it out loud to someone else. You’ll learn more quickly, and you might uncover ideas you hadn’t known were there when you were reading about it.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑦ Listen to your brain.</strong></span><br/>Pay attention to whether your brain is getting overloaded. If you find yourself starting to skim the surface or forget what you just read, it’s time for a break. Once you go past a certain point, you won’t learn faster by trying to shove more in, and you might even hurt the process.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑧ <span class="emphasis"><em>Feel</em></span> something!</strong></span><br/>Your brain needs to know that this <span class="emphasis"><em>matters</em></span>. Get involved with the stories. Make up your own captions for the photos. Groaning over a bad joke is <span class="emphasis"><em>still</em></span> better than feeling nothing at all.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑨ <span class="emphasis"><em>Design</em></span> something!</strong></span><br/>Apply this to something new you’re designing, or refactor an older project. Just do <span class="emphasis"><em>something</em></span> to get some experience beyond the exercises and activities in this book. All you need is a pencil and a problem to solve... a problem that might benefit from one or more design patterns.</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_read_me" style="clear: both">Read Me</h2></div></div></div><p>This is a learning experience, not a reference book. We deliberately stripped out everything that might get in the way of learning whatever it is we’re working on at that point in the book. And the first time through, you need to begin at the beginning, because the book makes assumptions about what you’ve already seen and learned.</p><div class="informalfigure"><a id="part0007_med_id00020a"></a><div class="mediaobject"><a id="part0007_med_id00020"></a><img alt="image with no caption" hisrc="figs/web/xxxiifig01.png.jpg" src="../Images/image00506.jpeg"/></div></div><p><span class="strong"><strong>We use simple UML-like diagrams.</strong></span></p><p>Although there’s a good chance you’ve run across UML, it’s not covered in the book, and it’s not a prerequisite for the book. If you’ve never seen UML before, don’t worry, we’ll give you a few pointers along the way. So in other words, you won’t have to worry about Design Patterns and UML at the same time. Our diagrams are “UML-<span class="emphasis"><em>like</em></span>” — while we try to be true to UML there are times we bend the rules a bit, usually for our own selfish artistic reasons.</p><p><span class="strong"><strong>We don’t cover every single Design Pattern ever created.</strong></span></p><p>There are a <span class="emphasis"><em>lot</em></span> of Design Patterns. The original foundational patterns (known as the GoF patterns), enterprise Java patterns, JSP patterns, architectural patterns, game design patterns and a lot more. But our goal was to make sure the book weighed less than the person reading it, so we don’t cover them all here. Our focus is on the core patterns that <span class="emphasis"><em>matter</em></span> from the original GoF patterns, and making sure that you really, truly, deeply understand how and when to use them. You will find a brief look at some of the other patterns (the ones you’re far less likely to use) in the appendix. In any case, once you’re done with <span class="emphasis"><em>Head First Design Patterns</em></span>, you’ll be able to pick up any pattern catalog and get up to speed quickly.</p><p><span class="strong"><strong>The activities are NOT optional.</strong></span></p><p>The exercises and activities are not add-ons; they’re part of the core content of the book. Some of them are to help with memory, some for understanding, and some to help you apply what you’ve learned. <span class="bolditalic">Don’t skip the exercises</span>. The crossword puzzles are the only things you don’t <span class="emphasis"><em>have</em></span> to do, but they’re good for giving your brain a chance to think about the words from a different context.</p><p><span class="strong"><strong>We use the word “composition” in the general OO sense, which is more flexible than the strict UML use of “composition.”</strong></span></p><p>When we say “one object is composed with another object” we mean that they are related by a HAS-A relationship. Our use reflects the traditional use of the term and is the one used in the GoF text (you’ll learn what that is later). More recently, UML has refined this term into several types of composition. If you are an UML expert, you’ll still be able to read the book and you should be able to easily map the use of composition to more refined terms as you read.</p><p><a class="indexterm" id="part0007_iddle2528"></a><span class="strong"><strong>The redundancy is intentional and important.</strong></span></p><p>One distinct difference in a Head First book is that we want you to <span class="emphasis"><em>really</em></span> get it. And we want you to finish the book remembering what you’ve learned. Most reference books don’t have retention and recall as a goal, but this book is about <span class="emphasis"><em>learning</em></span>, so you’ll see some of the same concepts come up more than once.</p><p><span class="strong"><strong>The code examples are as lean as possible.</strong></span></p><p>Our readers tell us that it’s frustrating to wade through 200 lines of code looking for the two lines they need to understand. Most examples in this book are shown within the smallest possible context, so that the part you’re trying to learn is clear and simple. Don’t expect all of the code to be robust, or even complete — the examples are written specifically for learning, and aren’t always fully-functional.</p><p>In some cases, we haven’t included all of the import statements needed, but we assume that if you’re a Java programmer, you know that <code class="literal">ArrayList</code> is in java.util, for example. If the imports were not part of the normal core JSE API, we mention it. We’ve also placed all the source code on the Web so you can download it. You’ll find it at <code class="literal">http://wickedlysmart.com/head-first-design-patterns/</code></p><p>Also, for the sake of focusing on the learning side of the code, we did not put our classes into packages (in other words, they’re all in the Java default package). We don’t recommend this in the real world, and when you download the code examples from this book, you’ll find that all classes <span class="emphasis"><em>are</em></span> in packages.</p><p><span class="strong"><strong>The Brain Power exercises don’t have answers.</strong></span></p><p>For some of them, there is no right answer, and for others, part of the learning experience of the Brain Power activities is for you to decide if and when your answers are right. In some of the Brain Power exercises you will find hints to point you in the right direction.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_tech_reviewers" style="clear: both">Tech Reviewers</h2></div></div></div><div class="informalfigure"><a id="part0007_med_id00021a"></a><div class="mediaobject"><a id="part0007_med_id00021"></a><img alt="image with no caption" hisrc="figs/web/xxxivfig01.png.jpg" src="../Images/image00507.jpeg"/></div></div><div class="informalfigure"><a id="part0007_med_id00022a"></a><div class="mediaobject"><a id="part0007_med_id00022"></a><img alt="image with no caption" hisrc="figs/web/xxxvfig01.png.jpg" src="../Images/image00508.jpeg"/><div class="caption"><p>Philippe Maquet</p></div></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="emphasis"><em>In memory of Philippe Maquet</em></span></div><div>1960 - 2004</div><div>Your amazing technical expertise, relentless enthusiasm, and deep concern for the learner will inspire us always.</div><div><span class="emphasis"><em>We will never forget you.</em></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_acknowledgments" style="clear: both">Acknowledgments</h2></div></div></div><p><span class="bolditalic">At O’Reilly:</span></p><p>Our biggest thanks to <span class="strong"><strong>Mike Loukides</strong></span> at O’Reilly, for starting it all and helping to shape the Head First concept into a series. And a big thanks to the driving force behind Head First, <span class="strong"><strong>Tim O’Reilly</strong></span>. Thanks to the clever Head First “series mom” <span class="strong"><strong>Kyle Hart</strong></span>, “In Design King” <span class="strong"><strong>Ron Bilodeau</strong></span>, rock-and-roll star <span class="strong"><strong>Ellie Volkhausen</strong></span> for her inspired cover design, <span class="strong"><strong>Melanie Yarbrough</strong></span> for shepherding production, <span class="strong"><strong>Colleen Gorman</strong></span> and <span class="strong"><strong>Rachel Monaghan</strong></span> for their hardcore copyedits, and <span class="strong"><strong>Bob Pfahler</strong></span> for a much improved index. Finally, thanks to <span class="strong"><strong>Mike Hendrickson</strong></span> and <span class="strong"><strong>Meghan Blanchette</strong></span> for championing this book and building the team.</p><p><span class="bolditalic">Our intrepid reviewers:</span></p><p>We are extremely grateful for our technical review director <span class="strong"><strong>Johannes deJong</strong></span>. You are our hero, Johannes. And we deeply appreciate the contributions of the co-manager of the <span class="strong"><strong>Javaranch</strong></span> review team, the late <span class="strong"><strong>Philippe Maquet</strong></span>. You have single-handedly brightened the lives of thousands of developers, and the impact you’ve had on their (and our) lives is forever. <span class="strong"><strong>Jef Cumps</strong></span> is scarily good at finding problems in our draft chapters, and once again made a huge difference for the book. Thanks Jef! <span class="strong"><strong>Valentin Cretazz</strong></span> (AOP guy), who has been with us from the very first Head First book, proved (as always) just how much we really need his technical expertise and insight. You rock Valentin (but lose the tie).</p><p>Two newcomers to the HF review team, <span class="strong"><strong>Barney Marispini</strong></span> and <span class="strong"><strong>Ike Van Atta</strong></span> did a kick butt job on the book — you guys gave us some <span class="emphasis"><em>really</em></span> crucial feedback. Thanks for joining the team.</p><p>We also got some excellent technical help from Javaranch moderators/gurus <span class="strong"><strong>Mark Spritzler</strong></span>, <span class="strong"><strong>Jason Menard</strong></span>, <span class="strong"><strong>Dirk Schreckmann</strong></span>, <span class="strong"><strong>Thomas Paul</strong></span>, and <span class="strong"><strong>Margarita Isaeva</strong></span>. And as always, thanks especially to the javaranch.com Trail Boss, <span class="strong"><strong>Paul Wheaton</strong></span>.</p><p>Thanks to the finalists of the Javaranch “Pick the <span class="emphasis"><em>Head First Design Patterns</em></span> Cover” contest. The winner, Si Brewster, submitted the winning essay that persuaded us to pick the woman you see on our cover. Other finalists include Andrew Esse, Gian Franco Casula, Helen Crosbie, Pho Tek, Helen Thomas, Sateesh Kommineni, and Jeff Fisher.</p><p>For the 2014 update to the book, we are so grateful to the following technical reviewers: George Hoffer, Ted Hill, Todd Bartoszkiewicz, Sylvain Tenier, Scott Davidson, Kevin Ryan, Rich Ward, Mark Francis Jaeger, Mark Masse, Glenn Ray, Bayard Fetler, Paul Higgins, Matt Carpenter, Julia Williams, Matt McCullough, and Mary Ann Belarmino.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0007_even_more_peoplethe_large_number_of_ackn" style="clear: both">Even more people<sup>[<a class="footnote" epub:type="noteref" href="#part0007_ftn.pref06fn01" id="part0007_pref06fn01">1</a>]</sup></h2></div></div></div><p><span class="bolditalic">From Eric and Elisabeth</span></p><p>Writing a Head First book is a wild ride with two amazing tour guides: <span class="strong"><strong>Kathy Sierra</strong></span> and <span class="strong"><strong>Bert Bates</strong></span>. With Kathy and Bert you throw out all book writing convention and enter a world full of storytelling, learning theory, cognitive science, and pop culture, where the reader always rules. Thanks to both of you for letting us enter your amazing world; we hope we’ve done Head First justice. Seriously, this has been amazing. Thanks for all your careful guidance, for pushing us to go forward, and most of all, for trusting us (with your baby). You’re both certainly “wickedly smart” and you’re also the hippest 29-year-olds we know. So... what’s next?</p><p>A big thank you to <span class="strong"><strong>Mike Loukides, Mike Hendrickson</strong></span>, and <span class="strong"><strong>Meghan Blanchette</strong></span>. Mike L. was with us every step of the way. Mike, your insightful feedback helped shape the book and your encouragement kept us moving ahead. Mike H., thanks for your persistence over five years in trying to get us to write a patterns book; we finally did it and we’re glad we waited for Head First. And Meg, thanks for diving into the update with us; we couldn’t have done it without you.</p><p>A very special thanks to <span class="strong"><strong>Erich Gamma</strong></span>, who went far beyond the call of duty in reviewing this book (he even took a draft with him on vacation). Erich, your interest in this book inspired us and your thorough technical review improved it immeasurably. Thanks as well to the entire <span class="strong"><strong>Gang of Four</strong></span> for their support &amp; interest, and for making a special appearance in Objectville. We are also indebted to <span class="strong"><strong>Ward Cunningham</strong></span> and the patterns community who created the Portland Pattern Repository — an indespensible resource for us in writing this book.</p><p>It takes a village to write a technical book: <span class="strong"><strong>Bill Pugh</strong></span> and <span class="strong"><strong>Ken Arnold</strong></span> gave us expert advice on Singleton. <span class="strong"><strong>Joshua Marinacci</strong></span> provided rockin’ Swing tips and advice. <span class="strong"><strong>John Brewer’s</strong></span> “Why a Duck?” paper inspired SimUDuck (and we’re glad he likes ducks too). <span class="strong"><strong>Dan Friedman</strong></span> inspired the Little Singleton example. <span class="strong"><strong>Daniel Steinberg</strong></span> acted as our “technical liason” and our emotional support network. Thanks to Apple’s <span class="strong"><strong>James Dempsey</strong></span> for allowing us to use his MVC song. And thank you to <span class="strong"><strong>Richard Warburton</strong></span> who made sure our Java 8 code updates were up to snuff for this updated edition of the book.</p><p>Last, a personal thank you to the <span class="strong"><strong>Javaranch review team</strong></span> for their top-notch reviews and warm support. There’s more of you in this book than you know.</p><p><span class="bolditalic">From Kathy and Bert</span></p><p>We’d like to thank Mike Hendrickson for finding Eric and Elisabeth... but we can’t. Because of these two, we discovered (to our horror) that we aren’t the <span class="emphasis"><em>only</em></span> ones who can do a Head First book. ; ) However, if readers want to <span class="emphasis"><em>believe</em></span> that it’s really Kathy and Bert who did the cool things in the book, well, who are <span class="emphasis"><em>we</em></span> to set them straight?</p></div><div class="footnotes" epub:type="footnotes"><br/><hr data-amznremoved-m8="true" style="width: 100; align: left;"/><div class="footnote" epub:type="footnote" id="part0007_ftn.pref06fn01"><p><sup>[<a class="para" href="#part0007_pref06fn01">1</a>] </sup>The large number of acknowledgments is because we’re testing the theory that everyone mentioned in a book acknowledgment will buy at least one copy, probably more, what with relatives and everything. If you’d like to be in the acknowledgment of our <span class="emphasis"><em>next</em></span> book, and you have a large family, write to us.</p></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0008_intro_to_design_patterns_welcome_to_desi"><div class="titlepage" id="part0008_aid-7K4G2"><div><div><h2 class="title">Chapter 1. Intro to Design Patterns: Welcome to Design Patterns</h2></div></div></div><div class="informalfigure"><a id="part0008_med_id00023a"></a><div class="mediaobject"><a id="part0008_med_id00023"></a><img alt="image with no caption" hisrc="figs/web/001fig01.png.jpg" src="../Images/image00509.jpeg"/></div></div><p><span class="strong"><strong>Someone has already solved your problems.</strong></span> In this chapter, you’ll learn why (and how) you can exploit the wisdom and lessons learned by other developers who’ve been down the same design problem road and survived the trip. Before we’re done, we’ll look at the use and benefits of design patterns, look at some key OO design principles, and walk through an example of how one pattern works. The best way to use patterns is to <span class="emphasis"><em>load your brain</em></span> with them and then <span class="emphasis"><em>recognize places</em></span> in your designs and existing applications where you can <span class="emphasis"><em>apply them</em></span>. Instead of <span class="emphasis"><em>code</em></span> reuse, with patterns you get <span class="emphasis"><em>experience</em></span> reuse.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_it_started_with_a_simple_simuduck_app" style="clear: both">It started with a simple SimUDuck app</h2></div></div></div><p>Joe works for a company that makes a highly successful duck pond simulation game, <span class="emphasis"><em>SimUDuck</em></span>. The game can show a large variety of duck species swimming and making quacking sounds. The initial designers of the system used standard OO techniques and created one Duck superclass from which all other duck types inherit.</p><div class="informalfigure"><a id="part0008_med_id00024a"></a><div class="mediaobject"><a id="part0008_med_id00024"></a><img alt="image with no caption" hisrc="figs/web/002fig01.png.jpg" src="../Images/image00510.jpeg"/></div></div><p>In the last year, the company has been under increasing pressure from competitors. After a week long off-site brainstorming session over golf, the company executives think it’s time for a big innovation. They need something <span class="emphasis"><em>really</em></span> impressive to show at the upcoming shareholders meeting in Maui <span class="emphasis"><em>next week</em></span>.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_but_now_we_need_the_ducks_to_fly" style="clear: both">But now we need the ducks to FLY</h2></div></div></div><p>The executives decided that flying ducks is just what the simulator needs to blow away the other duck sim competitors. And of course Joe’s manager told them it’ll be no problem for Joe to just whip something up in a week. “After all,” said Joe’s boss, “he’s an OO programmer... <span class="emphasis"><em>how hard can it be?”</em></span></p><div class="informalfigure"><a id="part0008_med_id00025a"></a><div class="mediaobject"><a id="part0008_med_id00025"></a><img alt="image with no caption" hisrc="figs/web/003fig03.png.jpg" src="../Images/image00511.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00026a"></a><div class="mediaobject"><a id="part0008_med_id00026"></a><img alt="image with no caption" hisrc="figs/web/003fig01.png.jpg" src="../Images/image00512.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00027a"></a><div class="mediaobject"><a id="part0008_med_id00027"></a><img alt="image with no caption" hisrc="figs/web/003fig02.png.jpg" src="../Images/image00513.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_but_something_went_horribly_wronghellip" style="clear: both">But something went horribly wrong...</h2></div></div></div><div class="informalfigure"><a id="part0008_med_id00028a"></a><div class="mediaobject"><a id="part0008_med_id00028"></a><img alt="image with no caption" hisrc="figs/web/004fig01.png.jpg" src="../Images/image00514.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00029a"></a><div class="mediaobject"><a id="part0008_med_id00029"></a><img alt="image with no caption" hisrc="figs/web/004fig02.png.jpg" src="../Images/image00515.jpeg"/></div></div><p><a class="indexterm" id="part0008_iddle1784"></a><a class="indexterm" id="part0008_iddle1785"></a><a class="indexterm" id="part0008_iddle1897"></a><a class="indexterm" id="part0008_iddle2237"></a><a class="indexterm" id="part0008_iddle2435"></a><a class="indexterm" id="part0008_iddle2444"></a><span class="strong"><strong>What happened?</strong></span></p><p>Joe failed to notice that not <span class="emphasis"><em>all</em></span> subclasses of Duck should <span class="emphasis"><em>fly</em></span>. When Joe added new behavior to the Duck superclass, he was also adding behavior that was <span class="emphasis"><em>not</em></span> appropriate for some Duck subclasses. He now has flying inanimate objects in the SimUDuck program.</p><p><span class="emphasis"><em>A localized update to the code caused a nonlocal side effect (flying rubber ducks)!</em></span></p><div class="informalfigure"><a id="part0008_med_id00030a"></a><div class="mediaobject"><a id="part0008_med_id00030"></a><img alt="image with no caption" hisrc="figs/web/004fig03.png.jpg" src="../Images/image00516.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00031a"></a><div class="mediaobject"><a id="part0008_med_id00031"></a><img alt="image with no caption" hisrc="figs/web/004fig04.png.jpg" src="../Images/image00517.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>What Joe thought was a great use of inheritance for the purpose of <span class="underline">reuse</span> hasn’t turned out so well when it comes to <span class="underline">maintenance</span>.</strong></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_joe_thinks_about_inheritancehellip" style="clear: both">Joe thinks about inheritance...</h2></div></div></div><div class="informalfigure"><a id="part0008_med_id00032a"></a><div class="mediaobject"><a id="part0008_med_id00032"></a><img alt="image with no caption" hisrc="figs/web/005fig01.png.jpg" src="../Images/image00518.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_sharpen_your_pencil"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0008_iddle1557"></a><a class="indexterm" id="part0008_iddle1779"></a><a class="indexterm" id="part0008_iddle1781"></a><a class="indexterm" id="part0008_iddle2302"></a>Which of the following are disadvantages of using <span class="emphasis"><em>inheritance</em></span> to provide Duck behavior? (Choose all that apply.)</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00001"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Code is duplicated across subclasses.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00002"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Runtime behavior changes are difficult.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00003"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We can’t make ducks dance.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00004"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Hard to gain knowledge of all duck behaviors.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00005"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Ducks can’t fly and quack at the same time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00006"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>Changes can unintentionally affect other ducks.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_how_about_an_interfacequestion_mark" style="clear: both">How about an interface?</h2></div></div></div><p>Joe realized that inheritance probably wasn’t the answer, because he just got a memo that says that the executives now want to update the product every six months (in ways they haven’t yet decided on). Joe knows the spec will keep changing and he’ll be forced to look at and possibly override fly() and quack() for every new Duck subclass that’s ever added to the program... <span class="emphasis"><em>forever.</em></span></p><p>So, he needs a cleaner way to have only <span class="emphasis"><em>some</em></span> (but not <span class="emphasis"><em>all</em></span>) of the duck types fly or quack.</p><div class="informalfigure"><a id="part0008_med_id00033a"></a><div class="mediaobject"><a id="part0008_med_id00033"></a><img alt="image with no caption" hisrc="figs/web/006fig01.png.jpg" src="../Images/image00520.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00034a"></a><div class="mediaobject"><a id="part0008_med_id00034"></a><img alt="image with no caption" hisrc="figs/web/006fig02.png.jpg" src="../Images/image00521.jpeg"/></div></div><p><span class="strong"><strong>What do YOU think about this design?</strong></span></p><div class="informalfigure"><a id="part0008_med_id00035a"></a><div class="mediaobject"><a id="part0008_med_id00035"></a><img alt="image with no caption" hisrc="figs/web/007fig01.png.jpg" src="../Images/image00522.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_what_would_you_do_if_you_were_joequestio" style="clear: both">What would you do if you were Joe?</h2></div></div></div><p>We know that not <span class="emphasis"><em>all</em></span> of the subclasses should have flying or quacking behavior, so inheritance isn’t the right answer. But while having the subclasses implement Flyable and/or Quackable solves <span class="emphasis"><em>part</em></span> of the problem (no inappropriately flying rubber ducks), it completely destroys code reuse for those behaviors, so it just creates a <span class="emphasis"><em>different</em></span> maintenance nightmare. And of course there might be more than one kind of flying behavior even among the ducks that <span class="emphasis"><em>do</em></span> fly...</p><p>At this point you might be waiting for a Design Pattern to come riding in on a white horse and save the day. But what fun would that be? No, we’re going to figure out a solution the old-fashioned way — <span class="emphasis"><em>by applying good OO software design principles.</em></span></p><div class="informalfigure"><a id="part0008_med_id00036a"></a><div class="mediaobject"><a id="part0008_med_id00036"></a><img alt="image with no caption" hisrc="figs/web/007fig02.png.jpg" src="../Images/image00523.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_one_constant_in_software_development" style="clear: both">The one constant in software development</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1099"></a><a class="indexterm" id="part0008_iddle1301"></a><a class="indexterm" id="part0008_iddle1560"></a><a class="indexterm" id="part0008_iddle2305"></a><span class="strong"><strong>Okay, what’s the one thing you can always count on in software development?</strong></span></p><p>No matter where you work, what you’re building, or what language you are programming in, what’s the one true constant that will be with you always?</p><div class="informalfigure"><a id="part0008_med_id00037a"></a><div class="mediaobject"><a id="part0008_med_id00037"></a><img alt="image with no caption" hisrc="figs/web/008fig01.png.jpg" src="../Images/image00524.jpeg"/></div></div><p>(use a mirror to see the answer)</p><p>No matter how well you design an application, over time an application must grow and change or it will <span class="emphasis"><em>die</em></span>.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_sharpen_your_pencil-id00001"></a><h3 class="title">Sharpen your pencil</h3><p>Lots of things can drive change. List some reasons you’ve had to change code in your applications (we put in a couple of our own to get you started).</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/></colgroup><tbody><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>My customers or users decide they want something else, or they want new functionality.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>My company decided it is going with another database vendor and it is also purchasing its data from another supplier that uses a different data format. Argh!</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>______________________________________________________________________________</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>______________________________________________________________________________</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>______________________________________________________________________________</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>______________________________________________________________________________</p></td></tr><tr><td style="vertical-align: top; "><p>______________________________________________________________________________</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_zeroing_in_on_the_problemhellip" style="clear: both">Zeroing in on the problem...</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1402"></a><a class="indexterm" id="part0008_iddle1469"></a>So we know using inheritance hasn’t worked out very well, since the duck behavior keeps changing across the subclasses, and it’s not appropriate for <span class="emphasis"><em>all</em></span> subclasses to have those behaviors. The Flyable and Quackable interface sounded promising at first — only ducks that really do fly will be Flyable, etc. — except Java interfaces have no implementation code, so no code reuse. And that means that whenever you need to modify a behavior, you’re forced to track down and change it in all the different subclasses where that behavior is defined, probably introducing <span class="emphasis"><em>new</em></span> bugs along the way!</p><p>Luckily, there’s a design principle for just this situation.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note01"></a>Design Principle</h3><p><span class="emphasis"><em>Identify the aspects of your application that vary and separate them from what stays the same.</em></span></p><div class="blockquote"><blockquote class="blockquote"><div>The first of many design principles. We’ll spend more time on these throughout the book.</div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>Take what varies and “encapsulate” it so it won’t affect the rest of your code.</strong></span></div><div><span class="strong"><strong>The result? Fewer unintended consequences from code changes and more flexibility in your systems!</strong></span></div></blockquote></div><p>In other words, if you’ve got some aspect of your code that is changing, say with every new requirement, then you know you’ve got a behavior that needs to be pulled out and separated from all the stuff that doesn’t change.</p><p>Here’s another way to think about this principle: <span class="emphasis"><em><span class="strong"><strong>take the parts that vary and encapsulate them, so that later you can alter or extend the parts that vary without affecting those that don’t.</strong></span></em></span></p><p>As simple as this concept is, it forms the basis for almost every design pattern. All patterns provide a way to let <span class="emphasis"><em>some part of a system vary independently of all other parts</em></span>.</p><p>Okay, time to pull the duck behavior out of the Duck classes!</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_separating_what_changes_from_what_stays" style="clear: both">Separating what changes from what stays the same</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1116"></a>Where do we start? As far as we can tell, other than the problems with fly() and quack(), the Duck class is working well and there are no other parts of it that appear to vary or change frequently. So, other than a few slight changes, we’re going to pretty much leave the Duck class alone.</p><p>Now, to separate the “parts that change from those that stay the same,” we are going to create two <span class="emphasis"><em>sets</em></span> of classes (totally apart from Duck), one for <span class="emphasis"><em>fly</em></span> and one for <span class="emphasis"><em>quack</em></span>. Each set of classes will hold all the implementations of the respective behavior. For instance, we might have <span class="emphasis"><em>one</em></span> class that implements <span class="emphasis"><em>quacking</em></span>, <span class="emphasis"><em>another</em></span> that implements <span class="emphasis"><em>squeaking</em></span>, and <span class="emphasis"><em>another</em></span> that implements <span class="emphasis"><em>silence</em></span>.</p><p><span class="strong"><strong>We know that fly() and quack() are the parts of the Duck class that vary across ducks.</strong></span></p><p><span class="strong"><strong>To separate these behaviors from the Duck class, we’ll pull both methods out of the Duck class and create a new set of classes to represent each behavior.</strong></span></p><div class="informalfigure"><a id="part0008_med_id00038a"></a><div class="mediaobject"><a id="part0008_med_id00038"></a><img alt="image with no caption" hisrc="figs/web/010fig01.png.jpg" src="../Images/image00525.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_designing_the_duck_behaviors" style="clear: both">Designing the Duck Behaviors</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1072"></a><a class="indexterm" id="part0008_iddle1077"></a><a class="indexterm" id="part0008_iddle1419"></a><a class="indexterm" id="part0008_iddle1486"></a><a class="indexterm" id="part0008_iddle1798"></a><a class="indexterm" id="part0008_iddle2140"></a><span class="strong"><strong>So how are we going to design the set of classes that implement the fly and quack behaviors?</strong></span></p><p>We’d like to keep things flexible; after all, it was the inflexibility in the duck behaviors that got us into trouble in the first place. And we know that we want to <span class="emphasis"><em>assign</em></span> behaviors to the instances of Duck. For example, we might want to instantiate a new MallardDuck instance and initialize it with a specific <span class="emphasis"><em>type</em></span> of flying behavior. And while we’re there, why not make sure that we can change the behavior of a duck dynamically? In other words, we should include behavior setter methods in the Duck classes so that we can <span class="emphasis"><em>change</em></span> the MallardDuck’s flying behavior <span class="emphasis"><em>at runtime</em></span>.</p><p>Given these goals, let’s look at our second design principle:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note02"></a>Design Principle</h3><p><span class="emphasis"><em>Program to an interface, not an implementation.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>From now on, the Duck behaviors will live in a separate class — a class that implements a particular behavior interface.</strong></span></div><div><span class="strong"><strong>That way, the Duck classes won’t need to know any of the implementation details for their own behaviors.</strong></span></div></blockquote></div><p>We’ll use an interface to represent each behavior — for instance, FlyBehavior and QuackBehavior — and each implementation of a <span class="emphasis"><em>behavior</em></span> will implement one of those interfaces.</p><p>So this time it won’t be the <span class="emphasis"><em>Duck</em></span> classes that will implement the flying and quacking interfaces. Instead, we’ll make a set of classes whose entire reason for living is to represent a behavior (for example, “squeaking”), and it’s the <span class="emphasis"><em>behavior</em></span> class, rather than the Duck class, that will implement the behavior interface.</p><p>This is in contrast to the way we were doing things before, where a behavior came either from a concrete implementation in the superclass Duck, or by providing a specialized implementation in the subclass itself. In both cases we were relying on an <span class="emphasis"><em>implementation</em></span>. We were locked into using that specific implementation and there was no room for changing the behavior (other than writing more code).</p><p>With our new design, the Duck subclasses will use a behavior represented by an <span class="emphasis"><em>interface</em></span> (FlyBehavior and QuackBehavior), so that the actual <span class="emphasis"><em>implementation</em></span> of the behavior (in other words, the specific concrete behavior coded in the class that implements the FlyBehavior or QuackBehavior) won’t be locked into the Duck subclass.</p><div class="informalfigure"><a id="part0008_med_id00039a"></a><div class="mediaobject"><a id="part0008_med_id00039"></a><img alt="image with no caption" hisrc="figs/web/011fig01.png.jpg" src="../Images/image00526.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00040a"></a><div class="mediaobject"><a id="part0008_med_id00040"></a><img alt="image with no caption" hisrc="figs/web/012fig01.png.jpg" src="../Images/image00527.jpeg"/></div></div><p><a class="indexterm" id="part0008_iddle1014"></a><a class="indexterm" id="part0008_iddle1296"></a><a class="indexterm" id="part0008_iddle2135"></a><a class="indexterm" id="part0008_iddle2145"></a><a class="indexterm" id="part0008_iddle2443"></a><a class="indexterm" id="part0008_iddle2445"></a><span class="strong"><strong>“Program to an <span class="emphasis"><em>interface</em></span>” really means “Program to a <span class="emphasis"><em>supertype</em></span>.”</strong></span></p><p>The word <span class="emphasis"><em>interface</em></span> is overloaded here. There’s the <span class="emphasis"><em>concept</em></span> of interface, but there’s also the Java construct interface. You can <span class="emphasis"><em>program to an interface</em></span>, without having to actually use a Java interface. The point is to exploit polymorphism by programming to a supertype so that the actual runtime object isn’t locked into the code. And we could rephrase “program to a supertype” as “the declared type of the variables should be a supertype, usually an abstract class or interface, so that the objects assigned to those variables can be of any concrete implementation of the supertype, which means the class declaring them doesn’t have to know about the actual object types!”</p><p>This is probably old news to you, but just to make sure we’re all saying the same thing, here’s a simple example of using a polymorphic type — imagine an abstract class Animal, with two concrete implementations, Dog and Cat.</p><p><span class="strong"><strong>Programming to an implementation</strong></span> would be:</p><a id="part0008_pro_id00001"></a><pre class="programlisting"><span class="strong"><strong>Dog d = new Dog();</strong></span>
<span class="strong"><strong>d.bark();</strong></span></pre><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note03"></a>Note</h3><p>Declaring the variable “d” as type Dog (a concrete implementation of Animal) forces us to code to a concrete implementation.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>But <span class="strong"><strong>programming to an interface/supertype</strong></span> would be:</p><a id="part0008_pro_id00002"></a><pre class="programlisting"><span class="strong"><strong>Animal animal = new Dog();</strong></span>
<span class="strong"><strong>animal.makeSound();</strong></span></pre><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note04"></a>Note</h3><p>We know it’s a Dog, but we can now use the animal reference polymorphically.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Even better, rather than hardcoding the instantiation of the subtype (like new Dog()) into the code, <span class="strong"><strong>assign the concrete implementation object at runtime:</strong></span></p><a id="part0008_pro_id00003"></a><pre class="programlisting"><span class="strong"><strong>a = getAnimal();</strong></span>
<span class="strong"><strong>a.makeSound();</strong></span></pre><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note05"></a>Note</h3><p>We don’t know WHAT the actual animal subtype is... all we care about is that it knows how to respond to makeSound().</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0008_med_id00041a"></a><div class="mediaobject"><a id="part0008_med_id00041"></a><img alt="image with no caption" hisrc="figs/web/012fig02.png.jpg" src="../Images/image00528.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_implementing_the_duck_behaviors" style="clear: both">Implementing the Duck Behaviors</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1079"></a><a class="indexterm" id="part0008_iddle1776"></a><a class="indexterm" id="part0008_iddle1786"></a>Here we have the two interfaces, FlyBehavior and QuackBehavior, along with the corresponding classes that implement each concrete behavior:</p><div class="informalfigure"><a id="part0008_med_id00042a"></a><div class="mediaobject"><a id="part0008_med_id00042"></a><img alt="image with no caption" hisrc="figs/web/013fig01.png.jpg" src="../Images/image00529.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note06"></a>Note</h3><p><span class="strong"><strong>With this design, other types of objects can reuse our fly and quack behaviors because these behaviors are no longer hidden away in our Duck classes!</strong></span></p><p><span class="strong"><strong>And we can add new behaviors without modifying any of our existing behavior classes or touching any of the Duck classes that use flying behaviors.</strong></span></p><div class="blockquote"><blockquote class="blockquote"><div>So we get the benefit of REUSE without all the baggage that comes along with inheritance.</div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_there_are_no_dumb_questions"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa1qe1"></a><a id="part0008_ch01qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0008_iddle1073"></a><a class="indexterm" id="part0008_iddle1112"></a><a class="indexterm" id="part0008_iddle1554"></a><a class="indexterm" id="part0008_iddle2299"></a><span class="strong"><strong>Q: Do I always have to implement my application first, see where things are changing, and then go back and separate &amp; encapsulate those things?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Not always; often when you are designing an application, you anticipate those areas that are going to vary and then go ahead and build the flexibility to deal with it into your code. You’ll find that the principles and patterns can be applied at any stage of the development lifecycle.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa1qe2"></a><a id="part0008_ch01qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Should we make Duck an interface too?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Not in this case. As you’ll see once we’ve got everything hooked together, we do benefit by having Duck not be an interface, and having specific ducks, like MallardDuck, inherit common properties and methods. Now that we’ve removed what varies from the Duck inheritance, we get the benefits of this structure without the problems.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa1qe3"></a><a id="part0008_ch01qa1q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: It feels a little weird to have a class that’s just a behavior. Aren’t classes supposed to represent things? Aren’t classes supposed to have both state AND behavior?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa1q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> In an OO system, yes, classes represent things that generally have both state (instance variables) and methods. And in this case, the thing happens to be a behavior. But even a behavior can still have state and methods; a flying behavior might have instance variables representing the attributes for the flying (wing beats per minute, max altitude, and speed, etc.) behavior.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_sharpen_your_pencil-id00002"></a><h3 class="title">Sharpen your pencil</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Using our new design, what would you do if you needed to add rocket-powered flying to the SimUDuck app?</li><li class="listitem" style="list-style-type: none">② Can you think of a class that might want to use the Quack behavior that isn’t a duck?</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Answers:</p><p>1) Create a FlyRocketPowered class that implements the FlyBehavior interface.</p><p>2) One example, a duck call (a device that makes duck sounds).</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_integrating_the_duck_behavior" style="clear: both">Integrating the Duck Behavior</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1075"></a><a class="indexterm" id="part0008_iddle1080"></a><a class="indexterm" id="part0008_iddle1793"></a><a class="indexterm" id="part0008_iddle1800"></a><a class="indexterm" id="part0008_iddle2492"></a><span class="strong"><strong>The key is that a Duck will now <span class="underline"><span class="emphasis"><em>delegate</em></span></span> its flying and quacking behavior, instead of using quacking and flying methods defined in the Duck class (or subclass).</strong></span></p><p><span class="strong"><strong>Here’s how:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① First we’ll add two instance variables</strong></span> to the Duck class called <span class="emphasis"><em>flyBehavior</em></span> and <span class="emphasis"><em>quackBehavior</em></span> that are declared as the interface type (not a concrete class implementation type). Each duck object will set these variables polymorphically to reference the <span class="emphasis"><em>specific</em></span> behavior type it would like at runtime (FlyWithWings, Squeak, etc.).<br/>We’ll also remove the fly() and quack() methods from the Duck class (and any subclasses) because we’ve moved this behavior out into the FlyBehavior and QuackBehavior classes.<br/>We’ll replace fly() and quack() in the Duck class with two similar methods, called performFly() and performQuack(); you’ll see how they work next.<div class="informalfigure"><a id="part0008_med_id00043a"></a><div class="mediaobject"><a id="part0008_med_id00043"></a><img alt="image with no caption" hisrc="figs/web/015fig01.png.jpg" src="../Images/image00530.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Now we implement performQuack():</strong></span><div class="informalfigure"><a id="part0008_med_id00044a"></a><div class="mediaobject"><a id="part0008_med_id00044"></a><img alt="image with no caption" hisrc="figs/web/015fig02.png.jpg" src="../Images/image00531.jpeg"/></div></div><br/>Pretty simple, huh? To perform the quack, a Duck just allows the object that is referenced by quackBehavior to quack for it.<br/>In this part of the code we don’t care what kind of object it is, <span class="bolditalic">all we care about is that it knows how to quack()!</span></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_more_integrationhellip" style="clear: both">More integration...</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">③ Okay, time to worry about <span class="strong"><strong>how the flyBehavior and quackBehavior instance variables are set</strong></span>. Let’s take a look at the MallardDuck class:<div class="informalfigure"><a id="part0008_med_id00045a"></a><div class="mediaobject"><a id="part0008_med_id00045"></a><img alt="image with no caption" hisrc="figs/web/016fig01.png.jpg" src="../Images/image00532.jpeg"/></div></div><br/>So MallardDuck’s quack is a real live duck <span class="strong"><strong>quack</strong></span>, not a <span class="strong"><strong>squeak</strong></span> and not a <span class="strong"><strong>mute quack</strong></span>. So what happens here? When a MallardDuck is instantiated, its constructor initializes the MallardDuck’s inherited quackBehavior instance variable to a new instance of type Quack (a QuackBehavior concrete implementation class).<br/>And the same is true for the duck’s flying behavior — the MallardDuck’s constructor initializes the flyBehavior instance variable with an instance of type FlyWithWings (a FlyBehavior concrete implementation class).</li></ul></div><div class="informalfigure"><a id="part0008_med_id00046a"></a><div class="mediaobject"><a id="part0008_med_id00046"></a><img alt="image with no caption" hisrc="figs/web/017fig01.png.jpg" src="../Images/image00533.jpeg"/></div></div><p><a class="indexterm" id="part0008_iddle1774"></a>Good catch, that’s exactly what we’re doing... <span class="emphasis"><em>for now.</em></span></p><p>Later in the book we’ll have more patterns in our toolbox that can help us fix it.</p><p>Still, notice that while we <span class="emphasis"><em>are</em></span> setting the behaviors to concrete classes (by instantiating a behavior class like Quack or FlyWithWings and assigning it to our behavior reference variable), we could <span class="emphasis"><em>easily</em></span> change that at runtime.</p><p>So, we still have a lot of flexibility here, but we’re doing a poor job of initializing the instance variables in a flexible way. But think about it: since the quackBehavior instance variable is an interface type, we could (through the magic of polymorphism) dynamically assign a different QuackBehavior implementation class at runtime.</p><p>Take a moment and think about how you would implement a duck so that its behavior could change at runtime. (You’ll see the code that does this a few pages from now.)</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_testing_the_duck_code" style="clear: both">Testing the Duck code</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① <a class="indexterm" id="part0008_iddle1801"></a><span class="strong"><strong>Type and compile the Duck class below (Duck.java), and the MallardDuck class from two pages back (MallardDuck.java).</strong></span><div class="informalfigure"><a id="part0008_med_id00047a"></a><div class="mediaobject"><a id="part0008_med_id00047"></a><img alt="image with no caption" hisrc="figs/web/018fig01.png.jpg" src="../Images/image00534.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Type and compile the FlyBehavior interface (FlyBehavior.java) and the two behavior implementation classes (FlyWithWings.java and FlyNoWay.java).</strong></span><div class="informalfigure"><a id="part0008_med_id00048a"></a><div class="mediaobject"><a id="part0008_med_id00048"></a><img alt="image with no caption" hisrc="figs/web/018fig02.png.jpg" src="../Images/image00535.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Type and compile the QuackBehavior interface (QuackBehavior.java) and the three behavior implementation classes (Quack.java, MuteQuack.java, and Squeak.java).</strong></span><a id="part0008_pro_id00004"></a><pre class="programlisting"><span class="strong"><strong>public interface QuackBehavior {</strong></span>
   <span class="strong"><strong>public void quack();</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>_______________________________________________________________</strong></span>
<span class="strong"><strong>public class Quack implements QuackBehavior {</strong></span>
   <span class="strong"><strong>public void quack() {</strong></span>
      <span class="strong"><strong>System.out.println("Quack");</strong></span>
   <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>_______________________________________________________________</strong></span>
<span class="strong"><strong>public class MuteQuack implements QuackBehavior {</strong></span>
   <span class="strong"><strong>public void quack() {</strong></span>
       <span class="strong"><strong>System.out.println("&lt;&lt; Silence &gt;&gt;");</strong></span>
   <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>_______________________________________________________________</strong></span>
<span class="strong"><strong>public class Squeak implements QuackBehavior {</strong></span>
   <span class="strong"><strong>public void quack() {</strong></span>
       <span class="strong"><strong>System.out.println("Squeak");</strong></span>
   <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Type and compile the test class (MiniDuckSimulator.java).</strong></span><div class="informalfigure"><a id="part0008_med_id00049a"></a><div class="mediaobject"><a id="part0008_med_id00049"></a><img alt="image with no caption" hisrc="figs/web/019fig01.png.jpg" src="../Images/image00536.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ Run the code!</strong></span><div class="informalfigure"><a id="part0008_med_id00050a"></a><div class="mediaobject"><a id="part0008_med_id00050"></a><img alt="image with no caption" hisrc="figs/web/019fig02.png.jpg" src="../Images/image00537.jpeg"/></div></div></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_setting_behavior_dynamically" style="clear: both">Setting behavior dynamically</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1081"></a>What a shame to have all this dynamic talent built into our ducks and not be using it! Imagine you want to set the duck’s behavior type through a setter method on the duck subclass, rather than by instantiating it in the duck’s constructor.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Add two new methods to the Duck class:</strong></span><div class="informalfigure"><a id="part0008_med_id00051a"></a><div class="mediaobject"><a id="part0008_med_id00051"></a><img alt="image with no caption" hisrc="figs/web/020fig01.png.jpg" src="../Images/image00538.jpeg"/></div></div><br/>We can call these methods anytime we want to change the behavior of a duck <span class="underline">on the fly</span>.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note07"></a>Note</h3><p>Editor note: gratuitous pun - fix</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Make a new Duck type (ModelDuck.java).</strong></span><div class="informalfigure"><a id="part0008_med_id00052a"></a><div class="mediaobject"><a id="part0008_med_id00052"></a><img alt="image with no caption" hisrc="figs/web/020fig02.png.jpg" src="../Images/image00539.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Make a new FlyBehavior type (FlyRocketPowered.java).</strong></span><div class="informalfigure"><a id="part0008_med_id00053a"></a><div class="mediaobject"><a id="part0008_med_id00053"></a><img alt="image with no caption" hisrc="figs/web/020fig03.png.jpg" src="../Images/image00540.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Change the test class (MiniDuckSimulator.java), add the ModelDuck, and make the ModelDuck rocket-enabled.</strong></span><div class="informalfigure"><a id="part0008_med_id00054a"></a><div class="mediaobject"><a id="part0008_med_id00054"></a><img alt="image with no caption" hisrc="figs/web/021fig01.png.jpg" src="../Images/image00541.jpeg"/></div></div></li></ul></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>To change a duck’s behavior at runtime, just call the duck’s setter method for that behavior.</strong></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_big_picture_on_encapsulated_behaviors" style="clear: both">The Big Picture on encapsulated behaviors</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1078"></a><a class="indexterm" id="part0008_iddle1487"></a><span class="strong"><strong>Okay, now that we’ve done the deep dive on the duck simulator design, it’s time to come back up for air and take a look at the big picture.</strong></span></p><p>Below is the entire reworked class structure. We have everything you’d expect: ducks extending Duck, fly behaviors implementing FlyBehavior, and quack behaviors implementing QuackBehavior.</p><p>Notice also that we’ve started to describe things a little differently. Instead of thinking of the duck behaviors as a <span class="emphasis"><em>set of behaviors</em></span>, we’ll start thinking of them as a <span class="emphasis"><em>family of algorithms</em></span>. Think about it: in the SimUDuck design, the algorithms represent things a duck would do (different ways of quacking or flying), but we could just as easily use the same techniques for a set of classes that implement the ways to compute state sales tax by different states.</p><p>Pay careful attention to the <span class="emphasis"><em>relationships</em></span> between the classes. In fact, grab your pen and write the appropriate relationship (IS-A, HAS-A, and IMPLEMENTS) on each arrow in the class diagram.</p><div class="informalfigure"><a id="part0008_med_id00055a"></a><div class="mediaobject"><a id="part0008_med_id00055"></a><img alt="image with no caption" hisrc="figs/web/022fig01.png.jpg" src="../Images/image00542.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_has-a_can_be_better_than_is-a" style="clear: both">HAS-A can be better than IS-A</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1129"></a><a class="indexterm" id="part0008_iddle1251"></a><a class="indexterm" id="part0008_iddle1406"></a><a class="indexterm" id="part0008_iddle1673"></a><a class="indexterm" id="part0008_iddle1719"></a><a class="indexterm" id="part0008_iddle1783"></a>The HAS-A relationship is an interesting one: each duck has a FlyBehavior and a QuackBehavior to which it delegates flying and quacking.</p><p>When you put two classes together like this you’re using <span class="strong"><strong>composition</strong></span>. Instead of <span class="emphasis"><em>inheriting</em></span> their behavior, the ducks get their behavior by being <span class="emphasis"><em>composed</em></span> with the right behavior object.</p><p>This is an important technique; in fact, we’ve been using our third design principle:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note08"></a>Design Principle</h3><p><span class="emphasis"><em>Favor composition over inheritance.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>As you’ve seen, creating systems using composition gives you a lot more flexibility. Not only does it let you encapsulate a family of algorithms into their own set of classes, but it also lets you <span class="bolditalic">change behavior at runtime</span> as long as the object you’re composing with implements the correct behavior interface.</p><p>Composition is used in <span class="underline">many</span> design patterns and you’ll see a lot more about its advantages and disadvantages throughout the book.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note09"></a>Brain Power</h3><p>A duck call is a device that hunters use to mimic the calls (quacks) of ducks. How would you implement your own duck call that does <span class="emphasis"><em>not</em></span> inherit from the Duck class?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_master_and_studenthellip"></a><h3 class="title">Master and Student...</h3><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, tell me what you have learned of the Object-Oriented ways.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, I have learned that the promise of the object-oriented way is reuse.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, continue...</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, through inheritance all good things may be reused and so we come to drastically cut development time like we swiftly cut bamboo in the woods.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, is more time spent on code</em></span> <span class="bolditalic">before</span> <span class="emphasis"><em>or</em></span> <span class="bolditalic">after</span> <span class="emphasis"><em>development is complete?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>The answer is</em></span> <span class="bolditalic">after</span>, <span class="emphasis"><em>Master. We always spend more time maintaining and changing software than on initial development.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>So Grasshopper, should effort go into reuse</em></span> <span class="bolditalic">above</span> <span class="emphasis"><em>maintainability and extensibility?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, I believe that there is truth in this.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>I can see that you still have much to learn. I would like for you to go and meditate on inheritance further. As you’ve seen, inheritance has its problems, and there are other ways of achieving reuse.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_speaking_of_design_patternshellip" style="clear: both">Speaking of Design Patterns...</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_congratulations_on_your_first_patternexc"></a><h3 class="title">Congratulations on your first pattern!</h3><div class="informalfigure"><a id="part0008_med_id00840a"></a><div class="mediaobject"><a id="part0008_med_id00840"></a><img alt="image with no caption" hisrc="figs/web/common3.png.jpg" src="../Images/image00543.jpeg"/></div></div><p><a class="indexterm" id="part0008_iddle2407"></a>You just applied your first design pattern — the <span class="strong"><strong>STRATEGY</strong></span> Pattern. That’s right, you used the Strategy Pattern to rework the SimUDuck app. Thanks to this pattern, the simulator is ready for any changes those execs might cook up on their next business trip to Maui.</p><p>Now that we’ve made you take the long road to apply it, here’s the formal definition of this pattern:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note10"></a>Note</h3><p><span class="strong"><strong>The Strategy Pattern</strong></span> defines a family of algorithms, encapsulates each one, and makes them interchangeable. Strategy lets the algorithm vary independently from clients that use it.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div>Use THIS definition when you need to impress friends and influence key executives.</div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_design_puzzle"></a><h3 class="title">Design Puzzle</h3><p><a class="indexterm" id="part0008_iddle1434"></a><a class="indexterm" id="part0008_iddle1514"></a>Below you’ll find a mess of classes and interfaces for an action adventure game. You’ll find classes for game characters along with classes for weapon behaviors the characters can use in the game. Each character can make use of one weapon at a time, but can change weapons at any time during the game. Your job is to sort it all out...</p><p>(Answers are at the end of the chapter.)</p><p><span class="strong"><strong>Your task:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Arrange the classes.</li><li class="listitem" style="list-style-type: none">② Identify one abstract class, one interface, and eight classes.</li><li class="listitem" style="list-style-type: none">③ Draw arrows between classes.<div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Draw this kind of arrow for inheritance (“extends”). <span class="inlinemediaobject"><a id="part0008_inline_id00007"></a><img alt="" hisrc="figs/web/025fig02.png.jpg" src="../Images/image00544.jpeg"/></span></li><li class="listitem">Draw this kind of arrow for interface (“implements”). <span class="inlinemediaobject"><a id="part0008_inline_id00008"></a><img alt="" hisrc="figs/web/025fig03.png.jpg" src="../Images/image00545.jpeg"/></span></li><li class="listitem">Draw this kind of arrow for “HAS-A”. <span class="inlinemediaobject"><a id="part0008_inline_id00009"></a><img alt="" hisrc="figs/web/025fig04.png.jpg" src="../Images/image00546.jpeg"/></span></li></ol></div></li><li class="listitem" style="list-style-type: none">④ Put the method setWeapon() into the right class.<div class="informalfigure"><a id="part0008_med_id00056a"></a><div class="mediaobject"><a id="part0008_med_id00056"></a><img alt="image with no caption" hisrc="figs/web/025fig01.png.jpg" src="../Images/image00547.jpeg"/></div></div></li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_overheard_at_the_local_dinerhellip" style="clear: both">Overheard at the local diner...</h2></div></div></div><div class="informalfigure"><a id="part0008_med_id00057a"></a><div class="mediaobject"><a id="part0008_med_id00057"></a><img alt="image with no caption" hisrc="figs/web/026fig01.png.jpg" src="../Images/image00548.jpeg"/></div></div><p><a class="indexterm" id="part0008_iddle2259"></a>What’s the difference between these two orders? Not a thing! They’re both the same order, except Alice is using twice the number of words and trying the patience of a grumpy short-order cook.</p><p>What’s Flo got that Alice doesn’t? <span class="strong"><strong>A shared vocabulary</strong></span> with the short-order cook. Not only does that make it easier to communicate with the cook, but it gives the cook less to remember because he’s got all the diner patterns in his head.</p><p>Design Patterns give you a shared vocabulary with other developers. Once you’ve got the vocabulary you can more easily communicate with other developers and inspire those who don’t know patterns to start learning them. It also elevates your thinking about architectures by letting you <span class="strong"><strong>think at the</strong></span> <span class="bolditalic">pattern</span> <span class="strong"><strong>level</strong></span>, not the nitty-gritty <span class="emphasis"><em>object</em></span> level.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_overheard_in_the_next_cubiclehellip" style="clear: both">Overheard in the next cubicle...</h2></div></div></div><div class="informalfigure"><a id="part0008_med_id00058a"></a><div class="mediaobject"><a id="part0008_med_id00058"></a><img alt="image with no caption" hisrc="figs/web/027fig01.png.jpg" src="../Images/image00549.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00059a"></a><div class="mediaobject"><a id="part0008_med_id00059"></a><img alt="image with no caption" hisrc="figs/web/027fig02.png.jpg" src="../Images/image00550.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note11"></a>Brain Power</h3><p>Can you think of other shared vocabularies that are used beyond OO design and diner talk? (Hint: how about auto mechanics, carpenters, gourmet chefs, air traffic control.) What qualities are communicated along with the lingo?</p><p>Can you think of aspects of OO design that get communicated along with pattern names? What qualities get communicated along with the name “Strategy Pattern”?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_power_of_a_shared_pattern_vocabulary" style="clear: both">The power of a shared pattern vocabulary</h2></div></div></div><p><a class="indexterm" id="part0008_iddle2260"></a><span class="strong"><strong>When you communicate using patterns you are doing <span class="underline">more</span> than just sharing LINGO.</strong></span></p><p><span class="strong"><strong>Shared pattern vocabularies are POWERFUL.</strong></span> When you communicate with another developer or your team using patterns, you are communicating not just a pattern name but a whole set of qualities, characteristics, and constraints that the pattern represents.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note12"></a>Note</h3><p>“We’re using the Strategy Pattern to implement the various behaviors of our ducks.” This tells you the duck behavior has been encapsulated into its own set of classes that can be easily expanded and changed, even at runtime if needed.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Patterns allow you to say more with less.</strong></span> When you use a pattern in a description, other developers quickly know precisely the design you have in mind.</p><p><span class="strong"><strong>Talking at the pattern level allows you to stay “in the design” longer.</strong></span> Talking about software systems using patterns allows you to keep the discussion at the design level, without having to dive down to the nitty-gritty details of implementing objects and classes.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note13"></a>Note</h3><p>How many design meetings have you been in that quickly degrade into implementation details?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Shared vocabularies can turbo-charge your development team.</strong></span> A team well versed in design patterns can move more quickly with less room for misunderstanding.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note14"></a>Note</h3><p>As your team begins to share design ideas and experience in terms of patterns, you will build a community of patterns users.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Shared vocabularies encourage more junior developers to get up to speed.</strong></span> Junior developers look up to experienced developers. When senior developers make use of design patterns, junior developers also become motivated to learn them. Build a community of pattern users at your organization.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note15"></a>Note</h3><p>Think about starting a patterns study group at your organization. Maybe you can even get paid while you’re learning...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_how_do_i_use_design_patternsquestion_mar" style="clear: both">How do I use Design Patterns?</h2></div></div></div><p><a class="indexterm" id="part0008_iddle1383"></a><a class="indexterm" id="part0008_iddle1386"></a><a class="indexterm" id="part0008_iddle1395"></a><a class="indexterm" id="part0008_iddle1680"></a><a class="indexterm" id="part0008_iddle1883"></a><a class="indexterm" id="part0008_iddle1884"></a>We’ve all used off-the-shelf libraries and frameworks. We take them, write some code against their APIs, compile them into our programs, and benefit from a lot of code someone else has written. Think about the Java APIs and all the functionality they give you: network, GUI, IO, etc. Libraries and frameworks go a long way towards a development model where we can just pick and choose components and plug them right in. But... they don’t help us structure our own applications in ways that are easier to understand, more maintainable and flexible. That’s where Design Patterns come in.</p><p>Design patterns don’t go directly into your code, they first go into your BRAIN. Once you’ve loaded your brain with a good working knowledge of patterns, you can then start to apply them to your new designs, and rework your old code when you find it’s degrading into an inflexible mess of jungle spaghetti code.</p><div class="informalfigure"><a id="part0008_med_id00060a"></a><div class="mediaobject"><a id="part0008_med_id00060"></a><img alt="image with no caption" hisrc="figs/web/029fig01.png.jpg" src="../Images/image00551.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_there_are_no_dumb_questions-id00003"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa2qe1"></a><a id="part0008_ch01qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: If design patterns are so great, why can’t someone build a library of them so I don’t have to?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Design patterns are higher level than libraries. Design patterns tell us how to structure classes and objects to solve certain problems and it is our job to adapt those designs to fit our particular application.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa2qe2"></a><a id="part0008_ch01qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Aren’t libraries and frameworks also design patterns?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Frameworks and libraries are not design patterns; they provide specific implementations that we link into our code. Sometimes, however, libraries and frameworks make use of design patterns in their implementations. That’s great, because once you understand design patterns, you’ll more quickly understand APIs that are structured around design patterns.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa2qe3"></a><a id="part0008_ch01qa2q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: So, there are no libraries of design patterns?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0008_ch01qa2q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No, but you will learn later about pattern catalogs with lists of patterns that you can apply to your applications.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0008_med_id00061a"></a><div class="mediaobject"><a id="part0008_med_id00061"></a><img alt="image with no caption" hisrc="figs/web/030fig01.png.jpg" src="../Images/image00552.jpeg"/></div></div><div class="informalfigure"><a id="part0008_med_id00062a"></a><div class="mediaobject"><a id="part0008_med_id00062"></a><img alt="image with no caption" hisrc="figs/web/030fig02.png.jpg" src="../Images/image00553.jpeg"/></div></div><p><a class="indexterm" id="part0008_iddle2012"></a><a class="indexterm" id="part0008_iddle2083"></a><span class="strong"><strong>Developer:</strong></span> Okay, hmm, but isn’t this all just good object-oriented design; I mean as long as I follow encapsulation and I know about abstraction, inheritance, and polymorphism, do I really need to think about Design Patterns? Isn’t it pretty straightforward? Isn’t this why I took all those OO courses? I think Design Patterns are useful for people who don’t know good OO design.</p><p><span class="strong"><strong>Guru:</strong></span> Ah, this is one of the true misunderstandings of object-oriented development: that by knowing the OO basics we are automatically going to be good at building flexible, reusable, and maintainable systems.</p><p><span class="strong"><strong>Developer:</strong></span> No?</p><p><span class="strong"><strong>Guru:</strong></span> No. As it turns out, constructing OO systems that have these properties is not always obvious and has been discovered only through hard work.</p><p><span class="strong"><strong>Developer:</strong></span> I think I’m starting to get it. These, sometimes non-obvious, ways of constructing object-oriented systems have been collected...</p><p><span class="strong"><strong>Guru:</strong></span> ...yes, into a set of patterns called Design Patterns.</p><p><span class="strong"><strong>Developer:</strong></span> So, by knowing patterns, I can skip the hard work and jump straight to designs that always work?</p><p><span class="strong"><strong>Guru:</strong></span> Yes, to an extent, but remember, design is an art. There will always be tradeoffs. But, if you follow well thought-out and time-tested design patterns, you’ll be way ahead.</p><p><span class="strong"><strong>Developer:</strong></span> What do I do if I can’t find a pattern?</p><div class="informalfigure"><a id="part0008_med_id00063a"></a><div class="mediaobject"><a id="part0008_med_id00063"></a><img alt="image with no caption" hisrc="figs/web/031fig01.png.jpg" src="../Images/image00554.jpeg"/></div></div><p><span class="strong"><strong>Guru:</strong></span> There are some object-oriented principles that underlie the patterns, and knowing these will help you to cope when you can’t find a pattern that matches your problem.</p><p><span class="strong"><strong>Developer:</strong></span> Principles? You mean beyond abstraction, encapsulation, and...</p><p><span class="strong"><strong>Guru:</strong></span> Yes, one of the secrets to creating maintainable OO systems is thinking about how they might change in the future, and these principles address those issues.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0008_tools_for_your_design_toolbox" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>You’ve nearly made it through the first chapter! You’ve already put a few tools in your OO toolbox; let’s make a list of them before we move on to <a class="xref" href="#part0009_aid-8IL22">Chapter 2</a>.</p><div class="informalfigure"><a id="part0008_med_id00064a"></a><div class="mediaobject"><a id="part0008_med_id00064"></a><img alt="image with no caption" hisrc="figs/web/032fig01.png.jpg" src="../Images/image00555.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_bullet_points"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Knowing the OO basics does not make you a good OO designer.</li><li class="listitem">Good OO designs are reusable, extensible, and maintainable.</li><li class="listitem">Patterns show you how to build systems with good OO design qualities.</li><li class="listitem">Patterns are proven object-oriented experience.</li><li class="listitem">Patterns don’t give you code, they give you general solutions to design problems. You apply them to your specific application.</li><li class="listitem">Patterns aren’t <span class="emphasis"><em>invented</em></span>, they are <span class="emphasis"><em>discovered</em></span>.</li><li class="listitem">Most patterns and principles address issues of <span class="emphasis"><em>change</em></span> in software.</li><li class="listitem">Most patterns allow some part of a system to vary independently of all other parts.</li><li class="listitem">We often try to take what varies in a system and encapsulate it.</li><li class="listitem">Patterns provide a shared language that can maximize the value of your communication with other developers.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_design_patterns_crossword"></a><h3 class="title">Design Patterns Crossword</h3><p><a class="indexterm" id="part0008_iddle1339"></a>Let’s give your right brain something to do.</p><p>It’s your standard crossword; all of the solution words are from this chapter.</p><div class="informalfigure"><a id="part0008_med_id00065a"></a><div class="mediaobject"><a id="part0008_med_id00065"></a><img alt="image with no caption" hisrc="figs/web/033fig01.png" src="../Images/image00556.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>2. ________ what varies.</p>
<p>4. Design patterns __________.</p>
<p>6. Java IO, Networking, Sound.</p>
<p>9. Rubber ducks make a __________.</p>
<p>13. Bartender thought they were called.</p>
<p>15. Program to this, not an implementation.</p>
<p>17. Patterns go into your _________.</p>
<p>18. Learn from the other guy’s ___________.</p>
<p>19. Development constant.</p>
<p>20. Patterns give us a shared ____________.</p></td><td style="vertical-align: top; "><p>1. Patterns _______ in many applications.</p>
<p>3. Favor this over inheritance.</p>
<p>5. Dan was thrilled with this pattern.</p>
<p>7. Most patterns follow from OO _________.</p>
<p>8. Not your own __________.</p>
<p>10. High level libraries.</p>
<p>11. Joe’s favorite drink.</p>
<p>12. Pattern that fixed the simulator.</p>
<p>13. Duck that can’t quack.</p>
<p>14. Grilled cheese with bacon.</p>
<p>15. Duck demo was located here.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_design_puzzle_solution"></a><h3 class="title">Design Puzzle Solution</h3><p><a class="indexterm" id="part0008_iddle1435"></a><a class="indexterm" id="part0008_iddle1515"></a>Character is the abstract class for all the other characters (King, Queen, Knight, and Troll), while WeaponBehavior is an interface that all weapon behaviors implement. So all actual characters and weapons are concrete classes.</p><p>To switch weapons, each character calls the setWeapon() method, which is defined in the Character superclass. During a fight the useWeapon() method is called on the current weapon set for a given character to inflict great bodily damage on another character.</p><div class="informalfigure"><a id="part0008_med_id00066a"></a><div class="mediaobject"><a id="part0008_med_id00066"></a><img alt="image with no caption" hisrc="figs/web/034fig01.png.jpg" src="../Images/image00557.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_sharpen_your_pencil_solution"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0008_iddle1558"></a><a class="indexterm" id="part0008_iddle1561"></a><a class="indexterm" id="part0008_iddle2303"></a><a class="indexterm" id="part0008_iddle2306"></a>Which of the following are disadvantages of using subclassing to provide specific Duck behavior? (Choose all that apply.) Here’s our solution.</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00010"></a><img alt="" hisrc="figs/web/035fig01.png.jpg" src="../Images/image00558.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Code is duplicated across subclasses.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00011"></a><img alt="" hisrc="figs/web/035fig02.png.jpg" src="../Images/image00559.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Runtime behavior changes are difficult.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00012"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We can’t make duck’s dance.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00013"></a><img alt="" hisrc="figs/web/035fig03.png.jpg" src="../Images/image00560.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Hard to gain knowledge of all duck behaviors.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00014"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Ducks can’t fly and quack at the same time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0008_inline_id00015"></a><img alt="" hisrc="figs/web/035fig04.png.jpg" src="../Images/image00561.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>Changes can unintentionally affect other ducks.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_sharpen_your_pencil_solution-id00004"></a><h3 class="title">Sharpen your pencil Solution</h3><p>What are some factors that drive change in your applications? You might have a very different list, but here’s a few of ours. Look familiar? Here’s our solution.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0008_ch01note16"></a>Note</h3><p>My customers or users decide they want something else, or they want new functionality.</p><p>My company decided it is going with another database vendor and it is also purchasing its data from another supplier that uses a different data format. Argh!</p><p>Well, technology changes and we’ve got to update our code to make use of protocols.</p><p>We’ve learned enough building our system that we’d like to go back and do things a little better.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0008_design_patterns_crossword_solution"></a><h3 class="title">Design Patterns Crossword Solution</h3><div class="informalfigure"><a id="part0008_med_id00067a"></a><div class="mediaobject"><a id="part0008_med_id00067"></a><img alt="image with no caption" hisrc="figs/web/036fig01.png" src="../Images/image00562.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0009_observer_pattern_keeping_your_objects_in"><div class="titlepage" id="part0009_aid-8IL22"><div><div><h2 class="title">Chapter 2. The Observer Pattern: Keeping your Objects in the know</h2></div></div></div><div class="informalfigure"><a id="part0009_med_id00068a"></a><div class="mediaobject"><a id="part0009_med_id00068"></a><img alt="image with no caption" hisrc="figs/web/037fig01.png.jpg" src="../Images/image00563.jpeg"/></div></div><p><a class="indexterm" id="part0009_iddle2029"></a><span class="strong"><strong>Don’t miss out when something interesting happens!</strong></span> We’ve got a pattern that keeps your objects in the know when something they might care about happens. Objects can even decide at runtime whether they want to be kept informed. The Observer Pattern is one of the most heavily used patterns in the JDK, and it’s incredibly useful. Before we’re done, we’ll also look at one-to-many relationships and loose coupling (yeah, that’s right, we said coupling). With Observer, you’ll be the life of the Patterns Party.</p><p><span class="strong"><strong>Congratulations!</strong></span></p><p><span class="strong"><strong>Your team has just won the contract to build Weather-O-Rama, Inc.’s next-generation, Internet-based Weather Monitoring Station.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/></colgroup><tbody><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00069a"></a><img alt="" hisrc="figs/web/038fig01.png.jpg" src="../Images/image00564.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Statement of Work</strong></span></p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Congratulations on being selected to build our next-generation, Internet-based Weather Monitoring Station!</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The weather station will be based on our patent pending WeatherData object, which tracks current weather conditions (temperature, humidity, and barometric pressure). We’d like you to create an application that initially provides three display elements: current conditions, weather statistics, and a simple forecast, all updated in real time as the WeatherData object acquires the most recent measurements.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Further, this is an expandable weather station. Weather-ORama wants to release an API so that other developers can write their own weather displays and plug them right in. We’d like for you to supply that API!</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Weather-O-Rama thinks we have a great business model: once the customers are hooked, we intend to charge them for each display they use. Now for the best part: we are going to pay you in stock options.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We look forward to seeing your design and alpha application.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Sincerely,</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00070a"></a><img alt="" hisrc="figs/web/038fig02.png.jpg" src="../Images/image00565.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Johnny Hurricane, CEO</p></td></tr><tr><td style="vertical-align: top; "><p>P.S. We are overnighting the WeatherData source files to you.</p></td></tr></tbody></table></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_weather_monitoring_application_overview" style="clear: both">The Weather Monitoring application overview</h2></div></div></div><p>The three players in the system are the weather station (the physical device that acquires the actual weather data), the WeatherData object (that tracks the data coming from the Weather Station and updates the displays), and the display that shows users the current weather conditions.</p><div class="informalfigure"><a id="part0009_med_id00071a"></a><div class="mediaobject"><a id="part0009_med_id00071"></a><img alt="image with no caption" hisrc="figs/web/039fig01.png.jpg" src="../Images/image00566.jpeg"/></div></div><p>The WeatherData object knows how to talk to the physical Weather Station, to get updated data. The WeatherData object then updates its displays for the three different display elements: Current Conditions (shows temperature, humidity, and pressure), Weather Statistics, and a simple forecast.</p><p><span class="strong"><strong>Our job, if we choose to accept it, is to create an app that uses the WeatherData object to update three displays for current conditions, weather stats, and a forecast.</strong></span></p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_unpacking_the_weatherdata_class" style="clear: both">Unpacking the WeatherData class</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2057"></a><a class="indexterm" id="part0009_iddle2511"></a><span class="strong"><strong>As promised, the next morning the WeatherData source files arrive. When we peek inside the code, things look pretty straightforward:</strong></span></p><div class="informalfigure"><a id="part0009_med_id00072a"></a><div class="mediaobject"><a id="part0009_med_id00072"></a><img alt="image with no caption" hisrc="figs/web/040fig01.png.jpg" src="../Images/image00567.jpeg"/></div></div><div class="informalfigure"><a id="part0009_med_id00073a"></a><div class="mediaobject"><a id="part0009_med_id00073"></a><img alt="image with no caption" hisrc="figs/web/040fig02.png.jpg" src="../Images/image00568.jpeg"/></div></div><p><span class="strong"><strong>Our job is to implement measurementsChanged() so that it updates the three displays for current conditions, weather stats, and forecast.</strong></span></p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_what_do_we_know_so_farquestion_mark" style="clear: both">What do we know so far?</h2></div></div></div><div class="informalfigure"><a id="part0009_med_id00074a"></a><div class="mediaobject"><a id="part0009_med_id00074"></a><img alt="image with no caption" hisrc="figs/web/common6.png.jpg" src="../Images/image00569.jpeg"/></div></div><p>The spec from Weather-O-Rama wasn’t all that clear, but we have to figure out what we need to do. So, what do we know so far?</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00016"></a><img alt="" hisrc="figs/web/common7.png.jpg" src="../Images/image00570.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The WeatherData class has getter methods for three measurement values: temperature, humidity, and barometric pressure.</p>
<a id="part0009_pro_id00005"></a><pre class="programlisting"><span class="strong"><strong>getTemperature()</strong></span>
<span class="strong"><strong>getHumidity()</strong></span>
<span class="strong"><strong>getPressure()</strong></span></pre></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00017"></a><img alt="" hisrc="figs/web/common7.png.jpg" src="../Images/image00570.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The measurementsChanged() method is called any time new weather measurement data is available. (We don’t know or care how this method is called; we just know that it <span class="emphasis"><em>is.</em></span>)</p>
<a id="part0009_pro_id00006"></a><pre class="programlisting"><span class="strong"><strong>measurementsChanged()</strong></span></pre></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00018"></a><img alt="" hisrc="figs/web/common7.png.jpg" src="../Images/image00570.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We need to implement three display elements that use the weather data: a <span class="emphasis"><em>current conditions</em></span> display, a <span class="emphasis"><em>statistics display,</em></span> and a <span class="emphasis"><em>forecast</em></span> display. These displays must be updated each time WeatherData has new measurements. <span class="inlinemediaobject"><a id="part0009_inline_id00075a"></a><img alt="" hisrc="figs/web/041fig01.png.jpg" src="../Images/image00571.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00019"></a><img alt="" hisrc="figs/web/common7.png.jpg" src="../Images/image00570.jpeg"/></span></p></td><td style="vertical-align: top; "><p>The system must be expandable — other developers can create new custom display elements and users can add or remove as many display elements as they want to the application. Currently, we know about only the initial <span class="emphasis"><em>three</em></span> display types (current conditions, statistics, and forecast). <span class="inlinemediaobject"><a id="part0009_inline_id00076a"></a><img alt="" hisrc="figs/web/041fig02.png.jpg" src="../Images/image00572.jpeg"/></span></p></td></tr></tbody></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_taking_a_firstcomma_misguided_swag_at_th" style="clear: both">Taking a first, misguided SWAG at the Weather Station</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1564"></a><a class="indexterm" id="part0009_iddle2056"></a><a class="indexterm" id="part0009_iddle2309"></a><a class="indexterm" id="part0009_iddle2446"></a><a class="indexterm" id="part0009_iddle2510"></a>Here’s a first implementation possibility — we’ll take the hint from the Weather-O-Rama developers and add our code to the measurementsChanged() method:</p><div class="informalfigure"><a id="part0009_med_id00077a"></a><div class="mediaobject"><a id="part0009_med_id00077"></a><img alt="image with no caption" hisrc="figs/web/042fig01.png.jpg" src="../Images/image00573.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_sharpen_your_pencil-id00005"></a><h3 class="title">Sharpen your pencil</h3><p>Based on our first implementation, which of the following apply? (Choose all that apply.)</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00020"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We are coding to concrete implementations, not interfaces.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00021"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>For every new display element we need to alter code.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00022"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We have no way to add (or remove) display elements at run time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00023"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The display elements don’t implement a common interface.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00024"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We haven’t encapsulated the part that changes.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00025"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>We are violating encapsulation of the WeatherData class.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Definition of SWAG: Scientific Wild A** Guess</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_whatapostrophes_wrong_with_our_implement" style="clear: both">What’s wrong with our implementation?</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1773"></a>Think back to all those <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a> concepts and principles...</p><div class="informalfigure"><a id="part0009_med_id00078a"></a><div class="mediaobject"><a id="part0009_med_id00078"></a><img alt="image with no caption" hisrc="figs/web/043fig01.png.jpg" src="../Images/image00574.jpeg"/></div></div><div class="informalfigure"><a id="part0009_med_id00079a"></a><div class="mediaobject"><a id="part0009_med_id00079"></a><img alt="image with no caption" hisrc="figs/web/043fig02.png.jpg" src="../Images/image00575.jpeg"/></div></div><p>We’ll take a look at Observer, then come back and figure out how to apply it to the Weather Monitoring app.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_meet_the_observer_pattern" style="clear: both">Meet the Observer Pattern</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2030"></a><span class="strong"><strong>You know how newspaper or magazine subscriptions work:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① A newspaper publisher goes into business and begins publishing newspapers.</li><li class="listitem" style="list-style-type: none">② You subscribe to a particular publisher, and every time there’s a new edition it gets delivered to you. As long as you remain a subscriber, you get new newspapers.</li><li class="listitem" style="list-style-type: none">③ You unsubscribe when you don’t want papers anymore, and they stop being delivered.</li><li class="listitem" style="list-style-type: none">④ While the publisher remains in business, people, hotels, airlines, and other businesses constantly subscribe and unsubscribe to the newspaper.</li></ul></div><div class="informalfigure"><a id="part0009_med_id00080a"></a><div class="mediaobject"><a id="part0009_med_id00080"></a><img alt="image with no caption" hisrc="figs/web/044fig01.png.jpg" src="../Images/image00576.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_publishers_plus_subscribers_equals_obser" style="clear: both">Publishers + Subscribers = Observer Pattern</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2045"></a><a class="indexterm" id="part0009_iddle2048"></a><a class="indexterm" id="part0009_iddle2049"></a><a class="indexterm" id="part0009_iddle2061"></a><a class="indexterm" id="part0009_iddle2202"></a><a class="indexterm" id="part0009_iddle2441"></a><span class="strong"><strong>If you understand newspaper subscriptions, you pretty much understand the Observer Pattern, only we call the publisher the SUBJECT and the subscribers the OBSERVERS.</strong></span></p><p><span class="strong"><strong>Let’s take a closer look:</strong></span></p><div class="informalfigure"><a id="part0009_med_id00081a"></a><div class="mediaobject"><a id="part0009_med_id00081"></a><img alt="image with no caption" hisrc="figs/web/045fig01.png.jpg" src="../Images/image00577.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_day_in_the_life_of_the_observer_pattern" style="clear: both">A day in the life of the Observer Pattern</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><a class="indexterm" id="part0009_iddle2047"></a><span class="strong"><strong>A Duck object comes along and tells the Subject that it wants to become an observer.</strong></span></p>
<p>Duck really wants in on the action; those ints Subject is sending out whenever its state changes look pretty interesting...</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00082a"></a><img alt="" hisrc="figs/web/046fig01.png.jpg" src="../Images/image00578.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>The Duck object is now an official observer.</strong></span></p>
<p>Duck is psyched... he’s on the list and is waiting with great anticipation for the next notification so he can get an int.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00083a"></a><img alt="" hisrc="figs/web/046fig02.png.jpg" src="../Images/image00579.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>The Subject gets a new data value!</strong></span></p>
<p>Now Duck and all the rest of the observers get a notification that the Subject has changed.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00084a"></a><img alt="" hisrc="figs/web/046fig03.png.jpg" src="../Images/image00580.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>The Mouse object asks to be removed as an observer.</strong></span></p>
<p>The Mouse object has been getting ints for ages and is tired of it, so it decides it’s time to stop being an observer.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00085a"></a><img alt="" hisrc="figs/web/047fig01.png.jpg" src="../Images/image00581.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Mouse is outta here!</strong></span></p>
<p>The Subject acknowledges the Mouse’s request and removes it from the set of observers.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00086a"></a><img alt="" hisrc="figs/web/047fig02.png.jpg" src="../Images/image00582.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="strong"><strong>The Subject has another new int.</strong></span></p>
<p>All the observers get another notification, except for the Mouse who is no longer included. Don’t tell anyone, but the Mouse secretly misses those ints... maybe it’ll ask to be an observer again some day.</p></td><td style="vertical-align: top; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00087a"></a><img alt="" hisrc="figs/web/047fig03.png.jpg" src="../Images/image00583.jpeg"/></span></p></td></tr></tbody></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_five-minute_drama_a_subject_for_observat" style="clear: both">Five-minute drama: a subject for observation</h2></div></div></div><div class="informalfigure"><a id="part0009_med_id00088a"></a><div class="mediaobject"><a id="part0009_med_id00088"></a><img alt="image with no caption" hisrc="figs/web/common8.png.jpg" src="../Images/image00584.jpeg"/></div></div><p><a class="indexterm" id="part0009_iddle2039"></a><a class="indexterm" id="part0009_iddle2060"></a><a class="indexterm" id="part0009_iddle2440"></a>In today’s skit, two post-bubble software developers encounter a real live head hunter...</p><div class="informalfigure"><a id="part0009_med_id00089a"></a><div class="mediaobject"><a id="part0009_med_id00089"></a><img alt="image with no caption" hisrc="figs/web/048fig01.png.jpg" src="../Images/image00585.jpeg"/></div></div><div class="informalfigure"><a id="part0009_med_id00090a"></a><div class="mediaobject"><a id="part0009_med_id00090"></a><img alt="image with no caption" hisrc="figs/web/049fig01.png.jpg" src="../Images/image00586.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_two_weeks_laterhellip" style="clear: both">Two weeks later...</h2></div></div></div><div class="informalfigure"><a id="part0009_med_id00091a"></a><div class="mediaobject"><a id="part0009_med_id00091"></a><img alt="image with no caption" hisrc="figs/web/050fig01.png.jpg" src="../Images/image00587.jpeg"/></div></div><p>Jill’s loving life, and no longer an observer. She’s also enjoying the nice fat signing bonus that she got because the company didn’t have to pay a headhunter.</p><div class="informalfigure"><a id="part0009_med_id00092a"></a><div class="mediaobject"><a id="part0009_med_id00092"></a><img alt="image with no caption" hisrc="figs/web/050fig02.png.jpg" src="../Images/image00588.jpeg"/></div></div><p>But what has become of our dear Lori? We hear she’s beating the headhunter at his own game. She’s not only still an observer, she’s got her own call list now, and she is notifying her own observers. Lori’s a subject and an observer all in one.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_observer_pattern_defined" style="clear: both">The Observer Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1105"></a><a class="indexterm" id="part0009_iddle2031"></a><a class="indexterm" id="part0009_iddle2034"></a><a class="indexterm" id="part0009_iddle2046"></a><a class="indexterm" id="part0009_iddle2076"></a>When you’re trying to picture the Observer Pattern, a newspaper subscription service with its publisher and subscribers is a good way to visualize the pattern.</p><p>In the real world, however, you’ll typically see the Observer Pattern defined like this:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note01"></a>Note</h3><p><span class="strong"><strong>The Observer Pattern</strong></span> defines a one-to-many dependency between objects so that when one object changes state, all of its dependents are notified and updated automatically.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Let’s relate this definition to how we’ve been talking about the pattern:</p><div class="informalfigure"><a id="part0009_med_id00093a"></a><div class="mediaobject"><a id="part0009_med_id00093"></a><img alt="image with no caption" hisrc="figs/web/051fig01.png.jpg" src="../Images/image00589.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>The Observer Pattern defines a one-to-many relationship between a set of objects.</strong></span></div><div><span class="strong"><strong>When the state of one object changes, all of its dependents are notified.</strong></span></div></blockquote></div><p>The subject and observers define the one-to-many relationship. The observers are dependent on the subject such that when the subject’s state changes, the observers get notified. Depending on the style of notification, the observer may also be updated with new values.</p><p>As you’ll discover, there are a few different ways to implement the Observer Pattern, but most revolve around a class design that includes Subject and Observer interfaces.</p><p>Let’s take a look...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_observer_pattern_defined_the_class_diagr" style="clear: both">The Observer Pattern defined: the class diagram</h2></div></div></div><div class="informalfigure"><a id="part0009_med_id00094a"></a><div class="mediaobject"><a id="part0009_med_id00094"></a><img alt="image with no caption" hisrc="figs/web/052fig01.png.jpg" src="../Images/image00590.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_there_are_no_dumb_questions-id00006"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa1qe1"></a><a id="part0009_ch02qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0009_iddle1369"></a><a class="indexterm" id="part0009_iddle2035"></a><a class="indexterm" id="part0009_iddle2059"></a><a class="indexterm" id="part0009_iddle2439"></a><span class="strong"><strong>Q: What does this have to do with one-to-many relationships?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> With the Observer Pattern, the Subject is the object that contains the state and controls it. So, there is ONE subject with state. The observers, on the other hand, use the state, even if they don’t own it. There are many observers and they rely on the Subject to tell them when its state changes. So there is a relationship between the ONE Subject to the MANY Observers.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa1qe2"></a><a id="part0009_ch02qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How does dependence come into this?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Because the subject is the sole owner of that data, the observers are dependent on the subject to update them when the data changes. This leads to a cleaner OO design than allowing many objects to control the same data.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_power_of_loose_coupling" style="clear: both">The power of Loose Coupling</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1100"></a><a class="indexterm" id="part0009_iddle1425"></a><a class="indexterm" id="part0009_iddle1890"></a><a class="indexterm" id="part0009_iddle2015"></a><a class="indexterm" id="part0009_iddle2020"></a><a class="indexterm" id="part0009_iddle2044"></a><a class="indexterm" id="part0009_iddle2086"></a><a class="indexterm" id="part0009_iddle2476"></a><span class="strong"><strong>When two objects are loosely coupled, they can interact, but have very little knowledge of each other.</strong></span></p><p><span class="strong"><strong>The Observer Pattern provides an object design where subjects and observers are loosely coupled.</strong></span></p><p><span class="strong"><strong>Why?</strong></span></p><p><span class="strong"><strong>The only thing the subject knows about an observer is that it implements a certain interface (the Observer interface).</strong></span> It doesn’t need to know the concrete class of the observer, what it does, or anything else about it.</p><p><span class="strong"><strong>We can add new observers at any time.</strong></span> Because the only thing the subject depends on is a list of objects that implement the Observer interface, we can add new observers whenever we want. In fact, we can replace any observer at runtime with another observer and the subject will keep purring along. Likewise, we can remove observers at any time.</p><p><span class="strong"><strong>We never need to modify the subject to add new types of observers.</strong></span> Let’s say we have a new concrete class come along that needs to be an observer. We don’t need to make any changes to the subject to accommodate the new class type; all we have to do is implement the Observer interface in the new class and register as an observer. The subject doesn’t care; it will deliver notifications to any object that implements the Observer interface.</p><p><span class="strong"><strong>We can reuse subjects or observers independently of each other.</strong></span> If we have another use for a subject or an observer, we can easily reuse them because the two aren’t tightly coupled.</p><p><span class="strong"><strong>Changes to either the subject or an observer will not affect the other.</strong></span> Because the two are loosely coupled, we are free to make changes to either, as long as the objects still meet their obligations to implement the subject or observer interfaces.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note02"></a>Note</h3><p>How many different kinds of change can you identify here?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note03"></a>Design Principle</h3><p><span class="emphasis"><em>Strive for loosely coupled designs between objects that interact.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Loosely coupled designs allow us to build flexible OO systems that can handle change because they minimize the interdependency between objects.</strong></span></p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_sharpen_your_pencil-id00007"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0009_iddle1559"></a><a class="indexterm" id="part0009_iddle2304"></a>Before moving on, try sketching out the classes you’ll need to implement the Weather Station, including the WeatherData class and its display elements. Make sure your diagram shows how all the pieces fit together and also how another developer might implement her own display element.</p><p>If you need a little help, read the next page; your teammates are already talking about how to design the Weather Station.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_cubicle_conversation" style="clear: both">Cubicle conversation</h2></div></div></div><p>Back to the Weather Station project. Your teammates have already started thinking through the problem...</p><div class="informalfigure"><a id="part0009_med_id00095a"></a><div class="mediaobject"><a id="part0009_med_id00095"></a><img alt="image with no caption" hisrc="figs/web/055fig01.png.jpg" src="../Images/image00591.jpeg"/></div></div><p><span class="strong"><strong>Mary:</strong></span> Well, it helps to know we’re using the Observer Pattern.</p><p><span class="strong"><strong>Sue:</strong></span> Right... but how do we apply it?</p><p><span class="strong"><strong>Mary:</strong></span> Hmm. Let’s look at the definition again:</p><p><span class="emphasis"><em>The Observer Pattern defines a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.</em></span></p><p><span class="strong"><strong>Mary:</strong></span> That actually makes some sense when you think about it. Our WeatherData class is the “one” and our “many” is the various display elements that use the weather measurements.</p><p><span class="strong"><strong>Sue:</strong></span> That’s right. The WeatherData class certainly has state... that’s the temperature, humidity, and barometric pressure, and those definitely change.</p><p><span class="strong"><strong>Mary:</strong></span> Yup, and when those measurements change, we have to notify all the display elements so they can do whatever it is they are going to do with the measurements.</p><p><span class="strong"><strong>Sue:</strong></span> Cool, I now think I see how the Observer Pattern can be applied to our Weather Station problem.</p><p><span class="strong"><strong>Mary:</strong></span> There are still a few things to consider that I’m not sure I understand yet.</p><p><span class="strong"><strong>Sue:</strong></span> Like what?</p><p><span class="strong"><strong>Mary:</strong></span> For one thing, how do we get the weather measurements to the display elements?</p><p><span class="strong"><strong>Sue:</strong></span> Well, looking back at the picture of the Observer Pattern, if we make the WeatherData object the subject, and the display elements the observers, then the displays will register themselves with the WeatherData object in order to get the information they want, right?</p><p><span class="strong"><strong>Mary:</strong></span> Yes... and once the Weather Station knows about a display element, then it can just call a method to tell it about the measurements.</p><p><span class="strong"><strong>Sue:</strong></span> We gotta remember that every display element can be different... so I think that’s where having a common interface comes in. Even though every component has a different type, they should all implement the same interface so that the WeatherData object will know how to send them the measurements.</p><p><span class="strong"><strong>Mary:</strong></span> I see what you mean. So every display will have, say, an update() method that WeatherData will call.</p><p><span class="strong"><strong>Sue:</strong></span> And update() is defined in a common interface that all the elements implement...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_designing_the_weather_station" style="clear: both">Designing the Weather Station</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2053"></a><a class="indexterm" id="part0009_iddle2507"></a>How does this diagram compare with yours?</p><div class="informalfigure"><a id="part0009_med_id00096a"></a><div class="mediaobject"><a id="part0009_med_id00096"></a><img alt="image with no caption" hisrc="figs/web/056fig01.png.jpg" src="../Images/image00592.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_implementing_the_weather_station" style="clear: both">Implementing the Weather Station</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2054"></a><a class="indexterm" id="part0009_iddle2508"></a>We’re going to start our implementation using the class diagram and following Mary and Sue’s lead (from a few pages back). You’ll see later in this chapter that Java provides some built-in support for the Observer Pattern, however, we’re going to get our hands dirty and roll our own for now. While in some cases you can make use of Java’s built-in support, in a lot of cases it’s more flexible to build your own (and it’s not all that hard). So, let’s get started with the interfaces:</p><div class="informalfigure"><a id="part0009_med_id00097a"></a><div class="mediaobject"><a id="part0009_med_id00097"></a><img alt="image with no caption" hisrc="figs/web/057fig01.png.jpg" src="../Images/image00593.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note04"></a>Brain Power</h3><p>Mary and Sue thought that passing the measurements directly to the observers was the most straightforward method of updating state. Do you think this is wise? Hint: is this an area of the application that might change in the future? If it did change, would the change be well encapsulated, or would it require changes in many parts of the code?</p><p>Can you think of other ways to approach the problem of passing the updated state to the observers?</p><p>Don’t worry; we’ll come back to this design decision after we finish the initial implementation.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_implementing_the_subject_interface_in_we" style="clear: both">Implementing the Subject interface in WeatherData</h2></div></div></div><div class="blockquote"><blockquote class="blockquote"><div>REMEMBER: we don’t provide import and package statements in the code listings. Get the complete source code from <a class="ulink" href="http://wickedlysmart.com/head-first-design-patterns/" target="_top">http://wickedlysmart.com/head-first-design-patterns/</a>.</div></blockquote></div><p>Remember our first attempt at implementing the WeatherData class at the beginning of the chapter? You might want to refresh your memory. Now it’s time to go back and do things with the Observer Pattern in mind...</p><div class="informalfigure"><a id="part0009_med_id00098a"></a><div class="mediaobject"><a id="part0009_med_id00098"></a><img alt="image with no caption" hisrc="figs/web/058fig01.png.jpg" src="../Images/image00594.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_nowcomma_letapostrophes_build_those_disp" style="clear: both">Now, let’s build those display elements</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2052"></a><a class="indexterm" id="part0009_iddle2506"></a>Now that we’ve got our WeatherData class straightened out, it’s time to build the Display Elements. Weather-O-Rama ordered three: the current conditions display, the statistics display, and the forecast display. Let’s take a look at the current conditions display; once you have a good feel for this display element, check out the statistics and forecast displays in the code directory. You’ll see they are very similar.</p><div class="informalfigure"><a id="part0009_med_id00099a"></a><div class="mediaobject"><a id="part0009_med_id00099"></a><img alt="image with no caption" hisrc="figs/web/059fig01.png.jpg" src="../Images/image00595.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_there_are_no_dumb_questions-id00008"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa2qe1"></a><a id="part0009_ch02qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Is update() the best place to call display?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> In this simple example it made sense to call display() when the values changed. However, you are right; there are much better ways to design the way the data gets displayed. We are going to see this when we get to the Model-View-Controller pattern.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa2qe2"></a><a id="part0009_ch02qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Why did you store a reference to the Subject? It doesn’t look like you use it again after the constructor.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0009_ch02qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> True, but in the future we may want to un-register ourselves as an observer and it would be handy to already have a reference to the subject.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_power_up_the_weather_station" style="clear: both">Power up the Weather Station</h2></div></div></div><div class="informalfigure"><a id="part0009_med_id00100a"></a><div class="mediaobject"><a id="part0009_med_id00100"></a><img alt="image with no caption" hisrc="figs/web/common6.png.jpg" src="../Images/image00569.jpeg"/></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① <a class="indexterm" id="part0009_iddle2055"></a><a class="indexterm" id="part0009_iddle2509"></a><span class="strong"><strong>First, let’s create a test harness.</strong></span><br/>The Weather Station is ready to go. All we need is some code to glue everything together. Here’s our first attempt. We’ll come back later in the book and make sure all the components are easily pluggable via a configuration file. For now here’s how it all works:<div class="informalfigure"><a id="part0009_med_id00101a"></a><div class="mediaobject"><a id="part0009_med_id00101"></a><img alt="image with no caption" hisrc="figs/web/060fig01.png.jpg" src="../Images/image00596.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Run the code and let the Observer Pattern do its magic.</strong></span><div class="informalfigure"><a id="part0009_med_id00102a"></a><div class="mediaobject"><a id="part0009_med_id00102"></a><img alt="image with no caption" hisrc="figs/web/060fig02.png.jpg" src="../Images/image00597.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_sharpen_your_pencil-id00009"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0009_iddle2282"></a>Johnny Hurricane, Weather-O-Rama’s CEO, just called and they can’t possibly ship without a Heat Index display element. Here are the details.</p><p>The heat index is an index that combines temperature and humidity to determine the apparent temperature (how hot it actually feels). To compute the heat index, you take the temperature, T, and the relative humidity, RH, and use this formula:</p><a id="part0009_pro_id00007"></a><pre class="programlisting"><span class="strong"><strong>heatindex =</strong></span>

    <span class="strong"><strong>16.923 + 1.85212 * 10<sup>-1</sup> * T + 5.37941 * RH - 1.00254 * 10<sup>-1</sup> *</strong></span>
    <span class="strong"><strong>T * RH + 9.41695 * 10<sup>-3</sup> * T<sup>2</sup> + 7.28898 * 10<sup>-3</sup> * RH<sup>2</sup> + 3.45372 *</strong></span>
    <span class="strong"><strong>10<sup>-4</sup> * T<sup>2</sup> * RH - 8.14971 * 10<sup>-4</sup> * T * RH<sup>2</sup> + 1.02102 * 10<sup>-5</sup> * T<sup>2</sup> *</strong></span>
    <span class="strong"><strong>RH<sup>2</sup> - 3.8646 * 10<sup>-5</sup> * T<sup>3</sup> + 2.91583 * 10<sup>-5</sup> * RH<sup>3</sup> + 1.42721 * 10<sup>-6</sup></strong></span>
    <span class="strong"><strong>* T<sup>3</sup> * RH + 1.97483 * 10<sup>-7</sup> * T * RH<sup>3</sup> - 2.18429 * 10<sup>-8</sup> * T<sup>3</sup> * RH<sup>2</sup></strong></span>
    <span class="strong"><strong>+ 8.43296 * 10<sup>-10</sup> * T<sup>2</sup> * RH<sup>3</sup> - 4.81975 * 10<sup>-11</sup> * T<sup>3</sup> * RH<sup>3</sup></strong></span></pre><p>So get typing!</p><p>Just kidding. Don’t worry, you won’t have to type that formula in; just create your own HeatIndexDisplay.java file and copy the formula from heatindex.txt into it.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note05"></a>Note</h3><p>You can get heatindex.txt from wickedlysmart.com.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>How does it work? You’d have to refer to <span class="emphasis"><em>Head First Meteorology</em></span>, or try asking someone at the National Weather Service (or try a web search).</p><p>When you finish, your output should look like this:</p><div class="informalfigure"><a id="part0009_med_id00103a"></a><div class="mediaobject"><a id="part0009_med_id00103"></a><img alt="image with no caption" hisrc="figs/web/061fig01.png.jpg" src="../Images/image00598.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_fireside_chats"></a><h3 class="title"><code class="literal">Fireside Chats</code></h3><p>Tonight’s talk: <span class="strong"><strong>A Subject and Observer spar over the right way to get state information to the Observer.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Subject:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Observer:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I’m glad we’re finally getting a chance to chat in person.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Really? I thought you didn’t care much about us Observers.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, I do my job, don’t I? I always tell you what’s going on... Just because I don’t really know who you are doesn’t mean I don’t care. And besides, I do know the most important thing about you — you implement the Observer interface.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yeah, but that’s just a small part of who I am. Anyway, I know a lot more about you...</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Oh yeah, like what?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, you’re always passing your state around to us Observers so we can see what’s going on inside you. Which gets a little annoying at times...</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, excuuuse me. I have to send my state with my notifications so all you lazy Observers will know what happened!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, wait just a minute here; first, we’re not lazy, we just have other stuff to do in between your oh-so-important notifications, Mr. Subject, and second, why don’t you let us come to you for the state we want rather than pushing it out to just everyone?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well... I guess that might work. I’d have to open myself up even more, though, to let all you Observers come in and get the state that you need. That might be kind of dangerous. I can’t let you come in and just snoop around looking at everything I’ve got.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Why don’t you just write some public getter methods that will let us pull out the state we need?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Yes, I could let you <span class="strong"><strong>pull</strong></span> my state. But won’t that be less convenient for you? If you have to come to me every time you want something, you might have to make multiple method calls to get all the state you want. That’s why I like <span class="strong"><strong>push</strong></span> better... then you have everything you need in one notification.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Don’t be so pushy! There are so many different kinds of us Observers, there’s no way you can anticipate everything we need. Just let us come to you to get the state we need. That way, if some of us only need a little bit of state, we aren’t forced to get it all. It also makes things easier to modify later. Say, for example, you expand yourself and add some more state. If you use pull, you don’t have to go around and change the update calls on every observer; you just need to change yourself to allow more getter methods to access our additional state.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, I can see the advantages to doing it both ways. I have noticed that there is a built-in Java Observer Pattern that allows you to use either push or pull.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Oh really? I think we’re going to look at that next....</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Great... maybe I’ll get to see a good example of pull and change my mind.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; "> </td><td style="vertical-align: top; "><p>What, us agree on something? I guess there’s always hope.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_using_javaapostrophes_built-in_observer" style="clear: both">Using Java’s built-in Observer Pattern</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1861"></a><a class="indexterm" id="part0009_iddle2051"></a>So far we’ve rolled our own code for the Observer Pattern, but Java has built-in support in several of its APIs. The most general is the Observer interface and the Observable class in the java.util package. These are quite similar to our Subject and Observer interfaces, but give you a lot of functionality out of the box. You can also implement either a push or pull style of update to your observers, as you will see.</p><p>To get a high-level feel for java.util.Observer and java.util.Observable, check out this reworked OO design for the WeatherStation:</p><div class="informalfigure"><a id="part0009_med_id00104a"></a><div class="mediaobject"><a id="part0009_med_id00104"></a><img alt="image with no caption" hisrc="figs/web/064fig01.png.jpg" src="../Images/image00599.jpeg"/></div></div><div class="informalfigure"><a id="part0009_med_id00105a"></a><div class="mediaobject"><a id="part0009_med_id00105"></a><img alt="image with no caption" hisrc="figs/web/064fig02.png.jpg" src="../Images/image00600.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_how_javaapostrophes_built-in_observer_pa" style="clear: both">How Java’s built-in Observer Pattern works</h2></div></div></div><p>The built-in Observer Pattern works a bit differently than the implementation that we used on the Weather Station. The most obvious difference is that WeatherData (our subject) now extends the Observable class and inherits the add, delete, and notify Observer methods (among a few others). Here’s how we use Java’s version:</p><p><span class="strong"><strong>For an Object to become an observer...</strong></span></p><p>As usual, implement the Observer interface (this time the java.util.Observer interface) and call addObserver() on any Observable object. Likewise, to remove yourself as an observer, just call deleteObserver().</p><p><span class="strong"><strong>For the Observable to send notifications...</strong></span></p><p>First of all you need to be Observable by extending the java.util.Observable superclass. From there it is a two-step process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① You first must call the setChanged() method to signify that the state has changed in your object.</li><li class="listitem" style="list-style-type: none">② Then, call one of two notifyObservers() methods:<div class="informalfigure"><a id="part0009_med_id00106a"></a><div class="mediaobject"><a id="part0009_med_id00106"></a><img alt="image with no caption" hisrc="figs/web/065fig01.png.jpg" src="../Images/image00601.jpeg"/></div></div></li></ul></div><p><span class="strong"><strong>For an Observer to receive notifications...</strong></span></p><p>It implements the update method, as before, but the signature of the method is a bit different:</p><p>If you want to “push” data to the observers, you can pass the data as a data object to the notifyObservers(arg) method. If not, then the Observer has to “pull” the data it wants from the Observable object passed to it. How? Let’s rework the Weather Station and you’ll see.</p><div class="informalfigure"><a id="part0009_med_id00107a"></a><div class="mediaobject"><a id="part0009_med_id00107"></a><img alt="image with no caption" hisrc="figs/web/066fig01.png.jpg" src="../Images/image00602.jpeg"/></div></div><p>The setChanged() method is used to signify that the state has changed and that notifyObservers(), when it is called, should update its observers. If notifyObservers() is called without first calling setChanged(), the observers will NOT be notified. Let’s take a look behind the scenes of Observable to see how this works:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_behind_the_scenes"></a><h3 class="title">Behind the Scenes</h3><div class="informalfigure"><a id="part0009_med_id00108a"></a><div class="mediaobject"><a id="part0009_med_id00108"></a><img alt="image with no caption" hisrc="figs/web/066fig02.png.jpg" src="../Images/image00603.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Why is this necessary? The setChanged() method is meant to give you more flexibility in how you update observers by allowing you to optimize the notifications. For example, in our Weather Station, imagine if our measurements were so sensitive that the temperature readings were constantly fluctuating by a few tenths of a degree. That might cause the WeatherData object to send out notifications constantly. Instead, we might want to send out notifications only if the temperature changes more than half a degree and we could call setChanged() only after that happened.</p><p>You might not use this functionality very often, but it’s there if you need it. In either case, you need to call setChanged() for notifications to work. If this functionality is something that is useful to you, you may also want to use the clearChanged() method, which sets the changed state back to false, and the hasChanged() method, which tells you the current state of the changed flag.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_reworking_the_weather_station_with_the_b" style="clear: both">Reworking the Weather Station with the built-in support</h2></div></div></div><p><a class="indexterm" id="part0009_iddle2058"></a><a class="indexterm" id="part0009_iddle2512"></a><span class="strong"><strong>First, let’s rework WeatherData to use java.util.Observable</strong></span></p><div class="informalfigure"><a id="part0009_med_id00109a"></a><div class="mediaobject"><a id="part0009_med_id00109"></a><img alt="image with no caption" hisrc="figs/web/067fig01.png.jpg" src="../Images/image00604.jpeg"/></div></div><p><span class="strong"><strong>Now, let’s rework the CurrentConditionsDisplay</strong></span></p><div class="informalfigure"><a id="part0009_med_id00110a"></a><div class="mediaobject"><a id="part0009_med_id00110"></a><img alt="image with no caption" hisrc="figs/web/068fig01.png.jpg" src="../Images/image00605.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_code_magnets"></a><h3 class="title">Code Magnets</h3><p><a class="indexterm" id="part0009_iddle1144"></a><a class="indexterm" id="part0009_iddle1507"></a>The ForecastDisplay class is all scrambled up on the fridge. Can you reconstruct the code snippets to make it work? Some of the curly braces fell on the floor and they were too small to pick up, so feel free to add as many of those as you need!</p><div class="informalfigure"><a id="part0009_med_id00111a"></a><div class="mediaobject"><a id="part0009_med_id00111"></a><img alt="image with no caption" hisrc="figs/web/069fig01.png.jpg" src="../Images/image00606.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_running_the_new_code" style="clear: both">Running the new code</h2></div></div></div><p><span class="strong"><strong>Just to be sure, let’s run the new code...</strong></span></p><div class="informalfigure"><a id="part0009_med_id00112a"></a><div class="mediaobject"><a id="part0009_med_id00112"></a><img alt="image with no caption" hisrc="figs/web/070fig01.png.jpg" src="../Images/image00607.jpeg"/></div></div><p><span class="strong"><strong>Hmm, do you notice anything different? Look again...</strong></span></p><p>You’ll see all the same calculations, but mysteriously, the order of the text output is different. Why might this happen? Think for a minute before reading on...</p><p><span class="strong"><strong>Never depend on order of evaluation of the Observer notifications</strong></span></p><p>The java.util.Observable has implemented its notifyObservers() method such that the Observers are notified in a <span class="emphasis"><em>different</em></span> order than our own implementation. Who’s right? Neither; we just chose to implement things in different ways.</p><p>What would be incorrect, however, is if we wrote our code to <span class="emphasis"><em>depend</em></span> on a specific notification order. Why? Because if you need to change Observable/Observer implementations, the order of notification could change and your application would produce incorrect results. Now that’s definitely not what we’d consider loosely coupled.</p><div class="informalfigure"><a id="part0009_med_id00113a"></a><div class="mediaobject"><a id="part0009_med_id00113"></a><img alt="image with no caption" hisrc="figs/web/071fig01.png.jpg" src="../Images/image00608.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_dark_side_of_javadotutildotobservable" style="clear: both">The dark side of java.util.Observable</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1420"></a><a class="indexterm" id="part0009_iddle1799"></a><a class="indexterm" id="part0009_iddle2141"></a>Yes, good catch. As you’ve noticed, Observable is a class, not an <span class="emphasis"><em>interface</em></span>, and worse, it doesn’t even <span class="emphasis"><em>implement</em></span> an interface. Unfortunately, the java.util.Observable implementation has a number of problems that limit its usefulness and reuse. That’s not to say it doesn’t provide some utility, but there are some large potholes to watch out for.</p><p><span class="strong"><strong>Observable is a class</strong></span></p><p>You already know from our principles this is a bad idea, but what harm does it really cause?</p><p>First, because Observable is a <span class="emphasis"><em>class</em></span>, you have to <span class="emphasis"><em>subclass</em></span> it. That means you can’t add on the Observable behavior to an existing class that already extends another superclass. This limits its reuse potential (and isn’t that why we are using patterns in the first place?).</p><p>Second, because there isn’t an Observable interface, you can’t even create your own implementation that plays well with Java’s built-in Observer API. Nor do you have the option of swapping out the java.util implementation for another (say, a new, multithreaded implementation).</p><p><span class="strong"><strong>Observable protects crucial methods</strong></span></p><p>If you look at the Observable API, the setChanged() method is protected. So what? Well, this means you can’t call setChanged() unless you’ve subclassed Observable. This means you can’t even create an instance of the Observable class and compose it with your own objects, you <span class="emphasis"><em>have</em></span> to subclass. The design violates a second design principle here...<span class="emphasis"><em>favor composition over inheritance</em></span>.</p><p><span class="strong"><strong>What to do?</strong></span></p><p>Observable <span class="emphasis"><em>may</em></span> serve your needs if you can extend java.util.Observable. On the other hand, you may need to roll your own implementation as we did at the beginning of the chapter. In either case, you know the Observer Pattern well and you’re in a good position to work with any API that makes use of the pattern.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_other_places_youapostrophell_find_the_ob" style="clear: both">Other places you’ll find the Observer Pattern in the JDK</h2></div></div></div><p><a class="indexterm" id="part0009_iddle1871"></a><a class="indexterm" id="part0009_iddle2050"></a><a class="indexterm" id="part0009_iddle2448"></a>The java.util implementation of Observer/Observable is not the only place you’ll find the Observer Pattern in the JDK; both JavaBeans and Swing also provide their own implementations of the pattern. At this point you understand enough about Observer to explore these APIs on your own; however, let’s do a quick, simple Swing example just for the fun of it.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note06"></a>Note</h3><p>If you’re curious about the Observer Pattern in JavaBeans, check out the PropertyChangeListener interface.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>A little background...</strong></span></p><p>Let’s take a look at a simple part of the Swing API, the JButton. If you look under the hood at JButton’s superclass, AbstractButton, you’ll see that it has a lot of add/ remove listener methods. These methods allow you to add and remove observers, or, as they are called in Swing, listeners, to listen for various types of events that occur on the Swing component. For instance, an ActionListener lets you “listen in” on any types of actions that might occur on a button, like a button press. You’ll find various types of listeners all over the Swing API.</p><p><span class="strong"><strong>A little life-changing application</strong></span></p><p>Okay, our application is pretty simple. You’ve got a button that says “Should I do it?” and when you click on that button the listeners (observers) get to answer the question in any way they want. We’re implementing two such listeners, called the AngelListener and the DevilListener. Here’s how the application behaves:</p><div class="informalfigure"><a id="part0009_med_id00114a"></a><div class="mediaobject"><a id="part0009_med_id00114"></a><img alt="image with no caption" hisrc="figs/web/072fig01.png.jpg" src="../Images/image00609.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_and_the_codehellip" style="clear: both">And the code...</h2></div></div></div><p>This life-changing application requires very little code. All we need to do is create a JButton object, add it to a JFrame and set up our listeners. We’re going to use inner classes for the listeners, which is a common technique in Swing programming. If you aren’t up on inner classes or Swing, you might want to review the “Getting GUI” chapter of <span class="emphasis"><em>Head First Java</em></span>.</p><div class="informalfigure"><a id="part0009_med_id00115a"></a><div class="mediaobject"><a id="part0009_med_id00115"></a><img alt="image with no caption" hisrc="figs/web/073fig01.png.jpg" src="../Images/image00610.jpeg"/></div></div><div class="informalfigure"><a id="part0009_med_id00116a"></a><div class="mediaobject"><a id="part0009_med_id00116"></a><img alt="image with no caption" hisrc="figs/web/074fig01.png.jpg" src="../Images/image00611.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note07"></a>Note</h3><p><a class="indexterm" id="part0009_iddle1877"></a><a class="indexterm" id="part0009_iddle2043"></a>Lambda expressions were added in Java 8. If you aren’t familiar with them, don’t worry about it; you can continue using inner classes for your Swing observers.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Yes, you’re still using the Observer Pattern. By using a lambda expression rather than an inner class, you’re just skipping the step of creating an ActionListener object. With a lambda expression, you create a function object instead, and this function object is the observer. When you pass that function object to addActionListener(), Java ensures its signature matches actionPerformed(), the one method in the ActionListener interface.</p><p>Later, when the button is clicked, the button object notifies its observers — including the function objects created by the lambda expressions — that it’s been clicked, and calls each listener’s actionPerformed() method.</p><p>Let’s take a look at how you’d use lambda expressions as observers to simplify our previous code:</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0009_updated_codecomma_using_lambda_expressio">The updated code, using lambda expressions</h3></div></div></div><div class="informalfigure"><a id="part0009_med_id00117a"></a><div class="mediaobject"><a id="part0009_med_id00117"></a><img alt="image with no caption" hisrc="figs/web/074fig02.png.jpg" src="../Images/image00612.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0009_tools_for_your_design_toolbox-id00010" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>Welcome to the end of <a class="xref" href="#part0009_aid-8IL22">Chapter 2</a>. You’ve added a few new things to your OO toolbox...</p><div class="informalfigure"><a id="part0009_med_id00118a"></a><div class="mediaobject"><a id="part0009_med_id00118"></a><img alt="image with no caption" hisrc="figs/web/075fig01.png.jpg" src="../Images/image00613.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_bullet_points-id00011"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Observer Pattern defines a one-to-many relationship between objects.</li><li class="listitem">Subjects, or as we also know them, Observables, update Observers using a common interface.</li><li class="listitem">Observers are loosely coupled in that the Observable knows nothing about them, other than that they implement the Observer interface.</li><li class="listitem">You can push or pull data from the Observable when using the pattern (pull is considered more “correct”).</li><li class="listitem">Don’t depend on a specific order of notification for your Observers.</li><li class="listitem">Java has several implementations of the Observer Pattern, including the general purpose java.util.Observable.</li><li class="listitem">Watch out for issues with the java.util.Observable implementation.</li><li class="listitem">Don’t be afraid to create your own Observable implementation if needed.</li><li class="listitem">Swing makes heavy use of the Observer Pattern, as do many GUI frameworks.</li><li class="listitem">You’ll also find the pattern in many other places, including JavaBeans and RMI.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_design_principle_challenge"></a><h3 class="title">Design Principle Challenge</h3><p><a class="indexterm" id="part0009_iddle1403"></a><a class="indexterm" id="part0009_iddle1407"></a><a class="indexterm" id="part0009_iddle1421"></a><a class="indexterm" id="part0009_iddle1426"></a><a class="indexterm" id="part0009_iddle1470"></a><a class="indexterm" id="part0009_iddle1674"></a><a class="indexterm" id="part0009_iddle2142"></a>For each design principle, describe how the Observer Pattern makes use of the principle.</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note08"></a>Design Principle</h3><p><span class="emphasis"><em>Identify the aspects of your application that vary and separate them from what stays the same.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note09"></a>Design Principle</h3><p><span class="emphasis"><em>Program to an interface, not an implementation.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note10"></a>Design Principle</h3><p><span class="emphasis"><em>Favor composition over inheritance.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></td><td style="vertical-align: top; "><p><span class="underline">This is a hard one, hint: think about how observers and subjects work together.</span></p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p>
<p>______________________________________________________</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_design_patterns_crossword-id00012"></a><h3 class="title">Design Patterns Crossword</h3><p>Time to give your right brain something to do again! This time all of the solution words are from <a class="xref" href="#part0009_aid-8IL22">Chapter 2</a>.</p><div class="informalfigure"><a id="part0009_med_id00119a"></a><div class="mediaobject"><a id="part0009_med_id00119"></a><img alt="image with no caption" hisrc="figs/web/077fig01.png" src="../Images/image00614.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. Observable is a ___________, not an interface.</p>
<p>3. Devil and Angel are _________ to the button.</p>
<p>4. Implement this method to get notified.</p>
<p>5. Jill got one of her own.</p>
<p>6. CurrentConditionsDisplay implements this interface.</p>
<p>8. How to get yourself off the Observer list.</p>
<p>12. You forgot this if you’re not getting notified when you think you should be.</p>
<p>15. One Subject likes to talk to _______ observers.</p>
<p>18. Don’t count on this for notification.</p>
<p>19. Temperature, humidity and __________.</p>
<p>20. Observers are __________ on the Subject.</p>
<p>21. Program to an _________ not an implementation.</p>
<p>22. A Subject is similar to a __________.</p></td><td style="vertical-align: top; "><p>2. Ron was both an Observer and a _________.</p>
<p>3. You want to keep your coupling _________.</p>
<p>7. He says you should go for it.</p>
<p>9. _________ can manage your observers for you.</p>
<p>10. Java framework with lots of Observers.</p>
<p>11. Weather-O-Rama’s CEO named after this kind of storm.</p>
<p>13. Observers like to be ___________ when something new happens.</p>
<p>14. The WeatherData class __________ the Subject interface.</p>
<p>16. He didn’t want any more ints, so he removed himself.</p>
<p>17. CEO almost forgot the ________ index display</p>
<p>19. Subject initially wanted to _________ all the data to Observer.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_sharpen_your_pencil_solution-id00013"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0009_iddle1404"></a><a class="indexterm" id="part0009_iddle1408"></a><a class="indexterm" id="part0009_iddle1422"></a><a class="indexterm" id="part0009_iddle1427"></a><a class="indexterm" id="part0009_iddle1471"></a><a class="indexterm" id="part0009_iddle1565"></a><a class="indexterm" id="part0009_iddle1675"></a><a class="indexterm" id="part0009_iddle2143"></a><a class="indexterm" id="part0009_iddle2310"></a>Based on our first implementation, which of the following apply? (Choose all that apply.)</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00026"></a><img alt="" hisrc="figs/web/078fig01.png.jpg" src="../Images/image00615.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We are coding to concrete implementations, not interfaces.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00027"></a><img alt="" hisrc="figs/web/078fig02.png.jpg" src="../Images/image00616.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>For every new display element we need to alter code.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00028"></a><img alt="" hisrc="figs/web/078fig03.png.jpg" src="../Images/image00617.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We have no way to add display elements at run time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00029"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The display elements don’t implement a common interface.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00030"></a><img alt="" hisrc="figs/web/078fig04.png.jpg" src="../Images/image00618.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We haven’t encapsulated what changes.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0009_inline_id00031"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>We are violating encapsulation of the WeatherData class.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_design_principle_challenge_solution"></a><h3 class="title">Design Principle Challenge Solution</h3><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note11"></a>Design Principle</h3><p><span class="emphasis"><em>Identify the aspects of your application that vary and separate them from what stays the same.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>__<span class="underline">The thing that varies in the Observer Pattern</span>_______</p>
<p>__<span class="underline">is the state of the Subject and the number and</span>_____</p>
<p>__<span class="underline">types of Observers. With this pattern, you can</span>______</p>
<p>__<span class="underline">vary the objects that are dependent on the state</span>____</p>
<p>__<span class="underline">of the Subject, without having to change that</span>_______</p>
<p>__<span class="underline">Subject. That’s called planning ahead!</span>____________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note12"></a>Design Principle</h3><p><span class="emphasis"><em>Program to an interface, not an implementation.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>__<span class="underline">Both the Subject and Observer use interfaces.</span>______</p>
<p>__<span class="underline">The Subject keeps track of objects implementing</span>____</p>
<p>__<span class="underline">the Observer interface, while the observers</span>_________</p>
<p>__<span class="underline">register with, and get notified by, the Subject</span>_______</p>
<p>__<span class="underline">interface. As we’ve seen, this keeps things nice and</span>______</p>
<p>__<span class="underline">loosely coupled.</span>___________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0009_ch02note13"></a>Design Principle</h3><p><span class="emphasis"><em>Favor composition over inheritance.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></td><td style="vertical-align: top; "><p>__<span class="underline">The Observer Pattern uses composition to compose</span>__</p>
<p>__<span class="underline">any number of Observers with their Subjects.</span>________</p>
<p>__<span class="underline">These relationships aren’t set up by some kind of</span>_____</p>
<p>__<span class="underline">inheritance hierarchy. No, they are set up at</span>_____</p>
<p>__<span class="underline">runtime by composition!</span>___________________________</p>
<p>_____________________________________________</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_code_magnets_solution"></a><h3 class="title">Code Magnets Solution</h3><p><a class="indexterm" id="part0009_iddle1145"></a><a class="indexterm" id="part0009_iddle1508"></a>The ForecastDisplay class is all scrambled up on the fridge. Can you reconstruct the code snippets to make it work? Some of the curly braces fell on the floor and they were too small to pick up, so feel free to add as many of those as you need! Here’s our solution.</p><div class="informalfigure"><a id="part0009_med_id00120a"></a><div class="mediaobject"><a id="part0009_med_id00120"></a><img alt="image with no caption" hisrc="figs/web/079fig01.png.jpg" src="../Images/image00619.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0009_design_patterns_crossword_soluti-id00014"></a><h3 class="title">Design Patterns Crossword Solution</h3><div class="informalfigure"><a id="part0009_med_id00121a"></a><div class="mediaobject"><a id="part0009_med_id00121"></a><img alt="image with no caption" hisrc="figs/web/080fig01.png" src="../Images/image00620.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0010_decorator_pattern_decorating_objects"><div class="titlepage" id="part0010_aid-9H5K2"><div><div><h2 class="title">Chapter 3. The Decorator Pattern: Decorating Objects</h2></div></div></div><div class="informalfigure"><a id="part0010_med_id00122a"></a><div class="mediaobject"><a id="part0010_med_id00122"></a><img alt="image with no caption" hisrc="figs/web/081fig01.png.jpg" src="../Images/image00621.jpeg"/></div></div><p><span class="strong"><strong>Just call this chapter “Design Eye for the Inheritance Guy.”</strong></span> We’ll re-examine the typical overuse of inheritance and you’ll learn how to decorate your classes at runtime using a form of object composition. Why? Once you know the techniques of decorating, you’ll be able to give your (or someone else’s) objects new responsibilities <span class="emphasis"><em>without making any code changes to the underlying classes.</em></span></p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_welcome_to_starbuzz_coffee" style="clear: both">Welcome to Starbuzz Coffee</h2></div></div></div><div class="informalfigure"><a id="part0010_med_id00123a"></a><div class="mediaobject"><a id="part0010_med_id00123"></a><img alt="image with no caption" hisrc="figs/web/082fig01.png.jpg" src="../Images/image00622.jpeg"/></div></div><p><a class="indexterm" id="part0010_iddle1355"></a><a class="indexterm" id="part0010_iddle2362"></a><span class="strong"><strong>Starbuzz Coffee has made a name for itself as the fastest growing coffee shop around. If you’ve seen one on your local corner, look across the street; you’ll see another one.</strong></span></p><p><span class="strong"><strong>Because they’ve grown so quickly, they’re scrambling to update their ordering systems to match their beverage offerings.</strong></span></p><p><span class="strong"><strong>When they first went into business they designed their classes like this...</strong></span></p><div class="informalfigure"><a id="part0010_med_id00124a"></a><div class="mediaobject"><a id="part0010_med_id00124"></a><img alt="image with no caption" hisrc="figs/web/082fig02.png.jpg" src="../Images/image00623.jpeg"/></div></div><p><a class="indexterm" id="part0010_iddle1106"></a><a class="indexterm" id="part0010_iddle2431"></a><span class="strong"><strong>In addition to your coffee, you can also ask for several condiments like steamed milk, soy, and mocha (otherwise known as chocolate), and have it all topped off with whipped milk. Starbuzz charges a bit for each of these, so they really need to get them built into their order system.</strong></span></p><p><span class="strong"><strong>Here’s their first attempt...</strong></span></p><div class="informalfigure"><a id="part0010_med_id00125a"></a><div class="mediaobject"><a id="part0010_med_id00125"></a><img alt="image with no caption" hisrc="figs/web/083fig01.png.jpg" src="../Images/image00624.jpeg"/></div></div><div class="informalfigure"><a id="part0010_med_id00126a"></a><div class="mediaobject"><a id="part0010_med_id00126"></a><img alt="image with no caption" hisrc="figs/web/083fig02.png.jpg" src="../Images/image00625.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0010_ch03note01"></a>Brain Power</h3><p><a class="indexterm" id="part0010_iddle1130"></a><a class="indexterm" id="part0010_iddle1788"></a>It’s pretty obvious that Starbuzz has created a maintenance nightmare for themselves. What happens when the price of milk goes up? What do they do when they add a new caramel topping?</p><p>Thinking beyond the maintenance problem, which of the design principles that we’ve covered so far are they violating?</p><p><span class="emphasis"><em>Hint: they’re violating two of them in a big way!</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0010_med_id00127a"></a><div class="mediaobject"><a id="part0010_med_id00127"></a><img alt="image with no caption" hisrc="figs/web/084fig01.png.jpg" src="../Images/image00626.jpeg"/></div></div><p>Well, let’s give it a try. Let’s start with the Beverage base class and add instance variables to represent whether or not each beverage has milk, soy, mocha, and whip...</p><div class="informalfigure"><a id="part0010_med_id00128a"></a><div class="mediaobject"><a id="part0010_med_id00128"></a><img alt="image with no caption" hisrc="figs/web/084fig02.png.jpg" src="../Images/image00627.jpeg"/></div></div><p><a class="indexterm" id="part0010_iddle1574"></a><a class="indexterm" id="part0010_iddle2319"></a>Now let’s add in the subclasses, one for each beverage on the menu:</p><div class="informalfigure"><a id="part0010_med_id00129a"></a><div class="mediaobject"><a id="part0010_med_id00129"></a><img alt="image with no caption" hisrc="figs/web/085fig01.png.jpg" src="../Images/image00628.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil-id00015"></a><h3 class="title">Sharpen your pencil</h3><p>Write the cost() methods for the following classes (pseudo-Java is okay):</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><a id="part0010_pro_id00008"></a><pre class="programlisting"><span class="strong"><strong>public class Beverage {</strong></span>
  <span class="strong"><strong>public double cost() {</strong></span>










  <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></td><td style="vertical-align: top; "><a id="part0010_pro_id00009"></a><pre class="programlisting"><span class="strong"><strong>public class DarkRoast extends Beverage {</strong></span>

  <span class="strong"><strong>public DarkRoast() {</strong></span>
    <span class="strong"><strong>description = "Most Excellent Dark Roast";</strong></span>
  <span class="strong"><strong>}</strong></span>

  <span class="strong"><strong>public double cost() {</strong></span>




  }
}</pre></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0010_med_id00130a"></a><div class="mediaobject"><a id="part0010_med_id00130"></a><img alt="image with no caption" hisrc="figs/web/086fig01.png.jpg" src="../Images/image00629.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil-id00016"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0010_iddle1546"></a><a class="indexterm" id="part0010_iddle2288"></a>What requirements or other factors might change that will impact this design?</p><div class="informalfigure"><a id="part0010_med_id00131a"></a><div class="mediaobject"><a id="part0010_med_id00131"></a><img alt="image with no caption" hisrc="figs/web/086fig02.png.jpg" src="../Images/image00630.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_master_and_studenthellip-id00017"></a><h3 class="title">Master and Student...</h3><p><a class="indexterm" id="part0010_iddle1250"></a><a class="indexterm" id="part0010_iddle1252"></a><a class="indexterm" id="part0010_iddle1368"></a><a class="indexterm" id="part0010_iddle1782"></a><a class="indexterm" id="part0010_iddle2238"></a><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, it has been some time since our last meeting. Have you been deep in meditation on inheritance?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Yes, Master. While inheritance is powerful, I have learned that it doesn’t always lead to the most flexible or maintainable designs.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Ah yes, you have made some progress. So, tell me, my student, how then will you achieve reuse if not through inheritance?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, I have learned there are ways of “inheriting” behavior at runtime through composition and delegation.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Please, go on...</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>When I inherit behavior by subclassing, that behavior is set statically at compile time. In addition, all subclasses must inherit the same behavior. If however, I can extend an object’s behavior through composition, then I can do this dynamically at runtime.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Very good, Grasshopper, you are beginning to see the power of composition.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Yes, it is possible for me to add multiple new responsibilities to objects through this technique, including responsibilities that were not even thought of by the designer of the superclass. And, I don’t have to touch their code!</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>What have you learned about the effect of composition on maintaining your code?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Well, that is what I was getting at. By dynamically composing objects, I can add new functionality by writing new code rather than altering existing code. Because I’m not changing existing code, the chances of introducing bugs or causing unintended side effects in pre-existing code are much reduced.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Very good. Enough for today, Grasshopper. I would like for you to go and meditate further on this topic... Remember, code should be closed (to change) like the lotus flower in the evening, yet open (to extension) like the lotus flower in the morning.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_open-closed_principle" style="clear: both">The Open-Closed Principle</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1074"></a><a class="indexterm" id="part0010_iddle1121"></a><a class="indexterm" id="part0010_iddle1415"></a><a class="indexterm" id="part0010_iddle2090"></a><span class="strong"><strong>Grasshopper is on to one of the most important design principles:</strong></span></p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0010_ch03note02"></a>Design Principle</h3><p><span class="emphasis"><em>Classes should be open for extension, but closed for modification.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0010_med_id00132a"></a><div class="mediaobject"><a id="part0010_med_id00132"></a><img alt="image with no caption" hisrc="figs/web/088fig01.png.jpg" src="../Images/image00631.jpeg"/></div></div><p>Come on in; we’re <span class="emphasis"><em>open</em></span>. Feel free to extend our classes with any new behavior you like. If your needs or requirements change (and we know they will), just go ahead and make your own extensions.</p><div class="informalfigure"><a id="part0010_med_id00133a"></a><div class="mediaobject"><a id="part0010_med_id00133"></a><img alt="image with no caption" hisrc="figs/web/088fig02.png.jpg" src="../Images/image00632.jpeg"/></div></div><p>Sorry, we’re <span class="emphasis"><em>closed</em></span>. That’s right, we spent a lot of time getting this code correct and bug free, so we can’t let you alter the existing code. It must remain closed to modification. If you don’t like it, you can speak to the manager.</p><p><span class="strong"><strong>Our goal is to allow classes to be easily extended to incorporate new behavior without modifying existing code. What do we get if we accomplish this? Designs that are resilient to change and flexible enough to take on new functionality to meet changing requirements.</strong></span></p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_there_are_no_dumb_questions-id00018"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1qe1"></a><a id="part0010_ch03qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0010_iddle2013"></a><a class="indexterm" id="part0010_iddle2084"></a><span class="strong"><strong>Q: Open for extension and closed for modification? That sounds very contradictory. How can a design be both?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> That’s a very good question. It certainly sounds contradictory at first. After all, the less modifiable something is, the harder it is to extend, right?</div><div>As it turns out, though, there are some clever OO techniques for allowing systems to be extended, even if we can’t change the underlying code. Think about the Observer Pattern (in <a class="xref" href="#part0009_aid-8IL22">Chapter 2</a>)... by adding new Observers, we can extend the Subject at any time, without adding code to the Subject. You’ll see quite a few more ways of extending behavior with other OO design techniques.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1qe2"></a><a id="part0010_ch03qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Okay, I understand Observable, but how do I generally design something to be extensible, yet closed for modification?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Many of the patterns give us time-tested designs that protect your code from being modified by supplying a means of extension. In this chapter you’ll see a good example of using the Decorator Pattern to follow the Open-Closed principle.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1qe3"></a><a id="part0010_ch03qa1q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How can I make every part of my design follow the Open-Closed Principle?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Usually, you can’t. Making OO design flexible and open to extension without the modification of existing code takes time and effort. In general, we don’t have the luxury of tying down every part of our designs (and it would probably be wasteful). Following the Open-Closed Principle usually introduces new levels of abstraction, which adds complexity to our code. You want to concentrate on those areas that are most likely to change in your designs and apply the principles there.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1qe4"></a><a id="part0010_ch03qa1q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How do I know which areas of change are more important?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa1q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> That is partly a matter of experience in designing OO systems and also a matter of knowing the domain you are working in. Looking at other examples will help you learn to identify areas of change in your own designs.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>While it may seem like a contradiction, there are techniques for allowing code to be extended without direct modification.</strong></span></div><div><span class="strong"><strong>Be careful when choosing the areas of code that need to be extended; applying the Open-Closed Principle EVERYWHERE is wasteful and unnecessary, and can lead to complex, hard-to-understand code.</strong></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_meet_the_decorator_pattern" style="clear: both">Meet the Decorator Pattern</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1341"></a><a class="indexterm" id="part0010_iddle2024"></a><a class="indexterm" id="part0010_iddle2529"></a>Okay, we’ve seen that representing our beverage plus condiment pricing scheme with inheritance has not worked out very well — we get class explosions and rigid designs, or we add functionality to the base class that isn’t appropriate for some of the subclasses.</p><p>So, here’s what we’ll do instead: we’ll start with a beverage and “decorate” it with the condiments at runtime. For example, if the customer wants a Dark Roast with Mocha and Whip, then we’ll:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Take a DarkRoast object</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Decorate it with a Mocha object</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Decorate it with a Whip object</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Call the cost() method and rely on delegation to add on the condiment costs</strong></span></li></ul></div><p>Okay, but how do you “decorate” an object, and how does delegation come into this? A hint: think of decorator objects as “wrappers.” Let’s see how this works...</p><div class="informalfigure"><a id="part0010_med_id00134a"></a><div class="mediaobject"><a id="part0010_med_id00134"></a><img alt="image with no caption" hisrc="figs/web/090fig01.png.jpg" src="../Images/image00633.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_constructing_a_drink_order_with_decorato" style="clear: both">Constructing a drink order with Decorators</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① <a class="indexterm" id="part0010_iddle1357"></a><a class="indexterm" id="part0010_iddle2364"></a><span class="strong"><strong>We start with our DarkRoast object.</strong></span><div class="informalfigure"><a id="part0010_med_id00135a"></a><div class="mediaobject"><a id="part0010_med_id00135"></a><img alt="image with no caption" hisrc="figs/web/091fig01.png.jpg" src="../Images/image00634.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② The customer wants Mocha, so we create a Mocha object and wrap it around the DarkRoast.</strong></span><div class="informalfigure"><a id="part0010_med_id00136a"></a><div class="mediaobject"><a id="part0010_med_id00136"></a><img alt="image with no caption" hisrc="figs/web/091fig02.png.jpg" src="../Images/image00635.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ The customer also wants Whip, so we create a Whip decorator and wrap Mocha with it.</strong></span><div class="informalfigure"><a id="part0010_med_id00137a"></a><div class="mediaobject"><a id="part0010_med_id00137"></a><img alt="image with no caption" hisrc="figs/web/091fig03.png.jpg" src="../Images/image00636.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0010_ch03note03"></a>Note</h3><p>So, a DarkRoast wrapped in Mocha and Whip is still a Beverage and we can do anything with it we can do with a DarkRoast, including call its cost() method.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none">④ <a class="indexterm" id="part0010_iddle1076"></a><span class="strong"><strong>Now it’s time to compute the cost for the customer. We do this by calling cost() on the outermost decorator, Whip, and Whip is going to delegate computing the cost to the objects it decorates. Once it gets a cost, it will add on the cost of the Whip.</strong></span><div class="informalfigure"><a id="part0010_med_id00138a"></a><div class="mediaobject"><a id="part0010_med_id00138"></a><img alt="image with no caption" hisrc="figs/web/092fig01.png.jpg" src="../Images/image00637.jpeg"/></div></div></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0010_okaycomma_hereapostrophes_what_we_know_s">Okay, here’s what we know so far...</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Decorators have the same supertype as the objects they decorate.</li><li class="listitem">You can use one or more decorators to wrap an object.</li><li class="listitem">Given that the decorator has the same supertype as the object it decorates, we can pass around a decorated object in place of the original (wrapped) object.</li><li class="listitem"><span class="gray-background">The decorator adds its own behavior either before and/or after delegating to the object it decorates to do the rest of the job.</span><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0010_ch03note04"></a>Note</h3><p>Key point!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem">Objects can be decorated at any time, so we can decorate objects dynamically at runtime with as many decorators as we like.</li></ul></div><p><span class="strong"><strong>Now let’s see how this all really works by looking at the Decorator Pattern definition and writing some code.</strong></span></p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_decorator_pattern_defined" style="clear: both">The Decorator Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1345"></a><a class="indexterm" id="part0010_iddle1720"></a>Let’s first take a look at the Decorator Pattern description:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0010_ch03note05"></a>Note</h3><p><span class="strong"><strong>The Decorator Pattern</strong></span> attaches additional responsibilities to an object dynamically. Decorators provide a flexible alternative to subclassing for extending functionality.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>While that describes the <span class="emphasis"><em>role</em></span> of the Decorator Pattern, it doesn’t give us a lot of insight into how we’d <span class="emphasis"><em>apply</em></span> the pattern to our own implementation. Let’s take a look at the class diagram, which is a little more revealing (on the next page we’ll look at the same structure applied to the beverage problem).</p><div class="informalfigure"><a id="part0010_med_id00139a"></a><div class="mediaobject"><a id="part0010_med_id00139"></a><img alt="image with no caption" hisrc="figs/web/093fig01.png.jpg" src="../Images/image00638.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_decorating_our_beverages" style="clear: both">Decorating our Beverages</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1358"></a><a class="indexterm" id="part0010_iddle2365"></a><span class="strong"><strong>Okay, let’s work our Starbuzz beverages into this framework...</strong></span></p><div class="informalfigure"><a id="part0010_med_id00140a"></a><div class="mediaobject"><a id="part0010_med_id00140"></a><img alt="image with no caption" hisrc="figs/web/094fig01.png.jpg" src="../Images/image00639.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0010_ch03note06"></a>Brain Power</h3><p>Before going further, think about how you’d implement the cost() method of the coffees and the condiments. Also think about how you’d implement the getDescription() method of the condiments.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_cubicle_conversation-id00019" style="clear: both">Cubicle Conversation</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1253"></a><a class="indexterm" id="part0010_iddle1780"></a><span class="strong"><strong>Some confusion over Inheritance versus Composition</strong></span></p><div class="informalfigure"><a id="part0010_med_id00141a"></a><div class="mediaobject"><a id="part0010_med_id00141"></a><img alt="image with no caption" hisrc="figs/web/095fig01.png.jpg" src="../Images/image00640.jpeg"/></div></div><p><span class="strong"><strong>Sue:</strong></span> What do you mean?</p><p><span class="strong"><strong>Mary:</strong></span> Look at the class diagram. The CondimentDecorator is extending the Beverage class. That’s inheritance, right?</p><p><span class="strong"><strong>Sue:</strong></span> True. I think the point is that it’s vital that the decorators have the same type as the objects they are going to decorate. So here we’re using inheritance to achieve the <span class="emphasis"><em>type matching</em></span>, but we aren’t using inheritance to get <span class="emphasis"><em>behavior</em></span>.</p><p><span class="strong"><strong>Mary:</strong></span> Okay, I can see how decorators need the same “interface” as the components they wrap because they need to stand in place of the component. But where does the behavior come in?</p><p><span class="strong"><strong>Sue:</strong></span> When we compose a decorator with a component, we are adding new behavior. We are acquiring new behavior not by inheriting it from a superclass, but by composing objects together.</p><p><span class="strong"><strong>Mary:</strong></span> Okay, so we’re subclassing the abstract class Beverage in order to have the correct type, not to inherit its behavior. The behavior comes in through the composition of decorators with the base components as well as other decorators.</p><p><span class="strong"><strong>Sue:</strong></span> That’s right.</p><p><span class="strong"><strong>Mary:</strong></span> Ooooh, I see. And because we are using object composition, we get a whole lot more flexibility about how to mix and match condiments and beverages. Very smooth.</p><p><span class="strong"><strong>Sue:</strong></span> Yes, if we rely on inheritance, then our behavior can only be determined statically at compile time. In other words, we get only whatever behavior the superclass gives us or that we override. With composition, we can mix and match decorators any way we like... <span class="emphasis"><em>at runtime</em></span>.</p><p><span class="strong"><strong>Mary:</strong></span> And as I understand it, we can implement new decorators at any time to add new behavior. If we relied on inheritance, we’d have to go in and change existing code any time we wanted new behavior.</p><p><span class="strong"><strong>Sue:</strong></span> Exactly.</p><p><span class="strong"><strong>Mary:</strong></span> I just have one more question. If all we need to inherit is the type of the component, how come we didn’t use an interface instead of an abstract class for the Beverage class?</p><p><span class="strong"><strong>Sue:</strong></span> Well, remember, when we got this code, Starbuzz already <span class="emphasis"><em>had</em></span> an abstract Beverage class. Traditionally the Decorator Pattern does specify an abstract component, but in Java, obviously, we could use an interface. But we always try to avoid altering existing code, so don’t “fix” it if the abstract class will work just fine.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_new_barista_training" style="clear: both">New barista training</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1359"></a><a class="indexterm" id="part0010_iddle2366"></a>Make a picture for what happens when the order is for a “double mocha soy latte with whip” beverage. Use the menu to get the correct prices, and draw your picture using the same format we used earlier (from a few pages back):</p><div class="informalfigure"><a id="part0010_med_id00142a"></a><div class="mediaobject"><a id="part0010_med_id00142"></a><img alt="image with no caption" hisrc="figs/web/096fig01.png.jpg" src="../Images/image00641.jpeg"/></div></div><div class="informalfigure"><a id="part0010_med_id00143a"></a><div class="mediaobject"><a id="part0010_med_id00143"></a><img alt="image with no caption" hisrc="figs/web/096fig02.png.jpg" src="../Images/image00642.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil-id00020"></a><h3 class="title">Sharpen your pencil</h3><p>Draw your picture here.</p><div class="informalfigure"><a id="part0010_med_id00144a"></a><div class="mediaobject"><a id="part0010_med_id00144"></a><img alt="image with no caption" hisrc="figs/web/096fig03.png.jpg" src="../Images/image00643.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_writing_the_starbuzz_code" style="clear: both">Writing the Starbuzz code</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1363"></a><a class="indexterm" id="part0010_iddle2370"></a><span class="strong"><strong>It’s time to whip this design into some real code.</strong></span></p><p><span class="strong"><strong>Let’s start with the Beverage class, which doesn’t need to change from Starbuzz’s original design. Let’s take a look:</strong></span></p><div class="informalfigure"><a id="part0010_med_id00145a"></a><div class="mediaobject"><a id="part0010_med_id00145"></a><img alt="image with no caption" hisrc="figs/web/common10.png.jpg" src="../Images/image00644.jpeg"/></div></div><div class="informalfigure"><a id="part0010_med_id00146a"></a><div class="mediaobject"><a id="part0010_med_id00146"></a><img alt="image with no caption" hisrc="figs/web/097fig01.png.jpg" src="../Images/image00645.jpeg"/></div></div><p><span class="strong"><strong>Beverage is simple enough. Let’s implement the abstract class for the Condiments (Decorator) as well:</strong></span></p><div class="informalfigure"><a id="part0010_med_id00147a"></a><div class="mediaobject"><a id="part0010_med_id00147"></a><img alt="image with no caption" hisrc="figs/web/097fig02.png.jpg" src="../Images/image00646.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_coding_beverages" style="clear: both">Coding beverages</h2></div></div></div><p><span class="strong"><strong>Now that we’ve got our base classes out of the way, let’s implement some beverages. We’ll start with Espresso. Remember, we need to set a description for the specific beverage and also implement the cost() method.</strong></span></p><div class="informalfigure"><a id="part0010_med_id00148a"></a><div class="mediaobject"><a id="part0010_med_id00148"></a><img alt="image with no caption" hisrc="figs/web/098fig01.png.jpg" src="../Images/image00647.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_coding_condiments" style="clear: both">Coding condiments</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1789"></a><span class="strong"><strong>If you look back at the Decorator Pattern class diagram, you’ll see we’ve now written our abstract component (Beverage), we have our concrete components (HouseBlend), and we have our abstract decorator (CondimentDecorator). Now it’s time to implement the concrete decorators. Here’s Mocha:</strong></span></p><div class="informalfigure"><a id="part0010_med_id00149a"></a><div class="mediaobject"><a id="part0010_med_id00149"></a><img alt="image with no caption" hisrc="figs/web/099fig01.png.jpg" src="../Images/image00648.jpeg"/></div></div><p>On the next page we’ll actually instantiate the beverage and wrap it with all its condiments (decorators), but first...</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_exercise"></a><h3 class="title">Exercise</h3><p>Write and compile the code for the other Soy and Whip condiments. You’ll need them to finish and test the application.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_serving_some_coffees" style="clear: both">Serving some coffees</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1361"></a><a class="indexterm" id="part0010_iddle2368"></a>Congratulations. It’s time to sit back, order a few coffees, and marvel at the flexible design you created with the Decorator Pattern.</p><p><span class="strong"><strong>Here’s some test code*to make orders:</strong></span></p><div class="informalfigure"><a id="part0010_med_id00150a"></a><div class="mediaobject"><a id="part0010_med_id00150"></a><img alt="image with no caption" hisrc="figs/web/100fig01.png.jpg" src="../Images/image00649.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div>* We’re going to see a much better way of creating decorated objects when we cover the Factory and Builder Design Patterns. Please note that the Builder Pattern is covered in the Appendix.</div></blockquote></div><p><span class="strong"><strong>Now, let’s get those orders in:</strong></span></p><div class="informalfigure"><a id="part0010_med_id00151a"></a><div class="mediaobject"><a id="part0010_med_id00151"></a><img alt="image with no caption" hisrc="figs/web/100fig02.png.jpg" src="../Images/image00650.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_there_are_no_dumb_questions-id00021"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa2qe1"></a><a id="part0010_ch03qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0010_iddle1356"></a><a class="indexterm" id="part0010_iddle1523"></a><a class="indexterm" id="part0010_iddle2262"></a><a class="indexterm" id="part0010_iddle2363"></a><span class="strong"><strong>Q: I’m a little worried about code that might test for a specific concrete component — say, HouseBlend — and do something, like issue a discount. Once I’ve wrapped the HouseBlend with decorators, this isn’t going to work anymore.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> That is exactly right. If you have code that relies on the concrete component’s type, decorators will break that code. As long as you only write code against the abstract component type, the use of decorators will remain transparent to your code. However, once you start writing code against concrete components, you’ll want to rethink your application design and your use of decorators.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa2qe2"></a><a id="part0010_ch03qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Wouldn’t it be easy for some client of a beverage to end up with a decorator that isn’t the outermost decorator? Like if I had a DarkRoast with Mocha, Soy, and Whip, it would be easy to write code that somehow ended up with a reference to Soy instead of Whip, which means it would not include Whip in the order.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You could certainly argue that you have to manage more objects with the Decorator Pattern and so there is an increased chance that coding errors will introduce the kinds of problems you suggest. However, decorators are typically created by using other patterns like Factory and Builder. Once we’ve covered these patterns, you’ll see that the creation of the concrete component with its decorator is “well encapsulated” and doesn’t lead to these kinds of problems.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa2qe3"></a><a id="part0010_ch03qa2q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Can decorators know about the other decorations in the chain? Say I wanted my getDescription() method to print “Whip, Double Mocha” instead of “Mocha, Whip, Mocha.” That would require that my outermost decorator know all the decorators it is wrapping.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0010_ch03qa2q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Decorators are meant to add behavior to the object they wrap. When you need to peek at multiple layers into the decorator chain, you are starting to push the decorator beyond its true intent. Nevertheless, such things are possible. Imagine a CondimentPrettyPrint decorator that parses the final decription and can print “Mocha, Whip, Mocha” as “Whip, Double Mocha.” Note that getDescription() could return an ArrayList of descriptions to make this easier.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil-id00022"></a><h3 class="title">Sharpen your pencil</h3><p>Our friends at Starbuzz have introduced sizes to their menu. You can now order a coffee in tall, grande, and venti sizes (translation: small, medium, and large). Starbuzz saw this as an intrinsic part of the coffee class, so they’ve added two methods to the Beverage class: setSize() and getSize(). They’d also like for the condiments to be charged according to size, so for instance, Soy costs 10¢, 15¢, and 20¢, respectively, for tall, grande, and venti coffees. The updated Beverage class is shown below.</p><p>How would you alter the decorator classes to handle this change in requirements?</p><a id="part0010_pro_id00010"></a><pre class="programlisting"><span class="strong"><strong>public abstract class Beverage {</strong></span>
      <span class="strong"><strong><span class="gray-background">public enum Size { TALL, GRANDE, VENTI };</span></strong></span>
      <span class="strong"><strong><span class="gray-background">Size size = Size.TALL;                   </span></strong></span>
      <span class="strong"><strong>String description = "Unknown Beverage";</strong></span>
      <span class="strong"><strong>public String getDescription() {</strong></span>
             <span class="strong"><strong>return description;</strong></span>
      <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong><span class="gray-background">public void setSize(Size size) {</span></strong></span>
             <span class="strong"><strong><span class="gray-background">this.size = size;        </span></strong></span>
      <span class="strong"><strong><span class="gray-background">}                               </span></strong></span>
      <span class="strong"><strong><span class="gray-background">public Size getSize() {         </span></strong></span>
             <span class="strong"><strong><span class="gray-background">return this.size;        </span></strong></span>
      <span class="strong"><strong><span class="gray-background">}                               </span></strong></span>
      <span class="strong"><strong>public abstract double cost();</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_real_world_decorators_java_isoliduso" style="clear: both">Real World Decorators: Java I/O</h2></div></div></div><p><a class="indexterm" id="part0010_iddle1352"></a><a class="indexterm" id="part0010_iddle1362"></a><a class="indexterm" id="part0010_iddle1857"></a><a class="indexterm" id="part0010_iddle2369"></a>The large number of classes in the java.io package is... <span class="emphasis"><em>overwhelming</em></span>. Don’t feel alone if you said “whoa” the first (and second and third) time you looked at this API. But now that you know the Decorator Pattern, the I/O classes should make more sense since the java.io package is largely based on Decorator. Here’s a typical set of objects that use decorators to add functionality to reading data from a file:</p><div class="informalfigure"><a id="part0010_med_id00152a"></a><div class="mediaobject"><a id="part0010_med_id00152"></a><img alt="image with no caption" hisrc="figs/web/102fig01.png.jpg" src="../Images/image00651.jpeg"/></div></div><p><span class="bolditalic">Buffered</span>InputStream and <span class="bolditalic">LineNumber</span>InputStream both extend <span class="bolditalic">Filter</span>InputStream, which acts as the abstract decorator class.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_decorating_the_javadotio_classes" style="clear: both">Decorating the java.io classes</h2></div></div></div><div class="informalfigure"><a id="part0010_med_id00153a"></a><div class="mediaobject"><a id="part0010_med_id00153"></a><img alt="image with no caption" hisrc="figs/web/103fig01.png.jpg" src="../Images/image00652.jpeg"/></div></div><p><a class="indexterm" id="part0010_iddle1346"></a>You can see that this isn’t so different from the Starbuzz design. You should now be in a good position to look over the java.io API docs and compose decorators on the various <span class="emphasis"><em>input</em></span> streams.</p><p>You’ll see that the <span class="emphasis"><em>output</em></span> streams have the same design. And you’ve probably already found that the Reader/Writer streams (for character-based data) closely mirror the design of the streams classes (with a few differences and inconsistencies, but close enough to figure out what’s going on).</p><p>Java I/O also points out one of the <span class="emphasis"><em>downsides</em></span> of the Decorator Pattern: designs using this pattern often result in a large number of small classes that can be overwhelming to a developer trying to use the Decorator-based API. But now that you know how Decorator works, you can keep things in perspective and when you’re using someone else’s Decorator-heavy API, you can work through how their classes are organized so that you can easily use wrapping to get the behavior you’re after.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_writing_your_own_java_isoliduso_decorato" style="clear: both">Writing your own Java I/O Decorator</h2></div></div></div><p>Okay, you know the Decorator Pattern, you’ve seen the I/O class diagram. You should be ready to write your own input decorator.</p><p>How about this: write a decorator that converts all uppercase characters to lowercase in the input stream. In other words, if we read in “I know the Decorator Pattern therefore I RULE!” then your decorator converts this to “i know the decorator pattern therefore i rule!”</p><div class="informalfigure"><a id="part0010_med_id00154a"></a><div class="mediaobject"><a id="part0010_med_id00154"></a><img alt="image with no caption" hisrc="figs/web/104fig01.png.jpg" src="../Images/image00653.jpeg"/></div></div><div class="informalfigure"><a id="part0010_med_id00155a"></a><div class="mediaobject"><a id="part0010_med_id00155"></a><img alt="image with no caption" hisrc="figs/web/104fig02.png.jpg" src="../Images/image00654.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div>REMEMBER: we don’t provide import and package statements in the code listings. Get the complete source code from <a class="ulink" href="http://wickedlysmart.com/head-first-design-patterns/" target="_top">http://wickedlysmart.com/head-first-design-patterns/</a>.</div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_test_out_your_new_java_isoliduso_decorat" style="clear: both">Test out your new Java I/O Decorator</h2></div></div></div><p>Write some quick code to test the I/O decorator:</p><div class="informalfigure"><a id="part0010_med_id00156a"></a><div class="mediaobject"><a id="part0010_med_id00156"></a><img alt="image with no caption" hisrc="figs/web/105fig01.png.jpg" src="../Images/image00655.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0010_give_it_a_spin">Give it a spin</h3></div></div></div><div class="informalfigure"><a id="part0010_med_id00157a"></a><div class="mediaobject"><a id="part0010_med_id00157"></a><img alt="image with no caption" hisrc="figs/web/105fig02.png.jpg" src="../Images/image00656.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_patterns_exposed"></a><h3 class="title">Patterns Exposed</h3><p><a class="indexterm" id="part0010_iddle1342"></a><span class="strong"><strong>This week’s interview: Confessions of a Decorator</strong></span></p><p><span class="strong"><strong>Head First:</strong></span> Welcome, Decorator Pattern. We’ve heard that you’ve been a bit down on yourself lately?</p><p><span class="strong"><strong>Decorator:</strong></span> Yes, I know the world sees me as the glamorous design pattern, but you know, I’ve got my share of problems just like everyone.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Can you perhaps share some of your troubles with us?</p><p><span class="strong"><strong>Decorator:</strong></span> Sure. Well, you know I’ve got the power to add flexibility to designs, that much is for sure, but I also have a <span class="emphasis"><em>dark side</em></span>. You see, I can sometimes add a lot of small classes to a design and this occasionally results in a design that’s less than straightforward for others to understand.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Can you give us an example?</p><p><span class="strong"><strong>Decorator:</strong></span> Take the Java I/O libraries. These are notoriously difficult for people to understand at first. But if they just saw the classes as a set of wrappers around an InputStream, life would be much easier.</p><p><span class="strong"><strong>HeadFirst:</strong></span> That doesn’t sound so bad. You’re still a great pattern, and improving this is just a matter of public education, right?</p><p><span class="strong"><strong>Decorator:</strong></span> There’s more, I’m afraid. I’ve got typing problems: you see, people sometimes take a piece of client code that relies on specific types and introduce decorators without thinking through everything. Now, one great thing about me is that <span class="emphasis"><em><span class="strong"><strong>you can usually insert decorators transparently and the client never has to know it’s dealing with a decorator</strong></span></em></span>. But like I said, some code is dependent on specific types and when you start introducing decorators, boom! Bad things happen.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Well, I think everyone understands that you have to be careful when inserting decorators. I don’t think this is a reason to be too down on yourself.</p><p><span class="strong"><strong>Decorator:</strong></span> I know, I try not to be. I also have the problem that introducing decorators can increase the complexity of the code needed to instantiate the component. Once you’ve got decorators, you’ve got to not only instantiate the component, but also wrap it with who knows how many decorators.</p><p><span class="strong"><strong>HeadFirst:</strong></span> I’ll be interviewing the Factory and Builder patterns next week — I hear they can be very helpful with this?</p><p><span class="strong"><strong>Decorator:</strong></span> That’s true; I should talk to those guys more often.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Well, we all think you’re a great pattern for creating flexible designs and staying true to the Open-Closed Principle, so keep your chin up and think positively!</p><p><span class="strong"><strong>Decorator:</strong></span> I’ll do my best, thank you.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0010_tools_for_your_design_toolbox-id00023" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>You’ve got another chapter under your belt and a new principle and pattern in the toolbox.</p><div class="informalfigure"><a id="part0010_med_id00158a"></a><div class="mediaobject"><a id="part0010_med_id00158"></a><img alt="image with no caption" hisrc="figs/web/107fig01.png.jpg" src="../Images/image00657.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_bullet_points-id00024"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Inheritance is one form of extension, but not necessarily the best way to achieve flexibility in our designs.</li><li class="listitem">In our designs we should allow behavior to be extended without the need to modify existing code.</li><li class="listitem">Composition and delegation can often be used to add new behaviors at runtime.</li><li class="listitem">The Decorator Pattern provides an alternative to subclassing for extending behavior.</li><li class="listitem">The Decorator Pattern involves a set of decorator classes that are used to wrap concrete components.</li><li class="listitem">Decorator classes mirror the type of the components they decorate. (In fact, they are the same type as the components they decorate, either through inheritance or interface implementation.)</li><li class="listitem">Decorators change the behavior of their components by adding new functionality before and/or after (or even in place of) method calls to the component.</li><li class="listitem">You can wrap a component with any number of decorators.</li><li class="listitem">Decorators are typically transparent to the client of the component; that is, unless the client is relying on the component’s concrete type.</li><li class="listitem">Decorators can result in many small objects in our design, and overuse can be complex.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil_solution-id00025"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0010_iddle1575"></a><a class="indexterm" id="part0010_iddle2320"></a>Write the cost() methods for the following classes (pseudo-Java is okay). Here’s our solution:</p><a id="part0010_pro_id00011"></a><pre class="programlisting"><span class="strong"><strong>public class Beverage {</strong></span>

<span class="strong"><strong>// declare instance variables for milkCost,</strong></span>
<span class="strong"><strong>// soyCost, mochaCost, and whipCost, and</strong></span>
<span class="strong"><strong>// getters and setters for milk, soy, mocha</strong></span>
<span class="strong"><strong>// and whip.</strong></span>

<span class="strong"><strong>public double cost() {</strong></span>

        <span class="strong"><strong>float condimentCost = 0.0;</strong></span>
        <span class="strong"><strong>if (hasMilk()) {</strong></span>
            <span class="strong"><strong>condimentCost += milkCost;</strong></span>
        <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>if (hasSoy()) {</strong></span>
            <span class="strong"><strong>condimentCost += soyCost;</strong></span>
        <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>if (hasMocha()) {</strong></span>
            <span class="strong"><strong>condimentCost += mochaCost;</strong></span>
        <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>if (hasWhip()) {</strong></span>
            <span class="strong"><strong>condimentCost += whipCost;</strong></span>
        <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>return condimentCost;</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>


<span class="strong"><strong>public class DarkRoast extends Beverage {</strong></span>

    <span class="strong"><strong>public DarkRoast() {</strong></span>
        <span class="strong"><strong>description = "Most Excellent Dark Roast";</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public double cost() {</strong></span>
        <span class="strong"><strong>return 1.99 + super.cost();</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil_solution-id00026"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0010_iddle1360"></a><a class="indexterm" id="part0010_iddle1543"></a><a class="indexterm" id="part0010_iddle2285"></a><a class="indexterm" id="part0010_iddle2367"></a><span class="strong"><strong>New barista training</strong></span></p><p>“double mocha soy latte with whip”</p><div class="informalfigure"><a id="part0010_med_id00159a"></a><div class="mediaobject"><a id="part0010_med_id00159"></a><img alt="image with no caption" hisrc="figs/web/109fig01.png.jpg" src="../Images/image00658.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0010_sharpen_your_pencil_solution-id00027"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0010_iddle1111"></a><a class="indexterm" id="part0010_iddle1524"></a><a class="indexterm" id="part0010_iddle2263"></a>Our friends at Starbuzz have introduced sizes to their menu. You can now order a coffee in tall, grande, and venti sizes (for us normal folk: small, medium, and large). Starbuzz saw this as an intrinsic part of the coffee class, so they’ve added two methods to the Beverage class: setSize() and getSize(). They’d also like for the condiments to be charged according to size, so for instance, Soy costs 10¢, 15¢, and 20¢, respectively, for tall, grande, and venti coffees.</p><p>How would you alter the decorator classes to handle this change in requirements? Here’s our solution.</p><div class="informalfigure"><a id="part0010_med_id00160a"></a><div class="mediaobject"><a id="part0010_med_id00160"></a><img alt="image with no caption" hisrc="figs/web/110fig01.png.jpg" src="../Images/image00659.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0011_factory_pattern_baking_with_oo_goodness"><div class="titlepage" id="part0011_aid-AFM62"><div><div><h2 class="title">Chapter 4. The Factory Pattern: Baking with OO Goodness</h2></div></div></div><div class="informalfigure"><a id="part0011_med_id00161a"></a><div class="mediaobject"><a id="part0011_med_id00161"></a><img alt="image with no caption" hisrc="figs/web/111fig01.png.jpg" src="../Images/image00660.jpeg"/></div></div><p><span class="strong"><strong>Get ready to bake some loosely coupled OO designs.</strong></span> There is more to making objects than just using the <span class="strong"><strong>new</strong></span> operator. You’ll learn that instantiation is an activity that shouldn’t always be done in public and can often lead to <span class="emphasis"><em>coupling problems</em></span>. And you don’t want <span class="emphasis"><em>that</em></span>, do you? Find out how Factory Patterns can help save you from embarrassing dependencies.</p><div class="informalfigure"><a id="part0011_med_id00162a"></a><div class="mediaobject"><a id="part0011_med_id00162"></a><img alt="image with no caption" hisrc="figs/web/112fig01.png.jpg" src="../Images/image00661.jpeg"/></div></div><p><a class="indexterm" id="part0011_iddle1132"></a><a class="indexterm" id="part0011_iddle1293"></a><a class="indexterm" id="part0011_iddle1672"></a><a class="indexterm" id="part0011_iddle1791"></a><a class="indexterm" id="part0011_iddle1797"></a><a class="indexterm" id="part0011_iddle2326"></a><span class="strong"><strong>When you see “new,” think “concrete.”</strong></span></p><p>Yes, when you use <span class="strong"><strong>new</strong></span> you are certainly instantiating a concrete class, so that’s definitely an implementation, not an interface. And it’s a good question; you’ve learned that tying your code to a concrete class can make it more fragile and less flexible.</p><div class="informalfigure"><a id="part0011_med_id00163a"></a><div class="mediaobject"><a id="part0011_med_id00163"></a><img alt="image with no caption" hisrc="figs/web/112fig02.png.jpg" src="../Images/image00662.jpeg"/></div></div><p>When you have a whole set of related concrete classes, often you’re forced to write code like this:</p><div class="informalfigure"><a id="part0011_med_id00164a"></a><div class="mediaobject"><a id="part0011_med_id00164"></a><img alt="image with no caption" hisrc="figs/web/112fig03.png.jpg" src="../Images/image00663.jpeg"/></div></div><p>Here we’ve got several concrete classes being instantiated, and the decision of which to instantiate is made at runtime depending on some set of conditions.</p><p>When you see code like this, you know that when it comes time for changes or extensions, you’ll have to reopen this code and examine what needs to be added (or deleted). Often this kind of code ends up in several parts of the application making maintenance and updates more difficult and error-prone.</p><div class="informalfigure"><a id="part0011_med_id00165a"></a><div class="mediaobject"><a id="part0011_med_id00165"></a><img alt="image with no caption" hisrc="figs/web/113fig01.png.jpg" src="../Images/image00664.jpeg"/></div></div><p><span class="strong"><strong>What’s wrong with “new”?</strong></span></p><p>Technically there’s nothing wrong with <span class="strong"><strong>new</strong></span>. After all, it’s a fundamental part of Java. The real culprit is our old friend CHANGE and how change impacts our use of <span class="strong"><strong>new</strong></span>.</p><p>By coding to an interface, you know you can insulate yourself from a lot of changes that might happen to a system down the road. Why? If your code is written to an interface, then it will work with any new classes implementing that interface through polymorphism. However, when you have code that makes use of lots of concrete classes, you’re looking for trouble because that code may have to be changed as new concrete classes are added. So, in other words, your code will not be “closed for modification.” To extend it with new concrete types, you’ll have to reopen it.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note01"></a>Note</h3><p>Remember that designs should be “open for extension but closed for modification” - see <a class="xref" href="#part0010_aid-9H5K2">Chapter 3</a> for a review.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>So what can you do? It’s times like these that you can fall back on OO Design Principles to look for clues. Remember, our first principle deals with change and guides us to <span class="emphasis"><em>identify the aspects that vary and separate them from what stays the same</em></span>.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note02"></a>Brain Power</h3><p>How might you take all the parts of your application that instantiate concrete classes and separate or encapsulate them from the rest of your application?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_identifying_the_aspects_that_vary" style="clear: both">Identifying the aspects that vary</h2></div></div></div><div class="informalfigure"><a id="part0011_med_id00166a"></a><div class="mediaobject"><a id="part0011_med_id00166"></a><img alt="image with no caption" hisrc="figs/web/114fig01.png.jpg" src="../Images/image00665.jpeg"/></div></div><p><a class="indexterm" id="part0011_iddle2126"></a>Let’s say you have a pizza shop, and as a cutting-edge pizza store owner in Objectville you might end up writing some code like this:</p><div class="informalfigure"><a id="part0011_med_id00167a"></a><div class="mediaobject"><a id="part0011_med_id00167"></a><img alt="image with no caption" hisrc="figs/web/114fig02.png.jpg" src="../Images/image00666.jpeg"/></div></div><p><span class="strong"><strong>But you need more than one type of pizza...</strong></span></p><p>So then you’d add some code that <span class="emphasis"><em>determines</em></span> the appropriate type of pizza and then goes about <span class="emphasis"><em>making</em></span> the pizza:</p><div class="informalfigure"><a id="part0011_med_id00168a"></a><div class="mediaobject"><a id="part0011_med_id00168"></a><img alt="image with no caption" hisrc="figs/web/114fig03.png.jpg" src="../Images/image00667.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_but_the_pressure_is_on_to_add_more_pizza" style="clear: both">But the pressure is on to add more pizza types</h2></div></div></div><p>You realize that all of your competitors have added a couple of trendy pizzas to their menus: the Clam Pizza and the Veggie Pizza. Obviously you need to keep up with the competition, so you’ll add these items to your menu. And you haven’t been selling many Greek Pizzas lately, so you decide to take that off the menu:</p><div class="informalfigure"><a id="part0011_med_id00169a"></a><div class="mediaobject"><a id="part0011_med_id00169"></a><img alt="image with no caption" hisrc="figs/web/115fig01.png.jpg" src="../Images/image00668.jpeg"/></div></div><p>Clearly, dealing with <span class="emphasis"><em>which</em></span> concrete class is instantiated is really messing up our orderPizza() method and preventing it from being closed for modification. But now that we know what is varying and what isn’t, it’s probably time to encapsulate it.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_encapsulating_object_creation" style="clear: both">Encapsulating object creation</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1488"></a><a class="indexterm" id="part0011_iddle1621"></a><a class="indexterm" id="part0011_iddle1667"></a><a class="indexterm" id="part0011_iddle2004"></a><a class="indexterm" id="part0011_iddle2121"></a><a class="indexterm" id="part0011_iddle2321"></a>So now we know we’d be better off moving the object creation out of the orderPizza() method. But how? Well, what we’re going to do is take the creation code and move it out into another object that is only going to be concerned with creating pizzas.</p><div class="informalfigure"><a id="part0011_med_id00170a"></a><div class="mediaobject"><a id="part0011_med_id00170"></a><img alt="image with no caption" hisrc="figs/web/116fig01.png.jpg" src="../Images/image00669.jpeg"/></div></div><p><span class="strong"><strong>We’ve got a name for this new object: we call it a Factory.</strong></span></p><p>Factories handle the details of object creation. Once we have a SimplePizzaFactory, our orderPizza() method just becomes a client of that object. Any time it needs a pizza it asks the pizza factory to make one. Gone are the days when the orderPizza() method needs to know about Greek versus Clam pizzas. Now the orderPizza() method just cares that it gets a pizza that implements the Pizza interface so that it can call prepare(), bake(), cut(), and box().</p><p>We’ve still got a few details to fill in here; for instance, what does the orderPizza() method replace its creation code with? Let’s implement a simple factory for the pizza store and find out...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_building_a_simple_pizza_factory" style="clear: both">Building a simple pizza factory</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1332"></a><a class="indexterm" id="part0011_iddle1668"></a><a class="indexterm" id="part0011_iddle2117"></a><a class="indexterm" id="part0011_iddle2322"></a><a class="indexterm" id="part0011_iddle2406"></a>We’ll start with the factory itself. What we’re going to do is define a class that encapsulates the object creation for all pizzas. Here it is...</p><div class="informalfigure"><a id="part0011_med_id00171a"></a><div class="mediaobject"><a id="part0011_med_id00171"></a><img alt="image with no caption" hisrc="figs/web/117fig01.png.jpg" src="../Images/image00670.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_there_are_no_dumb_questions-id00028"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa1qe1"></a><a id="part0011_ch04qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: What’s the advantage of this? It looks like we are just pushing the problem off to another object.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> One thing to remember is that the SimplePizzaFactory may have many clients. We’ve only seen the orderPizza() method; however, there may be a PizzaShopMenu class that uses the factory to get pizzas for their current description and price. We might also have a HomeDelivery class that handles pizzas in a different way than our PizzaShop class but is also a client of the factory.</p><p>So, by encapsulating the pizza creating in one class, we now have only one place to make modifications when the implementation changes.</p><p>Don’t forget, we are also just about to remove the concrete instantiations from our client code.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa1qe2"></a><a id="part0011_ch04qa1q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: I’ve seen a similar design where a factory like this is defined as a static method. What is the difference?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa1q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Defining a simple factory as a static method is a common technique and is often called a static factory. Why use a static method? Because you don’t need to instantiate an object to make use of the create method. But remember it also has the disadvantage that you can’t subclass and change the behavior of the create method.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_reworking_the_pizzastore_class" style="clear: both">Reworking the PizzaStore class</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1291"></a><a class="indexterm" id="part0011_iddle1331"></a><a class="indexterm" id="part0011_iddle1964"></a>Now it’s time to fix up our client code. What we want to do is rely on the factory to create the pizzas for us. Here are the changes:</p><div class="informalfigure"><a id="part0011_med_id00172a"></a><div class="mediaobject"><a id="part0011_med_id00172"></a><img alt="image with no caption" hisrc="figs/web/118fig01.png.jpg" src="../Images/image00671.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note03"></a>Brain Power</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa2qe1"></a><a id="part0011_ch04qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p>We know that object composition allows us to change behavior dynamically at runtime (among other things) because we can swap in and out implementations. How might we be able to use that in the PizzaStore? What factory implementations might we be able to swap in and out?</p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p>We don’t know about you, but we’re thinking New York, Chicago, and California style pizza factories (let’s not forget New Haven, too)</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_simple_factory_defined" style="clear: both">The Simple Factory defined</h2></div></div></div><div class="informalfigure"><a id="part0011_med_id00173a"></a><div class="mediaobject"><a id="part0011_med_id00173"></a><img alt="image with no caption" hisrc="figs/web/common3.png.jpg" src="../Images/image00543.jpeg"/></div></div><p><a class="indexterm" id="part0011_iddle1385"></a><a class="indexterm" id="part0011_iddle1669"></a><a class="indexterm" id="part0011_iddle1671"></a><a class="indexterm" id="part0011_iddle1777"></a><a class="indexterm" id="part0011_iddle2323"></a><a class="indexterm" id="part0011_iddle2325"></a><span class="strong"><strong>Pattern Honorable Mention</strong></span></p><p>The Simple Factory isn’t actually a Design Pattern; it’s more of a programming idiom. But it is commonly used, so we’ll give it a Head First Pattern Honorable Mention. Some developers do mistake this idiom for the “Factory Pattern,” so the next time there is an awkward silence between you and another developer, you’ve got a nice topic to break the ice.</p><p>Just because Simple Factory isn’t a REAL pattern doesn’t mean we shouldn’t check out how it’s put together. Let’s take a look at the class diagram of our new Pizza Store:</p><div class="informalfigure"><a id="part0011_med_id00174a"></a><div class="mediaobject"><a id="part0011_med_id00174"></a><img alt="image with no caption" hisrc="figs/web/119fig01.png.jpg" src="../Images/image00672.jpeg"/></div></div><p>Think of Simple Factory as a warm up. Next, we’ll explore two heavy-duty patterns that are both factories. But don’t worry, there’s more pizza to come!</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note04"></a>Note</h3><p>*Just another reminder: in design patterns, the phrase “implement an interface” does NOT always mean “write a class that implements a Java interface, by using the ‘implements’ keyword in the class declaration.” In the general use of the phrase, a concrete class implementing a method from a supertype (which could be a class OR interface) is still considered to be “implementing the interface” of that supertype.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_franchising_the_pizza_store" style="clear: both">Franchising the pizza store</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2125"></a>Your Objectville PizzaStore has done so well that you’ve trounced the competition and now everyone wants a PizzaStore in their own neighborhood. As the franchiser, you want to ensure the quality of the franchise operations and so you want them to use your time-tested code.</p><p>But what about regional differences? Each franchise might want to offer different styles of pizzas (New York, Chicago, and California, to name a few), depending on where the franchise store is located and the tastes of the local pizza connoisseurs.</p><div class="informalfigure"><a id="part0011_med_id00175a"></a><div class="mediaobject"><a id="part0011_med_id00175"></a><img alt="image with no caption" hisrc="figs/web/120fig01.png.jpg" src="../Images/image00673.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_weapostropheve_seen_one_approachhellip">We’ve seen one approach...</h3></div></div></div><p>If we take out SimplePizzaFactory and create three different factories — NYPizzaFactory, ChicagoPizzaFactory and CaliforniaPizzaFactory — then we can just compose the PizzaStore with the appropriate factory and a franchise is good to go. That’s one approach.</p><p>Let’s see what that would look like...</p><div class="informalfigure"><a id="part0011_med_id00176a"></a><div class="mediaobject"><a id="part0011_med_id00176"></a><img alt="image with no caption" hisrc="figs/web/121fig01.png.jpg" src="../Images/image00674.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_but_youapostrophed_like_a_little_more_qu">But you’d like a little more quality control...</h3></div></div></div><p>So you test-marketed the SimpleFactory idea, and what you found was that the franchises were using your factory to create pizzas, but starting to employ their own home-grown procedures for the rest of the process: they’d bake things a little differently, they’d forget to cut the pizza and they’d use third-party boxes.</p><p>Rethinking the problem a bit, you see that what you’d really like to do is create a framework that ties the store and the pizza creation together, yet still allows things to remain flexible.</p><p>In our early code, before the SimplePizzaFactory, we had the pizza-making code tied to the PizzaStore, but it wasn’t flexible. So, how can we have our pizza and eat it too?</p><div class="informalfigure"><a id="part0011_med_id00177a"></a><div class="mediaobject"><a id="part0011_med_id00177"></a><img alt="image with no caption" hisrc="figs/web/121fig02.png.jpg" src="../Images/image00675.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_framework_for_the_pizza_store" style="clear: both">A framework for the pizza store</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2124"></a>There <span class="emphasis"><em>is</em></span> a way to localize all the pizza-making activities to the PizzaStore class, and yet give the franchises freedom to have their own regional style.</p><p>What we’re going to do is put the createPizza() method back into PizzaStore, but this time as an <span class="strong"><strong>abstract method</strong></span>, and then create a PizzaStore subclass for each regional style.</p><p>First, let’s look at the changes to the PizzaStore:</p><div class="informalfigure"><a id="part0011_med_id00178a"></a><div class="mediaobject"><a id="part0011_med_id00178"></a><img alt="image with no caption" hisrc="figs/web/122fig01.png.jpg" src="../Images/image00676.jpeg"/></div></div><p>Now we’ve got a store waiting for subclasses; we’re going to have a subclass for each regional type (NYPizzaStore, ChicagoPizzaStore, CaliforniaPizzaStore) and each subclass is going to make the decision about what makes up a pizza. Let’s take a look at how this is going to work.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_allowing_the_subclasses_to_decide" style="clear: both">Allowing the subclasses to decide</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1299"></a><a class="indexterm" id="part0011_iddle1333"></a><a class="indexterm" id="part0011_iddle2118"></a><a class="indexterm" id="part0011_iddle2437"></a>Remember, the PizzaStore already has a well-honed order system in the orderPizza() method and you want to ensure that it’s consistent across all franchises.</p><p>What varies among the regional PizzaStores is the style of pizzas they make — New York Pizza has thin crust, Chicago Pizza has thick, and so on — and we are going to push all these variations into the createPizza() method and make it responsible for creating the right kind of pizza. The way we do this is by letting each subclass of PizzaStore define what the createPizza() method looks like. So, we will have a number of concrete subclasses of PizzaStore, each with its own pizza variations, all fitting within the PizzaStore framework and still making use of the well-tuned orderPizza() method.</p><div class="informalfigure"><a id="part0011_med_id00179a"></a><div class="mediaobject"><a id="part0011_med_id00179"></a><img alt="image with no caption" hisrc="figs/web/123fig01.png.jpg" src="../Images/image00677.jpeg"/></div></div><div class="informalfigure"><a id="part0011_med_id00180a"></a><div class="mediaobject"><a id="part0011_med_id00180"></a><img alt="image with no caption" hisrc="figs/web/124fig01.png.jpg" src="../Images/image00678.jpeg"/></div></div><p>Well, think about it from the point of view of the PizzaStore’s orderPizza() method: it is defined in the abstract PizzaStore, but concrete types are only created in the subclasses.</p><div class="informalfigure"><a id="part0011_med_id00181a"></a><div class="mediaobject"><a id="part0011_med_id00181"></a><img alt="image with no caption" hisrc="figs/web/124fig02.png.jpg" src="../Images/image00679.jpeg"/></div></div><p>Now, to take this a little further, the orderPizza() method does a lot of things with a Pizza object (like prepare, bake, cut, box), but because Pizza is abstract, orderPizza() has no idea what real concrete classes are involved. In other words, it’s decoupled!</p><div class="informalfigure"><a id="part0011_med_id00182a"></a><div class="mediaobject"><a id="part0011_med_id00182"></a><img alt="image with no caption" hisrc="figs/web/124fig03.png.jpg" src="../Images/image00680.jpeg"/></div></div><p>When orderPizza() calls createPizza(), one of your subclasses will be called into action to create a pizza. Which kind of pizza will be made? Well, that’s decided by the choice of pizza store you order from, NYStylePizzaStore or ChicagoStylePizzaStore.</p><div class="informalfigure"><a id="part0011_med_id00183a"></a><div class="mediaobject"><a id="part0011_med_id00183"></a><img alt="image with no caption" hisrc="figs/web/124fig04.png.jpg" src="../Images/image00681.jpeg"/></div></div><p>So, is there a real-time decision that subclasses make? No, but from the perspective of orderPizza(), if you chose a NYStylePizzaStore, that subclass gets to determine which pizza is made. So the subclasses aren’t really “deciding” — it was <span class="emphasis"><em>you</em></span> who decided by choosing which store you wanted — but they do determine which kind of pizza gets made.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_letapostrophes_make_a_pizzastore" style="clear: both">Let’s make a PizzaStore</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2128"></a>Being a franchise has its benefits. You get all the PizzaStore functionality for free. All the regional stores need to do is subclass PizzaStore and supply a createPizza() method that implements their style of Pizza. We’ll take care of the big three pizza styles for the franchisees.</p><p>Here’s the New York regional style:</p><div class="informalfigure"><a id="part0011_med_id00184a"></a><div class="mediaobject"><a id="part0011_med_id00184"></a><img alt="image with no caption" hisrc="figs/web/125fig01.png.jpg" src="../Images/image00682.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note05"></a>Note</h3><p>* Note that the orderPizza() method in the superclass has no clue which Pizza we are creating; it just knows it can prepare, bake, cut, and box it!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Once we’ve got our PizzaStore subclasses built, it will be time to see about ordering up a pizza or two. But before we do that, why don’t you take a crack at building the Chicago Style and California Style pizza stores on the next page.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_sharpen_your_pencil-id00029"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0011_iddle2293"></a>We’ve knocked out the NYPizzaStore; just two more to go and we’ll be ready to franchise! Write the Chicago and California PizzaStore implementations here:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_declaring_a_factory_method" style="clear: both">Declaring a factory method</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1615"></a><a class="indexterm" id="part0011_iddle1618"></a><a class="indexterm" id="part0011_iddle1626"></a><a class="indexterm" id="part0011_iddle1656"></a>With just a couple of transformations to the PizzaStore we’ve gone from having an object handle the instantiation of our concrete classes to a set of subclasses that are now taking on that responsibility. Let’s take a closer look:</p><div class="informalfigure"><a id="part0011_med_id00185a"></a><div class="mediaobject"><a id="part0011_med_id00185"></a><img alt="image with no caption" hisrc="figs/web/127fig01.png.jpg" src="../Images/image00683.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_code_up_close"></a><h3 class="title">Code Up Close</h3><p>A factory method handles object creation and encapsulates it in a subclass. This decouples the client code in the superclass from the object creation code in the subclass.</p><div class="informalfigure"><a id="part0011_med_id00186a"></a><div class="mediaobject"><a id="part0011_med_id00186"></a><img alt="image with no caption" hisrc="figs/web/127fig02.png.jpg" src="../Images/image00684.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_letapostrophes_see_how_it_works_ordering">Let’s see how it works: ordering pizzas with the pizza factory method</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00187a"></a><div class="mediaobject"><a id="part0011_med_id00187"></a><img alt="image with no caption" hisrc="figs/web/128fig01.png.jpg" src="../Images/image00685.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_so_how_do_they_orderquestion_mark">So how do they order?</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① First, Joel and Ethan need an instance of a PizzaStore. Joel needs to instantiate a ChicagoPizzaStore and Ethan needs a NYPizzaStore.</li><li class="listitem" style="list-style-type: none">② With a PizzaStore in hand, both Ethan and Joel call the orderPizza() method and pass in the type of pizza they want (cheese, veggie, and so on).</li><li class="listitem" style="list-style-type: none">③ To create the pizzas, the createPizza() method is called, which is defined in the two subclasses NYPizzaStore and ChicagoPizzaStore. As we defined them, the NYPizzaStore instantiates a NY style pizza, and the ChicagoPizzaStore instantiates a Chicago style pizza. In either case, the Pizza is returned to the orderPizza() method.</li><li class="listitem" style="list-style-type: none">④ The orderPizza() method has no idea what kind of pizza was created, but it knows it is a pizza and it prepares, bakes, cuts, and boxes it for Ethan and Joel.</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_letapostrophes_check_out_how_these_pizza">Let’s check out how these pizzas are really made to order...</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00188a"></a><div class="mediaobject"><a id="part0011_med_id00188"></a><img alt="image with no caption" hisrc="figs/web/common17.png.jpg" src="../Images/image00686.jpeg"/></div></div><p><span class="strong"><strong>Behind the Scenes</strong></span></p><div class="informalfigure"><a id="part0011_med_id00189a"></a><div class="mediaobject"><a id="part0011_med_id00189"></a><img alt="image with no caption" hisrc="figs/web/129fig01.png.jpg" src="../Images/image00687.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_weapostrophere_just_missing_one_thing_pi" style="clear: both">We’re just missing one thing: PIZZA!</h2></div></div></div><div class="informalfigure"><a id="part0011_med_id00190a"></a><div class="mediaobject"><a id="part0011_med_id00190"></a><img alt="image with no caption" hisrc="figs/web/common11.png.jpg" src="../Images/image00688.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_our_pizzastore_isnapostrophet_going_to_b">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00191a"></a><div class="mediaobject"><a id="part0011_med_id00191"></a><img alt="image with no caption" hisrc="figs/web/130fig01.png.jpg" src="../Images/image00689.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note06"></a>Note</h3><p><a class="indexterm" id="part0011_iddle1001"></a><a class="indexterm" id="part0011_iddle1107"></a><a class="indexterm" id="part0011_iddle1778"></a><a class="indexterm" id="part0011_iddle2093"></a><a class="indexterm" id="part0011_iddle2129"></a>REMEMBER: we don’t provide import and package statements in the code listings. Get the complete source code from the wickedlysmart website. You’ll find the URL on page xxxiii in the Intro.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_now_we_just_need_some_concrete_subclasse">Now we just need some concrete subclasses... how about defining New York and Chicago style cheese pizzas?</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00192a"></a><div class="mediaobject"><a id="part0011_med_id00192"></a><img alt="image with no caption" hisrc="figs/web/131fig01.png.jpg" src="../Images/image00690.jpeg"/></div></div><div class="informalfigure"><a id="part0011_med_id00193a"></a><div class="mediaobject"><a id="part0011_med_id00193"></a><img alt="image with no caption" hisrc="figs/web/131fig02.png.jpg" src="../Images/image00691.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_youapostropheve_waited_long_enoughdot_ti" style="clear: both">You’ve waited long enough. Time for some pizzas!</h2></div></div></div><div class="informalfigure"><a id="part0011_med_id00194a"></a><div class="mediaobject"><a id="part0011_med_id00194"></a><img alt="image with no caption" hisrc="figs/web/132fig01.png.jpg" src="../Images/image00692.jpeg"/></div></div><div class="informalfigure"><a id="part0011_med_id00195a"></a><div class="mediaobject"><a id="part0011_med_id00195"></a><img alt="image with no caption" hisrc="figs/web/132fig02.png.jpg" src="../Images/image00693.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_itapostrophes_finally_time_to_meet_the_f" style="clear: both">It’s finally time to meet the Factory Method Pattern</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1117"></a><a class="indexterm" id="part0011_iddle1337"></a><a class="indexterm" id="part0011_iddle1620"></a><a class="indexterm" id="part0011_iddle1625"></a><a class="indexterm" id="part0011_iddle1635"></a><a class="indexterm" id="part0011_iddle1649"></a><a class="indexterm" id="part0011_iddle1655"></a><a class="indexterm" id="part0011_iddle1665"></a>All factory patterns encapsulate object creation. The Factory Method Pattern encapsulates object creation by letting subclasses decide what objects to create. Let’s check out these class diagrams to see who the players are in this pattern:</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_creator_classes">The Creator classes</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00196a"></a><div class="mediaobject"><a id="part0011_med_id00196"></a><img alt="image with no caption" hisrc="figs/web/133fig01.png.jpg" src="../Images/image00694.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_product_classes">The Product classes</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00197a"></a><div class="mediaobject"><a id="part0011_med_id00197"></a><img alt="image with no caption" hisrc="figs/web/133fig02.png.jpg" src="../Images/image00695.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_another_perspective_parallel_class_hiera" style="clear: both">Another perspective: parallel class hierarchies</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1133"></a><a class="indexterm" id="part0011_iddle1619"></a><a class="indexterm" id="part0011_iddle1634"></a><a class="indexterm" id="part0011_iddle1664"></a><a class="indexterm" id="part0011_iddle2094"></a>We’ve seen that the factory method provides a framework by supplying an orderPizza() method that is combined with a factory method. Another way to look at this pattern as a framework is in the way it encapsulates product knowledge into each creator.</p><p>Let’s look at the two parallel class hierarchies and see how they relate:</p><div class="informalfigure"><a id="part0011_med_id00198a"></a><div class="mediaobject"><a id="part0011_med_id00198"></a><img alt="image with no caption" hisrc="figs/web/134fig01.png.jpg" src="../Images/image00696.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note07"></a>Note</h3><p>The factory method is the key to encapsulating this knowledge.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_design_puzzle-id00030"></a><h3 class="title">Design Puzzle</h3><p><a class="indexterm" id="part0011_iddle1430"></a><a class="indexterm" id="part0011_iddle1629"></a><a class="indexterm" id="part0011_iddle1659"></a><a class="indexterm" id="part0011_iddle2119"></a>We need another kind of pizza for those crazy Californians (crazy in a <span class="emphasis"><em>good</em></span> way, of course). Draw another parallel set of classes that you’d need to add a new California region to our PizzaStore.</p><div class="informalfigure"><a id="part0011_med_id00199a"></a><div class="mediaobject"><a id="part0011_med_id00199"></a><img alt="image with no caption" hisrc="figs/web/135fig01.png.jpg" src="../Images/image00697.jpeg"/></div></div><p>Okay, now write the five <span class="emphasis"><em>most bizarre</em></span> things you can think of to put on a pizza. Then, you’ll be ready to go into business making pizza in California!</p><p>___________________________________________________________</p><p>___________________________________________________________</p><p>___________________________________________________________</p><p>___________________________________________________________</p><p>___________________________________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_factory_method_pattern_defined" style="clear: both">Factory Method Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1290"></a><a class="indexterm" id="part0011_iddle1338"></a><a class="indexterm" id="part0011_iddle1616"></a><a class="indexterm" id="part0011_iddle1624"></a><a class="indexterm" id="part0011_iddle1627"></a><a class="indexterm" id="part0011_iddle1657"></a><a class="indexterm" id="part0011_iddle2019"></a><a class="indexterm" id="part0011_iddle2434"></a>It’s time to roll out the official definition of the Factory Method Pattern:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note08"></a>Note</h3><p><span class="strong"><strong>The Factory Method Pattern</strong></span> defines an interface for creating an object, but lets subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>As with every factory, the Factory Method Pattern gives us a way to encapsulate the instantiations of concrete types. Looking at the class diagram below, you can see that the abstract Creator gives you an interface with a method for creating objects, also known as the “factory method.” Any other methods implemented in the abstract Creator are written to operate on products produced by the factory method. Only subclasses actually implement the factory method and create products.</p><p>As in the official definition, you’ll often hear developers say that the Factory Method lets subclasses decide which class to instantiate. They say “decide” not because the pattern allows subclasses themselves to decide at runtime, but because the creator class is written without knowledge of the actual products that will be created, which is decided purely by the choice of the subclass that is used.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note09"></a>Note</h3><p>You could ask them what “decides” means, but we bet you now understand this better than they do!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0011_med_id00200a"></a><div class="mediaobject"><a id="part0011_med_id00200"></a><img alt="image with no caption" hisrc="figs/web/136fig01.png.jpg" src="../Images/image00698.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_there_are_no_dumb_questions-id00031"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3qe1"></a><a id="part0011_ch04qa3q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a class="indexterm" id="part0011_iddle1295"></a><a class="indexterm" id="part0011_iddle1617"></a><a class="indexterm" id="part0011_iddle1636"></a><a class="indexterm" id="part0011_iddle1653"></a><a class="indexterm" id="part0011_iddle1666"></a><a class="indexterm" id="part0011_iddle1670"></a><a class="indexterm" id="part0011_iddle2251"></a><a class="indexterm" id="part0011_iddle2324"></a><a class="indexterm" id="part0011_iddle2483"></a><span class="strong"><strong>Q: What’s the advantage of the Factory Method Pattern when you only have one ConcreteCreator?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> The Factory Method Pattern is useful if you’ve only got one concrete creator because you are decoupling the implementation of the product from its use. If you add additional products or change a product’s implementation, it will not affect your Creator (because the Creator is not tightly coupled to any ConcreteProduct).</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3qe2"></a><a id="part0011_ch04qa3q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Would it be correct to say that our NY and Chicago stores are implemented using Simple Factory? They look just like it.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> They’re similar, but used in different ways. Even though the implementation of each concrete store looks a lot like the SimplePizzaFactory, remember that the concrete stores are extending a class that has defined createPizza() as an abstract method. It is up to each store to define the behavior of the createPizza() method. In Simple Factory, the factory is another object that is composed with the PizzaStore.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3qe3"></a><a id="part0011_ch04qa3q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Are the factory method and the Creator always abstract?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No, you can define a default factory method to produce some concrete product. Then you always have a means of creating products even if there are no subclasses of the Creator.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3qe4"></a><a id="part0011_ch04qa3q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Each store can make four different kinds of pizzas based on the type passed in. Do all concrete creators make multiple products, or do they sometimes just make one?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> We implemented what is known as the parameterized factory method. It can make more than one object based on a parameter passed in, as you noticed. Often, however, a factory just produces one object and is not parameterized. Both are valid forms of the pattern.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3qe5"></a><a id="part0011_ch04qa3q5"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Your parameterized types don’t seem “type-safe.” I’m just passing in a String! What if I asked for a “CalmPizza”?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3q5a5"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You are certainly correct and that would cause, what we call in the business, a “runtime error.” There are several other more sophisticated techniques that can be used to make parameters more “type safe,” or, in other words, to ensure errors in parameters can be caught at compile time. For instance, you can create objects that represent the parameter types, use static constants, or use enums.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3qe6"></a><a id="part0011_ch04qa3q6"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: I’m still a bit confused about the difference between Simple Factory and Factory Method. They look very similar, except that in Factory Method, the class that returns the pizza is a subclass. Can you explain?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0011_ch04qa3q6a6"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You’re right that the subclasses do look a lot like Simple Factory; however, think of Simple Factory as a one-shot deal, while with Factory Method you are creating a framework that lets the subclasses decide which implementation will be used. For example, the orderPizza() method in the Factory Method provides a general framework for creating pizzas that relies on a factory method to actually create the concrete classes that go into making a pizza. By subclassing the PizzaStore class, you decide what concrete products go into making the pizza that orderPizza() returns. Compare that with SimpleFactory, which gives you a way to encapsulate object creation, but doesn’t give you the flexibility of the Factory Method because there is no way to vary the products you’re creating.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_master_and_studenthellip-id00032"></a><h3 class="title">Master and Student...</h3><p><a class="indexterm" id="part0011_iddle1405"></a><a class="indexterm" id="part0011_iddle1472"></a><a class="indexterm" id="part0011_iddle1489"></a><a class="indexterm" id="part0011_iddle2005"></a><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, tell me how your training is going.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, I have taken my study of “encapsulate what varies” further.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Go on...</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>I have learned that one can encapsulate the code that creates objects. When you have code that instantiates concrete classes, this is an area of frequent change. I’ve learned a technique called “factories” that allows you to encapsulate this behavior of instantiation.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>And these “factories,” of what benefit are they?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>There are many. By placing all my creation code in one object or method, I avoid duplication in my code and provide one place to perform maintenance. That also means clients depend only upon interfaces rather than the concrete classes required to instantiate objects. As I have learned in my studies, this allows me to program to an interface, not an implementation, and that makes my code more flexible and extensible in the future.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Yes Grasshopper, your OO instincts are growing. Do you have any questions for your master today?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, I know that by encapsulating object creation I am coding to abstractions and decoupling my client code from actual implementations. But my factory code must still use concrete classes to instantiate real objects. Am I not pulling the wool over my own eyes?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, object creation is a reality of life; we must create objects or we will never create a single Java program. But, with knowledge of this reality, we can design our code so that we have corralled this creation code like the sheep whose wool you would pull over your eyes. Once corralled, we can protect and care for the creation code. If we let our creation code run wild, then we will never collect its “wool.”</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, I see the truth in this.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>As I knew you would. Now, please go and meditate on object dependencies.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_very_dependent_pizzastore" style="clear: both">A very dependent PizzaStore</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_sharpen_your_pencil-id00033"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0011_iddle2278"></a>Let’s pretend you’ve never heard of an OO factory. Here’s a version of the PizzaStore that doesn’t use a factory; make a count of the number of concrete pizza objects this class is dependent on. If you added California style pizzas to this PizzaStore, how many objects would it be dependent on then?</p><div class="informalfigure"><a id="part0011_med_id00201a"></a><div class="mediaobject"><a id="part0011_med_id00201"></a><img alt="image with no caption" hisrc="figs/web/139fig01.png.jpg" src="../Images/image00699.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_looking_at_object_dependencies" style="clear: both">Looking at object dependencies</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1292"></a><a class="indexterm" id="part0011_iddle1633"></a><a class="indexterm" id="part0011_iddle1663"></a><a class="indexterm" id="part0011_iddle1790"></a>When you directly instantiate an object, you are depending on its concrete class. Take a look at our very dependent PizzaStore one page back. It creates all the pizza objects right in the PizzaStore class instead of delegating to a factory.</p><p>If we draw a diagram representing that version of the PizzaStore and all the objects it depends on, here’s what it looks like:</p><div class="informalfigure"><a id="part0011_med_id00202a"></a><div class="mediaobject"><a id="part0011_med_id00202"></a><img alt="image with no caption" hisrc="figs/web/140fig01.png.jpg" src="../Images/image00700.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_dependency_inversion_principle" style="clear: both">The Dependency Inversion Principle</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1119"></a><a class="indexterm" id="part0011_iddle1370"></a><a class="indexterm" id="part0011_iddle1400"></a><a class="indexterm" id="part0011_iddle1401"></a><a class="indexterm" id="part0011_iddle1628"></a><a class="indexterm" id="part0011_iddle1658"></a><a class="indexterm" id="part0011_iddle1729"></a><a class="indexterm" id="part0011_iddle2006"></a><a class="indexterm" id="part0011_iddle2077"></a>It should be pretty clear that reducing dependencies to concrete classes in our code is a “good thing.” In fact, we’ve got an OO design principle that formalizes this notion; it even has a big, formal name: <span class="emphasis"><em>Dependency Inversion Principle</em></span>.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note10"></a>Note</h3><p>Yet another phrase you can use to impress the execs in the room! Your raise will more than offset the cost of this book, and you’ll gain the admiration of your fellow developers.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Here’s the general principle:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note11"></a>Design Principle</h3><p><span class="emphasis"><em>Depend upon abstractions. Do not depend upon concrete classes.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>At first, this principle sounds a lot like “Program to an interface, not an implementation,” right? It is similar; however, the Dependency Inversion Principle makes an even stronger statement about abstraction. It suggests that our high-level components should not depend on our low-level components; rather, they should <span class="emphasis"><em>both</em></span> depend on abstractions.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note12"></a>Note</h3><p>A “high-level” component is a class with behavior defined in terms of other, “low-level” components.</p><p>For example, PizzaStore is a high-level component because its behavior is defined in terms of pizzas - it creates all the different pizza objects, and prepares, bakes, cuts, and boxes them, while the pizzas it uses are low-level components.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>But what the heck does that mean?</p><p>Well, let’s start by looking again at the pizza store diagram on the previous page. PizzaStore is our “high-level component” and the pizza implementations are our “low-level components,” and clearly the PizzaStore is dependent on the concrete pizza classes.</p><p>Now, this principle tells us we should instead write our code so that we are depending on abstractions, not concrete classes. That goes for both our high-level modules and our low-level modules.</p><p>But how do we do this? Let’s think about how we’d apply this principle to our Very Dependent PizzaStore implementation...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_applying_the_principle" style="clear: both">Applying the Principle</h2></div></div></div><p>Now, the main problem with the Very Dependent PizzaStore is that it depends on every type of pizza because it actually instantiates concrete types in its orderPizza() method.</p><p>While we’ve created an abstraction, Pizza, we’re nevertheless creating concrete Pizzas in this code, so we don’t get a lot of leverage out of this abstraction.</p><p>How can we get those instantiations out of the orderPizza() method? Well, as we know, the Factory Method allows us to do just that.</p><p>So, after we’ve applied the Factory Method, our diagram looks like this:</p><div class="informalfigure"><a id="part0011_med_id00203a"></a><div class="mediaobject"><a id="part0011_med_id00203"></a><img alt="image with no caption" hisrc="figs/web/142fig01.png.jpg" src="../Images/image00701.jpeg"/></div></div><p>After applying the Factory Method, you’ll notice that our high-level component, the PizzaStore, and our low-level components, the pizzas, both depend on Pizza, the abstraction. Factory Method is not the only technique for adhering to the Dependency Inversion Principle, but it is one of the more powerful ones.</p><div class="informalfigure"><a id="part0011_med_id00204a"></a><div class="mediaobject"><a id="part0011_med_id00204"></a><img alt="image with no caption" hisrc="figs/web/143fig01.png.jpg" src="../Images/image00702.jpeg"/></div></div><p><a class="indexterm" id="part0011_iddle1804"></a><span class="strong"><strong>Where’s the “inversion” in Dependency Inversion Principle?</strong></span></p><p>The “inversion” in the name Dependency Inversion Principle is there because it inverts the way you typically might think about your OO design. Look at the diagram on the previous page. Notice that the low-level components now depend on a higher level abstraction. Likewise, the high-level component is also tied to the same abstraction. So, the top-to-bottom dependency chart we drew a couple of pages back has inverted itself, with both high-level and low-level modules now depending on the abstraction.</p><p>Let’s also walk through the thinking behind the typical design process and see how introducing the principle can invert the way we think about the design...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_inverting_your_thinkinghellip" style="clear: both">Inverting your thinking...</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><a class="indexterm" id="part0011_iddle2127"></a><span class="inlinemediaobject"><a id="part0011_inline_id00205a"></a><img alt="" hisrc="figs/web/144fig01.png.jpg" src="../Images/image00703.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, so you need to implement a PizzaStore. What’s the first thought that pops into your head?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0011_inline_id00206a"></a><img alt="" hisrc="figs/web/144fig02.png.jpg" src="../Images/image00704.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Right, you start at the top and follow things down to the concrete classes. But, as you’ve seen, you don’t want your store to know about the concrete pizza types, because then it’ll be dependent on all those concrete classes!</p>
<p>Now, let’s “invert” your thinking... instead of starting at the top, start at the Pizzas and think about what you can abstract.</p></td></tr><tr><td rowspan="2" style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0011_inline_id00207a"></a><img alt="" hisrc="figs/web/144fig03.png.jpg" src="../Images/image00705.jpeg"/></span></p></td><td style="vertical-align: top; "><p>Right! You are thinking about the abstraction <span class="emphasis"><em>Pizza</em></span>. So now, go back and think about the design of the Pizza Store again.</p>
<p>Close. But to do that you’ll have to rely on a factory to get those concrete classes out of your Pizza Store. Once you’ve done that, your different concrete pizza types depend only on an abstraction and so does your store. We’ve taken a design where the store depended on concrete classes and inverted those dependencies (along with your thinking).</p></td></tr></tbody></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_few_guidelines_to_help_you_follow_the_pr" style="clear: both">A few guidelines to help you follow the Principle...</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1289"></a><a class="indexterm" id="part0011_iddle1294"></a><a class="indexterm" id="part0011_iddle1915"></a><a class="indexterm" id="part0011_iddle2014"></a><a class="indexterm" id="part0011_iddle2085"></a><a class="indexterm" id="part0011_iddle2493"></a>The following guidelines can help you avoid OO designs that violate the Dependency Inversion Principle:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">No variable should hold a reference to a concrete class.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note13"></a>Note</h3><p>If you use <span class="strong"><strong>new</strong></span>, you’ll be holding a reference to a concrete class. Use a factory to get around that!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem">No class should derive from a concrete class.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note14"></a>Note</h3><p>If you derive from a concrete class, you’re depending on a concrete class. Derive from an abstraction, like an interface or an abstract class.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem">No method should override an implemented method of any of its base classes.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note15"></a>Note</h3><p>If you override an implemented method, then your base class wasn’t really an abstraction to start with. Those methods implemented in the base class are meant to be shared by all your subclasses.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li></ul></div><p>You’re exactly right! Like many of our principles, this is a guideline you should strive for, rather than a rule you should follow all the time. Clearly, every single Java program ever written violates these guidelines!</p><p>But, if you internalize these guidelines and have them in the back of your mind when you design, you’ll know when you are violating the principle and you’ll have a good reason for doing so. For instance, if you have a class that isn’t likely to change, and you know it, then it’s not the end of the world if you instantiate a concrete class in your code. Think about it; we instantiate String objects all the time without thinking twice. Does that violate the principle? Yes. Is that okay? Yes. Why? Because String is very unlikely to change.</p><p>If, on the other hand, a class you write is likely to change, you have some good techniques like Factory Method to encapsulate that change.</p><div class="informalfigure"><a id="part0011_med_id00208a"></a><div class="mediaobject"><a id="part0011_med_id00208"></a><img alt="image with no caption" hisrc="figs/web/145fig01.png.jpg" src="../Images/image00706.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_meanwhilecomma_back_at_the_pizzastorehel" style="clear: both">Meanwhile, back at the PizzaStore...</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2122"></a>The design for the PizzaStore is really shaping up: it’s got a flexible framework and it does a good job of adhering to design principles.</p><p>Now, the key to Objectville Pizza’s success has always been fresh, quality ingredients, and what you’ve discovered is that with the new framework your franchises have been following your <span class="emphasis"><em>procedures</em></span>, but a few franchises have been substituting inferior ingredients in their pies to lower costs and increase their margins. You know you’ve got to do something, because in the long term this is going to hurt the Objectville brand!</p><div class="informalfigure"><a id="part0011_med_id00209a"></a><div class="mediaobject"><a id="part0011_med_id00209"></a><img alt="image with no caption" hisrc="figs/web/146fig01.png.jpg" src="../Images/image00707.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_ensuring_consistency_in_your_ingredients">Ensuring consistency in your ingredients</h3></div></div></div><p>So how are you going to ensure each franchise is using quality ingredients? You’re going to build a factory that produces them and ships them to your franchises!</p><p>Now there is only one problem with this plan: the franchises are located in different regions and what is red sauce in New York is not red sauce in Chicago. So, you have one set of ingredients that needs to be shipped to New York and a <span class="emphasis"><em>different</em></span> set that needs to be shipped to Chicago. Let’s take a closer look:</p><div class="informalfigure"><a id="part0011_med_id00210a"></a><div class="mediaobject"><a id="part0011_med_id00210"></a><img alt="image with no caption" hisrc="figs/web/146fig02.png.jpg" src="../Images/image00708.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_families_of_ingredientshellip" style="clear: both">Families of ingredients...</h2></div></div></div><p><span class="strong"><strong>New York uses one set of ingredients and Chicago another. Given the popularity of Objectville Pizza, it won’t be long before you also need to ship another set of regional ingredients to California, and what’s next? Seattle?</strong></span></p><p><span class="strong"><strong>For this to work, you are going to have to figure out how to handle families of ingredients.</strong></span></p><div class="informalfigure"><a id="part0011_med_id00211a"></a><div class="mediaobject"><a id="part0011_med_id00211"></a><img alt="image with no caption" hisrc="figs/web/147fig01.png.jpg" src="../Images/image00709.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_building_the_ingredient_factories" style="clear: both">Building the ingredient factories</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1005"></a><a class="indexterm" id="part0011_iddle1638"></a><span class="strong"><strong>Now we’re going to build a factory to create our ingredients; the factory will be responsible for creating each ingredient in the ingredient family. In other words, the factory will need to create dough, sauce, cheese, and so on... You’ll see how we are going to handle the regional differences shortly.</strong></span></p><p><span class="strong"><strong>Let’s start by defining an interface for the factory that is going to create all our ingredients:</strong></span></p><div class="informalfigure"><a id="part0011_med_id00212a"></a><div class="mediaobject"><a id="part0011_med_id00212"></a><img alt="image with no caption" hisrc="figs/web/148fig01.png.jpg" src="../Images/image00710.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note16"></a>Note</h3><p>If we’d had some common “machinery” to implement in each instance of factory, we could have made this an abstract class instead...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Here’s what we’re going to do:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Build a factory for each region. To do this, you’ll create a subclass of PizzaIngredientFactory that implements each create method.</li><li class="listitem" style="list-style-type: none">② Implement a set of ingredient classes to be used with the factory, like ReggianoCheese, RedPeppers, and ThickCrustDough. These classes can be shared among regions where appropriate.</li><li class="listitem" style="list-style-type: none">③ Then we still need to hook all this up by working our new ingredient factories into our old PizzaStore code.</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_building_the_new_york_ingredient_factory" style="clear: both">Building the New York ingredient factory</h2></div></div></div><p><span class="strong"><strong>Okay, here’s the implementation for the New York ingredient factory. This factory specializes in Marinara Sauce, Reggiano Cheese, Fresh Clams...</strong></span></p><div class="informalfigure"><a id="part0011_med_id00213a"></a><div class="mediaobject"><a id="part0011_med_id00213"></a><img alt="image with no caption" hisrc="figs/web/149fig01.png.jpg" src="../Images/image00711.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_sharpen_your_pencil-id00034"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0011_iddle1529"></a><a class="indexterm" id="part0011_iddle2268"></a>Write the ChicagoPizzaIngredientFactory. You can reference the classes below in your implementation:</p><div class="informalfigure"><a id="part0011_med_id00214a"></a><div class="mediaobject"><a id="part0011_med_id00214"></a><img alt="image with no caption" hisrc="figs/web/150fig01.png.jpg" src="../Images/image00712.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_reworking_the_pizzashellip" style="clear: both">Reworking the pizzas...</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2131"></a>We’ve got our factories all fired up and ready to produce quality ingredients; now we just need to rework our Pizzas so they only use factory-produced ingredients. We’ll start with our abstract Pizza class:</p><div class="informalfigure"><a id="part0011_med_id00215a"></a><div class="mediaobject"><a id="part0011_med_id00215"></a><img alt="image with no caption" hisrc="figs/web/151fig01.png.jpg" src="../Images/image00713.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_reworking_the_pizzascomma_continuedhelli" style="clear: both">Reworking the pizzas, continued...</h2></div></div></div><p>Now that you’ve got an abstract Pizza to work from, it’s time to create the New York and Chicago style Pizzas — only this time around they will get their ingredients straight from the factory. The franchisees’ days of skimping on ingredients are over!</p><p>When we wrote the Factory Method code, we had a NYCheesePizza and a ChicagoCheesePizza class. If you look at the two classes, the only thing that differs is the use of regional ingredients. The pizzas are made just the same (dough + sauce + cheese). The same goes for the other pizzas: Veggie, Clam, and so on. They all follow the same preparation steps; they just have different ingredients.</p><p>So, what you’ll see is that we really don’t need two classes for each pizza; the ingredient factory is going to handle the regional differences for us. Here’s the Cheese Pizza:</p><div class="informalfigure"><a id="part0011_med_id00216a"></a><div class="mediaobject"><a id="part0011_med_id00216"></a><img alt="image with no caption" hisrc="figs/web/152fig01.png.jpg" src="../Images/image00714.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_code_up_close-id00035"></a><h3 class="title">Code Up Close</h3><p><a class="indexterm" id="part0011_iddle1623"></a><a class="indexterm" id="part0011_iddle1654"></a>The Pizza code uses the factory it has been composed with to produce the ingredients used in the pizza. The ingredients produced depend on which factory we’re using. The Pizza class doesn’t care; it knows how to make pizzas. Now, it’s decoupled from the differences in regional ingredients and can be easily reused when there are factories for the Rockies, the Pacific Northwest, and beyond.</p><div class="informalfigure"><a id="part0011_med_id00217a"></a><div class="mediaobject"><a id="part0011_med_id00217"></a><img alt="image with no caption" hisrc="figs/web/153fig01.png.jpg" src="../Images/image00715.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Let’s check out the ClamPizza as well:</p><div class="informalfigure"><a id="part0011_med_id00218a"></a><div class="mediaobject"><a id="part0011_med_id00218"></a><img alt="image with no caption" hisrc="figs/web/153fig02.png.jpg" src="../Images/image00716.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_revisiting_our_pizza_stores" style="clear: both">Revisiting our pizza stores</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2130"></a><span class="strong"><strong>We’re almost there; we just need to make a quick trip to our franchise stores to make sure they are using the correct Pizzas. We also need to give them a reference to their local ingredient factories:</strong></span></p><div class="informalfigure"><a id="part0011_med_id00219a"></a><div class="mediaobject"><a id="part0011_med_id00219"></a><img alt="image with no caption" hisrc="figs/web/154fig01.png.jpg" src="../Images/image00717.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note17"></a>Brain Power</h3><p>Compare this version of the createPizza() method to the one in the Factory Method implementation earlier in the chapter.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_what_have_we_donequestion_mark" style="clear: both">What have we done?</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1004"></a><a class="indexterm" id="part0011_iddle1637"></a><a class="indexterm" id="part0011_iddle1651"></a><a class="indexterm" id="part0011_iddle2114"></a><span class="strong"><strong>That was quite a series of code changes; what exactly did we do?</strong></span></p><p><span class="strong"><strong>We provided a means of creating a family of ingredients for pizzas by introducing a new type of factory called an Abstract Factory.</strong></span></p><p><span class="strong"><strong>An Abstract Factory gives us an interface for creating a family of products. By writing code that uses this interface, we decouple our code from the actual factory that creates the products. That allows us to implement a variety of factories that produce products meant for different contexts — such as different regions, different operating systems, or different look and feels.</strong></span></p><p><span class="strong"><strong>Because our code is decoupled from the actual products, we can substitute different factories to get different behaviors (like getting marinara instead of plum tomatoes).</strong></span></p><p>An Abstract Factory provides an interface for a family of products. What’s a family? In our case, it’s all the things we need to make a pizza: dough, sauce, cheese, meats, and veggies.</p><p>From the abstract factory, we derive one or more concrete factories that produce the same products, but with different implementations.</p><p>We then write our code so that it uses the factory to create products. By passing in a variety of factories, we get a variety of implementations of those products. But our client code stays the same.</p><div class="informalfigure"><a id="part0011_med_id00220a"></a><div class="mediaobject"><a id="part0011_med_id00220"></a><img alt="image with no caption" hisrc="figs/web/155fig01.png.jpg" src="../Images/image00718.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_more_pizza_for_ethan_and_joelhellip" style="clear: both">More pizza for Ethan and Joel...</h2></div></div></div><p><a class="indexterm" id="part0011_iddle2116"></a><span class="strong"><strong>Ethan and Joel can’t get enough Objectville Pizza! What they don’t know is that now their orders are making use of the new ingredient factories. So now when they order...</strong></span></p><div class="informalfigure"><a id="part0011_med_id00221a"></a><div class="mediaobject"><a id="part0011_med_id00221"></a><img alt="image with no caption" hisrc="figs/web/common17.png.jpg" src="../Images/image00686.jpeg"/></div></div><p><span class="strong"><strong>Behind the Scenes</strong></span></p><div class="informalfigure"><a id="part0011_med_id00222a"></a><div class="mediaobject"><a id="part0011_med_id00222"></a><img alt="image with no caption" hisrc="figs/web/156fig01.png.jpg" src="../Images/image00719.jpeg"/></div></div><p>The first part of the order process hasn’t changed at all. Let’s follow Ethan’s order again:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① First we need a NY PizzaStore:</strong></span><div class="informalfigure"><a id="part0011_med_id00223a"></a><div class="mediaobject"><a id="part0011_med_id00223"></a><img alt="image with no caption" hisrc="figs/web/156fig02.png.jpg" src="../Images/image00720.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Now that we have a store, we can take an order:</strong></span><div class="informalfigure"><a id="part0011_med_id00224a"></a><div class="mediaobject"><a id="part0011_med_id00224"></a><img alt="image with no caption" hisrc="figs/web/156fig03.png.jpg" src="../Images/image00721.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ The orderPizza() method first calls the createPizza() method:</strong></span><a id="part0011_pro_id00012"></a><pre class="programlisting"><span class="strong"><strong>Pizza pizza = createPizza("cheese");</strong></span></pre></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0011_from_here_things_changecomma_because_we">From here things change, because we are using an ingredient factory</h3></div></div></div><div class="informalfigure"><a id="part0011_med_id00225a"></a><div class="mediaobject"><a id="part0011_med_id00225"></a><img alt="image with no caption" hisrc="figs/web/common17.png.jpg" src="../Images/image00686.jpeg"/></div></div><p><span class="strong"><strong>Behind the Scenes</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ When the createPizza() method is called, that’s when our ingredient factory gets involved:</strong></span><div class="informalfigure"><a id="part0011_med_id00226a"></a><div class="mediaobject"><a id="part0011_med_id00226"></a><img alt="image with no caption" hisrc="figs/web/157fig01.png.jpg" src="../Images/image00722.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ Next we need to prepare the pizza. Once the prepare() method is called, the factory is asked to prepare ingredients:</strong></span><div class="informalfigure"><a id="part0011_med_id00227a"></a><div class="mediaobject"><a id="part0011_med_id00227"></a><img alt="image with no caption" hisrc="figs/web/157fig02.png.jpg" src="../Images/image00723.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑥ Finally, we have the prepared pizza in hand and the orderPizza() method bakes, cuts, and boxes the pizza.</strong></span></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_abstract_factory_pattern_defined" style="clear: both">Abstract Factory Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0011_iddle1009"></a><a class="indexterm" id="part0011_iddle1642"></a><a class="indexterm" id="part0011_iddle1652"></a><a class="indexterm" id="part0011_iddle2115"></a>We’re adding yet another factory pattern to our pattern family, one that lets us create families of products. Let’s check out the official definition for this pattern:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note18"></a>Note</h3><p><span class="strong"><strong>The Abstract Factory Pattern</strong></span> provides an interface for creating families of related or dependent objects without specifying their concrete classes.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>We’ve certainly seen that Abstract Factory allows a client to use an abstract interface to create a set of related products without knowing (or caring) about the concrete products that are actually produced. In this way, the client is decoupled from any of the specifics of the concrete products. Let’s look at the class diagram to see how this all holds together:</p><div class="informalfigure"><a id="part0011_med_id00228a"></a><div class="mediaobject"><a id="part0011_med_id00228"></a><img alt="image with no caption" hisrc="figs/web/158fig01.png.jpg" src="../Images/image00724.jpeg"/></div></div><p><span class="strong"><strong>That’s a fairly complicated class diagram; let’s look at it all in terms of our PizzaStore:</strong></span></p><div class="informalfigure"><a id="part0011_med_id00229a"></a><div class="mediaobject"><a id="part0011_med_id00229"></a><img alt="image with no caption" hisrc="figs/web/159fig01.png.jpg" src="../Images/image00725.jpeg"/></div></div><div class="informalfigure"><a id="part0011_med_id00230a"></a><div class="mediaobject"><a id="part0011_med_id00230"></a><img alt="image with no caption" hisrc="figs/web/160fig01.png.jpg" src="../Images/image00726.jpeg"/></div></div><p><a class="indexterm" id="part0011_iddle1012"></a><a class="indexterm" id="part0011_iddle1013"></a><a class="indexterm" id="part0011_iddle1622"></a><a class="indexterm" id="part0011_iddle1645"></a><a class="indexterm" id="part0011_iddle1646"></a><a class="indexterm" id="part0011_iddle1650"></a><span class="strong"><strong>Is that a Factory Method lurking inside the Abstract Factory?</strong></span></p><p>Good catch! Yes, often the methods of an Abstract Factory are implemented as factory methods. It makes sense, right? The job of an Abstract Factory is to define an interface for creating a set of products. Each method in that interface is responsible for creating a concrete product, and we implement a subclass of the Abstract Factory to supply those implementations. So, factory methods are a natural way to implement your product methods in your abstract factories.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_patterns_exposed-id00036"></a><h3 class="title">Patterns Exposed</h3><p><span class="strong"><strong>This week’s interview: Factory Method and Abstract Factory, on each other</strong></span></p><p><span class="strong"><strong>HeadFirst:</strong></span> Wow, an interview with two patterns at once! This is a first for us.</p><p><span class="strong"><strong>Factory Method:</strong></span> Yeah, I’m not so sure I like being lumped in with Abstract Factory, you know. Just because we’re both factory patterns doesn’t mean we shouldn’t get our own interviews.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Don’t be miffed, we wanted to interview you together so we could help clear up any confusion about who’s who for the readers. You do have similarities, and I’ve heard that people sometimes get you confused.</p><p><span class="strong"><strong>Abstract Factory:</strong></span> It is true, there have been times I’ve been mistaken for Factory Method, and I know you’ve had similar issues, Factory Method. We’re both really good at decoupling applications from specific implementations; we just do it in different ways. So I can see why people might sometimes get us confused.</p><p><span class="strong"><strong>Factory Method:</strong></span> Well, it still ticks me off. After all, I use classes to create and you use objects; that’s totally different!</p><p><span class="strong"><strong>HeadFirst:</strong></span> Can you explain more about that, Factory Method?</p><p><span class="strong"><strong>Factory Method:</strong></span> Sure. Both Abstract Factory and I create objects — that’s our jobs. But I do it through inheritance...</p><p><span class="strong"><strong>Abstract Factory:</strong></span> ...and I do it through object composition.</p><p><span class="strong"><strong>Factory Method:</strong></span> Right. So that means, to create objects using Factory Method, you need to extend a class and provide an implementation for a factory method.</p><p><span class="strong"><strong>HeadFirst:</strong></span> And that factory method does what?</p><p><span class="strong"><strong>Factory Method:</strong></span> It creates objects, of course! I mean, the whole point of the Factory Method Pattern is that you’re using a subclass to do your creation for you. In that way, clients only need to know the abstract type they are using, the subclass worries about the concrete type. So, in other words, I keep clients decoupled from the concrete types.</p><p><span class="strong"><strong>Abstract Factory:</strong></span> And I do too, only I do it in a different way.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Go on, Abstract Factory... you said something about object composition?</p><p><span class="strong"><strong>Abstract Factory:</strong></span> I provide an abstract type for creating a family of products. Subclasses of this type define how those products are produced. To use the factory, you instantiate one and pass it into some code that is written against the abstract type. So, like Factory Method, my clients are decoupled from the actual concrete products they use.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Oh, I see, so another advantage is that you group together a set of related products.</p><p><span class="strong"><strong>Abstract Factory:</strong></span> That’s right.</p><p><span class="strong"><strong>HeadFirst:</strong></span> What happens if you need to extend that set of related products to, say, add another one? Doesn’t that require changing your interface?</p><p><span class="strong"><strong>Abstract Factory:</strong></span> That’s true; my interface has to change if new products are added, which I know people don’t like to do....</p><p><span class="strong"><strong>Factory Method:</strong></span> &lt;snicker&gt;</p><p><span class="strong"><strong>Abstract Factory:</strong></span> What are you snickering at, Factory Method?</p><p><span class="strong"><strong>Factory Method:</strong></span> Oh, come on, that’s a big deal! Changing your interface means you have to go in and change the interface of every subclass! That sounds like a lot of work.</p><p><span class="strong"><strong>Abstract Factory:</strong></span> Yeah, but I need a big interface because I am used to creating entire families of products. You’re only creating one product, so you don’t really need a big interface, you just need one method.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Abstract Factory, I heard that you often use factory methods to implement your concrete factories?</p><p><span class="strong"><strong>Abstract Factory:</strong></span> Yes, I’ll admit it, my concrete factories often implement a factory method to create their products. In my case, they are used purely to create products...</p><p><span class="strong"><strong>Factory Method:</strong></span> ...while in my case I usually implement code in the abstract creator that makes use of the concrete types the subclasses create.</p><p><span class="strong"><strong>HeadFirst:</strong></span> It sounds like you both are good at what you do. I’m sure people like having a choice; after all, factories are so useful, they’ll want to use them in all kinds of different situations. You both encapsulate object creation to keep applications loosely coupled and less dependent on implementations, which is really great, whether you’re using Factory Method or Abstract Factory. May I allow you each a parting word?</p><p><span class="strong"><strong>Abstract Factory:</strong></span> Thanks. Remember me, Abstract Factory, and use me whenever you have families of products you need to create and you want to make sure your clients create products that belong together.</p><p><span class="strong"><strong>Factory Method:</strong></span> And I’m Factory Method; use me to decouple your client code from the concrete classes you need to instantiate, or if you don’t know ahead of time all the concrete classes you are going to need. To use me, just subclass me and implement my factory method!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_factory_method_and_abstract_factory_comp" style="clear: both">Factory Method and Abstract Factory compared</h2></div></div></div><div class="informalfigure"><a id="part0011_med_id00231a"></a><div class="mediaobject"><a id="part0011_med_id00231"></a><img alt="image with no caption" hisrc="figs/web/162fig01.png.jpg" src="../Images/image00727.jpeg"/></div></div><div class="informalfigure"><a id="part0011_med_id00232a"></a><div class="mediaobject"><a id="part0011_med_id00232"></a><img alt="image with no caption" hisrc="figs/web/163fig01.png.jpg" src="../Images/image00728.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note19"></a>Note</h3><p>The product subclasses create parallel sets of product families. Here we have a New York ingredient family and a Chicago family.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_tools_for_your_design_toolbox-id00037" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>In this chapter, we added two more tools to your toolbox: Factory Method and Abstract Factory. Both patterns encapsulate object creation and allow you to decouple your code from concrete types.</p><div class="informalfigure"><a id="part0011_med_id00233a"></a><div class="mediaobject"><a id="part0011_med_id00233"></a><img alt="image with no caption" hisrc="figs/web/164fig01.png.jpg" src="../Images/image00729.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_bullet_points-id00038"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">All factories encapsulate object creation.</li><li class="listitem">Simple Factory, while not a bona fide design pattern, is a simple way to decouple your clients from concrete classes.</li><li class="listitem">Factory Method relies on inheritance: object creation is delegated to subclasses, which implement the factory method to create objects.</li><li class="listitem">Abstract Factory relies on object composition: object creation is implemented in methods exposed in the factory interface.</li><li class="listitem">All factory patterns promote loose coupling by reducing the dependency of your application on concrete classes.</li><li class="listitem">The intent of Factory Method is to allow a class to defer instantiation to its subclasses.</li><li class="listitem">The intent of Abstract Factory is to create families of related objects without having to depend on their concrete classes.</li><li class="listitem">The Dependency Inversion Principle guides us to avoid dependencies on concrete types and to strive for abstractions.</li><li class="listitem">Factories are a powerful technique for coding to abstractions, not concrete classes.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_design_patterns_crossword-id00039"></a><h3 class="title">Design Patterns Crossword</h3><p>It’s been a long chapter. Grab a slice of Pizza and relax while doing this crossword; all of the solution words are from this chapter.</p><div class="informalfigure"><a id="part0011_med_id00234a"></a><div class="mediaobject"><a id="part0011_med_id00234"></a><img alt="image with no caption" hisrc="figs/web/165fig01.png" src="../Images/image00730.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. In Factory Method, each franchise is a ________.</p>
<p>4. In Factory Method, who decides which class to instantiate?</p>
<p>6. Role of PizzaStore in Factory Method Pattern.</p>
<p>7. All New York style pizzas use this kind of cheese.</p>
<p>8. In Abstract Factory, each ingredient factory is a _______.</p>
<p>9. When you use new, you are programming to an ___________.</p>
<p>11. createPizza() is a ____________ (two words).</p>
<p>12. Joel likes this kind of pizza.</p>
<p>13. In Factory Method, the PizzaStore and the concrete Pizzas all depend on this abstraction.</p>
<p>14. When a class instantiates an object from a concrete class, it’s ___________ on that object.</p>
<p>15. All factory patterns allow us to __________ object creation.</p></td><td style="vertical-align: top; "><p>2. We used ___________ in Simple Factory and Abstract Factory, and inheritance in Factory Method.</p>
<p>3. Abstract Factory creates a ___________ of products.</p>
<p>5. Not a REAL factory pattern, but handy nonetheless.</p>
<p>10. Ethan likes this kind of pizza.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_sharpen_your_pencil_solution-id00040"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0011_iddle2294"></a>We’ve knocked out the NYPizzaStore; just two more to go and we’ll be ready to franchise! Write the Chicago and California PizzaStore implementations here:</p><div class="informalfigure"><a id="part0011_med_id00235a"></a><div class="mediaobject"><a id="part0011_med_id00235"></a><img alt="image with no caption" hisrc="figs/web/166fig01.png.jpg" src="../Images/image00731.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_design_puzzle_solution-id00041"></a><h3 class="title">Design Puzzle Solution</h3><p><a class="indexterm" id="part0011_iddle1431"></a><a class="indexterm" id="part0011_iddle1630"></a><a class="indexterm" id="part0011_iddle1660"></a><a class="indexterm" id="part0011_iddle2120"></a>We need another kind of pizza for those crazy Californians (crazy in a GOOD way, of course). Draw another parallel set of classes that you’d need to add a new California region to our PizzaStore.</p><div class="informalfigure"><a id="part0011_med_id00236a"></a><div class="mediaobject"><a id="part0011_med_id00236"></a><img alt="image with no caption" hisrc="figs/web/167fig01.png.jpg" src="../Images/image00732.jpeg"/></div></div><p>Okay, now write the five silliest things you can think of to put on a pizza. Then, you’ll be ready to go into business making pizza in California!</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0011_ch04note20"></a>Note</h3><p>Here are our suggestions...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>__<span class="underline">Mashed Potatoes with Roasted Garlic</span>_____________________</p><p>__<span class="underline">BBQ Sauce</span>_________________________________________</p><p>__<span class="underline">Artichoke Hearts</span>_____________________________________</p><p>__<span class="underline">M<span class="inlinemediaobject"><a id="part0011_inline_id0001"></a><img alt="" hisrc="figs/web/599fig03.png.jpg" src="../Images/image00733.jpeg"/></span>M’s</span>____________________________________________</p><p>__<span class="underline">Peanuts</span>____________________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0011_very_dependent_pizzastore-id00042" style="clear: both">A very dependent PizzaStore</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_sharpen_your_pencil_solution-id00043"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0011_iddle2279"></a>Let’s pretend you’ve never heard of an OO factory. Here’s a version of the PizzaStore that doesn’t use a factory; make a count of the number of concrete pizza objects this class is dependent on. If you added California style pizzas to this PizzaStore, how many objects would it be dependent on then?</p><div class="informalfigure"><a id="part0011_med_id00237a"></a><div class="mediaobject"><a id="part0011_med_id00237"></a><img alt="image with no caption" hisrc="figs/web/168fig01.png.jpg" src="../Images/image00734.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_sharpen_your_pencil_solution-id00044"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0011_iddle1006"></a><a class="indexterm" id="part0011_iddle1530"></a><a class="indexterm" id="part0011_iddle1639"></a><a class="indexterm" id="part0011_iddle2123"></a><a class="indexterm" id="part0011_iddle2269"></a>Go ahead and write the ChicagoPizzaIngredientFactory; you can reference the classes below in your implementation:</p><a id="part0011_pro_id00013"></a><pre class="programlisting"><span class="strong"><strong>public class ChicagoPizzaIngredientFactory</strong></span>
    <span class="strong"><strong>implements PizzaIngredientFactory</strong></span>
<span class="strong"><strong>{</strong></span>

    <span class="strong"><strong>public Dough createDough() {</strong></span>
        <span class="strong"><strong>return new ThickCrustDough();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Sauce createSauce() {</strong></span>
        <span class="strong"><strong>return new PlumTomatoSauce();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Cheese createCheese() {</strong></span>
        <span class="strong"><strong>return new MozzarellaCheese();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Veggies[] createVeggies() {</strong></span>
        <span class="strong"><strong>Veggies veggies[] = { new BlackOlives(),</strong></span>
                              <span class="strong"><strong>new Spinach(),</strong></span>
                              <span class="strong"><strong>new Eggplant() };</strong></span>
        <span class="strong"><strong>return veggies;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Pepperoni createPepperoni() {</strong></span>
        <span class="strong"><strong>return new SlicedPepperoni();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Clams createClam() {</strong></span>
        <span class="strong"><strong>return new FrozenClams();</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><div class="informalfigure"><a id="part0011_med_id00238a"></a><div class="mediaobject"><a id="part0011_med_id00238"></a><img alt="image with no caption" hisrc="figs/web/169fig01.png.jpg" src="../Images/image00735.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0011_design_patterns_crossword_soluti-id00045"></a><h3 class="title">Design Patterns Crossword Solution</h3><p>It’s been a long chapter. Grab a slice of Pizza and relax while doing this crossword; all of the solution words are from this chapter. Here’s the solution.</p><div class="informalfigure"><a id="part0011_med_id00239a"></a><div class="mediaobject"><a id="part0011_med_id00239"></a><img alt="image with no caption" hisrc="figs/web/170fig01.png" src="../Images/image00736.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0012_singleton_pattern_one_of_a_kind_objects"><div class="titlepage" id="part0012_aid-BE6O2"><div><div><h2 class="title">Chapter 5. The Singleton Pattern: One of a Kind Objects</h2></div></div></div><div class="informalfigure"><a id="part0012_med_id00240a"></a><div class="mediaobject"><a id="part0012_med_id00240"></a><img alt="image with no caption" hisrc="figs/web/171fig01.png.jpg" src="../Images/image00737.jpeg"/></div></div><p><a class="indexterm" id="part0012_iddle1414"></a><a class="indexterm" id="part0012_iddle2330"></a><span class="strong"><strong>Our next stop is the Singleton Pattern, our ticket to creating one-of-a-kind objects for which there is only one instance.</strong></span> You might be happy to know that of all patterns, the Singleton is the simplest in terms of its class diagram; in fact, the diagram holds just a single class! But don’t get too comfortable; despite its simplicity from a class design perspective, we are going to encounter quite a few bumps and potholes in its implementation. So buckle up.</p><div class="informalfigure"><a id="part0012_med_id00241a"></a><div class="mediaobject"><a id="part0012_med_id00241"></a><img alt="image with no caption" hisrc="figs/web/172fig01.png.jpg" src="../Images/image00738.jpeg"/></div></div><p><a class="indexterm" id="part0012_iddle1792"></a><a class="indexterm" id="part0012_iddle2331"></a><span class="strong"><strong>Developer:</strong></span> What use is that?</p><p><span class="strong"><strong>Guru:</strong></span> There are many objects we only need one of: thread pools, caches, dialog boxes, objects that handle preferences and registry settings, objects used for logging, and objects that act as device drivers to devices like printers and graphics cards. In fact, for many of these types of objects, if we were to instantiate more than one we’d run into all sorts of problems like incorrect program behavior, overuse of resources, or inconsistent results.</p><p><span class="strong"><strong>Developer:</strong></span> Okay, so maybe there are classes that should only be instantiated once, but do I need a whole chapter for this? Can’t I just do this by convention or by global variables? You know, like in Java, I could do it with a static variable.</p><p><span class="strong"><strong>Guru:</strong></span> In many ways, the Singleton Pattern <span class="strong"><strong>is a convention</strong></span> for ensuring one and only one object is instantiated for a given class. If you’ve got a better one, the world would like to hear about it; but remember, like all patterns, the Singleton Pattern is a time-tested method for ensuring only one object gets created. The Singleton Pattern also gives us a global point of access, just like a global variable, but without the downsides.</p><p><span class="strong"><strong>Developer:</strong></span> What downsides?</p><p><span class="strong"><strong>Guru:</strong></span> Well, here’s one example: if you assign an object to a global variable, then that object might be created when your application begins. Right? What if this object is resource intensive and your application never ends up using it? As you will see, with the Singleton Pattern, we can create our objects only when they are needed.</p><p><span class="strong"><strong>Developer:</strong></span> This still doesn’t seem like it should be so difficult.</p><p><span class="strong"><strong>Guru:</strong></span> If you’ve got a good handle on static class variables and methods as well as access modifiers, it’s not. But, in either case, it is interesting to see how a Singleton works, and, as simple as it sounds, Singleton code is hard to get right. Just ask yourself: how do I prevent more than one object from being instantiated? It’s not so obvious, is it?</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_little_singleton" style="clear: both">The Little Singleton</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0012_small_socratic_exercise_in_the_style_of">A small Socratic exercise in the style of The Little Lisper</h3></div></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><a class="indexterm" id="part0012_iddle2022"></a><a class="indexterm" id="part0012_iddle2328"></a>How would you create a single object?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><a id="part0012_pro_id00014"></a><pre class="programlisting"><span class="strong"><strong>new MyObject();</strong></span></pre></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>And, what if another object wanted to create a MyObject? Could it call new on MyObject again?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yes, of course.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>So as long as we have a class, can we always instantiate it one or more times?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yes. Well, only if it’s a public class.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>And if not?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, if it’s not a public class, only classes in the same package can instantiate it. But they can still instantiate it more than once.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hmm, interesting.</p>
<p>Did you know you could do this?</p>
<p><span class="inlinemediaobject"><a id="part0012_inline_id00242a"></a><img alt="" hisrc="figs/web/173fig01.png.jpg" src="../Images/image00739.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>No, I’d never thought of it, but I guess it makes sense because it is a legal definition.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>What does it mean?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I suppose it is a class that can’t be instantiated because it has a private constructor.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, is there ANY object that could use the private constructor?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Hmm, I think the code in MyClass is the only code that could call it. But that doesn’t make much sense.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Why not?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Because I’d have to have an instance of the class to call it, but I can’t have an instance because no other class can instantiate it. It’s a chicken-and-egg problem: I can use the constructor from an object of type MyClass, but I can never instantiate that object because no other object can use “new MyClass()”.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Okay. It was just a thought.</p>
<p>What does this mean?</p>
<p><span class="inlinemediaobject"><a id="part0012_inline_id00243a"></a><img alt="" hisrc="figs/web/174fig01.png.jpg" src="../Images/image00740.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>MyClass is a class with a static method. We can call the static method like this:</p>
<a id="part0012_pro_id00015"></a><pre class="programlisting"><span class="strong"><strong>MyClass.getInstance();</strong></span></pre></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Why did you use MyClass, instead of some object name?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, getInstance() is a static method; in other words, it is a CLASS method. You need to use the class name to reference a static method.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Very interesting. What if we put things together.</p>
<p><span class="emphasis"><em>Now</em></span> can I instantiate a MyClass?</p>
<p><span class="inlinemediaobject"><a id="part0012_inline_id00244a"></a><img alt="" hisrc="figs/web/174fig02.png.jpg" src="../Images/image00741.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wow, you sure can.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>So, now can you think of a second way to instantiate an object?</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><a id="part0012_pro_id00016"></a><pre class="programlisting"><span class="strong"><strong>MyClass.getInstance();</strong></span></pre></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Can you finish the code so that only ONE instance of MyClass is ever created?</p></td><td style="vertical-align: top; "><p>Yes, I think so...</p>
<p>(You’ll find the code on the next page.)</p></td></tr></tbody></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_dissecting_the_classic_singleton_pattern" style="clear: both">Dissecting the classic Singleton Pattern implementation</h2></div></div></div><div class="informalfigure"><a id="part0012_med_id00245a"></a><div class="mediaobject"><a id="part0012_med_id00245"></a><img alt="image with no caption" hisrc="figs/web/175fig01.png.jpg" src="../Images/image00742.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0012_ch05note01"></a>Watch it!</h3><p><a class="indexterm" id="part0012_iddle2335"></a><a class="indexterm" id="part0012_iddle2343"></a>If you’re just flipping through the book, don’t blindly type in this code; you’ll see it has a few issues later in the chapter.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_code_up_close-id00046"></a><h3 class="title">Code Up Close</h3><div class="informalfigure"><a id="part0012_med_id00246a"></a><div class="mediaobject"><a id="part0012_med_id00246"></a><img alt="image with no caption" hisrc="figs/web/175fig02.png.jpg" src="../Images/image00743.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_patterns_exposed-id00047"></a><h3 class="title">Patterns Exposed</h3><p><a class="indexterm" id="part0012_iddle2023"></a><a class="indexterm" id="part0012_iddle2329"></a><span class="strong"><strong>This week’s interview: Confessions of a Singleton</strong></span></p><p><span class="strong"><strong>HeadFirst:</strong></span> Today we are pleased to bring you an interview with a Singleton object. Why don’t you begin by telling us a bit about yourself.</p><p><span class="strong"><strong>Singleton:</strong></span> Well, I’m totally unique; there is just one of me!</p><p><span class="strong"><strong>HeadFirst:</strong></span> One?</p><p><span class="strong"><strong>Singleton:</strong></span> Yes, one. I’m based on the Singleton Pattern, which assures that at any time there is only one instance of me.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Isn’t that sort of a waste? Someone took the time to develop a full-blown class and now all we can get is one object out of it?</p><p><span class="strong"><strong>Singleton:</strong></span> Not at all! There is power in ONE. Let’s say you have an object that contains registry settings. You don’t want multiple copies of that object and its values running around — that would lead to chaos. By using an object like me you can assure that every object in your application is making use of the same global resource.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Tell us more...</p><p><span class="strong"><strong>Singleton:</strong></span> Oh, I’m good for all kinds of things. Being single sometimes has its advantages you know. I’m often used to manage pools of resources, like connection or thread pools.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Still, only one of your kind? That sounds lonely.</p><p><span class="strong"><strong>Singleton:</strong></span> Because there’s only one of me, I do keep busy, but it would be nice if more developers knew me — many developers run into bugs because they have multiple copies of objects floating around they’re not even aware of.</p><p><span class="strong"><strong>HeadFirst:</strong></span> So, if we may ask, how do you know there is only one of you? Can’t anyone with a new operator create a “new you”?</p><p><span class="strong"><strong>Singleton:</strong></span> Nope! I’m truly unique.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Well, do developers swear an oath not to instantiate you more than once?</p><p><span class="strong"><strong>Singleton:</strong></span> Of course not. The truth be told... well, this is getting kind of personal but... I have no public constructor.</p><p><span class="strong"><strong>HeadFirst:</strong></span> NO PUBLIC CONSTRUCTOR! Oh, sorry, no public constructor?</p><p><span class="strong"><strong>Singleton:</strong></span> That’s right. My constructor is declared private.</p><p><span class="strong"><strong>HeadFirst:</strong></span> How does that work? How do you EVER get instantiated?</p><p><span class="strong"><strong>Singleton:</strong></span> You see, to get a hold of a Singleton object, you don’t instantiate one, you just ask for an instance. So my class has a static method called getInstance(). Call that, and I’ll show up at once, ready to work. In fact, I may already be helping other objects when you request me.</p><p><span class="strong"><strong>HeadFirst:</strong></span> Well, Mr. Singleton, there seems to be a lot under your covers to make all this work. Thanks for revealing yourself and we hope to speak with you again soon!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_chocolate_factory" style="clear: both">The Chocolate Factory</h2></div></div></div><p><a class="indexterm" id="part0012_iddle1102"></a><a class="indexterm" id="part0012_iddle2332"></a>Everyone knows that all modern chocolate factories have computer-controlled chocolate boilers. The job of the boiler is to take in chocolate and milk, bring them to a boil, and then pass them on to the next phase of making chocolate bars.</p><p>Here’s the controller class for Choc-O-Holic, Inc.’s industrial strength Chocolate Boiler. Check out the code; you’ll notice they’ve tried to be very careful to ensure that bad things don’t happen, like draining 500 gallons of unboiled mixture, or filling the boiler when it’s already full, or boiling an empty boiler!</p><div class="informalfigure"><a id="part0012_med_id00247a"></a><div class="mediaobject"><a id="part0012_med_id00247"></a><img alt="image with no caption" hisrc="figs/web/177fig01.png.jpg" src="../Images/image00744.jpeg"/></div></div><div class="informalfigure"><a id="part0012_med_id00248a"></a><div class="mediaobject"><a id="part0012_med_id00248"></a><img alt="image with no caption" hisrc="figs/web/177fig02.png.jpg" src="../Images/image00745.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0012_ch05note02"></a>Brain Power</h3><p><a class="indexterm" id="part0012_iddle1562"></a><a class="indexterm" id="part0012_iddle2307"></a>Choc-O-Holic has done a decent job of ensuring bad things don’t happen, don’t ya think? Then again, you probably suspect that if two ChocolateBoiler instances get loose, some very bad things can happen.</p><p>How might things go wrong if more than one instance of ChocolateBoiler is created in an application?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_sharpen_your_pencil-id00048"></a><h3 class="title">Sharpen your pencil</h3><p>Can you help Choc-O-Holic improve their ChocolateBoiler class by turning it into a singleton?</p><div class="informalfigure"><a id="part0012_med_id00249a"></a><div class="mediaobject"><a id="part0012_med_id00249"></a><img alt="image with no caption" hisrc="figs/web/178fig01.png.jpg" src="../Images/image00746.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_singleton_pattern_defined" style="clear: both">Singleton Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0012_iddle1686"></a><a class="indexterm" id="part0012_iddle1880"></a><a class="indexterm" id="part0012_iddle2334"></a><a class="indexterm" id="part0012_iddle2338"></a><span class="strong"><strong>Now that you’ve got the classic implementation of Singleton in your head, it’s time to sit back, enjoy a bar of chocolate, and check out the finer points of the Singleton Pattern.</strong></span></p><p><span class="strong"><strong>Let’s start with the concise definition of the pattern:</strong></span></p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0012_ch05note03"></a>Note</h3><p><span class="strong"><strong>The Singleton Pattern</strong></span> ensures a class has only one instance, and provides a global point of access to it.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>No big surprises there. But let’s break it down a bit more:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">What’s really going on here? We’re taking a class and letting it manage a single instance of itself. We’re also preventing any other class from creating a new instance on its own. To get an instance, you’ve got to go through the class itself.</li><li class="listitem">We’re also providing a global access point to the instance: whenever you need an instance, just query the class and it will hand you back the single instance. As you’ve seen, we can implement this so that the Singleton is created in a lazy manner, which is especially important for resource-intensive objects.</li></ul></div><p><span class="strong"><strong>Okay, let’s check out the class diagram:</strong></span></p><div class="informalfigure"><a id="part0012_med_id00250a"></a><div class="mediaobject"><a id="part0012_med_id00250"></a><img alt="image with no caption" hisrc="figs/web/179fig01.png.jpg" src="../Images/image00747.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_houstoncomma_hersheycomma_pa_we_have_a_p" style="clear: both"><span class="strikethrough">Houston,</span> Hershey, PA we have a problem...</h2></div></div></div><p><span class="strong"><strong>It looks like the Chocolate Boiler has let us down; despite the fact we improved the code using Classic Singleton, somehow the ChocolateBoiler’s fill() method was able to start filling the boiler even though a batch of milk and chocolate was already boiling! That’s 500 gallons of spilled milk (and chocolate)! What happened!?</strong></span></p><div class="informalfigure"><a id="part0012_med_id00251a"></a><div class="mediaobject"><a id="part0012_med_id00251"></a><img alt="image with no caption" hisrc="figs/web/180fig01.png.jpg" src="../Images/image00748.jpeg"/></div></div><p><span class="strong"><strong>Could the addition of threads have caused this? Isn’t it the case that once we’ve set the uniqueInstance variable to the sole instance of ChocolateBoiler, all calls to getInstance() should return the same instance? Right?</strong></span></p><div class="informalfigure"><a id="part0012_med_id00252a"></a><div class="mediaobject"><a id="part0012_med_id00252"></a><img alt="image with no caption" hisrc="figs/web/180fig02.png.jpg" src="../Images/image00749.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_be_the_jvm"></a><h3 class="title">BE the JVM</h3><p><a class="indexterm" id="part0012_iddle1083"></a><a class="indexterm" id="part0012_iddle1334"></a><a class="indexterm" id="part0012_iddle1503"></a><a class="indexterm" id="part0012_iddle2336"></a><span class="strong"><strong>We have two threads, each executing this code. Your job is to play the JVM and determine whether there is a case in which two threads might get ahold of different boiler objects. Hint: you really just need to look at the sequence of operations in the getInstance() method and the value of uniqueInstance to see how they might overlap. Use the code magnets to help you study how the code might interleave to create two boiler objects.</strong></span></p><div class="informalfigure"><a id="part0012_med_id00253a"></a><div class="mediaobject"><a id="part0012_med_id00253"></a><img alt="image with no caption" hisrc="figs/web/181fig01.png.jpg" src="../Images/image00750.jpeg"/></div></div><p><span class="strong"><strong>Make sure you check your answer in <a class="xref" href="#part0012_be_the_jvm_solution">BE the JVM Solution</a> before continuing!</strong></span></p><div class="informalfigure"><a id="part0012_med_id00254a"></a><div class="mediaobject"><a id="part0012_med_id00254"></a><img alt="image with no caption" hisrc="figs/web/181fig02.png.jpg" src="../Images/image00751.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_dealing_with_multithreading" style="clear: both">Dealing with multithreading</h2></div></div></div><p><a class="indexterm" id="part0012_iddle2450"></a><span class="strong"><strong>Our multithreading woes are almost trivially fixed by making getInstance() a synchronized method:</strong></span></p><div class="informalfigure"><a id="part0012_med_id00255a"></a><div class="mediaobject"><a id="part0012_med_id00255"></a><img alt="image with no caption" hisrc="figs/web/182fig01.png.jpg" src="../Images/image00752.jpeg"/></div></div><p>Good point, and it’s actually a little worse than you make out: the only time synchronization is relevant is the first time through this method. In other words, once we’ve set the uniqueInstance variable to an instance of Singleton, we have no further need to synchronize this method. After the first time through, synchronization is totally unneeded overhead!</p><div class="informalfigure"><a id="part0012_med_id00256a"></a><div class="mediaobject"><a id="part0012_med_id00256"></a><img alt="image with no caption" hisrc="figs/web/182fig02.png.jpg" src="../Images/image00753.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_can_we_improve_multithreadingquestion_ma" style="clear: both">Can we improve multithreading?</h2></div></div></div><p><a class="indexterm" id="part0012_iddle1962"></a>For most Java applications, we obviously need to ensure that the Singleton works in the presence of multiple threads. But, it is expensive to synchronize the getInstance() method, so what do we do?</p><p>Well, we have a few options...</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0012_onedot_do_nothing_if_the_performance_of">1. Do nothing if the performance of getInstance() isn’t critical to your application.</h3></div></div></div><p>That’s right; if calling the getInstance() method isn’t causing substantial overhead for your application, forget about it. Synchronizing getInstance() is straightforward and effective. Just keep in mind that synchronizing a method can decrease performance by a factor of 100, so if a high-traffic part of your code begins using getInstance(), you may have to reconsider.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0012_twodot_move_to_an_eagerly_created_instan">2. Move to an eagerly created instance rather than a lazily created one.</h3></div></div></div><p>If your application always creates and uses an instance of the Singleton or the overhead of creation and runtime aspects of the Singleton are not onerous, you may want to create your Singleton eagerly, like this:</p><div class="informalfigure"><a id="part0012_med_id00257a"></a><div class="mediaobject"><a id="part0012_med_id00257"></a><img alt="image with no caption" hisrc="figs/web/183fig01.png.jpg" src="../Images/image00754.jpeg"/></div></div><p>Using this approach, we rely on the JVM to create the unique instance of the Singleton when the class is loaded. The JVM guarantees that the instance will be created before any thread accesses the static uniqueInstance variable.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0012_threedot_use_quotation_markdouble-checke">3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</h3></div></div></div><p><a class="indexterm" id="part0012_iddle1454"></a><a class="indexterm" id="part0012_iddle1870"></a><a class="indexterm" id="part0012_iddle2340"></a><a class="indexterm" id="part0012_iddle2505"></a>With double-checked locking, we first check to see if an instance is created, and if not, THEN we synchronize. This way, we only synchronize the first time through, just what we want.</p><p>Let’s check out the code:</p><div class="informalfigure"><a id="part0012_med_id00258a"></a><div class="mediaobject"><a id="part0012_med_id00258"></a><img alt="image with no caption" hisrc="figs/web/184fig01.png.jpg" src="../Images/image00755.jpeg"/></div></div><p>If performance is an issue in your use of the getInstance() method then this method of implementing the Singleton can drastically reduce the overhead.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0012_ch05note04"></a>Watch it!</h3><p><span class="strong"><strong>Double-checked locking doesn’t work in Java 1.4 or earlier!</strong></span></p><p>Unfortunately, in Java version 1.4 and earlier, many JVMs contain implementations of the volatile keyword that allow improper synchronization for double-checked locking. If you must use a JVM earlier than Java 5, consider other methods of implementing your Singleton.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_meanwhilecomma_back_at_the_chocolate_fac" style="clear: both">Meanwhile, back at the Chocolate Factory...</h2></div></div></div><p><a class="indexterm" id="part0012_iddle1103"></a><a class="indexterm" id="part0012_iddle1544"></a><a class="indexterm" id="part0012_iddle2286"></a><a class="indexterm" id="part0012_iddle2333"></a>While we’ve been off diagnosing the multithreading problems, the chocolate boiler has been cleaned up and is ready to go. But first, we have to fix the multithreading problems. We have a few solutions at hand, each with different tradeoffs, so which solution are we going to employ?</p><div class="informalfigure"><a id="part0012_med_id00259a"></a><div class="mediaobject"><a id="part0012_med_id00259"></a><img alt="image with no caption" hisrc="figs/web/common22.png.jpg" src="../Images/image00756.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_sharpen_your_pencil-id00049"></a><h3 class="title">Sharpen your pencil</h3><p>For each solution, describe its applicability to the problem of fixing the Chocolate Boiler code:</p><p><span class="strong"><strong>Synchronize the getInstance() method:</strong></span></p><p>________________________________________________________</p><p>________________________________________________________</p><p><span class="strong"><strong>Use eager instantiation:</strong></span></p><p>________________________________________________________</p><p>________________________________________________________</p><p><span class="strong"><strong>Double-checked locking:</strong></span></p><p>________________________________________________________</p><p>________________________________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_congratulationsexclamation_mark" style="clear: both">Congratulations!</h2></div></div></div><p>At this point, the Chocolate Factory is a happy customer and Choc-O-Holic was glad to have some expertise applied to their boiler code. No matter which multithreading solution you applied, the boiler should be in good shape with no more mishaps. Congratulations. You’ve not only managed to escape 500lbs of hot chocolate in this chapter, but you’ve been through all the potential problems of the Singleton.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_there_are_no_dumb_questions-id00050"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa1qe1"></a><a id="part0012_ch05qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a class="indexterm" id="part0012_iddle1131"></a><a class="indexterm" id="part0012_iddle1135"></a><a class="indexterm" id="part0012_iddle1685"></a><a class="indexterm" id="part0012_iddle1868"></a><a class="indexterm" id="part0012_iddle2346"></a><a class="indexterm" id="part0012_iddle2405"></a><span class="strong"><strong>Q: For such a simple pattern consisting of only one class, Singletons sure seem to have some problems.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Well, we warned you up front! But don’t let the problems discourage you; while implementing Singletons correctly can be tricky, after reading this chapter you are now well informed on the techniques for creating Singletons and should use them wherever you need to control the number of instances you are creating.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa1qe2"></a><a id="part0012_ch05qa1q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Can’t I just create a class in which all methods and variables are defined as static? Wouldn’t that be the same as a Singleton?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa1q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes, if your class is self-contained and doesn’t depend on complex initialization. However, because of the way static initializations are handled in Java, this can get very messy, especially if multiple classes are involved. Often this scenario can result in subtle, hard-to-find bugs involving order of initialization. Unless there is a compelling need to implement your “singleton” this way, it is far better to stay in the object world.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa1qe3"></a><a id="part0012_ch05qa1q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: What about class loaders? I heard there is a chance that two class loaders could each end up with their own instance of Singleton.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa1q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes, that is true as each class loader defines a namespace. If you have two or more class loaders, you can load the same class multiple times (once in each classloader). Now, if that class happens to be a Singleton, then since we have more than one version of the class, we also have more than one instance of the Singleton. So, if you are using multiple classloaders and Singletons, be careful. One way around this problem is to specify the classloader yourself.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0012_ch05note05"></a>Relax</h3><p><span class="emphasis"><em><span class="strong"><strong>Rumors of Singletons being eaten by the garbage collectors are greatly exaggerated</strong></span></em></span></p><p><span class="emphasis"><em>Prior to Java 1.2, a bug in the garbage collector allowed Singletons to be prematurely collected if there was no global reference to them. In other words, you could create a Singleton and if the only reference to the Singleton was in the Singleton itself, it would be collected and destroyed by the garbage collector. This leads to confusing bugs because after the Singleton is “collected,” the next call to getInstance() produces a shiny new Singleton. In many applications, this can cause confusing behavior as state is mysteriously reset to initial values or things like network connections are reset.</em></span></p><p><span class="emphasis"><em>Since Java 1.2 this bug has been fixed and a global reference is no longer required. If you are, for some reason, still using a pre-Java 1.2 JVM, then be aware of this issue; otherwise, you can sleep well knowing your Singletons won’t be prematurely collected.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_there_are_no_dumb_questions-id00051"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa2qe1"></a><a id="part0012_ch05qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a class="indexterm" id="part0012_iddle1411"></a><a class="indexterm" id="part0012_iddle1687"></a><a class="indexterm" id="part0012_iddle2062"></a><a class="indexterm" id="part0012_iddle2339"></a><a class="indexterm" id="part0012_iddle2342"></a><a class="indexterm" id="part0012_iddle2344"></a><a class="indexterm" id="part0012_iddle2345"></a><a class="indexterm" id="part0012_iddle2436"></a><span class="strong"><strong>Q: I’ve always been taught that a class should do one thing and one thing only. For a class to do two things is considered bad OO design. Isn’t a Singleton violating this?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You would be referring to the “One Class, One Responsibility” principle, and yes, you are correct, the Singleton is not only responsible for managing its one instance (and providing global access), it is also responsible for whatever its main role is in your application. So, certainly you could argue it is taking on two responsibilities. Nevertheless, it isn’t hard to see that there is utility in a class managing its own instance; it certainly makes the overall design simpler. In addition, many developers are familiar with the Singleton pattern as it is in wide use. That said, some developers do feel the need to abstract out the Singleton functionality.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa2qe2"></a><a id="part0012_ch05qa2q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: I wanted to subclass my Singleton code, but I ran into problems. Is it okay to subclass a Singleton?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa2q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> One problem with subclassing a Singleton is that the constructor is private. You can’t extend a class with a private constructor. So, the first thing you’ll have to do is change your constructor so that it’s public or protected. But then, it’s not really a Singleton anymore, because other classes can instantiate it.</p><p>If you do change your constructor, there’s another issue. The implementation of Singleton is based on a static variable, so if you do a straightforward subclass, all of your derived classes will share the same instance variable. This is probably not what you had in mind. So, for subclassing to work, implementing a registry of sorts is required in the base class.</p><p>Before implementing such a scheme, you should ask yourself what you are really gaining from subclassing a Singleton. Like most patterns, the Singleton is not necessarily meant to be a solution that can fit into a library. In addition, the Singleton code is trivial to add to any existing class. Last, if you are using a large number of Singletons in your application, you should take a hard look at your design. Singletons are meant to be used sparingly.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa2qe3"></a><a id="part0012_ch05qa2q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: I still don’t totally understand why global variables are worse than a Singleton.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0012_ch05qa2q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> In Java, global variables are basically static references to objects. There are a couple of disadvantages to using global variables in this manner. We’ve already mentioned one: the issue of lazy versus eager instantiation. But we need to keep in mind the intent of the pattern: to ensure only one instance of a class exists and to provide global access. A global variable can provide the latter, but not the former. Global variables also tend to encourage developers to pollute the namespace with lots of global references to small objects. Singletons don’t encourage this in the same way, but can be abused nonetheless.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0012_tools_for_your_design_toolbox-id00052" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>You’ve now added another pattern to your toolbox. Singleton gives you another method of creating objects — in this case, unique objects.</p><div class="informalfigure"><a id="part0012_med_id00260a"></a><div class="mediaobject"><a id="part0012_med_id00260"></a><img alt="image with no caption" hisrc="figs/web/188fig01.png.jpg" src="../Images/image00757.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0012_ch05note06"></a>Note</h3><p>As you’ve seen, despite its apparent simplicity, there are a lot of details involved in the Singleton’s implementation. After reading this chapter, though, you are ready to go out and use Singleton in the wild.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_bullet_points-id00053"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Singleton Pattern ensures you have at most one instance of a class in your application.</li><li class="listitem">The Singleton Pattern also provides a global access point to that instance.</li><li class="listitem">Java’s implementation of the Singleton Pattern makes use of a private constructor, a static method combined with a static variable.</li><li class="listitem">Examine your performance and resource constraints and carefully choose an appropriate Singleton implementation for multithreaded applications (and we should consider all applications multithreaded!).</li><li class="listitem">Beware of the double-checked locking implementation; it is not thread-safe in versions before Java 2, version 5.</li><li class="listitem">Be careful if you are using multiple class loaders; this could defeat the Singleton implementation and result in multiple instances.</li><li class="listitem">If you are using a JVM earlier than 1.2, you’ll need to create a registry of Singletons to defeat the garbage collector.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_design_patterns_crossword-id00054"></a><h3 class="title">Design Patterns Crossword</h3><p>Sit back, open that case of chocolate that you were sent for solving the multithreading problem, and have some downtime working on this little crossword puzzle; all of the solution words are from this chapter.</p><div class="informalfigure"><a id="part0012_med_id00261a"></a><div class="mediaobject"><a id="part0012_med_id00261"></a><img alt="image with no caption" hisrc="figs/web/189fig01.png" src="../Images/image00758.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. It was “one of a kind.”</p>
<p>2. Added to chocolate in the boiler.</p>
<p>8. An incorrect implementation caused this to overflow.</p>
<p>10. Singleton provides a single instance and __________ (three words).</p>
<p>12. Flawed multi-threading approach if not using Java 5 or later.</p>
<p>13. Chocolate capital of the USA.</p>
<p>14. One advantage over global variables: ________ creation.</p>
<p>15. Company that produces boilers.</p>
<p>16. To totally defeat the new constructor, we have to declare the constructor __________.</p></td><td style="vertical-align: top; "><p>1. Multiple __________ can cause problems.</p>
<p>3. A Singleton is a class that manages an instance of ________.</p>
<p>4. If you don’t need to worry about lazy instantiation, you can create your instance __________.</p>
<p>5. Prior to Java 1.2, this can eat your Singletons (two words).</p>
<p>6. The Singleton was embarrassed it had no public __________.</p>
<p>7. The classic implementation doesn’t handle this.</p>
<p>9. Singleton ensures only one of these exists.</p>
<p>11. The Singleton Pattern has one.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_be_the_jvm_solution"></a><h3 class="title">BE the JVM Solution</h3><div class="informalfigure"><a id="part0012_med_id00262a"></a><div class="mediaobject"><a id="part0012_med_id00262"></a><img alt="image with no caption" hisrc="figs/web/190fig01.png.jpg" src="../Images/image00759.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_sharpen_your_pencil_solution-id00055"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0012_iddle1084"></a><a class="indexterm" id="part0012_iddle1504"></a><a class="indexterm" id="part0012_iddle1961"></a><a class="indexterm" id="part0012_iddle2337"></a><a class="indexterm" id="part0012_iddle1563"></a><a class="indexterm" id="part0012_iddle2308"></a>Can you help Choc-O-Holic improve their ChocolateBoiler class by turning it into a singleton?</p><div class="informalfigure"><a id="part0012_med_id00263a"></a><div class="mediaobject"><a id="part0012_med_id00263"></a><img alt="image with no caption" hisrc="figs/web/191fig01.png.jpg" src="../Images/image00760.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_sharpen_your_pencil_solution-id00056"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0012_iddle1545"></a><a class="indexterm" id="part0012_iddle2287"></a>For each solution, describe its applicability to the problem of fixing the Chocolate Boiler code:</p><p><span class="strong"><strong>Synchronize the getInstance() method:</strong></span></p><p><span class="underline">A straightforward technique that is guaranteed to work. We don’t seem to have</span>__________________</p><p><span class="underline">any performance concerns with the chocolate boiler, so this would be a good choice.</span>_____________________</p><p><span class="strong"><strong>Use eager instantiation:</strong></span></p><p><span class="underline">We are always going to instantiate the chocolate boiler in our code, so statically initializing</span>_______</p><p><span class="underline">the instance would cause no concerns. This solution would work as well as the synchronized</span>____</p><p>method, although perhaps be less obvious to a developer familar with the standard pattern.</p><p><span class="strong"><strong>Double-checked locking:</strong></span></p><p><span class="underline">Given we have no performance concerns, double-checked locking seems like overkill. In</span></p><p><span class="underline">addition, we’d have to ensure that we are running at least Java 5.</span>___________________________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0012_design_patterns_crossword_soluti-id00057"></a><h3 class="title">Design Patterns Crossword Solution</h3><div class="informalfigure"><a id="part0012_med_id00264a"></a><div class="mediaobject"><a id="part0012_med_id00264"></a><img alt="image with no caption" hisrc="figs/web/192fig01.png" src="../Images/image00761.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0013_command_pattern_encapsulating_invocation"><div class="titlepage" id="part0013_aid-CCNA2"><div><div><h2 class="title">Chapter 6. The Command Pattern: Encapsulating Invocation</h2></div></div></div><div class="informalfigure"><a id="part0013_med_id00265a"></a><div class="mediaobject"><a id="part0013_med_id00265"></a><img alt="image with no caption" hisrc="figs/web/193fig01.png.jpg" src="../Images/image00762.jpeg"/></div></div><p><a class="indexterm" id="part0013_iddle1491"></a><span class="strong"><strong>In this chapter, we take encapsulation to a whole new level: we’re going to encapsulate method invocation.</strong></span> That’s right; by encapsulating method invocation, we can crystallize pieces of computation so that the object invoking the computation doesn’t need to worry about how to do things, it just uses our crystallized method to get it done. We can also do some wickedly smart things with these encapsulated method invocations, like save them away for logging or reuse them to implement undo in our code.</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/></colgroup><tbody><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0013_inline_id00266a"></a><img alt="" hisrc="figs/web/194fig01.png.jpg" src="../Images/image00763.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Home Automation or Bust, Inc.</strong></span></p>
<p><span class="strong"><strong>1221 Industrial Avenue, Suite 2000</strong></span></p>
<p><span class="strong"><strong>Future City, IL 62914</strong></span></p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Greetings!</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I recently received a demo and briefing from Johnny Hurricane, CEO of Weather-O-Rama, on their new expandable weather station. I have to say, I was so impressed with the software architecture that I’d like to ask you to design the API for our new Home Automation Remote Control. In return for your services we’d be happy to handsomely reward you with stock options in Home Automation or Bust, Inc.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I’m enclosing a prototype of our ground-breaking remote control for your perusal. The remote control features seven programmable slots (each can be assigned to a different household device) along with corresponding on/off buttons for each. The remote also has a global undo button.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I’m also enclosing a set of Java classes on CD-R that were created by various vendors to control home automation devices such as lights, fans, hot tubs, audio equipment, and other similar controllable appliances.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We’d like you to create an API for programming the remote so that each slot can be assigned to control a device or set of devices. Note that it is important that we be able to control the current devices on the disc, and also any future devices that the vendors may supply.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Given the work you did on the Weather-O-Rama weather station, we know you’ll do a great job on our remote control! We look forward to seeing your design.</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Sincerely,</p></td></tr><tr><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0013_inline_id00267a"></a><img alt="" hisrc="figs/web/194fig02.png.jpg" src="../Images/image00764.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; "><p>Bill “X-10” Thompson, CEO</p></td></tr></tbody></table></div><div class="informalfigure"><a id="part0013_med_id00268a"></a><div class="mediaobject"><a id="part0013_med_id00268"></a><img alt="image with no caption" hisrc="figs/web/194fig03.png.jpg" src="../Images/image00765.jpeg"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_free_hardwareexclamation_mark_letapostro" style="clear: both">Free hardware! Let’s check out the Remote Control...</h2></div></div></div><div class="informalfigure"><a id="part0013_med_id00269a"></a><div class="mediaobject"><a id="part0013_med_id00269"></a><img alt="image with no caption" hisrc="figs/web/195fig01.png.jpg" src="../Images/image00766.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_taking_a_look_at_the_vendor_classes" style="clear: both">Taking a look at the vendor classes</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1189"></a><a class="indexterm" id="part0013_iddle1732"></a><a class="indexterm" id="part0013_iddle1215"></a><a class="indexterm" id="part0013_iddle1763"></a>Check out the vendor classes on the CD-R. These should give you some idea of the interfaces of the objects we need to control from the remote.</p><div class="informalfigure"><a id="part0013_med_id00270a"></a><div class="mediaobject"><a id="part0013_med_id00270"></a><img alt="image with no caption" hisrc="figs/web/196fig01.png.jpg" src="../Images/image00767.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00271a"></a><div class="mediaobject"><a id="part0013_med_id00271"></a><img alt="image with no caption" hisrc="figs/web/196fig02.png.jpg" src="../Images/image00768.jpeg"/></div></div><p>It looks like we have quite a set of classes here, and not a lot of industry effort to come up with a set of common interfaces. Not only that, it sounds like we can expect more of these classes in the future. Designing a remote control API is going to be interesting. Let’s get on to the design.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_cubicle_conversation-id00058" style="clear: both">Cubicle Conversation</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1197"></a><a class="indexterm" id="part0013_iddle1741"></a>Your teammates are already discussing how to design the remote control API...</p><div class="informalfigure"><a id="part0013_med_id00272a"></a><div class="mediaobject"><a id="part0013_med_id00272"></a><img alt="image with no caption" hisrc="figs/web/197fig01.png.jpg" src="../Images/image00769.jpeg"/></div></div><p><span class="strong"><strong>Mary</strong></span>: Yes, I thought we’d see a bunch of classes with on() and off() methods, but here we’ve got methods like dim(), setTemperature(), setVolume(), and setInputChannel().</p><p><span class="strong"><strong>Sue</strong></span>: Not only that, it sounds like we can expect more vendor classes in the future with just as diverse methods.</p><p><span class="strong"><strong>Mary</strong></span>: I think it’s important we view this as a separation of concerns: the remote should know how to interpret button presses and make requests, but it shouldn’t know a lot about home automation or how to turn on a hot tub.</p><p><span class="strong"><strong>Sue</strong></span>: Sounds like good design. But if the remote is dumb and just knows how to make generic requests, how do we design the remote so that it can invoke an action that, say, turns on a light or opens a garage door?</p><p><span class="strong"><strong>Mary</strong></span>: I’m not sure, but we don’t want the remote to have to know the specifics of the vendor classes.</p><p><span class="strong"><strong>Sue</strong></span>: What do you mean?</p><p><span class="strong"><strong>Mary</strong></span>: We don’t want the remote to consist of a set of if statements, like “if slot1 == Light, then light.on(), else if slot1 == Hottub then hottub.jetsOn()”. We know that is a bad design.</p><p><span class="strong"><strong>Sue</strong></span>: I agree. Whenever a new vendor class comes out, we’d have to go in and modify the code, potentially creating bugs and more work for ourselves!</p><div class="informalfigure"><a id="part0013_med_id00273a"></a><div class="mediaobject"><a id="part0013_med_id00273"></a><img alt="image with no caption" hisrc="figs/web/198fig01.png.jpg" src="../Images/image00770.jpeg"/></div></div><p><a class="indexterm" id="part0013_iddle1175"></a><a class="indexterm" id="part0013_iddle1182"></a><span class="strong"><strong>Mary</strong></span>: Yeah? Tell us more.</p><p><span class="strong"><strong>Joe</strong></span>: The Command Pattern allows you to decouple the requester of an action from the object that actually performs the action. So, here the requester would be the remote control and the object that performs the action would be an instance of one of your vendor classes.</p><p><span class="strong"><strong>Sue</strong></span>: How is that possible? How can we decouple them? After all, when I press a button, the remote has to turn on a light.</p><p><span class="strong"><strong>Joe</strong></span>: You can do that by introducing “command objects” into your design. A command object encapsulates a request to do something (like turn on a light) on a specific object (say, the living room light object). So, if we store a command object for each button, when the button is pressed we ask the command object to do some work. The remote doesn’t have any idea what the work is, it just has a command object that knows how to talk to the right object to get the work done. So, you see, the remote is decoupled from the light object!</p><p><span class="strong"><strong>Sue</strong></span>: This certainly sounds like it’s going in the right direction.</p><p><span class="strong"><strong>Mary</strong></span>: Still, I’m having a hard time wrapping my head around the pattern.</p><p><span class="strong"><strong>Joe</strong></span>: Given that the objects are so decoupled, it’s a little difficult to picture how the pattern actually works.</p><p><span class="strong"><strong>Mary</strong></span>: Let me see if I at least have the right idea: using this pattern, we could create an API in which these command objects can be loaded into button slots, allowing the remote code to stay very simple. And, the command objects encapsulate how to do a home automation task along with the object that needs to do it.</p><p><span class="strong"><strong>Joe</strong></span>: Yes, I think so. I also think this pattern can help you with that undo button, but I haven’t studied that part yet.</p><p><span class="strong"><strong>Mary</strong></span>: This sounds really encouraging, but I think I have a bit of work to do to really “get” the pattern.</p><p><span class="strong"><strong>Sue</strong></span>: Me too.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_meanwhilecomma_back_at_the_dinerhellipco" style="clear: both">Meanwhile, back at the Diner..., or, A brief introduction to the Command Pattern</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1222"></a>As Joe said, it is a little hard to understand the Command Pattern by just hearing its description. But don’t fear, we have some friends ready to help: remember our friendly diner from <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a>? It’s been a while since we visited Alice, Flo, and the short-order cook, but we’ve got good reason for returning (well, beyond the food and great conversation): the diner is going to help us understand the Command Pattern.</p><div class="informalfigure"><a id="part0013_med_id00274a"></a><div class="mediaobject"><a id="part0013_med_id00274"></a><img alt="image with no caption" hisrc="figs/web/199fig01.png.jpg" src="../Images/image00771.jpeg"/></div></div><p>So, let’s take a short detour back to the diner and study the interactions between the customers, the waitress, the orders and the short-order cook. Through these interactions, you’re going to understand the objects involved in the Command Pattern and also get a feel for how the decoupling works. After that, we’re going to knock out that remote control API.</p><p>Checking in at the Objectville Diner...</p><p><span class="strong"><strong>Okay, we all know how the Diner operates:</strong></span></p><div class="informalfigure"><a id="part0013_med_id00275a"></a><div class="mediaobject"><a id="part0013_med_id00275"></a><img alt="image with no caption" hisrc="figs/web/199fig02.png.jpg" src="../Images/image00772.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_letapostrophes_study_the_interaction_in" style="clear: both">Let’s study the interaction in a little more detail...</h2></div></div></div><p><span class="strong"><strong>...and given this Diner is in Objectville, let’s think about the object and method calls involved, too!</strong></span></p><div class="informalfigure"><a id="part0013_med_id00276a"></a><div class="mediaobject"><a id="part0013_med_id00276"></a><img alt="image with no caption" hisrc="figs/web/200fig01.png.jpg" src="../Images/image00773.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_objectville_diner_roles_and_responsibili" style="clear: both">The Objectville Diner roles and responsibilities</h2></div></div></div><p><span class="strong"><strong>An Order Slip encapsulates a request to prepare a meal.</strong></span></p><p><span class="strong"><strong>Think of the Order Slip as an object, an object that acts as a request to prepare a meal.</strong></span> Like any object, it can be passed around — from the Waitress to the order counter, or to the next Waitress taking over her shift. It has an interface that consists of only one method, orderUp(), that encapsulates the actions needed to prepare the meal. It also has a reference to the object that needs to prepare it (in our case, the Cook). It’s encapsulated in that the Waitress doesn’t have to know what’s in the order or even who prepares the meal; she only needs to pass the slip through the order window and call “Order up!”</p><div class="informalfigure"><a id="part0013_med_id00277a"></a><div class="mediaobject"><a id="part0013_med_id00277"></a><img alt="image with no caption" hisrc="figs/web/201fig01.png.jpg" src="../Images/image00774.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note01"></a>Note</h3><p>Okay, in real life a waitress would probably care what is on the Order Slip and who cooks it, but this is Objectville... work with us here!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>The Waitress’s job is to take Order Slips and invoke the orderUp() method on them.</strong></span></p><p><span class="strong"><strong>The Waitress has it easy: take an order from the customer, continue helping customers until she makes it back to the order counter, then invoke the orderUp() method to have the meal prepared.</strong></span> As we’ve already discussed, in Objectville, the Waitress really isn’t worried about what’s on the order or who is going to prepare it; she just knows Order Slips have an orderUp() method she can call to get the job done.</p><p>Now, throughout the day, the Waitress’s takeOrder() method gets parameterized with different Order Slips from different customers, but that doesn’t faze her; she knows all Order Slips support the orderUp() method and she can call orderUp() any time she needs a meal prepared.</p><div class="informalfigure"><a id="part0013_med_id00278a"></a><div class="mediaobject"><a id="part0013_med_id00278"></a><img alt="image with no caption" hisrc="figs/web/201fig02.png.jpg" src="../Images/image00775.jpeg"/></div></div><p><span class="strong"><strong>The Short Order Cook has the knowledge required to prepare the meal.</strong></span></p><p><span class="strong"><strong>The Short Order Cook is the object that really knows how to prepare meals.</strong></span> Once the Waitress has invoked the orderUp() method; the Short Order Cook takes over and implements all the methods that are needed to create meals. Notice the Waitress and the Cook are totally decoupled: the Waitress has Order Slips that encapsulate the details of the meal; she just calls a method on each order to get it prepared. Likewise, the Cook gets his instructions from the Order Slip; he never needs to directly communicate with the Waitress.</p><div class="informalfigure"><a id="part0013_med_id00279a"></a><div class="mediaobject"><a id="part0013_med_id00279"></a><img alt="image with no caption" hisrc="figs/web/201fig03.png.jpg" src="../Images/image00776.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00280a"></a><div class="mediaobject"><a id="part0013_med_id00280"></a><img alt="image with no caption" hisrc="figs/web/202fig01.png.jpg" src="../Images/image00777.jpeg"/></div></div><p><span class="strong"><strong>Patience, we’re getting there...</strong></span></p><p>Think of the Diner as a model for an OO design pattern that allows us to separate an object making a request from the objects that receive and execute those requests. For instance, in our remote control API, we need to separate the code that gets invoked when we press a button from the objects of the vendor-specific classes that carry out those requests. What if each slot of the remote held an object like the Diner’s Order Slip object? Then, when a button is pressed, we could just call the equivalent of the “orderUp()” method on this object and have the lights turn on without the remote knowing the details of how to make those things happen or what objects are making them happen.</p><p>Now, let’s switch gears a bit and map all this Diner talk to the Command Pattern...</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note02"></a>Brain Power</h3><p>Before we move on, spend some time studying the diagram two pages back along with Diner roles and responsibilities until you think you’ve got a handle on the Objectville Diner objects and relationships. Once you’ve done that, get ready to nail the Command Pattern!</p><div class="informalfigure"><a id="part0013_med_id00281a"></a><div class="mediaobject"><a id="part0013_med_id00281"></a><img alt="image with no caption" hisrc="figs/web/202fig02.png.jpg" src="../Images/image00778.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_from_the_diner_to_the_command_pattern" style="clear: both">From the Diner to the Command Pattern</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1176"></a><a class="indexterm" id="part0013_iddle1183"></a><a class="indexterm" id="part0013_iddle1203"></a><a class="indexterm" id="part0013_iddle1218"></a><a class="indexterm" id="part0013_iddle1749"></a><a class="indexterm" id="part0013_iddle1805"></a>Okay, we’ve spent enough time in the Objectville Diner that we know all the personalities and their responsibilities quite well. Now we’re going to rework the Diner diagram to reflect the Command Pattern. You’ll see that all the players are the same; only the names have changed.</p><div class="informalfigure"><a id="part0013_med_id00282a"></a><div class="mediaobject"><a id="part0013_med_id00282"></a><img alt="image with no caption" hisrc="figs/web/203fig01.png.jpg" src="../Images/image00779.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_loading_the_invoker"></a><h3 class="title">Loading the Invoker</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① The client creates a command object.</li><li class="listitem" style="list-style-type: none">② The client does a setCommand() to store the command object in the invoker.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Later</strong></span>... the client asks the invoker to execute the command. Note: as you’ll see later in the chapter, once the command is loaded into the invoker, it may be used and discarded, or it may remain and be used many times.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_who_does_whatquestion_mark"></a><h3 class="title">Who Does What?</h3><p><a class="indexterm" id="part0013_iddle1576"></a><a class="indexterm" id="part0013_iddle2514"></a>Match the diner objects and methods with the corresponding names from the Command Pattern.</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Diner</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Command Pattern</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Waitress</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Command</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Short Order Cook</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>execute()</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>orderUp()</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Client</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Order</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Invoker</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Customer</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Receiver</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>takeOrder()</p></td><td style="vertical-align: top; "><p>setCommand()</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_our_first_command_object" style="clear: both">Our first command object</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1181"></a><a class="indexterm" id="part0013_iddle1190"></a><a class="indexterm" id="part0013_iddle1733"></a>Isn’t it about time we build our first command object? Let’s go ahead and write some code for the remote control. While we haven’t figured out how to design the remote control API yet, building a few things from the bottom up may help us...</p><div class="informalfigure"><a id="part0013_med_id00283a"></a><div class="mediaobject"><a id="part0013_med_id00283"></a><img alt="image with no caption" hisrc="figs/web/205fig01.png.jpg" src="../Images/image00780.jpeg"/></div></div><p><span class="strong"><strong>Implementing the Command interface</strong></span></p><p>First things first: all command objects implement the same interface, which consists of one method. In the Diner we called this method orderUp(); however, we typically just use the name execute().</p><p>Here’s the Command interface:</p><div class="informalfigure"><a id="part0013_med_id00284a"></a><div class="mediaobject"><a id="part0013_med_id00284"></a><img alt="image with no caption" hisrc="figs/web/205fig02.png.jpg" src="../Images/image00781.jpeg"/></div></div><p><span class="strong"><strong>Implementing a command to turn a light on</strong></span></p><p>Now, let’s say you want to implement a command for turning a light on. Referring to our set of vendor classes, the Light class has two methods: on() and off(). Here’s how you can implement this as a command:</p><div class="informalfigure"><a id="part0013_med_id00285a"></a><div class="mediaobject"><a id="part0013_med_id00285"></a><img alt="image with no caption" hisrc="figs/web/205fig03.png.jpg" src="../Images/image00782.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00286a"></a><div class="mediaobject"><a id="part0013_med_id00286"></a><img alt="image with no caption" hisrc="figs/web/205fig04.png.jpg" src="../Images/image00783.jpeg"/></div></div><p>Now that you’ve got a LightOnCommand class, let’s see if we can put it to use...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_using_the_command_object" style="clear: both">Using the command object</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1177"></a><a class="indexterm" id="part0013_iddle1184"></a><a class="indexterm" id="part0013_iddle1207"></a><a class="indexterm" id="part0013_iddle1753"></a>Okay, let’s make things simple: say we’ve got a remote control with only one button and corresponding slot to hold a device to control:</p><div class="informalfigure"><a id="part0013_med_id00287a"></a><div class="mediaobject"><a id="part0013_med_id00287"></a><img alt="image with no caption" hisrc="figs/web/206fig01.png.jpg" src="../Images/image00784.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_creating_a_simple_test_to_use_the_remote" style="clear: both">Creating a simple test to use the Remote Control</h2></div></div></div><p>Here’s just a bit of code to test out the simple remote control. Let’s take a look and we’ll point out how the pieces match the Command Pattern diagram:</p><div class="informalfigure"><a id="part0013_med_id00288a"></a><div class="mediaobject"><a id="part0013_med_id00288"></a><img alt="image with no caption" hisrc="figs/web/206fig02.png.jpg" src="../Images/image00785.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_sharpen_your_pencil-id00059"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0013_iddle1547"></a><a class="indexterm" id="part0013_iddle2289"></a>Okay, it’s time for you to implement the GarageDoorOpenCommand class. First, supply the code for the class below. You’ll need the GarageDoor class diagram.</p><div class="informalfigure"><a id="part0013_med_id00289a"></a><div class="mediaobject"><a id="part0013_med_id00289"></a><img alt="image with no caption" hisrc="figs/web/207fig01.png.jpg" src="../Images/image00786.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00290a"></a><div class="mediaobject"><a id="part0013_med_id00290"></a><img alt="image with no caption" hisrc="figs/web/207fig02.png.jpg" src="../Images/image00787.jpeg"/></div></div><p>Now that you’ve got your class, what is the output of the following code? (Hint: the GarageDoor up() method prints out “Garage Door is Open” when it is complete.)</p><a id="part0013_pro_id00017"></a><pre class="programlisting"><span class="strong"><strong>public class RemoteControlTest {</strong></span>
    <span class="strong"><strong>public static void main(String[] args) {</strong></span>
        <span class="strong"><strong>SimpleRemoteControl remote = new SimpleRemoteControl();</strong></span>
        <span class="strong"><strong>Light light = new Light();</strong></span>
        <span class="strong"><strong>GarageDoor garageDoor = new GarageDoor();</strong></span>
        <span class="strong"><strong>LightOnCommand lightOn = new LightOnCommand(light);</strong></span>
        <span class="strong"><strong>GarageDoorOpenCommand garageOpen =</strong></span>
            <span class="strong"><strong>new GarageDoorOpenCommand(garageDoor);</strong></span>


        <span class="strong"><strong>remote.setCommand(lightOn);</strong></span>
        <span class="strong"><strong>remote.buttonWasPressed();</strong></span>
        <span class="strong"><strong>remote.setCommand(garageOpen);</strong></span>
        <span class="strong"><strong>remote.buttonWasPressed();</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><div class="informalfigure"><a id="part0013_med_id00291a"></a><div class="mediaobject"><a id="part0013_med_id00291"></a><img alt="image with no caption" hisrc="figs/web/207fig03.png.jpg" src="../Images/image00788.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_command_pattern_defined" style="clear: both">The Command Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1185"></a><a class="indexterm" id="part0013_iddle1196"></a><a class="indexterm" id="part0013_iddle1492"></a><a class="indexterm" id="part0013_iddle1494"></a><a class="indexterm" id="part0013_iddle1740"></a><a class="indexterm" id="part0013_iddle1806"></a><a class="indexterm" id="part0013_iddle2235"></a>You’ve done your time in the Objectville Diner, you’ve partly implemented the remote control API, and in the process you’ve got a fairly good picture of how the classes and objects interact in the Command Pattern. Now we’re going to define the Command Pattern and nail down all the details.</p><p>Let’s start with its official definition:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note03"></a>Note</h3><p><span class="strong"><strong>The Command Pattern</strong></span> encapsulates a request as an object, thereby letting you parameterize other objects with different requests, queue or log requests, and support undoable operations.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0013_med_id00292a"></a><div class="mediaobject"><a id="part0013_med_id00292"></a><img alt="image with no caption" hisrc="figs/web/208fig01.png.jpg" src="../Images/image00789.jpeg"/></div></div><p>Let’s step through this. We know that a command object <span class="emphasis"><em>encapsulates a request</em></span> by binding together a set of actions on a specific receiver. To achieve this, it packages the actions and the receiver up into an object that exposes just one method, execute(). When called, execute() causes the actions to be invoked on the receiver. From the outside, no other objects really know what actions get performed on what receiver; they just know that if they call the execute() method, their request will be serviced.</p><p>We’ve also seen a couple examples of <span class="emphasis"><em>parameterizing an object</em></span> with a command. Back at the diner, the Waitress was parameterized with multiple orders throughout the day. In the simple remote control, we first loaded the button slot with a “light on” command and then later replaced it with a “garage door open” command. Like the Waitress, your remote slot didn’t care what command object it had, as long as it implemented the Command interface.</p><p>What we haven’t encountered yet is using commands to implement <span class="emphasis"><em>queues and logs and support undo operations</em></span>. Don’t worry, those are pretty straightforward extensions of the basic Command Pattern and we will get to them soon. We can also easily support what’s known as the Meta Command Pattern once we have the basics in place. The Meta Command Pattern allows you to create macros of commands so that you can execute multiple commands at once.</p><div class="informalfigure"><a id="part0013_med_id00293a"></a><div class="mediaobject"><a id="part0013_med_id00293"></a><img alt="image with no caption" hisrc="figs/web/208fig02.png.jpg" src="../Images/image00790.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_command_pattern_defined_the_class_diagra" style="clear: both">The Command Pattern defined: the class diagram</h2></div></div></div><div class="informalfigure"><a id="part0013_med_id00294a"></a><div class="mediaobject"><a id="part0013_med_id00294"></a><img alt="image with no caption" hisrc="figs/web/209fig01.png.jpg" src="../Images/image00791.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note04"></a>Brain Power</h3><p><a class="indexterm" id="part0013_iddle1192"></a><a class="indexterm" id="part0013_iddle1735"></a><a class="indexterm" id="part0013_iddle2432"></a>How does the design of the Command Pattern support the decoupling of the invoker of a request and the receiver of the request?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0013_med_id00295a"></a><div class="mediaobject"><a id="part0013_med_id00295"></a><img alt="image with no caption" hisrc="figs/web/210fig01.png.jpg" src="../Images/image00792.jpeg"/></div></div><p><a class="indexterm" id="part0013_iddle1195"></a><a class="indexterm" id="part0013_iddle1739"></a><span class="strong"><strong>Mary</strong></span>: Me too. So where do we begin?</p><p><span class="strong"><strong>Sue</strong></span>: Like we did in the SimpleRemote, we need to provide a way to assign commands to slots. In our case we have seven slots, each with an “on” and “off” button. So we might assign commands to the remote something like this:</p><a id="part0013_pro_id00018"></a><pre class="programlisting"><span class="strong"><strong>onCommands[0] = onCommand;</strong></span>
<span class="strong"><strong>offCommands[0] = offCommand;</strong></span></pre><p>and so on for each of the seven command slots.</p><p><span class="strong"><strong>Mary</strong></span>: That makes sense, except for the Light objects. How does the remote know the living room from the kitchen light?</p><p><span class="strong"><strong>Sue</strong></span>: Ah, that’s just it, it doesn’t! The remote doesn’t know anything but how to call execute() on the corresponding command object when a button is pressed.</p><p><span class="strong"><strong>Mary</strong></span>: Yeah, I sorta got that, but in the implementation, how do we make sure the right objects are turning on and off the right devices?</p><p><span class="strong"><strong>Sue</strong></span>: When we create the commands to be loaded into the remote, we create one LightCommand that is bound to the living room light object and another that is bound to the kitchen light object. Remember, the receiver of the request gets bound to the command it’s encapsulated in. So, by the time the button is pressed, no one cares which light is which; the right thing just happens when the execute() method is called.</p><p><span class="strong"><strong>Mary</strong></span>: I think I’ve got it. Let’s implement the remote and I think this will get clearer!</p><p><span class="strong"><strong>Sue</strong></span>: Sounds good. Let’s give it a shot...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_assigning_commands_to_slots" style="clear: both">Assigning Commands to slots</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1807"></a>So we have a plan: we’re going to assign each slot to a command in the remote control. This makes the remote control our <span class="emphasis"><em>invoker</em></span>. When a button is pressed the execute() method is going to be called on the corresponding command, which results in actions being invoked on the receiver (like lights, ceiling fans, and stereos).</p><div class="informalfigure"><a id="part0013_med_id00296a"></a><div class="mediaobject"><a id="part0013_med_id00296"></a><img alt="image with no caption" hisrc="figs/web/211fig01.png.jpg" src="../Images/image00793.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_implementing_the_remote_control" style="clear: both">Implementing the Remote Control</h2></div></div></div><div class="informalfigure"><a id="part0013_med_id00297a"></a><div class="mediaobject"><a id="part0013_med_id00297"></a><img alt="image with no caption" hisrc="figs/web/212fig01.png.jpg" src="../Images/image00794.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_implementing_the_commands" style="clear: both">Implementing the Commands</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1199"></a><a class="indexterm" id="part0013_iddle1743"></a>Well, we’ve already gotten our feet wet implementing the LightOnCommand for the SimpleRemoteControl. We can plug that same code in here and everything works beautifully. Off commands are no different; in fact, the LightOffCommand looks like this:</p><div class="informalfigure"><a id="part0013_med_id00298a"></a><div class="mediaobject"><a id="part0013_med_id00298"></a><img alt="image with no caption" hisrc="figs/web/213fig01.png.jpg" src="../Images/image00795.jpeg"/></div></div><p>Let’s try something a little more challenging; how about writing on and off commands for the Stereo? Okay, off is easy, we just bind the Stereo to the off() method in the StereoOffCommand. On is a little more complicated; let’s say we want to write a StereoOnWithCDCommand...</p><div class="informalfigure"><a id="part0013_med_id00299a"></a><div class="mediaobject"><a id="part0013_med_id00299"></a><img alt="image with no caption" hisrc="figs/web/213fig02.png.jpg" src="../Images/image00796.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00300a"></a><div class="mediaobject"><a id="part0013_med_id00300"></a><img alt="image with no caption" hisrc="figs/web/213fig03.png.jpg" src="../Images/image00797.jpeg"/></div></div><p>Not too bad. Take a look at the rest of the vendor classes; by now, you can definitely knock out the rest of the Command classes we need for those.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_putting_the_remote_control_through_its_p" style="clear: both">Putting the Remote Control through its paces</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1208"></a><a class="indexterm" id="part0013_iddle1754"></a>Our job with the remote is pretty much done; all we need to do is run some tests and get some documentation together to describe the API. Home Automation or Bust, Inc. sure is going to be impressed, don’t ya think? We’ve managed to come up with a design that is going to allow them to produce a remote that is easy to maintain and they’re going to have no trouble convincing the vendors to write some simple command classes in the future since they are so easy to write.</p><p>Let’s get to testing this code!</p><div class="informalfigure"><a id="part0013_med_id00301a"></a><div class="mediaobject"><a id="part0013_med_id00301"></a><img alt="image with no caption" hisrc="figs/web/214fig01.png.jpg" src="../Images/image00798.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00302a"></a><div class="mediaobject"><a id="part0013_med_id00302"></a><img alt="image with no caption" hisrc="figs/web/215fig01.png.jpg" src="../Images/image00799.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0013_nowcomma_letapostrophes_check_out_the_ex">Now, let’s check out the execution of our remote control test...</h3></div></div></div><div class="informalfigure"><a id="part0013_med_id00303a"></a><div class="mediaobject"><a id="part0013_med_id00303"></a><img alt="image with no caption" hisrc="figs/web/215fig02.png.jpg" src="../Images/image00800.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00304a"></a><div class="mediaobject"><a id="part0013_med_id00304"></a><img alt="image with no caption" hisrc="figs/web/216fig01.png.jpg" src="../Images/image00801.jpeg"/></div></div><p><a class="indexterm" id="part0013_iddle1205"></a><a class="indexterm" id="part0013_iddle1220"></a><a class="indexterm" id="part0013_iddle1751"></a><a class="indexterm" id="part0013_iddle1967"></a><a class="indexterm" id="part0013_iddle1973"></a>Good catch. We did sneak a little something in there. In the remote control, we didn’t want to check to see if a command was loaded every time we referenced a slot. For instance, in the onButtonWasPushed() method, we would need code like this:</p><a id="part0013_pro_id00019"></a><pre class="programlisting"><span class="strong"><strong>public void onButtonWasPushed(int slot) {</strong></span>
    <span class="strong"><strong><span class="gray-background">if (onCommands[slot] != null) {</span></strong></span>
        <span class="strong"><strong>onCommands[slot].execute();</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p>So, how do we get around that? Implement a command that does nothing!</p><a id="part0013_pro_id00020"></a><pre class="programlisting"><span class="strong"><strong>public class NoCommand implements Command {</strong></span>
    <span class="strong"><strong>public void execute() { }</strong></span>
<span class="strong"><strong>}</strong></span></pre><p>Then, in our RemoteControl constructor, we assign every slot a NoCommand object by default and we know we’ll always have some command to call in each slot.</p><a id="part0013_pro_id00021"></a><pre class="programlisting"><span class="strong"><strong>Command noCommand = new NoCommand();</strong></span>
<span class="strong"><strong>for (int i = 0; i &lt; 7; i++) {</strong></span>
    <span class="strong"><strong>onCommands[i] = noCommand;</strong></span>
    <span class="strong"><strong>offCommands[i] = noCommand;</strong></span>
<span class="strong"><strong>}</strong></span></pre><p>So in the output of our test run, you are seeing only slots that have been assigned to a command other than the default NoCommand object, which we assigned when we created the RemoteControl.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_pattern_honorable_mention"></a><h3 class="title">Pattern Honorable Mention</h3><p>The NoCommand object is an example of a <span class="emphasis"><em>null object</em></span>. A null object is useful when you don’t have a meaningful object to return, and yet you want to remove the responsibility for handling <span class="strong"><strong>null</strong></span> from the client. For instance, in our remote control we didn’t have a meaningful object to assign to each slot out of the box, so we provided a NoCommand object that acts as a surrogate and does nothing when its execute method is called.</p><p>You’ll find uses for Null Objects in conjunction with many Design Patterns and sometimes you’ll even see Null Object listed as a Design Pattern.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_time_to_write_that_documentationhellip" style="clear: both">Time to write that documentation...</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_remote_control_api_design_for_home_autom"></a><h3 class="title">Remote Control API Design for Home Automation or Bust, Inc.</h3><p><a class="indexterm" id="part0013_iddle1216"></a><a class="indexterm" id="part0013_iddle1764"></a>We are pleased to present you with the following design and application programming interface for your Home Automation Remote Control. Our primary design goal was to keep the remote control code as simple as possible so that it doesn’t require changes as new vendor classes are produced. To this end we have employed the Command Pattern to logically decouple the RemoteControl class from the Vendor Classes. We believe this will reduce the cost of producing the remote as well as drastically reduce your ongoing maintenance costs.</p><p>The following class diagram provides an overview of our design:</p><div class="informalfigure"><a id="part0013_med_id00305a"></a><div class="mediaobject"><a id="part0013_med_id00305"></a><img alt="image with no caption" hisrc="figs/web/217fig01.png.jpg" src="../Images/image00802.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0013_med_id00306a"></a><div class="mediaobject"><a id="part0013_med_id00306"></a><img alt="image with no caption" hisrc="figs/web/218fig01.png.jpg" src="../Images/image00803.jpeg"/></div></div><p><a class="indexterm" id="part0013_iddle1211"></a><a class="indexterm" id="part0013_iddle1757"></a><a class="indexterm" id="part0013_iddle2484"></a><a class="indexterm" id="part0013_iddle2487"></a><span class="strong"><strong>Whoops! We almost forgot... luckily, once we have our basic Command classes, undo is easy to add. Let’s step through adding undo to our commands and to the remote control...</strong></span></p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_what_are_we_doingquestion_mark" style="clear: both">What are we doing?</h2></div></div></div><p>Okay, we need to add functionality to support the undo button on the remote. It works like this: say the Living Room Light is off and you press the on button on the remote. Obviously the light turns on. Now if you press the undo button then the last action will be reversed — in this case, the light will turn off. Before we get into more complex examples, let’s get the light working with the undo button:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① When commands support undo, they have an undo() method that mirrors the execute() method. Whatever execute() last did, undo() reverses. So, before we can add undo to our commands, we need to add an undo() method to the Command interface:<div class="informalfigure"><a id="part0013_med_id00307a"></a><div class="mediaobject"><a id="part0013_med_id00307"></a><img alt="image with no caption" hisrc="figs/web/218fig02.png.jpg" src="../Images/image00804.jpeg"/></div></div><br/>That was simple enough.<br/>Now, let’s dive into the Light command and implement the undo() method.</li><li class="listitem" style="list-style-type: none">② Let’s start with the LightOnCommand: if the LightOnCommand’s execute() method was called, then the on() method was last called. We know that undo() needs to do the opposite of this by calling the off() method.<div class="informalfigure"><a id="part0013_med_id00308a"></a><div class="mediaobject"><a id="part0013_med_id00308"></a><img alt="image with no caption" hisrc="figs/web/219fig01.png.jpg" src="../Images/image00805.jpeg"/></div></div><br/>Piece of cake! Now for the LightOffCommand. Here the undo() method just needs to call the Light’s on() method.<div class="informalfigure"><a id="part0013_med_id00309a"></a><div class="mediaobject"><a id="part0013_med_id00309"></a><img alt="image with no caption" hisrc="figs/web/219fig02.png.jpg" src="../Images/image00806.jpeg"/></div></div><br/>Could this be any easier? Okay, we aren’t done yet; we need to work a little support into the Remote Control to handle tracking the last button pressed and the undo button press.</li><li class="listitem" style="list-style-type: none">③ To add support for the undo button we only have to make a few small changes to the Remote Control class. Here’s how we’re going to do it: we’ll add a new instance variable to track the last command invoked; then, whenever the undo button is pressed, we retrieve that command and invoke its undo() method.<div class="informalfigure"><a id="part0013_med_id00310a"></a><div class="mediaobject"><a id="part0013_med_id00310"></a><img alt="image with no caption" hisrc="figs/web/220fig01.png.jpg" src="../Images/image00807.jpeg"/></div></div></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_time_to_qa_that_undo_buttonexclamation_m" style="clear: both">Time to QA that Undo button!</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1760"></a><a class="indexterm" id="part0013_iddle2488"></a>Okay, let’s rework the test harness a bit to test the undo button:</p><div class="informalfigure"><a id="part0013_med_id00311a"></a><div class="mediaobject"><a id="part0013_med_id00311"></a><img alt="image with no caption" hisrc="figs/web/221fig01.png.jpg" src="../Images/image00808.jpeg"/></div></div><p>And here are the test results...</p><div class="informalfigure"><a id="part0013_med_id00312a"></a><div class="mediaobject"><a id="part0013_med_id00312"></a><img alt="image with no caption" hisrc="figs/web/221fig02.png.jpg" src="../Images/image00809.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_using_state_to_implement_undo" style="clear: both">Using state to implement Undo</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1762"></a><a class="indexterm" id="part0013_iddle2404"></a><a class="indexterm" id="part0013_iddle2490"></a>Okay, implementing undo on the Light was instructive but a little too easy. Typically, we need to manage a bit of state to implement undo. Let’s try something a little more interesting, like the CeilingFan from the vendor classes. The CeilingFan allows a number of speeds to be set along with an off method.</p><div class="informalfigure"><a id="part0013_med_id00313a"></a><div class="mediaobject"><a id="part0013_med_id00313"></a><img alt="image with no caption" hisrc="figs/web/222fig01.png.jpg" src="../Images/image00810.jpeg"/></div></div><p>Here’s the source code for the CeilingFan:</p><div class="informalfigure"><a id="part0013_med_id00314a"></a><div class="mediaobject"><a id="part0013_med_id00314"></a><img alt="image with no caption" hisrc="figs/web/222fig02.png.jpg" src="../Images/image00811.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00315a"></a><div class="mediaobject"><a id="part0013_med_id00315"></a><img alt="image with no caption" hisrc="figs/web/222fig03.png.jpg" src="../Images/image00812.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_adding_undo_to_the_ceilingfan_commands" style="clear: both">Adding Undo to the CeilingFan commands</h2></div></div></div><p>Now let’s tackle adding undo to the various CeilingFan commands. To do so, we need to track the last speed setting of the fan and, if the undo() method is called, restore the fan to its previous setting. Here’s the code for the CeilingFanHighCommand:</p><div class="informalfigure"><a id="part0013_med_id00316a"></a><div class="mediaobject"><a id="part0013_med_id00316"></a><img alt="image with no caption" hisrc="figs/web/223fig01.png.jpg" src="../Images/image00813.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00317a"></a><div class="mediaobject"><a id="part0013_med_id00317"></a><img alt="image with no caption" hisrc="figs/web/223fig02.png.jpg" src="../Images/image00814.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note05"></a>Brain Power</h3><p>We’ve got three more ceiling fan commands to write: low, medium, and off. Can you see how these are implemented?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_get_ready_to_test_the_ceiling_fan" style="clear: both">Get ready to test the ceiling fan</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1212"></a><a class="indexterm" id="part0013_iddle1761"></a><a class="indexterm" id="part0013_iddle2489"></a>Time to load up our remote control with the ceiling fan commands. We’re going to load slot 0’s on button with the medium setting for the fan and slot 1 with the high setting. Both corresponding off buttons will hold the ceiling fan off command.</p><div class="informalfigure"><a id="part0013_med_id00318a"></a><div class="mediaobject"><a id="part0013_med_id00318"></a><img alt="image with no caption" hisrc="figs/web/224fig01.png.jpg" src="../Images/image00815.jpeg"/></div></div><p>Here’s our test script:</p><div class="informalfigure"><a id="part0013_med_id00319a"></a><div class="mediaobject"><a id="part0013_med_id00319"></a><img alt="image with no caption" hisrc="figs/web/224fig02.png.jpg" src="../Images/image00816.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_testing_the_ceiling_fanhellip" style="clear: both">Testing the ceiling fan...</h2></div></div></div><p>Okay, let’s fire up the remote, load it with commands, and push some buttons!</p><div class="informalfigure"><a id="part0013_med_id00320a"></a><div class="mediaobject"><a id="part0013_med_id00320"></a><img alt="image with no caption" hisrc="figs/web/225fig01.png.jpg" src="../Images/image00817.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_every_remote_needs_a_party_modeexclamati" style="clear: both">Every remote needs a Party Mode!</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1200"></a><a class="indexterm" id="part0013_iddle1744"></a><a class="indexterm" id="part0013_iddle1891"></a><span class="strong"><strong>What’s the point of having a remote if you can’t push one button and have the lights dimmed, the stereo and TV turned on and set to a DVD, and the hot tub fired up?</strong></span></p><div class="informalfigure"><a id="part0013_med_id00321a"></a><div class="mediaobject"><a id="part0013_med_id00321"></a><img alt="image with no caption" hisrc="figs/web/226fig01.png.jpg" src="../Images/image00818.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00322a"></a><div class="mediaobject"><a id="part0013_med_id00322"></a><img alt="image with no caption" hisrc="figs/web/226fig02.png.jpg" src="../Images/image00819.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00323a"></a><div class="mediaobject"><a id="part0013_med_id00323"></a><img alt="image with no caption" hisrc="figs/web/226fig03.png.jpg" src="../Images/image00820.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00324a"></a><div class="mediaobject"><a id="part0013_med_id00324"></a><img alt="image with no caption" hisrc="figs/web/226fig04.png.jpg" src="../Images/image00821.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_using_a_macro_command" style="clear: both">Using a macro command</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1201"></a><a class="indexterm" id="part0013_iddle1539"></a><a class="indexterm" id="part0013_iddle1748"></a><a class="indexterm" id="part0013_iddle1895"></a><a class="indexterm" id="part0013_iddle2280"></a>Let’s step through how we use a macro command:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① First we create the set of commands we want to go into the macro:<div class="informalfigure"><a id="part0013_med_id00325a"></a><div class="mediaobject"><a id="part0013_med_id00325"></a><img alt="image with no caption" hisrc="figs/web/227fig01.png.jpg" src="../Images/image00822.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_sharpen_your_pencil-id00060"></a><h3 class="title">Sharpen your pencil</h3><p>We will also need commands for the off buttons. Write the code to create those here:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none">② Next we create two arrays, one for the On commands and one for the Off commands, and load them with the corresponding commands:<div class="informalfigure"><a id="part0013_med_id00326a"></a><div class="mediaobject"><a id="part0013_med_id00326"></a><img alt="image with no caption" hisrc="figs/web/227fig02.png.jpg" src="../Images/image00823.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ Then we assign MacroCommand to a button like we always do:<div class="informalfigure"><a id="part0013_med_id00327a"></a><div class="mediaobject"><a id="part0013_med_id00327"></a><img alt="image with no caption" hisrc="figs/web/227fig03.png.jpg" src="../Images/image00824.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">④ <a class="indexterm" id="part0013_iddle1209"></a><a class="indexterm" id="part0013_iddle1755"></a>Finally, we just need to push some buttons and see if this works.<div class="informalfigure"><a id="part0013_med_id00328a"></a><div class="mediaobject"><a id="part0013_med_id00328"></a><img alt="image with no caption" hisrc="figs/web/228fig01.png.jpg" src="../Images/image00825.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_exercise-id00061"></a><h3 class="title">Exercise</h3><p><a class="indexterm" id="part0013_iddle1186"></a><a class="indexterm" id="part0013_iddle1213"></a><a class="indexterm" id="part0013_iddle1465"></a><a class="indexterm" id="part0013_iddle1521"></a><a class="indexterm" id="part0013_iddle1745"></a><a class="indexterm" id="part0013_iddle1746"></a><a class="indexterm" id="part0013_iddle1758"></a><a class="indexterm" id="part0013_iddle1892"></a><a class="indexterm" id="part0013_iddle1893"></a><a class="indexterm" id="part0013_iddle2351"></a><a class="indexterm" id="part0013_iddle2485"></a><a class="indexterm" id="part0013_iddle2486"></a>The only thing our MacroCommand is missing is its undo functionality. When the undo button is pressed after a macro command, all the commands that were invoked in the macro must undo their previous actions. Here’s the code for MacroCommand; go ahead and implement the undo() method:</p><div class="informalfigure"><a id="part0013_med_id00329a"></a><div class="mediaobject"><a id="part0013_med_id00329"></a><img alt="image with no caption" hisrc="figs/web/229fig01.png.jpg" src="../Images/image00826.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_there_are_no_dumb_questions-id00062"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa1qe1"></a><a id="part0013_ch06qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Do I always need a receiver? Why can’t the command object implement the details of the execute() method?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> In general, we strive for “dumb” command objects that just invoke an action on a receiver; however, there are many examples of “smart” command objects that implement most, if not all, of the logic needed to carry out a request. Certainly you can do this; just keep in mind you’ll no longer have the same level of decoupling between the invoker and receiver, nor will you be able to parameterize your commands with receivers.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa1qe2"></a><a id="part0013_ch06qa1q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: How can I implement a history of undo operations? In other words, I want to be able to press the undo button multiple times?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa1q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Great question. It’s pretty easy actually; instead of keeping just a reference to the last Command executed, you keep a stack of previous commands. Then, whenever undo is pressed, your invoker pops the first item off the stack and calls its undo() method.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa1qe3"></a><a id="part0013_ch06qa1q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Could I have just implemented party mode as a Command by creating a PartyCommand and putting the calls to execute the other Commands in the PartyCommand’s execute() method?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa1q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You could; however, you’d essentially be “hardcoding” the party mode into the PartyCommand. Why go to the trouble? With the MacroCommand, you can decide dynamically which Commands you want to go into the PartyCommand, so you have more flexibility using MacroCommands. In general, the MacroCommand is a more elegant solution and requires less new code.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_command_pattern_means_lots_of_command_cl" style="clear: both">The Command Pattern means lots of command classes</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1113"></a><a class="indexterm" id="part0013_iddle1172"></a><a class="indexterm" id="part0013_iddle1178"></a><a class="indexterm" id="part0013_iddle1193"></a><a class="indexterm" id="part0013_iddle1736"></a>When you use the Command Pattern, you end up with a lot of small classes — the concrete Command implementations — that each encapsulate the request to the corresponding receiver. In our remote control implementation, we have two command classes for each receiver class. For instance, for the Light receiver, we have LightOnCommand and LightOffCommand; for the GarageDoor receiver, we have GarageDoorUpCommand and GarageDoorDownCommand, and so on. That’s a lot of extra stuff that’s needed to create little bits of packaged-up computation that all have the same interface for the RemoteControl:</p><div class="informalfigure"><a id="part0013_med_id00330a"></a><div class="mediaobject"><a id="part0013_med_id00330"></a><img alt="image with no caption" hisrc="figs/web/230fig01.png.jpg" src="../Images/image00827.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0013_do_we_really_need_all_these_command_clas">Do we really need all these command classes?</h3></div></div></div><p>A command is simply a piece of packaged-up computation. It’s a way for us to have a common interface to the behavior of many different receivers (lights, hot tubs, stereos) each with its own set of actions.</p><p>What if you could keep the common interface for all your commands, but take out the bits of computation from inside the concrete Command implementations and use them directly instead? <span class="emphasis"><em>And</em></span> you could get rid of all those extra classes and simplify your code? Well, with lambda expressions you can. Let’s see how...</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_simplifying_the_remote_control_with_lamb" style="clear: both">Simplifying the Remote Control with lambda expressions</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1115"></a><a class="indexterm" id="part0013_iddle1174"></a><a class="indexterm" id="part0013_iddle1180"></a><a class="indexterm" id="part0013_iddle1738"></a><a class="indexterm" id="part0013_iddle1878"></a>While you’ve seen how straightforward the Command Pattern is, Java gives us a nice tool to simplify things even more; namely, the lambda expression. A lambda expression is a short hand for a method — a bit of computation — exactly where you need it. Instead of creating a whole separate class containing that method, instantiating an object from that class, and then calling the method, you can just say, “here’s the method I want called” by using a lambda expression. In our case, the method we want called is the execute() method.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note06"></a>Note</h3><p>If you aren’t yet familiar with lambda expressions (they were added in Java 8) they can take some getting used to. You should be able to follow along over the next few pages, but consult a Java reference to get up to speed on the syntax and semantics if you need to.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Let’s replace the LightOnCommand and LightOffCommand objects with lambda expressions to see how this works. Here are the steps to use lambda expressions instead of command objects to add the light on and off commands to the remote control:</p><p><span class="strong"><strong>Step 1: Create the Receiver</strong></span></p><p>This step is exactly the same as before.</p><a id="part0013_pro_id00022"></a><pre class="programlisting"><span class="strong"><strong>Light livingRoomLight = new Light("Living Room");</strong></span></pre><div class="informalfigure"><a id="part0013_med_id00331a"></a><div class="mediaobject"><a id="part0013_med_id00331"></a><img alt="image with no caption" hisrc="figs/web/231fig01.png.jpg" src="../Images/image00828.jpeg"/></div></div><p><span class="strong"><strong>Step 2: Set the remote control’s commands using lambda expressions</strong></span></p><p>This is where the magic happens. Now, instead of creating LightOnCommand and LightOffCommand objects to pass to remoteControl.setCommand(), we simply pass a lambda expression in place of each object, with the code from their respective execute() methods:</p><div class="informalfigure"><a id="part0013_med_id00332a"></a><div class="mediaobject"><a id="part0013_med_id00332"></a><img alt="image with no caption" hisrc="figs/web/231fig02.png.jpg" src="../Images/image00829.jpeg"/></div></div><p><span class="strong"><strong>Step 3: Push the remote control buttons</strong></span></p><p>This step doesn’t change either. Except now, when we call the remote’s onButtonWasPushed(0) method, the command that’s in slot 0 is a function object (created by the lambda expression). When we call execute() on the command, that method is matched up with the method defined by the lambda expression, which is then executed.</p><div class="informalfigure"><a id="part0013_med_id00333a"></a><div class="mediaobject"><a id="part0013_med_id00333"></a><img alt="image with no caption" hisrc="figs/web/231fig03.png.jpg" src="../Images/image00830.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00334a"></a><div class="mediaobject"><a id="part0013_med_id00334"></a><img alt="image with no caption" hisrc="figs/web/232fig01.png.jpg" src="../Images/image00831.jpeg"/></div></div><p><span class="strong"><strong>Well, we did say “magic” didn’t we?</strong></span></p><p>Just kidding... it’s actually not all that magical. We’re using lambda expressions to stand in for Command objects, and the Command interface has just one method: execute(). The lambda expression we use must have a compatible signature with this method — and it does: execute() takes no arguments (neither does our lambda expression), and returns no value (neither does our lambda expression), so the compiler is happy.</p><p>We pass the lambda expression into the Command parameter of the setCommand() method:</p><div class="informalfigure"><a id="part0013_med_id00335a"></a><div class="mediaobject"><a id="part0013_med_id00335"></a><img alt="image with no caption" hisrc="figs/web/232fig02.png.jpg" src="../Images/image00832.jpeg"/></div></div><p>The compiler checks to see if the Command interface has one method that matches the lambda expression, and it does: execute().</p><p>Then, when we call execute() on that command, the method in the lambda expression is called:</p><div class="informalfigure"><a id="part0013_med_id00336a"></a><div class="mediaobject"><a id="part0013_med_id00336"></a><img alt="image with no caption" hisrc="figs/web/232fig03.png.jpg" src="../Images/image00833.jpeg"/></div></div><p>Just remember: as long as the interface of the parameter we’re passing the lambda expression to has one (and only one!) method, and that method has a compatible signature with the lambda expression, this will work.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_simplifying_even_more_with_method_refere" style="clear: both">Simplifying even more with method references</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1114"></a><a class="indexterm" id="part0013_iddle1173"></a><a class="indexterm" id="part0013_iddle1179"></a><a class="indexterm" id="part0013_iddle1194"></a><a class="indexterm" id="part0013_iddle1737"></a><a class="indexterm" id="part0013_iddle1913"></a>We can simplify our code even more using <span class="emphasis"><em>method references</em></span>. When the lambda expression you’re passing calls just one method, you can pass a method reference in place of the lambda expression. Like this:</p><div class="informalfigure"><a id="part0013_med_id00337a"></a><div class="mediaobject"><a id="part0013_med_id00337"></a><img alt="image with no caption" hisrc="figs/web/233fig01.png.jpg" src="../Images/image00834.jpeg"/></div></div><p>So now, instead of passing a lambda expression that calls the livingRoomLight’s on() method, we’re passing a <span class="emphasis"><em>reference to the method itself</em></span>.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0013_what_if_we_need_to_do_more_than_one_thin">What if we need to do more than one thing in our lambda expression?</h3></div></div></div><p>Sometimes, the lambda expressions you’ll use to stand in for Command objects have to do more than one thing. Let’s take a quick look at how to replace the stereoOnWithCDCommand and stereoOffCommand objects with lambda expressions, and then we’ll look at the complete code for the RemoteLoader so you can see all these ideas come together.</p><p>The stereoOffCommand just executes a simple one-line command:</p><a id="part0013_pro_id00023"></a><pre class="programlisting"><span class="strong"><strong>stereo.off();</strong></span></pre><p>So we can use a method reference, <code class="literal">stereo::off</code>, in place of a lambda expression for this command.</p><p>But the stereoOnWithCDCommand does <span class="emphasis"><em>three</em></span> things:</p><a id="part0013_pro_id00024"></a><pre class="programlisting"><span class="strong"><strong>stereo.on();</strong></span>
<span class="strong"><strong>stereo.setCD();</strong></span>
<span class="strong"><strong>stereo.setVolume(11);</strong></span></pre><p>In this case, then, we can’t use a method reference. Instead, we can either write the lambda expression in line, or we can create it separately, give it a name, and then pass it to the remoteControl’s setCommand() method using that name. Here’s how you can create the lambda expression separately, and give it a name:</p><div class="informalfigure"><a id="part0013_med_id00338a"></a><div class="mediaobject"><a id="part0013_med_id00338"></a><img alt="image with no caption" hisrc="figs/web/233fig02.png.jpg" src="../Images/image00835.jpeg"/></div></div><p>Notice that we use Command as the type of the lambda expression. The lambda expression will match the Command interface’s execute() method, and the Command parameter we’re passing it to in the setCommand() method.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_test_the_remote_control_with_lambda_expr" style="clear: both">Test the remote control with lambda expressions</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1210"></a><a class="indexterm" id="part0013_iddle1756"></a>To use lambda expressions to simplify the code for the original Remote Control implementation (without undo), we’re going to change the code in the RemoteLoader to replace the concrete Command objects with lambda expressions, and change the RemoteControl constructor to use lambda expressions instead of a NoCommand object. Once we’ve done that, we can delete all the concrete Command classes (LightOnCommand, LightOffCommand, HottubOnCommand, HottubOffCommand, and so on). And that’s it. Everything else stays the same. Make sure you <span class="emphasis"><em>don’t</em></span> delete the Command interface; you still need that to match the type of the function objects created by the lambda expressions that get stored in the remote control, and passed to the various methods.</p><p>Here’s the new code for the RemoteLoader class:</p><div class="informalfigure"><a id="part0013_med_id00339a"></a><div class="mediaobject"><a id="part0013_med_id00339"></a><img alt="image with no caption" hisrc="figs/web/234fig01.png.jpg" src="../Images/image00836.jpeg"/></div></div><p><a class="indexterm" id="part0013_iddle1206"></a><a class="indexterm" id="part0013_iddle1752"></a><a class="indexterm" id="part0013_iddle1968"></a>And don’t forget, we need to modify the RemoteControl constructor to remove the code to construct NoCommand objects, and replace those with lambda expressions too:</p><div class="informalfigure"><a id="part0013_med_id00340a"></a><div class="mediaobject"><a id="part0013_med_id00340"></a><img alt="image with no caption" hisrc="figs/web/235fig01.png.jpg" src="../Images/image00837.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00341a"></a><div class="mediaobject"><a id="part0013_med_id00341"></a><img alt="image with no caption" hisrc="figs/web/235fig02.png.jpg" src="../Images/image00838.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0013_check_out_the_results_of_all_those_lambd">Check out the results of all those lambda expression commands...</h3></div></div></div><div class="informalfigure"><a id="part0013_med_id00342a"></a><div class="mediaobject"><a id="part0013_med_id00342"></a><img alt="image with no caption" hisrc="figs/web/235fig03.png.jpg" src="../Images/image00839.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_there_are_no_dumb_questions-id00063"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2qe1"></a><a id="part0013_ch06qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a class="indexterm" id="part0013_iddle1198"></a><a class="indexterm" id="part0013_iddle1742"></a><span class="strong"><strong>Q: Can a lambda expression have parameters or return a value? Or does it always have to be a void, no-argument method?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes, a lambda expression can have parameters and return a value (take a look back at <a class="xref" href="#part0009_aid-8IL22">Chapter 2</a> to see how we used a one-argument lambda expression in place of an ActionListener object in the Swing observer example). But the rules are the same: the signature of the lambda expression must match the signature of the one method in the type of the object you’re using the lambda expression to stand in for. To learn more about how to write lambda expressions with parameters and return values (and how to deal with the types), check out the Java docs.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2qe2"></a><a id="part0013_ch06qa2q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: You keep saying that a lambda expression must match a method in an interface with one, and only one, method. So if an interface has two methods, we can’t use a lambda expression?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> That’s right. An interface, like our original Command interface (or ActionListener as another example), that has just one method is known as a <span class="emphasis"><em>functional interface</em></span>. Lambda expressions are designed specifically to replace the methods in these functional interfaces, partly as a way to reduce the code that is required when you have a lot of these small classes with functional interfaces. If your interface has two methods, it’s not a functional interface and you won’t be able to replace it with a lambda expression. Think about it: a lambda expression is really a replacement for a method, not an entire object. You can’t replace two methods with one lambda expression.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2qe3"></a><a id="part0013_ch06qa2q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Does that mean we can’t use lambda expressions for our Remote Control implementation with undo? There, our Command interface has two methods: execute() and undo().</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> That’s right. You could probably find a way to use lambdas with undo (by making two different types of commands), but in the end your code would probably be more complex than if you’d just used Command objects like we did when we implemented the RemoteControl with undo earlier in the chapter.</p><p>Lambda expressions are meant to be used with functional interfaces (one method only), to simplify your code. If you find yourself trying to work around this to support a case like Command with undo, then using lambda expressions probably isn’t the right solution.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2qe4"></a><a id="part0013_ch06qa2q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Why do the names of on and off slots look so weird when we display the RemoteControl?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0013_ch06qa2q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> If you take another look at how we implemented the toString() method of RemoteControl, you’ll see we’re using getClass() to get the class of the Command object, and then getName() to get the name of the class, and printing that to the console as a string. This was a convenient way to get a name for each slot, but kind of a cheat.</p><p>As you can see from the output, lambda expressions don’t have nice class names. That’s because their names are assigned internally by the Java runtime and Java has no idea what these lambda expressions mean; to Java, they’re just function objects that happen to match a method in an interface.</p><p>To fix the RemoteControl display, we’d have to modify the setCommand() code in RemoteControl, perhaps to allow a name parameter for each slot, and modify the toString() method to use this name. Then in RemoteLoader, we’d pass a nice, human-readable name into setCommand() along with the commands. This would probably mirror real life more closely (if you’re programming your own remote, you’ll likely want to set your own custom names).</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_more_uses_of_the_command_pattern_queuing" style="clear: both">More uses of the Command Pattern: queuing requests</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1221"></a><a class="indexterm" id="part0013_iddle2203"></a>Commands give us a way to package a piece of computation (a receiver and a set of actions) and pass it around as a first-class object. Now, the computation itself may be invoked long after some client application creates the command object. In fact, it may even be invoked by a different thread. We can take this scenario and apply it to many useful applications such as schedulers, thread pools, and job queues, to name a few.</p><p>Imagine a job queue: you add commands to the queue on one end, and on the other end sits a group of threads. Threads run the following script: they remove a command from the queue, call its execute() method, wait for the call to finish, then discard the command object and retrieve a new one.</p><div class="informalfigure"><a id="part0013_med_id00343a"></a><div class="mediaobject"><a id="part0013_med_id00343"></a><img alt="image with no caption" hisrc="figs/web/237fig01.png.jpg" src="../Images/image00840.jpeg"/></div></div><p>Note that the job queue classes are totally decoupled from the objects that are doing the computation. One minute a thread may be computing a financial computation, and the next it may be retrieving something from the network. The job queue objects don’t care; they just retrieve commands and call execute(). Likewise, as long as you put objects into the queue that implement the Command Pattern, your execute() method will be invoked when a thread is available.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0013_ch06note07"></a>Brain Power</h3><p>How might a web server make use of such a queue? What other applications can you think of?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_more_uses_of_the_command_pattern_logging" style="clear: both">More uses of the Command Pattern: logging requests</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1217"></a><a class="indexterm" id="part0013_iddle1887"></a>The semantics of some applications require that we log all actions and be able to recover after a crash by reinvoking those actions. The Command Pattern can support these semantics with the addition of two methods: store() and load(). In Java we could use object serialization to implement these methods, but the normal caveats for using serialization for persistence apply.</p><p>How does this work? As we execute commands, we store a history of them on disk. When a crash occurs, we reload the command objects and invoke their execute() methods in batch and in order.</p><p>Now, this kind of logging wouldn’t make sense for a remote control; however, there are many applications that invoke actions on large data structures that can’t be quickly saved each time a change is made. By using logging, we can save all the operations since the last check point, and if there is a system failure, apply those operations to our checkpoint. Take, for example, a spreadsheet application: we might want to implement our failure recovery by logging the actions on the spreadsheet rather than writing a copy of the spreadsheet to disk every time a change occurs. In more advanced applications, these techniques can be extended to apply to sets of operations in a transactional manner so that all of the operations complete, or none of them do.</p><div class="informalfigure"><a id="part0013_med_id00344a"></a><div class="mediaobject"><a id="part0013_med_id00344"></a><img alt="image with no caption" hisrc="figs/web/238fig01.png.jpg" src="../Images/image00841.jpeg"/></div></div><div class="informalfigure"><a id="part0013_med_id00345a"></a><div class="mediaobject"><a id="part0013_med_id00345"></a><img alt="image with no caption" hisrc="figs/web/238fig02.png.jpg" src="../Images/image00842.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0013_tools_for_your_design_toolbox-id00064" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p><a class="indexterm" id="part0013_iddle1808"></a>Your toolbox is starting to get heavy! In this chapter we’ve added a pattern that allows us to encapsulate methods into Command objects: store them, pass them around, and invoke them when you need them.</p><div class="informalfigure"><a id="part0013_med_id00346a"></a><div class="mediaobject"><a id="part0013_med_id00346"></a><img alt="image with no caption" hisrc="figs/web/239fig01.png.jpg" src="../Images/image00843.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_bullet_points-id00065"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Command Pattern decouples an object making a request from the one that knows how to perform it.</li><li class="listitem">A Command object is at the center of this decoupling and encapsulates a receiver with an action (or set of actions) .</li><li class="listitem">An invoker makes a request of a Command object by calling its execute() method, which invokes those actions on the receiver.</li><li class="listitem">Invokers can be parameterized with Commands, even dynamically at runtime.</li><li class="listitem">Commands may support undo by implementing an undo method that restores the object to its previous state before the execute() method was last called.</li><li class="listitem">Macro Commands are a simple extension of Command that allow multiple commands to be invoked. Likewise, Macro Commands can easily support undo().</li><li class="listitem">In practice, it is not uncommon for “smart” Command objects to implement the request themselves rather than delegating to a receiver.</li><li class="listitem">Commands may also be used to implement logging and transactional systems.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_design_patterns_crossword-id00066"></a><h3 class="title">Design Patterns Crossword</h3><p>Time to take a breather and let it all sink in.</p><p>It’s another crossword; all of the solution words are from this chapter.</p><div class="informalfigure"><a id="part0013_med_id00347a"></a><div class="mediaobject"><a id="part0013_med_id00347"></a><img alt="image with no caption" hisrc="figs/web/240fig01.png" src="../Images/image00844.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>3. The Waitress was one.</p>
<p>4. A command __________ a set of actions and a receiver.</p>
<p>7. Dr. Seuss diner food.</p>
<p>8. Our favorite city.</p>
<p>9. Act as the receivers in the remote control.</p>
<p>13. Object that knows the actions and the receiver.</p>
<p>14. Another thing Command can do.</p>
<p>15. Object that knows how to get things done.</p>
<p>17. A command encapsulates this.</p></td><td style="vertical-align: top; "><p>1. Role of customer in the Command Pattern.</p>
<p>2. Our first command object controlled this.</p>
<p>5. Invoker and receiver are _________.</p>
<p>6. Company that got us word-of-mouth business.</p>
<p>10. All commands provide this.</p>
<p>11. The Cook and this person were definitely decoupled.</p>
<p>12. Carries out a request.</p>
<p>16. Waitress didn’t do this.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_who_does_whatquestion_mark_solution"></a><h3 class="title">Who Does What? Solution</h3><p><a class="indexterm" id="part0013_iddle1191"></a><a class="indexterm" id="part0013_iddle1204"></a><a class="indexterm" id="part0013_iddle1219"></a><a class="indexterm" id="part0013_iddle1548"></a><a class="indexterm" id="part0013_iddle1577"></a><a class="indexterm" id="part0013_iddle1734"></a><a class="indexterm" id="part0013_iddle1750"></a><a class="indexterm" id="part0013_iddle2290"></a><a class="indexterm" id="part0013_iddle2515"></a>Match the diner objects and methods with the corresponding names from the Command Pattern</p><div class="informalfigure"><a id="part0013_med_id00348a"></a><div class="mediaobject"><a id="part0013_med_id00348"></a><img alt="image with no caption" hisrc="figs/web/241fig01.png.jpg" src="../Images/image00845.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_sharpen_your_pencil_solution-id00067"></a><h3 class="title">Sharpen your pencil Solution</h3><p>Here’s the code for the GarageDoorOpenCommand class.</p><a id="part0013_pro_id00025"></a><pre class="programlisting"><span class="strong"><strong>public class GarageDoorOpenCommand implements Command {</strong></span>
    <span class="gray-background"><span class="strong"><strong>GarageDoor garageDoor;</strong></span></span>

    <span class="gray-background"><span class="strong"><strong>public GarageDoorOpenCommand(GarageDoor garageDoor) {</strong></span></span>
        <span class="gray-background"><span class="strong"><strong>this.garageDoor = garageDoor;</strong></span></span>
    <span class="gray-background"><span class="strong"><strong>}</strong></span></span>
    <span class="gray-background"><span class="strong"><strong>public void execute() {</strong></span></span>
        <span class="gray-background"><span class="strong"><strong>garageDoor.up();</strong></span></span>
    <span class="gray-background"><span class="strong"><strong>}</strong></span></span>
<span class="strong"><strong>}</strong></span></pre><p>Here’s the output:</p><div class="informalfigure"><a id="part0013_med_id00349a"></a><div class="mediaobject"><a id="part0013_med_id00349"></a><img alt="image with no caption" hisrc="figs/web/241fig02.png.jpg" src="../Images/image00846.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_exercise_solution"></a><h3 class="title">Exercise Solution</h3><p><a class="indexterm" id="part0013_iddle1202"></a><a class="indexterm" id="part0013_iddle1214"></a><a class="indexterm" id="part0013_iddle1522"></a><a class="indexterm" id="part0013_iddle1540"></a><a class="indexterm" id="part0013_iddle1747"></a><a class="indexterm" id="part0013_iddle1759"></a><a class="indexterm" id="part0013_iddle1894"></a><a class="indexterm" id="part0013_iddle2281"></a>Here is the undo() method for the MacroCommand.</p><a id="part0013_pro_id00026"></a><pre class="programlisting"><span class="strong"><strong>public class MacroCommand implements Command {</strong></span>
    <span class="strong"><strong>Command[] commands;</strong></span>
    <span class="strong"><strong>public MacroCommand(Command[] commands) {</strong></span>
        <span class="strong"><strong>this.commands = commands;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void execute() {</strong></span>
        <span class="strong"><strong>for (int i = 0; i &lt; commands.length; i++) {</strong></span>
            <span class="strong"><strong>commands[i].execute();</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="gray-background"><span class="strong"><strong>public void undo() {</strong></span></span>
        <span class="gray-background"><span class="strong"><strong>for (int i = commands.length - 1; i &gt; = 0; i--) {</strong></span></span>
            <span class="gray-background"><span class="strong"><strong>commands[i].undo();</strong></span></span>
        <span class="gray-background"><span class="strong"><strong>}</strong></span></span>
    <span class="gray-background"><span class="strong"><strong>}</strong></span></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0013_sharpen_your_pencil_solution-id00068"></a><h3 class="title">Sharpen your pencil Solution</h3><p>Here is the code to create commands for the off button.</p><a id="part0013_pro_id00027"></a><pre class="programlisting"><span class="strong"><strong>LightOffCommand lightOff = new LightOffCommand(light);</strong></span>
<span class="strong"><strong>StereoOffCommand stereoOff = new StereoOffCommand(stereo);</strong></span>
<span class="strong"><strong>TVOffCommand tvOff = new TVOffCommand(tv);</strong></span>
<span class="strong"><strong>HottubOffCommand hottubOff = new HottubOffCommand(hottub);</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0013_med_id00350a"></a><div class="mediaobject"><a id="part0013_med_id00350"></a><img alt="image with no caption" hisrc="figs/web/242fig01.png" src="../Images/image00847.gif"/></div></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0014_adapter_and_facade_patterns_being_adapti"><div class="titlepage" id="part0014_aid-DB7S2"><div><div><h2 class="title">Chapter 7. The Adapter and Facade Patterns: Being Adaptive</h2></div></div></div><div class="informalfigure"><a id="part0014_med_id00351a"></a><div class="mediaobject"><a id="part0014_med_id00351"></a><img alt="image with no caption" hisrc="figs/web/243fig01.png.jpg" src="../Images/image00848.jpeg"/></div></div><p><span class="strong"><strong>In this chapter we’re going to attempt such impossible feats as putting a square peg in a round hole.</strong></span> Sound impossible? Not when we have Design Patterns. Remember the Decorator Pattern? We <span class="strong"><strong>wrapped objects</strong></span> to give them new responsibilities. Now we’re going to wrap some objects with a different purpose: to make their interfaces look like something they’re not. Why would we do that? So we can adapt a design expecting one interface to a class that implements a different interface. That’s not all; while we’re at it, we’re going to look at another pattern that wraps objects to simplify their interface.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_adapters_all_around_us" style="clear: both">Adapters all around us</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1036"></a><a class="indexterm" id="part0014_iddle2007"></a><a class="indexterm" id="part0014_iddle2078"></a><span class="strong"><strong>You’ll have no trouble understanding what an OO adapter is because the real world is full of them. How’s this for an example: Have you ever needed to use a US-made laptop in Great Britain? Then you’ve probably needed an AC power adapter...</strong></span></p><div class="informalfigure"><a id="part0014_med_id00352a"></a><div class="mediaobject"><a id="part0014_med_id00352"></a><img alt="image with no caption" hisrc="figs/web/244fig01.png.jpg" src="../Images/image00849.jpeg"/></div></div><p>You know what the adapter does: it sits in between the plug of your laptop and the British AC outlet; its job is to adapt the British outlet so that you can plug your laptop into it and receive power. Or look at it this way: the adapter changes the interface of the outlet into one that your laptop expects.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note01"></a>Note</h3><p>How many other real-world adapters can you think of?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Some AC adapters are simple — they only change the shape of the outlet so that it matches your plug, and they pass the AC current straight through — but other adapters are more complex internally and may need to step the power up or down to match your devices’ needs.</p><p>Okay, that’s the real world; what about object-oriented adapters? Well, our OO adapters play the same role as their real-world counterparts: they take an interface and adapt it to one that a client is expecting.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_object-oriented_adapters" style="clear: both">Object-oriented adapters</h2></div></div></div><p>Say you’ve got an existing software system that you need to work a new vendor class library into, but the new vendor designed their interfaces differently than the last vendor:</p><div class="informalfigure"><a id="part0014_med_id00353a"></a><div class="mediaobject"><a id="part0014_med_id00353"></a><img alt="image with no caption" hisrc="figs/web/245fig01.png.jpg" src="../Images/image00850.jpeg"/></div></div><p>Okay, you don’t want to solve the problem by changing your existing code (and you can’t change the vendor’s code). So what do you do? Well, you can write a class that adapts the new vendor interface into the one you’re expecting.</p><div class="informalfigure"><a id="part0014_med_id00354a"></a><div class="mediaobject"><a id="part0014_med_id00354"></a><img alt="image with no caption" hisrc="figs/web/245fig02.png.jpg" src="../Images/image00851.jpeg"/></div></div><p>The adapter acts as the middleman by receiving requests from the client and converting them into requests that make sense on the vendor classes.</p><div class="informalfigure"><a id="part0014_med_id00355a"></a><div class="mediaobject"><a id="part0014_med_id00355"></a><img alt="image with no caption" hisrc="figs/web/245fig03.png.jpg" src="../Images/image00852.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note02"></a>Note</h3><p>Can you think of a solution that doesn’t require YOU to write ANY additional code to integrate the new vendor classes? How about making the vendor supply the adapter class?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_if_it_walks_like_a_duck_and_quacks_like" style="clear: both">If it walks like a duck and quacks like a duck, then it <span class="strikethrough">must</span> might be a <span class="strikethrough">duck</span> turkey wrapped with a duck adapter...</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1038"></a><a class="indexterm" id="part0014_iddle2009"></a><a class="indexterm" id="part0014_iddle2080"></a>It’s time to see an adapter in action. Remember our ducks from <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a>? Let’s review a slightly simplified version of the Duck interfaces and classes:</p><div class="informalfigure"><a id="part0014_med_id00356a"></a><div class="mediaobject"><a id="part0014_med_id00356"></a><img alt="image with no caption" hisrc="figs/web/246fig01.png.jpg" src="../Images/image00853.jpeg"/></div></div><div class="informalfigure"><a id="part0014_med_id00357a"></a><div class="mediaobject"><a id="part0014_med_id00357"></a><img alt="image with no caption" hisrc="figs/web/246fig02.png.jpg" src="../Images/image00854.jpeg"/></div></div><p>Here’s a subclass of Duck, the MallardDuck.</p><div class="informalfigure"><a id="part0014_med_id00358a"></a><div class="mediaobject"><a id="part0014_med_id00358"></a><img alt="image with no caption" hisrc="figs/web/246fig03.png.jpg" src="../Images/image00855.jpeg"/></div></div><p>Now it’s time to meet the newest fowl on the block:</p><div class="informalfigure"><a id="part0014_med_id00359a"></a><div class="mediaobject"><a id="part0014_med_id00359"></a><img alt="image with no caption" hisrc="figs/web/246fig04.png.jpg" src="../Images/image00856.jpeg"/></div></div><div class="informalfigure"><a id="part0014_med_id00360a"></a><div class="mediaobject"><a id="part0014_med_id00360"></a><img alt="image with no caption" hisrc="figs/web/247fig01.png.jpg" src="../Images/image00857.jpeg"/></div></div><p>Now, let’s say you’re short on Duck objects and you’d like to use some Turkey objects in their place. Obviously we can’t use the turkeys outright because they have a different interface.</p><p>So, let’s write an Adapter:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_code_up_close-id00069"></a><h3 class="title">Code Up Close</h3><div class="informalfigure"><a id="part0014_med_id00361a"></a><div class="mediaobject"><a id="part0014_med_id00361"></a><img alt="image with no caption" hisrc="figs/web/247fig02.png.jpg" src="../Images/image00858.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_test_drive_the_adapter" style="clear: both">Test drive the adapter</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1040"></a><a class="indexterm" id="part0014_iddle2010"></a><a class="indexterm" id="part0014_iddle2082"></a>Now we just need some code to test drive our adapter:</p><div class="informalfigure"><a id="part0014_med_id00362a"></a><div class="mediaobject"><a id="part0014_med_id00362"></a><img alt="image with no caption" hisrc="figs/web/248fig01.png.jpg" src="../Images/image00859.jpeg"/></div></div><div class="informalfigure"><a id="part0014_med_id00363a"></a><div class="mediaobject"><a id="part0014_med_id00363"></a><img alt="image with no caption" hisrc="figs/web/248fig02.png.jpg" src="../Images/image00860.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_adapter_pattern_explained" style="clear: both">The Adapter Pattern explained</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1016"></a>Now that we have an idea of what an Adapter is, let’s step back and look at all the pieces again.</p><div class="informalfigure"><a id="part0014_med_id00364a"></a><div class="mediaobject"><a id="part0014_med_id00364"></a><img alt="image with no caption" hisrc="figs/web/249fig01.png.jpg" src="../Images/image00861.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_hereapostrophes_how_the_client_uses_the">Here’s how the Client uses the Adapter</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① The client makes a request to the adapter by calling a method on it using the target interface.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② The adapter translates the request into one or more calls on the adaptee using the adaptee interface.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ The client receives the results of the call and never knows there is an adapter doing the translation.</strong></span></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note03"></a>Note</h3><p>Note that the Client and Adaptee are decoupled – neither knows about the other.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_sharpen_your_pencil-id00070"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0014_iddle1037"></a><a class="indexterm" id="part0014_iddle1108"></a><a class="indexterm" id="part0014_iddle1568"></a><a class="indexterm" id="part0014_iddle2008"></a><a class="indexterm" id="part0014_iddle2025"></a><a class="indexterm" id="part0014_iddle2079"></a><a class="indexterm" id="part0014_iddle2313"></a><a class="indexterm" id="part0014_iddle2482"></a><a class="indexterm" id="part0014_iddle2530"></a>Let’s say we also need an Adapter that converts a Duck to a Turkey. Let’s call it DuckAdapter. Write that class:</p><p>How did you handle the fly method (after all, we know ducks fly longer than turkeys)? Check the answers at the end of the chapter for our solution. Did you think of a better way?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_there_are_no_dumb_questions-id00071"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa1qe1"></a><a id="part0014_ch07qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How much “adapting” does an adapter need to do? It seems like if I need to implement a large target interface, I could have a LOT of work on my hands?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You certainly could. The job of implementing an adapter really is proportional to the size of the interface you need to support as your target interface. Think about your options, however. You could rework all your client-side calls to the interface, which would result in a lot of investigative work and code changes. Or, you can cleanly provide one class that encapsulates all the changes in one class.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa1qe2"></a><a id="part0014_ch07qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does an adapter always wrap one and only one class?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The Adapter Pattern’s role is to convert one interface into another. While most examples of the adapter pattern show an adapter wrapping one adaptee, we both know the world is often a bit more messy. So, you may well have situations where an adapter holds two or more adaptees that are needed to implement the target interface.</div><div>This relates to another pattern called the Facade Pattern; people often confuse the two. Remind us to revisit this point when we talk about facades later in this chapter.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa1qe3"></a><a id="part0014_ch07qa1q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: What if I have old and new parts of my system, and the old parts expect the old vendor interface, but we’ve already written the new parts to use the new vendor interface? It is going to get confusing using an adapter here and the unwrapped interface there. Wouldn’t I be better off just writing my older code and forgetting the adapter?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa1q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Not necessarily. One thing you can do is create a Two Way Adapter that supports both interfaces. To create a Two Way Adapter, just implement both interfaces involved, so the adapter can act as an old interface or a new interface.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_adapter_pattern_defined" style="clear: both">Adapter Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1021"></a><a class="indexterm" id="part0014_iddle1110"></a>Enough ducks, turkeys, and AC power adapters; let’s get real and look at the official definition of the Adapter Pattern:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note04"></a>Note</h3><p><span class="strong"><strong>The Adapter Pattern</strong></span> converts the interface of a class into another interface the clients expect. Adapter lets classes work together that couldn’t otherwise because of incompatible interfaces.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Now, we know this pattern allows us to use a client with an incompatible interface by creating an Adapter that does the conversion. This acts to decouple the client from the implemented interface, and if we expect the interface to change over time, the adapter encapsulates that change so that the client doesn’t have to be modified each time it needs to operate against a different interface.</p><p>We’ve taken a look at the runtime behavior of the pattern; let’s take a look at its class diagram as well:</p><div class="informalfigure"><a id="part0014_med_id00365a"></a><div class="mediaobject"><a id="part0014_med_id00365"></a><img alt="image with no caption" hisrc="figs/web/251fig01.png.jpg" src="../Images/image00862.jpeg"/></div></div><p>The Adapter Pattern is full of good OO design principles: check out the use of object composition to wrap the adaptee with an altered interface. This approach has the added advantage that we can use an adapter with any subclass of the adaptee.</p><p>Also check out how the pattern binds the client to an interface, not an implementation; we could use several adapters, each converting a different backend set of classes. Or, we could add new implementations after the fact, as long as they adhere to the Target interface.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_object_and_class_adapters" style="clear: both">Object and class adapters</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1032"></a><a class="indexterm" id="part0014_iddle1039"></a><a class="indexterm" id="part0014_iddle1104"></a><a class="indexterm" id="part0014_iddle1787"></a><a class="indexterm" id="part0014_iddle2002"></a><a class="indexterm" id="part0014_iddle2011"></a><a class="indexterm" id="part0014_iddle2081"></a>Now despite having defined the pattern, we haven’t told you the whole story yet. There are actually <span class="emphasis"><em>two</em></span> kinds of adapters: <span class="emphasis"><em>object</em></span> adapters and <span class="emphasis"><em>class</em></span> adapters. This chapter has covered object adapters and the class diagram on the previous page is a diagram of an object adapter.</p><p>So what’s a <span class="emphasis"><em>class</em></span> adapter and why haven’t we told you about it? Because you need multiple inheritance to implement it, which isn’t possible in Java. But, that doesn’t mean you might not encounter a need for class adapters down the road when using your favorite multiple inheritance language! Let’s look at the class diagram for multiple inheritance.</p><div class="informalfigure"><a id="part0014_med_id00366a"></a><div class="mediaobject"><a id="part0014_med_id00366"></a><img alt="image with no caption" hisrc="figs/web/252fig01.png.jpg" src="../Images/image00863.jpeg"/></div></div><p>Look familiar? That’s right — the only difference is that with class adapter we subclass the Target and the Adaptee, while with object adapter we use composition to pass requests to an Adaptee.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note05"></a>Brain Power</h3><p>Object adapters and class adapters use two different means of adapting the adaptee (composition versus inheritance). How do these implementation differences affect the flexibility of the adapter?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_duck_magnets"></a><h3 class="title">Duck Magnets</h3><p><a class="indexterm" id="part0014_iddle1455"></a><a class="indexterm" id="part0014_iddle1509"></a><a class="indexterm" id="part0014_iddle1519"></a>Your job is to take the duck and turkey magnets and drag them over the part of the diagram that describes the role played by that bird, in our earlier example. (Try not to flip back through the pages.) Then add your own annotations to describe how it works.</p><p><span class="strong"><strong>Class Adapter</strong></span></p><div class="informalfigure"><a id="part0014_med_id00367a"></a><div class="mediaobject"><a id="part0014_med_id00367"></a><img alt="image with no caption" hisrc="figs/web/253fig01.png.jpg" src="../Images/image00864.jpeg"/></div></div><p><span class="strong"><strong>Object Adapter</strong></span></p><div class="informalfigure"><a id="part0014_med_id00368a"></a><div class="mediaobject"><a id="part0014_med_id00368"></a><img alt="image with no caption" hisrc="figs/web/253fig02.png.jpg" src="../Images/image00865.jpeg"/></div></div><div class="informalfigure"><a id="part0014_med_id00369a"></a><div class="mediaobject"><a id="part0014_med_id00369"></a><img alt="image with no caption" hisrc="figs/web/253fig03.png.jpg" src="../Images/image00866.jpeg"/><div class="caption"><p>Drag these onto the class diagram, to show which part of the diagram represents the Duck and which represents the Turkey.</p></div></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_duck_magnets_answer"></a><h3 class="title">Duck Magnets Answer</h3><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note06"></a>Note</h3><p>Note: the class adapter uses multiple inheritance, so you can’t do it in Java...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Class Adapter</strong></span></p><div class="informalfigure"><a id="part0014_med_id00370a"></a><div class="mediaobject"><a id="part0014_med_id00370"></a><img alt="image with no caption" hisrc="figs/web/254fig01.png.jpg" src="../Images/image00867.jpeg"/></div></div><p><span class="strong"><strong>Object Adapter</strong></span></p><div class="informalfigure"><a id="part0014_med_id00371a"></a><div class="mediaobject"><a id="part0014_med_id00371"></a><img alt="image with no caption" hisrc="figs/web/254fig02.png.jpg" src="../Images/image00868.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_fireside_chats-id00072"></a><h3 class="title"><code class="literal">Fireside Chats</code></h3><p><a class="indexterm" id="part0014_iddle1254"></a>Tonight’s talk: <span class="strong"><strong>The Object Adapter and Class Adapter meet face to face.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Object Adapter:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Class Adapter:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Because I use composition I’ve got a leg up. I can not only adapt an adaptee class, but any of its subclasses.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>That’s true, I do have trouble with that because I am committed to one specific adaptee class, but I have a huge advantage because I don’t have to reimplement my entire adaptee. I can also override the behavior of my adaptee if I need to because I’m just subclassing.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>In my part of the world, we like to use composition over inheritance; you may be saving a few lines of code, but all I’m doing is writing a little code to delegate to the adaptee. We like to keep things flexible.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Flexible maybe, but efficient? No. Using a class adapter there is just one of me, not an adapter and an adaptee.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>You’re worried about one little object? You might be able to quickly override a method, but any behavior I add to my adapter code works with my adaptee class <span class="emphasis"><em>and</em></span> all its subclasses.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yeah, but what if a subclass of adaptee adds some new behavior. Then what?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey, come on, cut me a break, I just need to compose with the subclass to make that work.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Sounds messy...</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>You wanna see messy? Look in the mirror!</p></td><td> </td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_real-world_adapters" style="clear: both">Real-world adapters</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1034"></a><a class="indexterm" id="part0014_iddle1496"></a><a class="indexterm" id="part0014_iddle1498"></a><a class="indexterm" id="part0014_iddle1863"></a>Let’s take a look at the use of a simple Adapter in the real world (something more serious than Ducks at least)...</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_old-world_enumerators">Old-world Enumerators</h3></div></div></div><p>If you’ve been around Java for a while you probably remember that the early collection types (Vector, Stack, Hashtable, and a few others) implement a method, elements(), which returns an Enumeration. The Enumeration interface allows you to step through the elements of a collection without knowing the specifics of how they are managed in the collection.</p><div class="informalfigure"><a id="part0014_med_id00372a"></a><div class="mediaobject"><a id="part0014_med_id00372"></a><img alt="image with no caption" hisrc="figs/web/256fig01.png.jpg" src="../Images/image00869.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_new-world_iterators">New-world Iterators</h3></div></div></div><p>The newer Collection classes use an Iterator interface that, like Enumeration, allows you to iterate through a set of items in a collection, but also adds the ability to remove items.</p><div class="informalfigure"><a id="part0014_med_id00373a"></a><div class="mediaobject"><a id="part0014_med_id00373"></a><img alt="image with no caption" hisrc="figs/web/256fig02.png.jpg" src="../Images/image00870.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_and_todayhellip">And today...</h3></div></div></div><p>We are often faced with legacy code that exposes the Enumeration interface, yet we’d like for our new code to use only Iterators. It looks like we need to build an adapter.</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_adapting_an_enumeration_to_an_iterator" style="clear: both">Adapting an Enumeration to an Iterator</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1017"></a><a class="indexterm" id="part0014_iddle1022"></a><a class="indexterm" id="part0014_iddle1497"></a><a class="indexterm" id="part0014_iddle1842"></a>First we’ll look at the two interfaces to figure out how the methods map from one to the other. In other words, we’ll figure out what to call on the adaptee when the client invokes a method on the target.</p><div class="informalfigure"><a id="part0014_med_id00374a"></a><div class="mediaobject"><a id="part0014_med_id00374"></a><img alt="image with no caption" hisrc="figs/web/257fig01.png.jpg" src="../Images/image00871.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_designing_the_adapter">Designing the Adapter</h3></div></div></div><p>Here’s what the classes should look like: we need an adapter that implements the Target interface and that is composed with an adaptee. The hasNext() and next() methods are going to be straightforward to map from target to adaptee: we just pass them right through. But what do you do about remove()? Think about it for a moment (and we’ll deal with it on the next page). For now, here’s the class diagram:</p><div class="informalfigure"><a id="part0014_med_id00375a"></a><div class="mediaobject"><a id="part0014_med_id00375"></a><img alt="image with no caption" hisrc="figs/web/257fig02.png.jpg" src="../Images/image00872.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_dealing_with_the_removeleft_parenthesisr">Dealing with the remove() method</h3></div></div></div><p><a class="indexterm" id="part0014_iddle1019"></a><a class="indexterm" id="part0014_iddle1035"></a><a class="indexterm" id="part0014_iddle1500"></a><a class="indexterm" id="part0014_iddle1853"></a><a class="indexterm" id="part0014_iddle2232"></a>Well, we know Enumeration just doesn’t support remove. It’s a “read only” interface. There’s no way to implement a fully functioning remove() method on the adapter. The best we can do is throw a runtime exception. Luckily, the designers of the Iterator interface foresaw this need and defined the remove() method so that it supports an UnsupportedOperationException.</p><p>This is a case where the adapter isn’t perfect; clients will have to watch out for potential exceptions, but as long as the client is careful and the adapter is well documented this is a perfectly reasonable solution.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_writing_the_enumerationiterator_adapter">Writing the EnumerationIterator adapter</h3></div></div></div><p>Here’s simple but effective code for all those legacy classes still producing Enumerations:</p><div class="informalfigure"><a id="part0014_med_id00376a"></a><div class="mediaobject"><a id="part0014_med_id00376"></a><img alt="image with no caption" hisrc="figs/web/258fig01.png.jpg" src="../Images/image00873.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_exercise-id00073"></a><h3 class="title">Exercise</h3><p><a class="indexterm" id="part0014_iddle1501"></a><a class="indexterm" id="part0014_iddle1590"></a><a class="indexterm" id="part0014_iddle1854"></a>While Java has gone in the direction of the Iterator, there is nevertheless a lot of legacy client code that depends on the Enumeration interface, so an Adapter that converts an Iterator to an Enumeration is also quite useful.</p><p>Write an Adapter that adapts an Iterator to an Enumeration. You can test your code by adapting an ArrayList. The ArrayList class supports the Iterator interface but doesn’t support Enumerations (well, not yet anyway).</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note07"></a>Brain Power</h3><p>Some AC adapters do more than just change the interface — they add other features like surge protection, indicator lights, and other bells and whistles.</p><p>If you were going to implement these kinds of features, what pattern would you use?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_fireside_chats-id00074"></a><h3 class="title"><code class="literal">Fireside Chats</code></h3><p><a class="indexterm" id="part0014_iddle1020"></a><a class="indexterm" id="part0014_iddle1343"></a><a class="indexterm" id="part0014_iddle2026"></a><a class="indexterm" id="part0014_iddle2531"></a>Tonight’s talk: <span class="strong"><strong>The Decorator Pattern and the Adapter Pattern discuss their differences.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Decorator:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Adapter:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I’m important. My job is all about <span class="emphasis"><em>responsibility</em></span> — you know that when a Decorator is involved there’s going to be some new responsibilities or behaviors added to your design.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>You guys want all the glory while us adapters are down in the trenches doing the dirty work: converting interfaces. Our jobs may not be glamorous, but our clients sure do appreciate us making their lives simpler.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>That may be true, but don’t think we don’t work hard. When we have to decorate a big interface, whoa, that can take a lot of code.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Try being an adapter when you’ve got to bring several classes together to provide the interface your client is expecting. Now that’s tough. But we have a saying: “an uncoupled client is a happy client.”</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Cute. Don’t think we get all the glory; sometimes I’m just one decorator that is being wrapped by who knows how many other decorators. When a method call gets delegated to you, you have no idea how many other decorators have already dealt with it and you don’t know that you’ll ever get noticed for your efforts servicing the request.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Hey, if adapters are doing their job, our clients never even know we’re there. It can be a thankless job.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>But, the great thing about us adapters is that we allow clients to make use of new libraries and subsets without changing <span class="emphasis"><em>any</em></span> code; they just rely on us to do the conversion for them. Hey, it’s a niche, but we’re good at it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, us decorators do that as well, only we allow <span class="emphasis"><em>new behavior</em></span> to be added to classes without altering existing code. I still say that adapters are just fancy decorators — I mean, just like us, you wrap an object.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>No, no, no, not at all. We <span class="emphasis"><em>always</em></span> convert the interface of what we wrap; you <span class="emphasis"><em>never</em></span> do. I’d say a decorator is like an adapter; it is just that you don’t change the interface!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Uh, no. Our job in life is to extend the behaviors or responsibilities of the objects we wrap; we aren’t a <span class="emphasis"><em>simple pass through</em></span>.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Hey, who are you calling a simple pass through? Come on down and we’ll see how long <span class="emphasis"><em>you</em></span> last converting a few interfaces!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Maybe we should agree to disagree. We seem to look somewhat similar on paper, but clearly we are <span class="emphasis"><em>miles</em></span> apart in our <span class="emphasis"><em>intent</em></span>.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; "> </td><td style="vertical-align: top; "><p>Oh yeah, I’m with you there.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_and_now_for_something_differenthellip" style="clear: both">And now for something different...</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1028"></a><a class="indexterm" id="part0014_iddle1350"></a><a class="indexterm" id="part0014_iddle1578"></a><a class="indexterm" id="part0014_iddle1595"></a><a class="indexterm" id="part0014_iddle1612"></a><span class="strong"><strong>There’s another pattern in this chapter.</strong></span></p><p>You’ve seen how the Adapter Pattern converts the interface of a class into one that a client is expecting. You also know we achieve this in Java by wrapping the object that has an incompatible interface with an object that implements the correct one.</p><p>We’re going to look at a pattern now that alters an interface, but for a different reason: to simplify the interface. It’s aptly named the Facade Pattern because this pattern hides all the complexity of one or more classes behind a clean, well-lit facade.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_who_does_whatquestion_mark-id00075"></a><h3 class="title">Who Does What?</h3><p>Match each pattern with its intent:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Intent</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Decorator</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Converts one interface to another</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Adapter</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Doesn’t alter the interface, but adds responsibility</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Facade</p></td><td style="vertical-align: top; "><p>Makes an interface simpler</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_home_sweet_home_theater" style="clear: both">Home Sweet Home Theater</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1599"></a><a class="indexterm" id="part0014_iddle1765"></a>Before we dive into the details of the Facade Pattern, let’s take a look at a growing national obsession: building your own home theater.</p><p>You’ve done your research and you’ve assembled a killer system complete with a DVD player, a projection video system, an automated screen, surround sound, and even a popcorn popper.</p><div class="informalfigure"><a id="part0014_med_id00377a"></a><div class="mediaobject"><a id="part0014_med_id00377"></a><img alt="image with no caption" hisrc="figs/web/263fig01.png.jpg" src="../Images/image00874.jpeg"/></div></div><p>Check out all the components you’ve put together:</p><div class="informalfigure"><a id="part0014_med_id00378a"></a><div class="mediaobject"><a id="part0014_med_id00378"></a><img alt="image with no caption" hisrc="figs/web/263fig02.png.jpg" src="../Images/image00875.jpeg"/></div></div><p>You’ve spent weeks running wire, mounting the projector, making all the connections, and fine tuning. Now it’s time to put it all in motion and enjoy a movie...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_watching_a_movie_left_parenthesisthe_har" style="clear: both">Watching a movie (the hard way)</h2></div></div></div><p><span class="strong"><strong>Pick out a DVD, relax, and get ready for movie magic. Oh, there’s just one thing — to watch the movie, you need to perform a few tasks:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Turn on the popcorn popper</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Start the popper popping</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Dim the lights</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Put the screen down</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ Turn the projector on</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑥ Set the projector input to DVD</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑦ Put the projector on wide-screen mode</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑧ Turn the sound amplifier on</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑨ Set the amplifier to DVD input</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑩ Set the amplifier to surround sound</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑪ Set the amplifier volume to medium (5)</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑫ Turn the DVD player on</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑬ Start the DVD player playing</strong></span></li></ul></div><div class="informalfigure"><a id="part0014_med_id00379a"></a><div class="mediaobject"><a id="part0014_med_id00379"></a><img alt="image with no caption" hisrc="figs/web/264fig01.png.jpg" src="../Images/image00876.jpeg"/></div></div><p><span class="strong"><strong>Let’s check out those same tasks in terms of the classes and the method calls needed to perform them:</strong></span></p><div class="informalfigure"><a id="part0014_med_id00380a"></a><div class="mediaobject"><a id="part0014_med_id00380"></a><img alt="image with no caption" hisrc="figs/web/265fig01.png.jpg" src="../Images/image00877.jpeg"/></div></div><p><span class="strong"><strong>But there’s more...</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">When the movie is over, how do you turn everything off? Wouldn’t you have to do all of this over again, in reverse?</li><li class="listitem">Wouldn’t it be as complex to listen to a CD or the radio?</li><li class="listitem">If you decide to upgrade your system, you’re probably going to have to learn a slightly different procedure.</li></ul></div><p>So what to do? The complexity of using your home theater is becoming apparent!</p><p>Let’s see how the Facade Pattern can get us out of this mess so we can enjoy the movie...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_lightscomma_cameracomma_facadeexclamatio" style="clear: both">Lights, Camera, Facade!</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1601"></a><a class="indexterm" id="part0014_iddle1770"></a>A Facade is just what you need: with the Facade Pattern you can take a complex subsystem and make it easier to use by implementing a Facade class that provides one, more reasonable interface. Don’t worry; if you need the power of the complex subsystem, it’s still there for you to use, but if all you need is a straightforward interface, the Facade is there for you.</p><p>Let’s take a look at how the Facade operates:</p><div class="informalfigure"><a id="part0014_med_id00381a"></a><div class="mediaobject"><a id="part0014_med_id00381"></a><img alt="image with no caption" hisrc="figs/web/266fig01.png.jpg" src="../Images/image00878.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_there_are_no_dumb_questions-id00076"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2qe1"></a><a id="part0014_ch07qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0014_iddle1030"></a><a class="indexterm" id="part0014_iddle1495"></a><a class="indexterm" id="part0014_iddle1596"></a><a class="indexterm" id="part0014_iddle1597"></a><a class="indexterm" id="part0014_iddle1598"></a><a class="indexterm" id="part0014_iddle2027"></a><a class="indexterm" id="part0014_iddle2442"></a><a class="indexterm" id="part0014_iddle2532"></a><span class="strong"><strong>Q: If the facade encapsulates the subsystem classes, how does a client that needs lower-level functionality gain access to them?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Facades don’t “encapsulate” the subsystem classes; they merely provide a simplified interface to their functionality. The subsystem classes still remain available for direct use by clients that need to use more specific interfaces. This is a nice property of the Facade Pattern: it provides a simplified interface while still exposing the full functionality of the system to those who may need it.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2qe2"></a><a id="part0014_ch07qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does the facade add any functionality or does it just pass through each request to the subsystem?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> A facade is free to add its own “smarts” in addition to making use of the subsystem. For instance, while our home theater facade doesn’t implement any new behavior, it is smart enough to know that the popcorn popper has to be turned on before it can pop (as well as the details of how to turn on and stage a movie showing).</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2qe3"></a><a id="part0014_ch07qa2q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does each subsystem have only one facade?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Not necessarily. The pattern certainly allows for any number of facades to be created for a given subsystem.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2qe4"></a><a id="part0014_ch07qa2q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: What is the benefit of the facade other than the fact that I now have a simpler interface?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The Facade Pattern also allows you to decouple your client implementation from any one subsystem. Let’s say that you get a big raise and decide to upgrade your home theater to all new components that have different interfaces. Well, if you coded your client to the facade rather than the subsystem, your client code doesn’t need to change, just the facade (and hopefully the manufacturer is supplying that!).</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2qe5"></a><a id="part0014_ch07qa2q5"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: So the way to tell the difference between the Adapter Pattern and the Facade Pattern is that the adapter wraps one class and the facade may represent many classes?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa2q5a5"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No! Remember, the Adapter Pattern changes the interface of one or more classes into one interface that a client is expecting. While most textbook examples show the adapter adapting one class, you may need to adapt many classes to provide the interface a client is coded to. Likewise, a Facade may provide a simplified interface to a single class with a very complex interface.</div><div>The difference between the two is not in terms of how many classes they “wrap,” it is in their intent. The intent of the Adapter Pattern is to alter an interface so that it matches one a client is expecting. The intent of the Facade Pattern is to provide a simplified interface to a subsystem.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>A facade not only simplifies an interface, it decouples a client from a subsystem of components.</strong></span></div><div><span class="strong"><strong>Facades and adapters may wrap multiple classes, but a facade’s intent is to simplify, while an adapter’s is to convert the interface to something different.</strong></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_constructing_your_home_theater_facade" style="clear: both">Constructing your home theater facade</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1600"></a><a class="indexterm" id="part0014_iddle1766"></a>Let’s step through the construction of the HomeTheaterFacade. The first step is to use composition so that the facade has access to all the components of the subsystem:</p><div class="informalfigure"><a id="part0014_med_id00382a"></a><div class="mediaobject"><a id="part0014_med_id00382"></a><img alt="image with no caption" hisrc="figs/web/269fig01.png.jpg" src="../Images/image00879.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_implementing_the_simplified_interface" style="clear: both">Implementing the simplified interface</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1602"></a><a class="indexterm" id="part0014_iddle1767"></a>Now it’s time to bring the components of the subsystem together into a unified interface. Let’s implement the watchMovie() and endMovie() methods:</p><div class="informalfigure"><a id="part0014_med_id00383a"></a><div class="mediaobject"><a id="part0014_med_id00383"></a><img alt="image with no caption" hisrc="figs/web/270fig01.png.jpg" src="../Images/image00880.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note08"></a>Brain Power</h3><p>Think about the facades you’ve encountered in the Java API. Where would you like to have a few new ones?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_time_to_watch_a_movie_left_parenthesisth" style="clear: both">Time to watch a movie (the easy way)</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1603"></a><a class="indexterm" id="part0014_iddle1769"></a>It’s SHOWTIME!</p><div class="informalfigure"><a id="part0014_med_id00384a"></a><div class="mediaobject"><a id="part0014_med_id00384"></a><img alt="image with no caption" hisrc="figs/web/common13.png.jpg" src="../Images/image00881.jpeg"/></div></div><div class="informalfigure"><a id="part0014_med_id00385a"></a><div class="mediaobject"><a id="part0014_med_id00385"></a><img alt="image with no caption" hisrc="figs/web/271fig01.png.jpg" src="../Images/image00882.jpeg"/></div></div><div class="informalfigure"><a id="part0014_med_id00386a"></a><div class="mediaobject"><a id="part0014_med_id00386"></a><img alt="image with no caption" hisrc="figs/web/271fig02.png.jpg" src="../Images/image00883.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_facade_pattern_defined" style="clear: both">Facade Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1604"></a><a class="indexterm" id="part0014_iddle1606"></a>To use the Facade Pattern, we create a class that simplifies and unifies a set of more complex classes that belong to some subsystem. Unlike a lot of patterns, Facade is fairly straightforward; there are no mind-bending abstractions to get your head around. But that doesn’t make it any less powerful: the Facade Pattern allows us to avoid tight coupling between clients and subsystems, and, as you will see shortly, also helps us adhere to a new object-oriented principle.</p><p>Before we introduce that new principle, let’s take a look at the official definition of the pattern:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note09"></a>Note</h3><p><span class="strong"><strong>The Facade Pattern</strong></span> provides a unified interface to a set of interfaces in a subsystem. Facade defines a higher-level interface that makes the subsystem easier to use.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>There isn’t a lot here that you don’t already know, but one of the most important things to remember about a pattern is its intent. This definition tells us loud and clear that the purpose of the facade is to make a subsystem easier to use through a simplified interface. You can see this in the pattern’s class diagram:</p><div class="informalfigure"><a id="part0014_med_id00387a"></a><div class="mediaobject"><a id="part0014_med_id00387"></a><img alt="image with no caption" hisrc="figs/web/272fig01.png.jpg" src="../Images/image00884.jpeg"/></div></div><p>That’s it; you’ve got another pattern under your belt! Now, it’s time for that new OO principle. Watch out, this one can challenge some assumptions!</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_principle_of_least_knowledge" style="clear: both">The Principle of Least Knowledge</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1224"></a><a class="indexterm" id="part0014_iddle1418"></a><a class="indexterm" id="part0014_iddle1912"></a><a class="indexterm" id="part0014_iddle2018"></a><a class="indexterm" id="part0014_iddle2137"></a>The Principle of Least Knowledge guides us to reduce the interactions between objects to just a few close “friends.” The principle is usually stated as:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note10"></a>Design Principle</h3><p><span class="emphasis"><em>Principle of Least Knowledge: talk only to your immediate friends.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>But what does this mean in real terms? It means when you are designing a system, for any object, be careful of the number of classes it interacts with and also how it comes to interact with those classes.</p><p>This principle prevents us from creating designs that have a large number of classes coupled together so that changes in one part of the system cascade to other parts. When you build a lot of dependencies between many classes, you are building a fragile system that will be costly to maintain and complex for others to understand.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note11"></a>Brain Power</h3><p>How many classes is this code coupled to?</p><a id="part0014_pro_id00028"></a><pre class="programlisting"><span class="strong"><strong>public float getTemp() {</strong></span>
    <span class="strong"><strong>return station.getThermometer().getTemperature();</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_how_not_to_win_friends_and_influence_obj" style="clear: both">How NOT to Win Friends and Influence Objects</h2></div></div></div><p>Okay, but how do you keep from doing this? The principle provides some guidelines: take any object; now from any method in that object, the principle tells us that we should only invoke methods that belong to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The object itself</li><li class="listitem">Objects passed in as a parameter to the method</li><li class="listitem">Any object the method creates or instantiates<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note11a"></a>Note</h3><p>Notice that these guidelines tell us not to call methods on objects that were returned from calling other methods!!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem">Any components of the object<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note11b"></a>Note</h3><p>Think of a “component” as any object that is referenced by an instance variable. In other words, think of this as a HAS-A relationship.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li></ul></div><p>This sounds kind of stringent doesn’t it? What’s the harm in calling the method of an object we get back from another call? Well, if we were to do that, then we’d be making a request of another object’s subpart (and increasing the number of objects we directly know). In such cases, the principle forces us to ask the object to make the request for us; that way we don’t have to know about its component objects (and we keep our circle of friends small). For example:</p><div class="informalfigure"><a id="part0014_med_id00388a"></a><div class="mediaobject"><a id="part0014_med_id00388"></a><img alt="image with no caption" hisrc="figs/web/274fig01.png.jpg" src="../Images/image00885.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0014_keeping_your_method_calls_in_boundshelli">Keeping your method calls in bounds...</h3></div></div></div><p><a class="indexterm" id="part0014_iddle1879"></a>Here’s a Car class that demonstrates all the ways you can call methods and still adhere to the Principle of Least Knowledge:</p><div class="informalfigure"><a id="part0014_med_id00389a"></a><div class="mediaobject"><a id="part0014_med_id00389"></a><img alt="image with no caption" hisrc="figs/web/275fig01.png.jpg" src="../Images/image00886.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_there_are_no_dumb_questions-id00077"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa3qe1"></a><a id="part0014_ch07qa3q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: There is another principle called the Law of Demeter; how are they related?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa3q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The two are one and the same and you’ll encounter these terms being used interchangeably. We prefer to use the Principle of Least Knowledge for a couple of reasons: (1) the name is more intuitive and (2) the use of the word “Law” implies we always have to apply this principle. In fact, no principle is a law, all principles should be used when and where they are helpful. All design involves tradeoffs (abstractions versus speed, space versus time, and so on) and while principles provide guidance, all factors should be taken into account before applying them.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa3qe2"></a><a id="part0014_ch07qa3q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Are there any disadvantages to applying the Principle of Least Knowledge?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa3q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes; while the principle reduces the dependencies between objects and studies have shown this reduces software maintenance, it is also the case that applying this principle results in more “wrapper” classes being written to handle method calls to other components. This can result in increased complexity and development time as well as decreased runtime performance.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_sharpen_your_pencil-id00078"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0014_iddle1541"></a><a class="indexterm" id="part0014_iddle1768"></a><a class="indexterm" id="part0014_iddle2283"></a>Do either of these classes violate the Principle of Least Knowledge? Why or why not?</p><div class="informalfigure"><a id="part0014_med_id00390a"></a><div class="mediaobject"><a id="part0014_med_id00390"></a><img alt="image with no caption" hisrc="figs/web/276fig01.png.jpg" src="../Images/image00887.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0014_ch07note12"></a>Brain Power</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa4qe1"></a><a id="part0014_ch07qa4q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div>Can you think of a common use of Java that violates the Principle of Least Knowledge?</div><div>Should you care?</div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0014_ch07qa4q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div>Answer: How about System.out.println()?</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_facade_and_the_principle_of_least_knowle" style="clear: both">The Facade and the Principle of Least Knowledge</h2></div></div></div><div class="informalfigure"><a id="part0014_med_id00391a"></a><div class="mediaobject"><a id="part0014_med_id00391"></a><img alt="image with no caption" hisrc="figs/web/277fig01.png.jpg" src="../Images/image00888.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0014_tools_for_your_design_toolbox-id00079" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p><a class="indexterm" id="part0014_iddle1614"></a>Your toolbox is starting to get heavy! In this chapter we’ve added a couple of patterns that allow us to alter interfaces and reduce coupling between clients and the systems they use.</p><div class="informalfigure"><a id="part0014_med_id00392a"></a><div class="mediaobject"><a id="part0014_med_id00392"></a><img alt="image with no caption" hisrc="figs/web/278fig01.png.jpg" src="../Images/image00889.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_bullet_points-id00080"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">When you need to use an existing class and its interface is not the one you need, use an adapter.</li><li class="listitem">When you need to simplify and unify a large interface or complex set of interfaces, use a facade.</li><li class="listitem">An adapter changes an interface into one a client expects.</li><li class="listitem">A facade decouples a client from a complex subsystem.</li><li class="listitem">Implementing an adapter may require little work or a great deal of work depending on the size and complexity of the target interface.</li><li class="listitem">Implementing a facade requires that we compose the facade with its subsystem and use delegation to perform the work of the facade.</li><li class="listitem">There are two forms of the Adapter Pattern: object and class adapters. Class adapters require multiple inheritance.</li><li class="listitem">You can implement more than one facade for a subsystem.</li><li class="listitem">An adapter wraps an object to change its interface, a decorator wraps an object to add new behaviors and responsibilities, and a facade “wraps” a set of objects to simplify.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_design_patterns_crossword-id00081"></a><h3 class="title">Design Patterns Crossword</h3><p>Yes, it’s another crossword. All of the solution words are from this chapter.</p><div class="informalfigure"><a id="part0014_med_id00393a"></a><div class="mediaobject"><a id="part0014_med_id00393"></a><img alt="image with no caption" hisrc="figs/web/279fig01.png" src="../Images/image00890.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. True or false? Adapters can wrap only one object.</p>
<p>5. An Adapter __________ an interface.</p>
<p>6. Movie we watched (five words).</p>
<p>10. If in Britain, you might need one of these (two words).</p>
<p>11. Adapter with two roles (two words).</p>
<p>14. Facade still ________ low-level access.</p>
<p>15. Ducks do it better than Turkeys.</p>
<p>16. Disadvantage of the Principle of Least Knowledge: too many __________.</p>
<p>17. A __________ simplifies an interface.</p>
<p>19. New American dream (two words).</p></td><td style="vertical-align: top; "><p>2. Decorator called Adapter this (three words).</p>
<p>3. One advantage of Facade.</p>
<p>4. Principle that wasn’t as easy as it sounded (two words).</p>
<p>7. A __________ adds new behavior.</p>
<p>8. Masquerading as a Duck.</p>
<p>9. Example that violates the Principle of Least Knowledge: System.out.__________.</p>
<p>12. No movie is complete without this.</p>
<p>13. Adapter client uses the __________ interface.</p>
<p>18. An Adapter and a Decorator can be said to ________ an object.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_sharpen_your_pencil_solution-id00082"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0014_iddle1109"></a><a class="indexterm" id="part0014_iddle1542"></a><a class="indexterm" id="part0014_iddle1569"></a><a class="indexterm" id="part0014_iddle2284"></a><a class="indexterm" id="part0014_iddle2314"></a>Let’s say we also need an Adapter that converts a Duck to a Turkey. Let’s call it DuckAdapter. Here’s our solution:</p><div class="informalfigure"><a id="part0014_med_id00394a"></a><div class="mediaobject"><a id="part0014_med_id00394"></a><img alt="image with no caption" hisrc="figs/web/280fig01.png.jpg" src="../Images/image00891.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_sharpen_your_pencil_solution-id00083"></a><h3 class="title">Sharpen your pencil Solution</h3><p>Do either of these classes violate the Principle of Least Knowledge? Why or why not?</p><div class="informalfigure"><a id="part0014_med_id00395a"></a><div class="mediaobject"><a id="part0014_med_id00395"></a><img alt="image with no caption" hisrc="figs/web/280fig02.png.jpg" src="../Images/image00892.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_exercise_solution-id00084"></a><h3 class="title">Exercise Solution</h3><p><a class="indexterm" id="part0014_iddle1029"></a><a class="indexterm" id="part0014_iddle1351"></a><a class="indexterm" id="part0014_iddle1502"></a><a class="indexterm" id="part0014_iddle1579"></a><a class="indexterm" id="part0014_iddle1591"></a><a class="indexterm" id="part0014_iddle1613"></a><a class="indexterm" id="part0014_iddle1855"></a><a class="indexterm" id="part0014_iddle2516"></a>You’ve seen how to implement an adapter that adapts an Enumeration to an Iterator; now write an adapter that adapts an Iterator to an Enumeration.</p><div class="informalfigure"><a id="part0014_med_id00396a"></a><div class="mediaobject"><a id="part0014_med_id00396"></a><img alt="image with no caption" hisrc="figs/web/281fig01.png.jpg" src="../Images/image00893.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_who_does_whatquestion_mark_solut-id00085"></a><h3 class="title">Who Does What? Solution</h3><p>Match each pattern with its intent:</p><div class="informalfigure"><a id="part0014_med_id00397a"></a><div class="mediaobject"><a id="part0014_med_id00397"></a><img alt="image with no caption" hisrc="figs/web/281fig02.png.jpg" src="../Images/image00894.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0014_design_patterns_crossword_soluti-id00086"></a><h3 class="title">Design Patterns Crossword Solution</h3><div class="informalfigure"><a id="part0014_med_id00398a"></a><div class="mediaobject"><a id="part0014_med_id00398"></a><img alt="image with no caption" hisrc="figs/web/282fig01.png" src="../Images/image00895.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0015_template_method_pattern_encapsulating_al"><div class="titlepage" id="part0015_aid-E9OE2"><div><div><h2 class="title">Chapter 8. The Template Method Pattern: Encapsulating Algorithms</h2></div></div></div><div class="informalfigure"><a id="part0015_med_id00399a"></a><div class="mediaobject"><a id="part0015_med_id00399"></a><img alt="image with no caption" hisrc="figs/web/283fig01.png.jpg" src="../Images/image00896.jpeg"/></div></div><p><a class="indexterm" id="part0015_iddle1045"></a><a class="indexterm" id="part0015_iddle1474"></a><span class="strong"><strong>We’re on an encapsulation roll; we’ve encapsulated object creation, method invocation, complex interfaces, ducks, pizzas...what could be next?</strong></span> We’re going to get down to encapsulating pieces of algorithms so that subclasses can hook themselves right into a computation anytime they want. We’re even going to learn about a design principle inspired by Hollywood.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_itapostrophes_time_for_some_more_caffein" style="clear: both">It’s time for some more caffeine</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1436"></a><a class="indexterm" id="part0015_iddle2354"></a>Some people can’t live without their coffee; some people can’t live without their tea. The common ingredient? Caffeine, of course!</p><p>But there’s more; tea and coffee are made in very similar ways. Let’s check it out:</p><div class="informalfigure"><a id="part0015_med_id00400a"></a><div class="mediaobject"><a id="part0015_med_id00400"></a><img alt="image with no caption" hisrc="figs/web/284fig01.png.jpg" src="../Images/image00897.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_whipping_up_some_coffee_and_tea_classes" style="clear: both">Whipping up some coffee and tea classes (in Java)</h2></div></div></div><p>Let’s play “coding barista” and write some code for creating coffee and tea.</p><div class="informalfigure"><a id="part0015_med_id00401a"></a><div class="mediaobject"><a id="part0015_med_id00401"></a><img alt="image with no caption" hisrc="figs/web/285fig01.png.jpg" src="../Images/image00898.jpeg"/></div></div><p>Here’s the coffee:</p><div class="informalfigure"><a id="part0015_med_id00402a"></a><div class="mediaobject"><a id="part0015_med_id00402"></a><img alt="image with no caption" hisrc="figs/web/285fig02.png.jpg" src="../Images/image00899.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_and_now_the_teahellip" style="clear: both">And now the Tea...</h2></div></div></div><div class="informalfigure"><a id="part0015_med_id00403a"></a><div class="mediaobject"><a id="part0015_med_id00403"></a><img alt="image with no caption" hisrc="figs/web/286fig01.png.jpg" src="../Images/image00900.jpeg"/></div></div><div class="informalfigure"><a id="part0015_med_id00404a"></a><div class="mediaobject"><a id="part0015_med_id00404"></a><img alt="image with no caption" hisrc="figs/web/286fig02.png.jpg" src="../Images/image00901.jpeg"/></div></div><div class="informalfigure"><a id="part0015_med_id00405a"></a><div class="mediaobject"><a id="part0015_med_id00405"></a><img alt="image with no caption" hisrc="figs/web/286fig03.png.jpg" src="../Images/image00902.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_design_puzzle-id00087"></a><h3 class="title">Design Puzzle</h3><p><a class="indexterm" id="part0015_iddle1516"></a>You’ve seen that the Coffee and Tea classes have a fair bit of code duplication. Take another look at the Coffee and Tea classes and draw a class diagram showing how you’d redesign the classes to remove redundancy:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_sircomma_may_i_abstract_your_coffeecomma" style="clear: both">Sir, may I abstract your Coffee, Tea?</h2></div></div></div><p>It looks like we’ve got a pretty straightforward design exercise on our hands with the Coffee and Tea classes. Your first cut might have looked something like this:</p><div class="informalfigure"><a id="part0015_med_id00406a"></a><div class="mediaobject"><a id="part0015_med_id00406"></a><img alt="image with no caption" hisrc="figs/web/288fig01.png.jpg" src="../Images/image00903.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note01"></a>Brain Power</h3><p>Did we do a good job on the redesign? Hmmmm, take another look. Are we overlooking some other commonality? What are other ways that Coffee and Tea are similar?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_taking_the_design_furtherhellip" style="clear: both">Taking the design further...</h2></div></div></div><p>So what else do Coffee and Tea have in common? Let’s start with the recipes.</p><div class="informalfigure"><a id="part0015_med_id00407a"></a><div class="mediaobject"><a id="part0015_med_id00407"></a><img alt="image with no caption" hisrc="figs/web/289fig01.png.jpg" src="../Images/image00904.jpeg"/></div></div><p>Notice that both recipes follow the same algorithm:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Boil some water.</strong></span><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note01a"></a>Note</h3><p>These two are already abstracted into the base class.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Use the hot water to extract the coffee or tea.</strong></span><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note01b"></a>Note</h3><p>These aren’t abstracted but are the same; they just apply to different beverages.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Pour the resulting beverage into a cup.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Add the appropriate condiments to the beverage.</strong></span></li></ul></div><p>So, can we find a way to abstract prepareRecipe() too? Yes, let’s find out...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_abstracting_preparerecipeleft_parenthesi" style="clear: both">Abstracting prepareRecipe()</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1046"></a><a class="indexterm" id="part0015_iddle1475"></a><a class="indexterm" id="part0015_iddle2136"></a><a class="indexterm" id="part0015_iddle2355"></a>Let’s step through abstracting prepareRecipe() from each subclass (that is, the Coffee and Tea classes)...</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① The first problem we have is that Coffee uses brewCoffeeGrinds() and addSugarAndMilk() methods, while Tea uses steepTeaBag() and addLemon() methods.<div class="informalfigure"><a id="part0015_med_id00408a"></a><div class="mediaobject"><a id="part0015_med_id00408"></a><img alt="image with no caption" hisrc="figs/web/290fig01.png.jpg" src="../Images/image00905.jpeg"/></div></div><br/>Let’s think through this: steeping and brewing aren’t so different; they’re pretty analogous. So let’s make a new method name, say, brew(), and we’ll use the same name whether we’re brewing coffee or steeping tea.<br/>Likewise, adding sugar and milk is pretty much the same as adding a lemon: both are adding condiments to the beverage. Let’s also make up a new method name, addCondiments(), to handle this. So, our new prepareRecipe() method will look like this:<a id="part0015_pro_id00029"></a><pre class="programlisting">void prepareRecipe() {
    boilWater();
    <span class="gray-background">brew();</span>
    pourInCup();
    <span class="gray-background">addCondiments();</span>
}</pre></li><li class="listitem" style="list-style-type: none">② Now we have a new prepareRecipe() method, but we need to fit it into the code. To do this we are going to start with the CaffeineBeverage superclass:<div class="informalfigure"><a id="part0015_med_id00409a"></a><div class="mediaobject"><a id="part0015_med_id00409"></a><img alt="image with no caption" hisrc="figs/web/291fig01.png.jpg" src="../Images/image00906.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ Finally, we need to deal with the Coffee and Tea classes. They now rely on CaffeineBeverage to handle the recipe, so they just need to handle brewing and condiments:<div class="informalfigure"><a id="part0015_med_id00410a"></a><div class="mediaobject"><a id="part0015_med_id00410"></a><img alt="image with no caption" hisrc="figs/web/291fig02.png.jpg" src="../Images/image00907.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_sharpen_your_pencil-id00088"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0015_iddle1537"></a><a class="indexterm" id="part0015_iddle2276"></a>Draw the new class diagram now that we’ve moved the implementation of prepareRecipe() into the CaffeineBeverage class:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_what_have_we_donequestion_mark-id00089" style="clear: both">What have we done?</h2></div></div></div><div class="informalfigure"><a id="part0015_med_id00411a"></a><div class="mediaobject"><a id="part0015_med_id00411"></a><img alt="image with no caption" hisrc="figs/web/293fig01.png.jpg" src="../Images/image00908.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_meet_the_template_method" style="clear: both">Meet the Template Method</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1047"></a><a class="indexterm" id="part0015_iddle1476"></a><a class="indexterm" id="part0015_iddle2356"></a><a class="indexterm" id="part0015_iddle2438"></a><a class="indexterm" id="part0015_iddle2452"></a>We’ve basically just implemented the Template Method Pattern. What’s that? Let’s look at the structure of the CaffeineBeverage class; it contains the actual “template method”:</p><div class="informalfigure"><a id="part0015_med_id00412a"></a><div class="mediaobject"><a id="part0015_med_id00412"></a><img alt="image with no caption" hisrc="figs/web/294fig01.png.jpg" src="../Images/image00909.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>The Template Method defines the steps of an algorithm and allows subclasses to provide the implementation for one or more steps.</strong></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_letapostrophes_make_some_teahellip" style="clear: both">Let’s make some tea...</h2></div></div></div><div class="informalfigure"><a id="part0015_med_id00413a"></a><div class="mediaobject"><a id="part0015_med_id00413"></a><img alt="image with no caption" hisrc="figs/web/common17.png.jpg" src="../Images/image00686.jpeg"/></div></div><p><span class="strong"><strong>Behind the Scenes</strong></span></p><p>Let’s step through making a tea and trace through how the template method works. You’ll see that the template method controls the algorithm; at certain points in the algorithm, it lets the subclass supply the implementation of the steps...</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Okay, first we need a Tea object...<a id="part0015_pro_id00030"></a><pre class="programlisting">Tea myTea = new Tea();</pre></li><li class="listitem" style="list-style-type: none">② Then we call the template method:<div class="informalfigure"><a id="part0015_med_id00414a"></a><div class="mediaobject"><a id="part0015_med_id00414"></a><img alt="image with no caption" hisrc="figs/web/295fig01.png.jpg" src="../Images/image00910.jpeg"/></div></div><br/>which follows the algorithm for making caffeine beverages...</li><li class="listitem" style="list-style-type: none">③ First we boil water:<div class="informalfigure"><a id="part0015_med_id00415a"></a><div class="mediaobject"><a id="part0015_med_id00415"></a><img alt="image with no caption" hisrc="figs/web/295fig02.png.jpg" src="../Images/image00911.jpeg"/></div></div><br/>which happens in CaffeineBeverage.</li><li class="listitem" style="list-style-type: none">④ Next we need to brew the tea, which only the subclass knows how to do:<a id="part0015_pro_id00031"></a><pre class="programlisting">brew();</pre></li><li class="listitem" style="list-style-type: none">⑤ Now we pour the tea in the cup; this is the same for all beverages so it happens in CaffeineBeverage:<a id="part0015_pro_id00032"></a><pre class="programlisting">pourInCup();</pre></li><li class="listitem" style="list-style-type: none">⑥ Finally, we add the condiments, which are specific to each beverage, so the subclass implements this:<a id="part0015_pro_id00033"></a><pre class="programlisting">addCondiments();</pre></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_what_did_the_template_method_get_usquest" style="clear: both">What did the Template Method get us?</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0015_inline_id00032"></a><img alt="" hisrc="figs/web/296fig01.png.jpg" src="../Images/image00912.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0015_inline_id00033"></a><img alt="" hisrc="figs/web/296fig02.png.jpg" src="../Images/image00913.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Underpowered Tea &amp; Coffee implementation</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>New, hip CaffeineBeverage powered by Template Method</strong></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Coffee and Tea are running the show; they control the algorithm.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The CaffeineBeverage class runs the show; it has the algorithm, and protects it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Code is duplicated across Coffee and Tea.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The CaffeineBeverage class maximizes reuse among the subclasses.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Code changes to the algorithm require opening the subclasses and making multiple changes.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The algorithm lives in one place and code changes only need to be made there.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Classes are organized in a structure that requires a lot of work to add a new caffeine beverage.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Template Method version provides a framework that other caffeine beverages can be plugged into. New caffeine beverages only need to implement a couple of methods.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Knowledge of the algorithm and how to implement it is distributed over many classes.</p></td><td style="vertical-align: top; "><p>The CaffeineBeverage class concentrates knowledge about the algorithm and relies on subclasses to provide complete implementations.</p></td></tr></tbody></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_template_method_pattern_defined" style="clear: both">Template Method Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1050"></a><a class="indexterm" id="part0015_iddle1479"></a><a class="indexterm" id="part0015_iddle2358"></a><a class="indexterm" id="part0015_iddle2457"></a><a class="indexterm" id="part0015_iddle2459"></a>You’ve seen how the Template Method Pattern works in our Tea and Coffee example; now, check out the official definition and nail down all the details:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note02"></a>Note</h3><p><span class="strong"><strong>The Template Method Pattern</strong></span> defines the skeleton of an algorithm in a method, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing the algorithm’s structure.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>This pattern is all about creating a template for an algorithm. What’s a template? As you’ve seen it’s just a method; more specifically, it’s a method that defines an algorithm as a set of steps. One or more of these steps is defined to be abstract and implemented by a subclass. This ensures the algorithm’s structure stays unchanged, while subclasses provide some part of the implementation.</p><p>Let’s check out the class diagram:</p><div class="informalfigure"><a id="part0015_med_id00416a"></a><div class="mediaobject"><a id="part0015_med_id00416"></a><img alt="image with no caption" hisrc="figs/web/297fig01.png.jpg" src="../Images/image00914.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_code_up_close-id00090"></a><h3 class="title">Code Up Close</h3><p><a class="indexterm" id="part0015_iddle1002"></a><a class="indexterm" id="part0015_iddle1049"></a><a class="indexterm" id="part0015_iddle1478"></a><a class="indexterm" id="part0015_iddle2357"></a><a class="indexterm" id="part0015_iddle2453"></a><a class="indexterm" id="part0015_iddle2458"></a>Let’s take a closer look at how the AbstractClass is defined, including the template method and primitive operations.</p><div class="informalfigure"><a id="part0015_med_id00417a"></a><div class="mediaobject"><a id="part0015_med_id00417"></a><img alt="image with no caption" hisrc="figs/web/298fig01.png.jpg" src="../Images/image00915.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_code_way_up_close"></a><h3 class="title">Code Way Up Close</h3><p><a class="indexterm" id="part0015_iddle1003"></a><a class="indexterm" id="part0015_iddle1052"></a><a class="indexterm" id="part0015_iddle1297"></a><a class="indexterm" id="part0015_iddle1481"></a><a class="indexterm" id="part0015_iddle1771"></a><a class="indexterm" id="part0015_iddle1914"></a><a class="indexterm" id="part0015_iddle2360"></a><a class="indexterm" id="part0015_iddle2455"></a><a class="indexterm" id="part0015_iddle2467"></a>Now we’re going to look even closer at the types of method that can go in the abstract class:</p><div class="informalfigure"><a id="part0015_med_id00418a"></a><div class="mediaobject"><a id="part0015_med_id00418"></a><img alt="image with no caption" hisrc="figs/web/299fig01.png.jpg" src="../Images/image00916.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_hooked_on_template_methodhellip" style="clear: both">Hooked on Template Method...</h2></div></div></div><p>A hook is a method that is declared in the abstract class, but only given an empty or default implementation. This gives subclasses the ability to “hook into” the algorithm at various points, if they wish; a subclass is also free to ignore the hook.</p><div class="informalfigure"><a id="part0015_med_id00419a"></a><div class="mediaobject"><a id="part0015_med_id00419"></a><img alt="image with no caption" hisrc="figs/web/300fig01.png.jpg" src="../Images/image00917.jpeg"/></div></div><p>There are several uses of hooks; let’s take a look at one now. We’ll talk about a few other uses later:</p><div class="informalfigure"><a id="part0015_med_id00420a"></a><div class="mediaobject"><a id="part0015_med_id00420"></a><img alt="image with no caption" hisrc="figs/web/300fig02.png.jpg" src="../Images/image00918.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_using_the_hook" style="clear: both">Using the hook</h2></div></div></div><p>To use the hook, we override it in our subclass. Here, the hook controls whether the CaffeineBeverage evaluates a certain part of the algorithm; that is, whether it adds a condiment to the beverage.</p><p>How do we know whether the customer wants the condiment? Just ask!</p><div class="informalfigure"><a id="part0015_med_id00421a"></a><div class="mediaobject"><a id="part0015_med_id00421"></a><img alt="image with no caption" hisrc="figs/web/301fig01.png.jpg" src="../Images/image00919.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_letapostrophes_run_the_test_drive" style="clear: both">Let’s run the Test Drive</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1056"></a><a class="indexterm" id="part0015_iddle1485"></a><a class="indexterm" id="part0015_iddle2361"></a><a class="indexterm" id="part0015_iddle2474"></a>Okay, the water’s boiling... Here’s the test code where we create a hot tea and a hot coffee.</p><div class="informalfigure"><a id="part0015_med_id00422a"></a><div class="mediaobject"><a id="part0015_med_id00422"></a><img alt="image with no caption" hisrc="figs/web/302fig01.png.jpg" src="../Images/image00920.jpeg"/></div></div><p><span class="strong"><strong>And let’s give it a run...</strong></span></p><div class="informalfigure"><a id="part0015_med_id00423a"></a><div class="mediaobject"><a id="part0015_med_id00423"></a><img alt="image with no caption" hisrc="figs/web/302fig02.png.jpg" src="../Images/image00921.jpeg"/></div></div><div class="informalfigure"><a id="part0015_med_id00424a"></a><div class="mediaobject"><a id="part0015_med_id00424"></a><img alt="image with no caption" hisrc="figs/web/303fig01.png.jpg" src="../Images/image00922.jpeg"/></div></div><p><a class="indexterm" id="part0015_iddle1298"></a><a class="indexterm" id="part0015_iddle2454"></a><a class="indexterm" id="part0015_iddle2468"></a>You know what? We agree with you. But you have to admit before you thought of that, it was a pretty cool example of how a hook can be used to conditionally control the flow of the algorithm in the abstract class. Right?</p><p>We’re sure you can think of many other more realistic scenarios where you could use the template method and hooks in your own code.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_there_are_no_dumb_questions-id00091"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1qe1"></a><a id="part0015_ch08qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: When I’m creating a template method, how do I know when to use abstract methods and when to use hooks?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Use abstract methods when your subclass MUST provide an implementation of the method or step in the algorithm. Use hooks when that part of the algorithm is optional. With hooks, a subclass may choose to implement that hook, but it doesn’t have to.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1qe2"></a><a id="part0015_ch08qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: What are hooks really supposed to be used for?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> There are a few uses of hooks. As we just said, a hook may provide a way for a subclass to implement an optional part of an algorithm, or if it isn’t important to the subclass’s implementation, it can skip it. Another use is to give the subclass a chance to react to some step in the template method that is about to happen, or just happened. For instance, a hook method like justReOrderedList() allows the subclass to perform some activity (such as redisplaying an onscreen representation) after an internal list is reordered. As you’ve seen, a hook can also provide a subclass with the ability to make a decision for the abstract class.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1qe3"></a><a id="part0015_ch08qa1q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does a subclass have to implement all the abstract methods in the AbstractClass?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes, each concrete subclass defines the entire set of abstract methods and provides a complete implementation of the undefined steps of the template method’s algorithm.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1qe4"></a><a id="part0015_ch08qa1q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: It seems like I should keep my abstract methods small in number; otherwise, it will be a big job to implement them in the subclass.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa1q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> That’s a good thing to keep in mind when you write template methods. Sometimes this can be done by not making the steps of your algorithm too granular. But it’s obviously a trade off: the less granularity, the less flexibility.</div><div>Remember, too, that some steps will be optional; so you can implement these as hooks rather than abstract methods, easing the burden on the subclasses of your abstract class.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_hollywood_principle" style="clear: both">The Hollywood Principle</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1051"></a><a class="indexterm" id="part0015_iddle1372"></a><a class="indexterm" id="part0015_iddle1410"></a><a class="indexterm" id="part0015_iddle1480"></a><a class="indexterm" id="part0015_iddle1731"></a><a class="indexterm" id="part0015_iddle2359"></a><a class="indexterm" id="part0015_iddle2466"></a>We’ve got another design principle for you; it’s called the Hollywood Principle:</p><div class="informalfigure"><a id="part0015_med_id00425a"></a><div class="mediaobject"><a id="part0015_med_id00425"></a><img alt="image with no caption" hisrc="figs/web/304fig01.png.jpg" src="../Images/image00923.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note03"></a>Note</h3><p><span class="bolditalic">The Hollywood Principle</span></p><p><span class="emphasis"><em>Don’t call us, we’ll call you.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Easy to remember, right? But what has it got to do with OO design?</p><p>The Hollywood Principle gives us a way to prevent “dependency rot.” Dependency rot happens when you have high-level components depending on low-level components depending on high-level components depending on sideways components depending on low-level components, and so on. When rot sets in, no one can easily understand the way a system is designed.</p><p>With the Hollywood Principle, we allow low-level components to hook themselves into a system, but the high-level components determine when they are needed, and how. In other words, the high-level components give the low-level components a “don’t call us, we’ll call you” treatment.</p><div class="informalfigure"><a id="part0015_med_id00426a"></a><div class="mediaobject"><a id="part0015_med_id00426"></a><img alt="image with no caption" hisrc="figs/web/304fig02.png.jpg" src="../Images/image00924.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_hollywood_principle_and_template_method" style="clear: both">The Hollywood Principle and Template Method</h2></div></div></div><p>The connection between the Hollywood Principle and the Template Method Pattern is probably somewhat apparent: when we design with the Template Method Pattern, we’re telling subclasses, “don’t call us, we’ll call you.” How? Let’s take another look at our CaffeineBeverage design:</p><div class="informalfigure"><a id="part0015_med_id00427a"></a><div class="mediaobject"><a id="part0015_med_id00427"></a><img alt="image with no caption" hisrc="figs/web/305fig01.png.jpg" src="../Images/image00925.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note04"></a>Brain Power</h3><p>What other patterns make use of the Hollywood Principle?</p><p>The Factory Method, Observer; any others?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_there_are_no_dumb_questions-id00092"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa2qe1"></a><a id="part0015_ch08qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0015_iddle1371"></a><a class="indexterm" id="part0015_iddle1580"></a><a class="indexterm" id="part0015_iddle1647"></a><a class="indexterm" id="part0015_iddle2408"></a><a class="indexterm" id="part0015_iddle2460"></a><a class="indexterm" id="part0015_iddle2517"></a><span class="strong"><strong>Q: How does the Hollywood Principle relate to the Dependency Inversion Principle that we learned a few chapters back?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The Dependency Inversion Principle teaches us to avoid the use of concrete classes and instead work as much as possible with abstractions. The Hollywood Principle is a technique for building frameworks or components so that lower-level components can be hooked into the computation, but without creating dependencies between the lower-level components and the higher-level layers. So, they both have the goal of decoupling, but the Dependency Inversion Principle makes a much stronger and general statement about how to avoid dependencies in design.</div><div>The Hollywood Principle gives us a technique for creating designs that allow low-level structures to interoperate while preventing other classes from becoming too dependent on them.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa2qe2"></a><a id="part0015_ch08qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Is a low-level component disallowed from calling a method in a higher-level component?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Not really. In fact, a low-level component will often end up calling a method defined above it in the inheritance hierarchy purely through inheritance. But we want to avoid creating explicit circular dependencies between the low-level component and the high-level ones.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_who_does_whatquestion_mark-id00093"></a><h3 class="title">Who Does What?</h3><p>Match each pattern with its description:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Description</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Template Method</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Encapsulate interchangeable behaviors and use delegation to decide which behavior to use.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Strategy</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Subclasses decide how to implement steps in an algorithm.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Factory Method</p></td><td style="vertical-align: top; "><p>Subclasses decide which concrete classes to instantiate.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_template_methods_in_the_wild" style="clear: both">Template Methods in the Wild</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1053"></a><a class="indexterm" id="part0015_iddle1482"></a><a class="indexterm" id="part0015_iddle2469"></a>The Template Method Pattern is a very common pattern and you’re going to find lots of it in the wild. You’ve got to have a keen eye, though, because there are many implementations of the template methods that don’t quite look like the textbook design of the pattern.</p><p>This pattern shows up so often because it’s a great design tool for creating frameworks, where the framework controls how something gets done, but leaves you (the person using the framework) to specify your own details about what is actually happening at each step of the framework’s algorithm.</p><p>Let’s take a little safari through a few uses in the wild (well, okay, in the Java API)...</p><div class="informalfigure"><a id="part0015_med_id00428a"></a><div class="mediaobject"><a id="part0015_med_id00428"></a><img alt="image with no caption" hisrc="figs/web/307fig01.png.jpg" src="../Images/image00926.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_sorting_with_template_method" style="clear: both">Sorting with Template Method</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1054"></a><a class="indexterm" id="part0015_iddle1068"></a><a class="indexterm" id="part0015_iddle1483"></a><a class="indexterm" id="part0015_iddle2353"></a><a class="indexterm" id="part0015_iddle2470"></a>What’s something we often need to do with arrays? Sort them!</p><div class="informalfigure"><a id="part0015_med_id00429a"></a><div class="mediaobject"><a id="part0015_med_id00429"></a><img alt="image with no caption" hisrc="figs/web/308fig01.png.jpg" src="../Images/image00927.jpeg"/></div></div><p>Recognizing that, the designers of the Java Arrays class have provided us with a handy template method for sorting. Let’s take a look at how this method operates:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note05"></a>Note</h3><p>We’ve pared down this code a little to make it easier to explain. If you’d like to see it all, grab the Java source code and check it out...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0015_med_id00430a"></a><div class="mediaobject"><a id="part0015_med_id00430"></a><img alt="image with no caption" hisrc="figs/web/308fig02.png.jpg" src="../Images/image00928.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_weapostropheve_got_some_ducks_to_sorthel" style="clear: both">We’ve got some ducks to sort...</h2></div></div></div><p>Let’s say you have an array of ducks that you’d like to sort. How do you do it? Well, the sort template method in Arrays gives us the algorithm, but you need to tell it how to compare ducks, which you do by implementing the compareTo() method... Make sense?</p><div class="informalfigure"><a id="part0015_med_id00431a"></a><div class="mediaobject"><a id="part0015_med_id00431"></a><img alt="image with no caption" hisrc="figs/web/309fig01.png.jpg" src="../Images/image00929.jpeg"/></div></div><div class="informalfigure"><a id="part0015_med_id00432a"></a><div class="mediaobject"><a id="part0015_med_id00432"></a><img alt="image with no caption" hisrc="figs/web/309fig02.png.jpg" src="../Images/image00930.jpeg"/></div></div><p>Good point. Here’s the deal: the designers of sort() wanted it to be useful across all arrays, so they had to make sort() a static method that could be used from anywhere. But that’s okay, it works almost the same as if it were in a superclass. Now, here is one more detail: because sort() really isn’t defined in our superclass, the sort() method needs to know that you’ve implemented the compareTo() method, or else you don’t have the piece needed to complete the sort algorithm.</p><p>To handle this, the designers made use of the Comparable interface. All you have to do is implement this interface, which has one method (surprise): compareTo().</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_what_is_comparetoleft_parenthesisright_p" style="clear: both">What is compareTo()?</h2></div></div></div><p>The compareTo() method compares two objects and returns whether one is less than, greater than, or equal to the other. sort() uses this as the basis of its comparison of objects in the array.</p><div class="informalfigure"><a id="part0015_med_id00433a"></a><div class="mediaobject"><a id="part0015_med_id00433"></a><img alt="image with no caption" hisrc="figs/web/309fig03.png.jpg" src="../Images/image00931.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_comparing_ducks_and_ducks" style="clear: both">Comparing Ducks and Ducks</h2></div></div></div><p>Okay, so you know that if you want to sort Ducks, you’re going to have to implement this compareTo() method; by doing that you’ll give the Arrays class what it needs to complete the algorithm and sort your ducks.</p><p>Here’s the duck implementation:</p><div class="informalfigure"><a id="part0015_med_id00434a"></a><div class="mediaobject"><a id="part0015_med_id00434"></a><img alt="image with no caption" hisrc="figs/web/310fig01.png.jpg" src="../Images/image00932.jpeg"/></div></div><div class="informalfigure"><a id="part0015_med_id00435a"></a><div class="mediaobject"><a id="part0015_med_id00435"></a><img alt="image with no caption" hisrc="figs/web/310fig02.png.jpg" src="../Images/image00933.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_letapostrophes_sort_some_ducks" style="clear: both">Let’s sort some Ducks</h2></div></div></div><p>Here’s the test drive for sorting Ducks...</p><div class="informalfigure"><a id="part0015_med_id00436a"></a><div class="mediaobject"><a id="part0015_med_id00436"></a><img alt="image with no caption" hisrc="figs/web/311fig01.png.jpg" src="../Images/image00934.jpeg"/></div></div><p><span class="strong"><strong>Let the sorting commence!</strong></span></p><div class="informalfigure"><a id="part0015_med_id00437a"></a><div class="mediaobject"><a id="part0015_med_id00437"></a><img alt="image with no caption" hisrc="figs/web/311fig02.png.jpg" src="../Images/image00935.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_making_of_the_sorting_duck_machine" style="clear: both">The making of the sorting duck machine</h2></div></div></div><div class="informalfigure"><a id="part0015_med_id00438a"></a><div class="mediaobject"><a id="part0015_med_id00438"></a><img alt="image with no caption" hisrc="figs/web/common17.png.jpg" src="../Images/image00686.jpeg"/></div></div><p><span class="strong"><strong>Behind the Scenes</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① First, we need an array of Ducks:<a id="part0015_pro_id00034"></a><pre class="programlisting"><span class="strong"><strong>Duck[] ducks = {new Duck("Daffy", 8), ... };</strong></span></pre></li><li class="listitem" style="list-style-type: none">② Then we call the sort() template method in the Array class and pass it our ducks:<div class="informalfigure"><a id="part0015_med_id00439a"></a><div class="mediaobject"><a id="part0015_med_id00439"></a><img alt="image with no caption" hisrc="figs/web/312fig01.png.jpg" src="../Images/image00936.jpeg"/></div></div><br/>The sort() method (and its helper mergeSort()) control the sort procedure.</li><li class="listitem" style="list-style-type: none">③ To sort an array, you need to compare two items one by one until the entire list is in sorted order.<br/>When it comes to comparing two ducks, the sort method relies on the Duck’s compareTo() method to know how to do this. The compareTo() method is called on the first duck and passed the duck to be compared to:<div class="informalfigure"><a id="part0015_med_id00440a"></a><div class="mediaobject"><a id="part0015_med_id00440"></a><img alt="image with no caption" hisrc="figs/web/312fig02.png.jpg" src="../Images/image00937.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">④ If the Ducks are not in sorted order, they’re swapped with the concrete swap() method in Arrays:<a id="part0015_pro_id00035"></a><pre class="programlisting"><span class="strong"><strong>swap()</strong></span></pre></li><li class="listitem" style="list-style-type: none">⑤ The sort() method continues comparing and swapping Ducks until the array is in the correct order!</li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_there_are_no_dumb_questions-id00094"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa3qe1"></a><a id="part0015_ch08qa3q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0015_iddle2422"></a><a class="indexterm" id="part0015_iddle2471"></a><span class="strong"><strong>Q: Is this really the Template Method Pattern, or are you trying too hard?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa3q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The pattern calls for implementing an algorithm and letting subclasses supply the implementation of the steps — and the Arrays sort is clearly not doing that! But, as we know, patterns in the wild aren’t always just like the textbook patterns. They have to be modified to fit the context and implementation constraints.</div><div>The designers of the Arrays sort() method had a few constraints. In general, you can’t subclass a Java array and they wanted the sort to be used on all arrays (and each array is a different class). So they defined a static method and deferred the comparison part of the algorithm to the items being sorted.</div><div>So, while it’s not a textbook template method, this implementation is still in the spirit of the Template Method Pattern. Also, by eliminating the requirement that you have to subclass Arrays to use this algorithm, they’ve made sorting in some ways more flexible and useful.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa3qe2"></a><a id="part0015_ch08qa3q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: This implementation of sorting actually seems more like the Strategy Pattern than the Template Method Pattern. Why do we consider it Template Method?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa3q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You’re probably thinking that because the Strategy Pattern uses object composition. You’re right in a way — we’re using the Arrays object to sort our array, so that’s similar to Strategy. But remember, in Strategy, the class that you compose with implements the entire algorithm. The algorithm that Arrays implements for sort is incomplete; it needs a class to fill in the missing compareTo() method. So, in that way, it’s more like Template Method.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa3qe3"></a><a id="part0015_ch08qa3q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Are there other examples of template methods in the Java API?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0015_ch08qa3q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes, you’ll find them in a few places. For example, java.io has a read() method in InputStream that subclasses must implement and is used by the template method read(byte b[], int off, int len).</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note06"></a>Brain Power</h3><p>We know that we should favor composition over inheritance, right? Well, the implementers of the sort() template method decided not to use inheritance and instead to implement sort() as a static method that is composed with a Comparable at runtime. How is this better? How is it worse? How would you approach this problem? Do Java arrays make this particularly tricky?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0015_ch08note07"></a>Brain<sup>2</sup> Power</h3><p>Think of another pattern that is a specialization of the template method. In this specialization, primitive operations are used to create and return objects. What pattern is this?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_swinginapostrophe_with_frames" style="clear: both">Swingin’ with Frames</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1055"></a><a class="indexterm" id="part0015_iddle1484"></a><a class="indexterm" id="part0015_iddle1872"></a><a class="indexterm" id="part0015_iddle2449"></a><a class="indexterm" id="part0015_iddle2473"></a>Up next on our Template Method safari... keep your eye out for swinging JFrames!</p><div class="informalfigure"><a id="part0015_med_id00441a"></a><div class="mediaobject"><a id="part0015_med_id00441"></a><img alt="image with no caption" hisrc="figs/web/common14.png.jpg" src="../Images/image00938.jpeg"/></div></div><p>If you haven’t encountered JFrame, it’s the most basic Swing container and inherits a paint() method. By default, paint() does nothing because it’s a hook! By overriding paint(), you can insert yourself into JFrame’s algorithm for displaying its area of the screen and have your own graphic output incorporated into the JFrame. Here’s an embarrassingly simple example of using a JFrame to override the paint() hook method:</p><div class="informalfigure"><a id="part0015_med_id00442a"></a><div class="mediaobject"><a id="part0015_med_id00442"></a><img alt="image with no caption" hisrc="figs/web/314fig01.png.jpg" src="../Images/image00939.jpeg"/></div></div><div class="informalfigure"><a id="part0015_med_id00443a"></a><div class="mediaobject"><a id="part0015_med_id00443"></a><img alt="image with no caption" hisrc="figs/web/314fig02.png.jpg" src="../Images/image00940.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_applets" style="clear: both">Applets</h2></div></div></div><p><a class="indexterm" id="part0015_iddle1048"></a><a class="indexterm" id="part0015_iddle1058"></a><a class="indexterm" id="part0015_iddle1477"></a><a class="indexterm" id="part0015_iddle2456"></a>Our final stop on the safari: the applet.</p><div class="informalfigure"><a id="part0015_med_id00444a"></a><div class="mediaobject"><a id="part0015_med_id00444"></a><img alt="image with no caption" hisrc="figs/web/common14.png.jpg" src="../Images/image00938.jpeg"/></div></div><p>You probably know an applet is a small program that runs in a web page. Any applet must subclass Applet, and this class provides several hooks. Let’s take a look at a few of them:</p><div class="informalfigure"><a id="part0015_med_id00445a"></a><div class="mediaobject"><a id="part0015_med_id00445"></a><img alt="image with no caption" hisrc="figs/web/315fig01.png.jpg" src="../Images/image00941.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>Concrete applets make extensive use of hooks to supply their own behaviors. Because these methods are implemented as hooks, the applet isn’t required to implement them.</strong></span></div></blockquote></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_fireside_chats-id00095"></a><h3 class="title"><code class="literal">Fireside Chats</code></h3><p><a class="indexterm" id="part0015_iddle2423"></a><a class="indexterm" id="part0015_iddle2472"></a>Tonight’s talk: <span class="strong"><strong>Template Method and Strategy compare methods.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Template Method:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Strategy:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey Strategy, what are you doing in my chapter? I figured I’d get stuck with someone boring like Factory Method.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0015_inline_id00034"></a><img alt="" hisrc="figs/web/316fig01.png.jpg" src="../Images/image00942.jpeg"/></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Nope, it’s me, although be careful — you and Factory Method are related, aren’t you?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I was just kidding! But seriously, what are you doing here? We haven’t heard from you in eight chapters!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I’d heard you were on the final draft of your chapter and I thought I’d swing by to see how it was going. We have a lot in common, so I thought I might be able to help...</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>You might want to remind the reader what you’re all about, since it’s been so long.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I don’t know, since <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a>, people have been stopping me in the street saying, “Aren’t you that pattern...?” So I think they know who I am. But for your sake: I define a family of algorithms and make them interchangeable. Since each algorithm is encapsulated, the client can use different algorithms easily.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey, that does sound a lot like what I do. But my intent’s a little different from yours; my job is to define the outline of an algorithm, but let my subclasses do some of the work. That way, I can have different implementations of an algorithm’s individual steps, but keep control over the algorithm’s structure. Seems like you have to give up control of your algorithms.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I’m not sure I’d put it quite like <span class="emphasis"><em>that</em></span>... and anyway, I’m not stuck using inheritance for algorithm implementations. I offer clients a choice of algorithm implementation through object composition.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I remember that. But I have more control over my algorithm and I don’t duplicate code. In fact, if every part of my algorithm is the same except for, say, one line, then my classes are much more efficient than yours. All my duplicated code gets put into the superclass, so all the subclasses can share it.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>You might be a little more efficient (just a little) and require fewer objects. <span class="emphasis"><em>And</em></span> you might also be a little less complicated in comparison to my delegation model, but I’m more flexible because I use object composition. With me, clients can change their algorithms at runtime simply by using a different strategy object. Come on, they didn’t choose me for <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a> for nothing!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Yeah, well, I’m <span class="emphasis"><em>real</em></span> happy for ya, but don’t forget I’m the most used pattern around. Why? Because I provide a fundamental method for code reuse that allows subclasses to specify behavior. I’m sure you can see that this is perfect for creating frameworks.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yeah, I guess... but, what about dependency? You’re way more dependent than me.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>How’s that? My superclass is abstract.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>But you have to depend on methods implemented in your subclasses, which are part of your algorithm. I don’t depend on anyone; I can do the entire algorithm myself!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Like I said, Strategy, I’m <span class="emphasis"><em>real</em></span> happy for you. Thanks for stopping by, but I’ve got to get the rest of this chapter done.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, okay, don’t get touchy. I’ll let you work, but let me know if you need my special techniques anyway; I’m always glad to help.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Got it. Don’t call us, we’ll call you...</p></td><td> </td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_design_patterns_crossword-id00096"></a><h3 class="title">Design Patterns Crossword</h3><p>It’s that time again....</p><div class="informalfigure"><a id="part0015_med_id00446a"></a><div class="mediaobject"><a id="part0015_med_id00446"></a><img alt="image with no caption" hisrc="figs/web/318fig01.png" src="../Images/image00943.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. Strategy uses __________ rather than inheritance.</p>
<p>4. Type of sort used in Arrays.</p>
<p>5. The JFrame hook method that we overrode to print “I Rule”.</p>
<p>6. The Template Method Pattern uses __________ to defer implementation to other classes.</p>
<p>8. Coffee and ________.</p>
<p>9. “Don’t call us, we’ll call you” is known as the __________ Principle.</p>
<p>12. A template method defines the steps of an ____________.</p>
<p>13. In this chapter, we give you more ________.</p>
<p>14. The template method is usually defined in an __________ class.</p>
<p>16. Class that likes web pages.</p></td><td style="vertical-align: top; "><p>2. _____________ algorithm steps are implemented by hook methods.</p>
<p>3. Factory Method is a __________ of Template Method.</p>
<p>7. The steps in the algorithm that must be supplied by the subclasses are usually declared ____________.</p>
<p>8. Huey, Louie, and Dewey all weigh ___________ pounds.</p>
<p>9. A method in the abstract superclass that does nothing or provides default behavior is called a ____________ method.</p>
<p>10. Big-headed pattern.</p>
<p>11. Our favorite coffee shop in Objectville.</p>
<p>15. The Arrays class implements its template method as a __________ method.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0015_tools_for_your_design_toolbox-id00097" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>We’ve added Template Method to your toolbox. With Template Method you can reuse code like a pro while keeping control of your algorithms.</p><div class="informalfigure"><a id="part0015_med_id00447a"></a><div class="mediaobject"><a id="part0015_med_id00447"></a><img alt="image with no caption" hisrc="figs/web/319fig01.png.jpg" src="../Images/image00944.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_bullet_points-id00098"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">A “template method” defines the steps of an algorithm, deferring to subclasses for the implementation of those steps.</li><li class="listitem">The Template Method Pattern gives us an important technique for code reuse.</li><li class="listitem">The template method’s abstract class may define concrete methods, abstract methods, and hooks.</li><li class="listitem">Abstract methods are implemented by subclasses.</li><li class="listitem">Hooks are methods that do nothing or default behavior in the abstract class, but may be overridden in the subclass.</li><li class="listitem">To prevent subclasses from changing the algorithm in the template method, declare the template method as final.</li><li class="listitem">The Hollywood Principle guides us to put decision making in high-level modules that can decide how and when to call low-level modules.</li><li class="listitem">You’ll see lots of uses of the Template Method Pattern in real-world code, but don’t expect it all (like any pattern) to be designed “by the book.”</li><li class="listitem">The Strategy and Template Method Patterns both encapsulate algorithms, one by inheritance and one by composition.</li><li class="listitem">The Factory Method is a specialization of Template Method.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_sharpen_your_pencil_solution-id00099"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0015_iddle1538"></a><a class="indexterm" id="part0015_iddle1581"></a><a class="indexterm" id="part0015_iddle1648"></a><a class="indexterm" id="part0015_iddle2277"></a><a class="indexterm" id="part0015_iddle2409"></a><a class="indexterm" id="part0015_iddle2461"></a><a class="indexterm" id="part0015_iddle2518"></a>Draw the new class diagram now that we’ve moved prepareRecipe() into the CaffeineBeverage class:</p><div class="informalfigure"><a id="part0015_med_id00448a"></a><div class="mediaobject"><a id="part0015_med_id00448"></a><img alt="image with no caption" hisrc="figs/web/320fig01.png.jpg" src="../Images/image00945.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_who_does_whatquestion_mark_solut-id00100"></a><h3 class="title">Who Does What? Solution</h3><p>Match each pattern with its description:</p><div class="informalfigure"><a id="part0015_med_id00449a"></a><div class="mediaobject"><a id="part0015_med_id00449"></a><img alt="image with no caption" hisrc="figs/web/320fig02.png.jpg" src="../Images/image00946.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0015_design_patterns_crossword_soluti-id00101"></a><h3 class="title">Design Patterns Crossword Solution</h3><p>It’s that time again...</p><div class="informalfigure"><a id="part0015_med_id00450a"></a><div class="mediaobject"><a id="part0015_med_id00450"></a><img alt="image with no caption" hisrc="figs/web/321fig01.png" src="../Images/image00947.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0016_iterator_and_composite_patterns_well-man"><div class="titlepage" id="part0016_aid-F8902"><div><div><h2 class="title">Chapter 9. The Iterator and Composite Patterns: Well-Managed Collections</h2></div></div></div><div class="informalfigure"><a id="part0016_med_id00451a"></a><div class="mediaobject"><a id="part0016_med_id00451"></a><img alt="image with no caption" hisrc="figs/web/323fig01.png.jpg" src="../Images/image00948.jpeg"/></div></div><p><a class="indexterm" id="part0016_iddle1149"></a><span class="strong"><strong>There are lots of ways to stuff objects into a collection.</strong></span> Put them into an Array, a Stack, a List, a Hashmap, take your pick. Each has its own advantages and tradeoffs. But at some point your client is going to want to iterate over those objects, and when he does, are you going to show him your implementation? We certainly hope not! That just wouldn’t be professional. Well, you don’t have to risk your career; you’re going to see how you can allow your clients to iterate through your objects without ever getting a peek at how you store your objects. You’re also going to learn how to create some super collections of objects that can leap over some impressive data structures in a single bound. And if that’s not enough, you’re also going to learn a thing or two about object responsibility.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_breaking_news_objectville_diner_and_obje" style="clear: both">Breaking News: Objectville Diner and Objectville Pancake House Merge</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1445"></a><a class="indexterm" id="part0016_iddle1824"></a><a class="indexterm" id="part0016_iddle1906"></a>That’s great news! Now we can get those delicious pancake breakfasts at the Pancake House and those yummy lunches at the Diner all in one place. But, there seems to be a slight problem...</p><div class="informalfigure"><a id="part0016_med_id00452a"></a><div class="mediaobject"><a id="part0016_med_id00452"></a><img alt="image with no caption" hisrc="figs/web/324fig01.png.jpg" src="../Images/image00949.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_check_out_the_menu_items" style="clear: both">Check out the Menu Items</h2></div></div></div><p>At least Lou and Mel agree on the implementation of the MenuItems. Let’s check out the items on each menu, and also take a look at the implementation.</p><div class="informalfigure"><a id="part0016_med_id00453a"></a><div class="mediaobject"><a id="part0016_med_id00453"></a><img alt="image with no caption" hisrc="figs/web/325fig01.png.jpg" src="../Images/image00950.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00454a"></a><div class="mediaobject"><a id="part0016_med_id00454"></a><img alt="image with no caption" hisrc="figs/web/325fig02.png.jpg" src="../Images/image00951.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_lou_and_melapostrophes_menu_implementati" style="clear: both">Lou and Mel’s Menu implementations</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1062"></a><a class="indexterm" id="part0016_iddle1450"></a><a class="indexterm" id="part0016_iddle1829"></a><a class="indexterm" id="part0016_iddle1911"></a>Now let’s take a look at what Lou and Mel are arguing about. They both have lots of time and code invested in the way they store their menu items in a menu, and lots of other code that depends on it.</p><div class="informalfigure"><a id="part0016_med_id00455a"></a><div class="mediaobject"><a id="part0016_med_id00455"></a><img alt="image with no caption" hisrc="figs/web/326fig01.png.jpg" src="../Images/image00952.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00456a"></a><div class="mediaobject"><a id="part0016_med_id00456"></a><img alt="image with no caption" hisrc="figs/web/326fig02.png.jpg" src="../Images/image00953.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00457a"></a><div class="mediaobject"><a id="part0016_med_id00457"></a><img alt="image with no caption" hisrc="figs/web/327fig01.png.jpg" src="../Images/image00954.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00458a"></a><div class="mediaobject"><a id="part0016_med_id00458"></a><img alt="image with no caption" hisrc="figs/web/327fig02.png.jpg" src="../Images/image00955.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_whatapostrophes_the_problem_with_having" style="clear: both">What’s the problem with having two different menu representations?</h2></div></div></div><p>To see why having two different menu representations complicates things, let’s try implementing a client that uses the two menus. Imagine you have been hired by the new company formed by the merger of the Diner and the Pancake House to create a Java-enabled waitress (this is Objectville, after all). The spec for the Java-enabled waitress specifies that she can print a custom menu for customers on demand, and even tell you if a menu item is vegetarian without having to ask the cook — now that’s an innovation!</p><p>Let’s check out the spec, and then step through what it might take to implement her...</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0016_java-enabled_waitress_specification">The Java-Enabled Waitress Specification</h3></div></div></div><div class="informalfigure"><a id="part0016_med_id00459a"></a><div class="mediaobject"><a id="part0016_med_id00459"></a><img alt="image with no caption" hisrc="figs/web/328fig01.png.jpg" src="../Images/image00956.jpeg"/></div></div><p><a class="indexterm" id="part0016_iddle1888"></a>Let’s start by stepping through how we’d implement the printMenu() method:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① To print all the items on each menu, you’ll need to call the getMenuItems() method on the PancakeHouseMenu and the DinerMenu to retrieve their respective menu items. Note that each returns a different type:<div class="informalfigure"><a id="part0016_med_id00460a"></a><div class="mediaobject"><a id="part0016_med_id00460"></a><img alt="image with no caption" hisrc="figs/web/329fig01.png.jpg" src="../Images/image00957.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② Now, to print out the items from the PancakeHouseMenu, we’ll loop through the items on the breakfastItems ArrayList. And to print out the Diner items we’ll loop through the Array.<div class="informalfigure"><a id="part0016_med_id00461a"></a><div class="mediaobject"><a id="part0016_med_id00461"></a><img alt="image with no caption" hisrc="figs/web/329fig02.png.jpg" src="../Images/image00958.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ Implementing every other method in the Waitress is going to be a variation of this theme. We’re always going to need to get both menus and use two loops to iterate through their items. If another restaurant with a different implementation is acquired then we’ll have <span class="emphasis"><em>three</em></span> loops.</li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_sharpen_your_pencil-id00102"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0016_iddle1555"></a><a class="indexterm" id="part0016_iddle2300"></a>Based on our implementation of printMenu(), which of the following apply?</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00035"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We are coding to the PancakeHouseMenu and DinerMenu concrete implementations, not to an interface.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00036"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Waitress doesn’t implement the Java Waitress API and so she isn’t adhering to a standard.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00037"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>If we decided to switch from using DinerMenu to another type of menu that implemented its list of menu items with a Hashtable, we’d have to modify a lot of code in the Waitress.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00038"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Waitress needs to know how each menu represents its internal collection of menu items; this violates encapsulation.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00039"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We have duplicate code: the printMenu() method needs two separate loops to iterate over the two different kinds of menus. And if we added a third menu, we’d have yet another loop.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00040"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>The implementation isn’t based on MXML (Menu XML) and so isn’t as interoperable as it should be.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_what_nowquestion_mark" style="clear: both">What now?</h2></div></div></div><p>Mel and Lou are putting us in a difficult position. They don’t want to change their implementations because it would mean rewriting a lot of code that is in each respective menu class. But if one of them doesn’t give in, then we’re going to have the job of implementing a Waitress that is going to be hard to maintain and extend.</p><p>It would really be nice if we could find a way to allow them to implement the same interface for their menus (they’re already close, except for the return type of the getMenuItems() method). That way we can minimize the concrete references in the Waitress code and also hopefully get rid of the multiple loops required to iterate over both menus.</p><p>Sound good? Well, how are we going to do that?</p><div class="informalfigure"><a id="part0016_med_id00462a"></a><div class="mediaobject"><a id="part0016_med_id00462"></a><img alt="image with no caption" hisrc="figs/web/331fig01.png.jpg" src="../Images/image00959.jpeg"/></div></div><p><a class="indexterm" id="part0016_iddle1889"></a><span class="strong"><strong>Yes, using for each would allow us to hide the complexity of the different kinds of iteration.</strong></span> But that doesn’t solve the real problem here: that we’ve got two different implementations of the menus, and the Waitress has to know how each kind of menu is implemented. That’s not really the Waitress’s job. We want her to focus on being a waitress, and not have to think about the type of the menus <span class="emphasis"><em>at all</em></span>.</p><div class="informalfigure"><a id="part0016_med_id00463a"></a><div class="mediaobject"><a id="part0016_med_id00463"></a><img alt="image with no caption" hisrc="figs/web/331fig02.png.jpg" src="../Images/image00960.jpeg"/></div></div><p>Our goal is to decouple the Waitress from the concrete implementations of the menus completely. So hang in there, and you’ll see there’s a better way to do this.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_can_we_encapsulate_the_iterationquestion" style="clear: both">Can we encapsulate the iteration?</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1064"></a><a class="indexterm" id="part0016_iddle1448"></a><a class="indexterm" id="part0016_iddle1490"></a><a class="indexterm" id="part0016_iddle1827"></a><a class="indexterm" id="part0016_iddle1841"></a><a class="indexterm" id="part0016_iddle1909"></a>If we’ve learned one thing in this book, it’s encapsulate what varies. It’s obvious what is changing here: the iteration caused by different collections of objects being returned from the menus. But can we encapsulate this? Let’s work through the idea...</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① To iterate through the breakfast items we use the size() and get() methods on the ArrayList:<div class="informalfigure"><a id="part0016_med_id00464a"></a><div class="mediaobject"><a id="part0016_med_id00464"></a><img alt="image with no caption" hisrc="figs/web/332fig01.png.jpg" src="../Images/image00961.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② And to iterate through the lunch items we use the Array length field and the array subscript notation on the MenuItem Array.<div class="informalfigure"><a id="part0016_med_id00465a"></a><div class="mediaobject"><a id="part0016_med_id00465"></a><img alt="image with no caption" hisrc="figs/web/332fig02.png.jpg" src="../Images/image00962.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ Now what if we create an object, let’s call it an Iterator, that encapsulates the way we iterate through a collection of objects? Let’s try this on the ArrayList<div class="informalfigure"><a id="part0016_med_id00466a"></a><div class="mediaobject"><a id="part0016_med_id00466"></a><img alt="image with no caption" hisrc="figs/web/333fig01.png.jpg" src="../Images/image00963.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">④ Let’s try that on the Array too:<div class="informalfigure"><a id="part0016_med_id00467a"></a><div class="mediaobject"><a id="part0016_med_id00467"></a><img alt="image with no caption" hisrc="figs/web/333fig02.png.jpg" src="../Images/image00964.jpeg"/></div></div></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_meet_the_iterator_pattern" style="clear: both">Meet the Iterator Pattern</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1041"></a><a class="indexterm" id="part0016_iddle1153"></a><a class="indexterm" id="part0016_iddle1156"></a><a class="indexterm" id="part0016_iddle1449"></a><a class="indexterm" id="part0016_iddle1809"></a><a class="indexterm" id="part0016_iddle1828"></a><a class="indexterm" id="part0016_iddle1846"></a><a class="indexterm" id="part0016_iddle1910"></a>Well, it looks like our plan of encapsulating iteration just might actually work; and as you’ve probably already guessed, it is a Design Pattern called the Iterator Pattern.</p><p>The first thing you need to know about the Iterator Pattern is that it relies on an interface called Iterator. Here’s one possible Iterator interface:</p><div class="informalfigure"><a id="part0016_med_id00468a"></a><div class="mediaobject"><a id="part0016_med_id00468"></a><img alt="image with no caption" hisrc="figs/web/334fig01.png.jpg" src="../Images/image00965.jpeg"/></div></div><p>Now, once we have this interface, we can implement Iterators for any kind of collection of objects: arrays, lists, hashmaps, ...pick your favorite collection of objects. Let’s say we wanted to implement the Iterator for the Array used in the DinerMenu. It would look like this:</p><div class="informalfigure"><a id="part0016_med_id00469a"></a><div class="mediaobject"><a id="part0016_med_id00469"></a><img alt="image with no caption" hisrc="figs/web/334fig02.png.jpg" src="../Images/image00966.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00470a"></a><div class="mediaobject"><a id="part0016_med_id00470"></a><img alt="image with no caption" hisrc="figs/web/334fig03.png.jpg" src="../Images/image00967.jpeg"/></div></div><p>Let’s go ahead and implement this Iterator and hook it into the DinerMenu to see how this works...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_adding_an_iterator_to_dinermenu" style="clear: both">Adding an Iterator to DinerMenu</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1065"></a><a class="indexterm" id="part0016_iddle1066"></a><a class="indexterm" id="part0016_iddle1150"></a><a class="indexterm" id="part0016_iddle1446"></a><a class="indexterm" id="part0016_iddle1724"></a><a class="indexterm" id="part0016_iddle1825"></a><a class="indexterm" id="part0016_iddle1834"></a><a class="indexterm" id="part0016_iddle1907"></a><a class="indexterm" id="part0016_iddle1966"></a>To add an Iterator to the DinerMenu we first need to define the Iterator Interface:</p><div class="informalfigure"><a id="part0016_med_id00471a"></a><div class="mediaobject"><a id="part0016_med_id00471"></a><img alt="image with no caption" hisrc="figs/web/335fig01.png.jpg" src="../Images/image00968.jpeg"/></div></div><p>And now we need to implement a concrete Iterator that works for the Diner menu:</p><div class="informalfigure"><a id="part0016_med_id00472a"></a><div class="mediaobject"><a id="part0016_med_id00472"></a><img alt="image with no caption" hisrc="figs/web/335fig02.png.jpg" src="../Images/image00969.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_reworking_the_diner_menu_with_iterator" style="clear: both">Reworking the Diner Menu with Iterator</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1520"></a>Okay, we’ve got the iterator. Time to work it into the DinerMenu; all we need to do is add one method to create a DinerMenuIterator and return it to the client:</p><div class="informalfigure"><a id="part0016_med_id00473a"></a><div class="mediaobject"><a id="part0016_med_id00473"></a><img alt="image with no caption" hisrc="figs/web/336fig01.png.jpg" src="../Images/image00970.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_exercise-id00103"></a><h3 class="title">Exercise</h3><p>Go ahead and implement the PancakeHouseIterator yourself and make the changes needed to incorporate it into the PancakeHouseMenu.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_fixing_up_the_waitress_code" style="clear: both">Fixing up the Waitress code</h2></div></div></div><p>Now we need to integrate the iterator code into the Waitress. We should be able to get rid of some of the redundancy in the process. Integration is pretty straightforward: first we create a printMenu() method that takes an Iterator; then we use the createIterator() method on each menu to retrieve the Iterator and pass it to the new method.</p><div class="informalfigure"><a id="part0016_med_id00474a"></a><div class="mediaobject"><a id="part0016_med_id00474"></a><img alt="image with no caption" hisrc="figs/web/337fig01.png.jpg" src="../Images/image00971.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_testing_our_code" style="clear: both">Testing our code</h2></div></div></div><p>It’s time to put everything to a test. Let’s write some test drive code and see how the Waitress works...</p><div class="informalfigure"><a id="part0016_med_id00475a"></a><div class="mediaobject"><a id="part0016_med_id00475"></a><img alt="image with no caption" hisrc="figs/web/338fig01.png.jpg" src="../Images/image00972.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0016_hereapostrophes_the_test_runhellip">Here’s the test run...</h3></div></div></div><div class="informalfigure"><a id="part0016_med_id00476a"></a><div class="mediaobject"><a id="part0016_med_id00476"></a><img alt="image with no caption" hisrc="figs/web/338fig02.png.jpg" src="../Images/image00973.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_what_have_we_done_so_farquestion_mark" style="clear: both">What have we done so far?</h2></div></div></div><p>For starters, we’ve made our Objectville cooks very happy. They settled their differences and kept their own implementations. Once we gave them a PancakeHouseMenuIterator and a DinerMenuIterator, all they had to do was add a createIterator() method and they were finished.</p><p>We’ve also helped ourselves in the process. The Waitress will be much easier to maintain and extend down the road. Let’s go through exactly what we did and think about the consequences:</p><div class="informalfigure"><a id="part0016_med_id00477a"></a><div class="mediaobject"><a id="part0016_med_id00477"></a><img alt="image with no caption" hisrc="figs/web/339fig01.png.jpg" src="../Images/image00974.jpeg"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hard to Maintain Waitress Implementation</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>New, Hip Waitress Powered by Iterator</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>The Menus are not well encapsulated; we can see the Diner is using an ArrayList and the Pancake House an Array.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Menu implementations are now encapsulated. The Waitress has no idea how the Menus hold their collection of menu items.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>We need two loops to iterate through the MenuItems.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>All we need is a loop that polymorphically handles any collection of items as long as it implements Iterator.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>The Waitress is bound to concrete classes (MenuItem[] and ArrayList).</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Waitress now uses an interface (Iterator).</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>The Waitress is bound to two different concrete Menu classes, despite their interfaces being almost identical.</p></td><td style="vertical-align: top; "><p>The Menu interfaces are now exactly the same and, uh oh, we still don’t have a common interface, which means the Waitress is still bound to two concrete Menu classes. We’d better fix that.</p></td></tr></tbody></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_what_we_have_so_farhellip" style="clear: both">What we have so far...</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1364"></a><a class="indexterm" id="part0016_iddle1835"></a>Before we clean things up, let’s get a bird’s-eye view of our current design.</p><div class="informalfigure"><a id="part0016_med_id00478a"></a><div class="mediaobject"><a id="part0016_med_id00478"></a><img alt="image with no caption" hisrc="figs/web/340fig01.png.jpg" src="../Images/image00975.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_making_some_improvementshellip" style="clear: both">Making some improvements...</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1152"></a><a class="indexterm" id="part0016_iddle1823"></a><a class="indexterm" id="part0016_iddle1832"></a><a class="indexterm" id="part0016_iddle1866"></a><a class="indexterm" id="part0016_iddle2233"></a>Okay, we know the interfaces of PancakeHouseMenu and DinerMenu are exactly the same and yet we haven’t defined a common interface for them. So, we’re going to do that and clean up the Waitress a little more.</p><p>You may be wondering why we’re not using the Java Iterator interface — we did that so you could see how to build an iterator from scratch. Now that we’ve done that, we’re going to switch to using the Java Iterator interface, because we’ll get a lot of leverage by implementing that instead of our home-grown Iterator interface. What kind of leverage? You’ll soon see.</p><p>First, let’s check out the java.util.Iterator interface:</p><div class="informalfigure"><a id="part0016_med_id00479a"></a><div class="mediaobject"><a id="part0016_med_id00479"></a><img alt="image with no caption" hisrc="figs/web/341fig01.png.jpg" src="../Images/image00976.jpeg"/></div></div><p>This is going to be a piece of cake: we just need to change the interface that both PancakeHouseMenuIterator and DinerMenuIterator extend, right? Almost... actually, it’s even easier than that. Not only does java.util have its own Iterator interface, but ArrayList has an iterator() method that returns an iterator. In other words, we never needed to implement our own iterator for ArrayList. However, we’ll still need our implementation for the DinerMenu because it relies on an Array, which doesn’t support the iterator() method (or any other way to create an array iterator).</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_there_are_no_dumb_questions-id00104"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa1qe1"></a><a id="part0016_ch09qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: What if I don’t want to provide the ability to remove something from the underlying collection of objects?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The remove() method is considered optional. You don’t have to provide remove functionality. But, you should provide the method because it’s part of the Iterator interface. If you’re not going to allow remove() in your iterator you’ll want to throw the runtime exception java.lang.UnsupportedOperationException. The Iterator API documentation specifies that this exception may be thrown from remove() and any client that is a good citizen will check for this exception when calling the remove() method.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa1qe2"></a><a id="part0016_ch09qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How does remove() behave under multiple threads that may be using different iterators over the same collection of objects?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The behavior of the remove() is unspecified if the collection changes while you are iterating over it. So you should be careful in designing your own multithreaded code when accessing a collection concurrently.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_cleaning_things_up_with_javadotutildotit" style="clear: both">Cleaning things up with java.util.Iterator</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1067"></a><a class="indexterm" id="part0016_iddle1151"></a><a class="indexterm" id="part0016_iddle1447"></a><a class="indexterm" id="part0016_iddle1826"></a><a class="indexterm" id="part0016_iddle1839"></a><a class="indexterm" id="part0016_iddle1865"></a><a class="indexterm" id="part0016_iddle1908"></a>Let’s start with the PancakeHouseMenu. Changing it over to java.util.Iterator is going to be easy. We just delete the PancakeHouseMenuIterator class, add an import java.util.Iterator to the top of PancakeHouseMenu and change one line of the PancakeHouseMenu:</p><div class="informalfigure"><a id="part0016_med_id00480a"></a><div class="mediaobject"><a id="part0016_med_id00480"></a><img alt="image with no caption" hisrc="figs/web/342fig01.png.jpg" src="../Images/image00977.jpeg"/></div></div><p>And that’s it, PancakeHouseMenu is done.</p><p>Now we need to make the changes to allow the DinerMenu to work with java.util.Iterator.</p><div class="informalfigure"><a id="part0016_med_id00481a"></a><div class="mediaobject"><a id="part0016_med_id00481"></a><img alt="image with no caption" hisrc="figs/web/342fig02.png.jpg" src="../Images/image00978.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_we_are_almost_therehellip" style="clear: both">We are almost there...</h2></div></div></div><p>We just need to give the Menus a common interface and rework the Waitress a little. The Menu interface is quite simple: we might want to add a few more methods to it eventually, like addItem(), but for now we will let the chefs control their menus by keeping that method out of the public interface:</p><div class="informalfigure"><a id="part0016_med_id00482a"></a><div class="mediaobject"><a id="part0016_med_id00482"></a><img alt="image with no caption" hisrc="figs/web/343fig01.png.jpg" src="../Images/image00979.jpeg"/></div></div><p>Now we need to add an <code class="literal">implements Menu</code> to both the PancakeHouseMenu and the DinerMenu class definitions and update the Waitress:</p><div class="informalfigure"><a id="part0016_med_id00483a"></a><div class="mediaobject"><a id="part0016_med_id00483"></a><img alt="image with no caption" hisrc="figs/web/343fig02.png.jpg" src="../Images/image00980.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_what_does_this_get_usquestion_mark" style="clear: both">What does this get us?</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1365"></a><a class="indexterm" id="part0016_iddle1423"></a><a class="indexterm" id="part0016_iddle1836"></a><a class="indexterm" id="part0016_iddle2144"></a>The PancakeHouseMenu and DinerMenu classes implement an interface, Menu. Waitress can refer to each menu object using the interface rather than the concrete class. So, we’re reducing the dependency between the Waitress and the concrete classes by “programming to an interface, not an implementation.”</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note01"></a>Note</h3><p>This solves the problem of the Waitress depending on the concrete Menus.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>The new Menu interface has one method, createIterator(), that is implemented by PancakeHouseMenu and DinerMenu. Each menu class assumes the responsibility of creating a concrete Iterator that is appropriate for its internal implementation of the menu items.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note02"></a>Note</h3><p>This solves the problem of the Waitress depending on the implementation of the MenuItems.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00484a"></a><div class="mediaobject"><a id="part0016_med_id00484"></a><img alt="image with no caption" hisrc="figs/web/344fig01.png.jpg" src="../Images/image00981.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_iterator_pattern_defined" style="clear: both">Iterator Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1042"></a><a class="indexterm" id="part0016_iddle1816"></a><a class="indexterm" id="part0016_iddle1849"></a><a class="indexterm" id="part0016_iddle2133"></a>You’ve already seen how to implement the Iterator Pattern with your very own iterator. You’ve also seen how Java supports iterators in some of its collection oriented classes (the ArrayList). Now it’s time to check out the official definition of the pattern:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note03"></a>Note</h3><p><span class="strong"><strong>The Iterator Pattern</strong></span> provides a way to access the elements of an aggregate object sequentially without exposing its underlying representation.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>This makes a lot of sense: the pattern gives you a way to step through the elements of an aggregate without having to know how things are represented under the covers. You’ve seen that with the two implementations of Menus. But the effect of using iterators in your design is just as important: once you have a uniform way of accessing the elements of all your aggregate objects, you can write polymorphic code that works with <span class="emphasis"><em>any</em></span> of these aggregates — just like the printMenu() method, which doesn’t care if the menu items are held in an Array or ArrayList (or anything else that can create an Iterator), as long as it can get hold of an Iterator.</p><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>The Iterator Pattern allows traversal of the elements of an aggregate without exposing the underlying implementation.</strong></span></div><div><span class="strong"><strong>It also places the task of traversal on the iterator object, not on the aggregate, which simplifies the aggregate interface and implementation, and places the responsibility where it should be.</strong></span></div></blockquote></div><p>The other important impact on your design is that the Iterator Pattern takes the responsibility of traversing elements and gives that responsibility to the iterator object, not the aggregate object. This not only keeps the aggregate interface and implementation simpler, it removes the responsibility for iteration from the aggregate and keeps the aggregate focused on the things it should be focused on (managing a collection of objects), not on iteration.</p><p>Let’s check out the class diagram to put all the pieces in context...</p><div class="informalfigure"><a id="part0016_med_id00485a"></a><div class="mediaobject"><a id="part0016_med_id00485"></a><img alt="image with no caption" hisrc="figs/web/346fig01.png.jpg" src="../Images/image00982.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note04"></a>Brain Power</h3><p><a class="indexterm" id="part0016_iddle1366"></a><a class="indexterm" id="part0016_iddle1810"></a><a class="indexterm" id="part0016_iddle1837"></a>The class diagram for the Iterator Pattern looks very similar to another pattern you’ve studied; can you think of what it is? Hint: a subclass decides which object to create.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_there_are_no_dumb_questions-id00105"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe1"></a><a id="part0016_ch09qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0016_iddle1499"></a><a class="indexterm" id="part0016_iddle1594"></a><a class="indexterm" id="part0016_iddle1725"></a><a class="indexterm" id="part0016_iddle1802"></a><a class="indexterm" id="part0016_iddle1843"></a><a class="indexterm" id="part0016_iddle1844"></a><a class="indexterm" id="part0016_iddle1847"></a><a class="indexterm" id="part0016_iddle1848"></a><a class="indexterm" id="part0016_iddle1850"></a><a class="indexterm" id="part0016_iddle1851"></a><a class="indexterm" id="part0016_iddle1864"></a><a class="indexterm" id="part0016_iddle1867"></a><a class="indexterm" id="part0016_iddle1886"></a><a class="indexterm" id="part0016_iddle1965"></a><a class="indexterm" id="part0016_iddle2134"></a><a class="indexterm" id="part0016_iddle2234"></a><span class="strong"><strong>Q: I’ve seen other books show the Iterator class diagram with the methods first(), next(), isDone() and currentItem(). Why are these methods different?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Those are the “classic” method names that have been used. These names have changed over time and we now have next(), hasNext() and even remove() in java.util.Iterator.</div><div>Let’s look at the classic methods. The next() and currentItem() have been merged into one method in java.util. The isDone() method has obviously become hasNext(); but we have no method corresponding to first(). That’s because in Java we tend to just get a new iterator whenever we need to start the traversal over. Nevertheless, you can see there is very little difference in these interfaces. In fact, there is a whole range of behaviors you can give your iterators. The remove() method is an example of an extension in java.util.Iterator.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe2"></a><a id="part0016_ch09qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I’ve heard about “internal” iterators and “external” iterators. What are they? Which kind did we implement in the example?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> We implemented an external iterator, which means that the client controls the iteration by calling next() to get the next element. An internal iterator is controlled by the iterator itself. In that case, because it’s the iterator that’s stepping through the elements, you have to tell the iterator what to do with those elements as it goes through them. That means you need a way to pass an operation to an iterator. Internal iterators are less flexible than external iterators because the client doesn’t have control of the iteration. However, some might argue that they are easier to use because you just hand them an operation and tell them to iterate, and they do all the work for you.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe3"></a><a id="part0016_ch09qa2q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Could I implement an Iterator that can go backwards as well as forwards?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Definitely. In that case, you’d probably want to add two methods, one to get to the previous element, and one to tell you when you’re at the beginning of the collection of elements. Java’s Collection Framework provides another type of iterator interface called ListIterator. This iterator adds previous() and a few other methods to the standard Iterator interface. It is supported by any Collection that implements the List interface.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe4"></a><a id="part0016_ch09qa2q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Who defines the ordering of the iteration in a collection like Hashtable, which are inherently unordered?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Iterators imply no ordering. The underlying collections may be unordered as in a hashtable or in a bag; they may even contain duplicates. So ordering is related to both the properties of the underlying collection and to the implementation. In general, you should make no assumptions about ordering unless the Collection documentation indicates otherwise.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe5"></a><a id="part0016_ch09qa2q5"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: You said we can write “polymorphic code” using an iterator; can you explain that more?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q5a5"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> When we write methods that take Iterators as parameters, we are using polymorphic iteration. That means we are creating code that can iterate over any collection as long as it supports Iterator. We don’t care about how the collection is implemented, we can still write code to iterate over it.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe6"></a><a id="part0016_ch09qa2q6"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: If I’m using Java, won’t I always want to use the java.util.Iterator interface so I can use my own iterator implementations with classes that are already using the Java iterators?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q6a6"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Probably. If you have a common Iterator interface, it will certainly make it easier for you to mix and match your own aggregates with Java aggregates like ArrayList and Vector. But remember, if you need to add functionality to your Iterator interface for your aggregates, you can always extend the Iterator interface.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2qe7"></a><a id="part0016_ch09qa2q7"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I’ve seen an Enumeration interface in Java; does that implement the Iterator Pattern?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa2q7a7"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> We talked about this in the Adapter Pattern chapter (<a class="xref" href="#part0014_aid-DB7S2">Chapter 7</a>). Remember? The java.util.Enumeration is an older implementation of Iterator that has since been replaced by java.util. Iterator. Enumeration has two methods, hasMoreElements(), corresponding to hasNext(), and nextElement(), corresponding to next(). However, you’ll probably want to use Iterator over Enumeration as more Java classes support it. If you need to convert from one to another, review <a class="xref" href="#part0014_aid-DB7S2">Chapter 7</a> again where you implemented the adapter for Enumeration and Iterator.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_single_responsibility" style="clear: both">Single Responsibility</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1101"></a><a class="indexterm" id="part0016_iddle1118"></a><a class="indexterm" id="part0016_iddle1146"></a><a class="indexterm" id="part0016_iddle1412"></a><a class="indexterm" id="part0016_iddle1424"></a><a class="indexterm" id="part0016_iddle1833"></a><a class="indexterm" id="part0016_iddle2063"></a><a class="indexterm" id="part0016_iddle2327"></a>What if we allowed our aggregates to implement their internal collections and related operations AND the iteration methods? Well, we already know that would expand the number of methods in the aggregate, but so what? Why is that so bad?</p><p>Well, to see why, you first need to recognize that when we allow a class to not only take care of its own business (managing some kind of aggregate) but also take on more responsibilities (like iteration) then we’ve given the class two reasons to change. Two? Yup, two: it can change if the collection changes in some way, and it can change if the way we iterate changes. So once again our friend CHANGE is at the center of another design principle:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note05"></a>Design Principle</h3><p><span class="emphasis"><em>A class should have only one reason to change.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>Every responsibility of a class is an area of potential change. More than one responsibility means more than one area of change.</strong></span></div><div><span class="strong"><strong>This principle guides us to keep each class to a single responsibility.</strong></span></div></blockquote></div><p>We know we want to avoid change in a class like the plague — modifying code provides all sorts of opportunities for problems to creep in. Having two ways to change increases the probability the class will change in the future, and when it does, it’s going to affect two aspects of your design.</p><p>The solution? The principle guides us to assign each responsibility to one class, and only one class.</p><p>That’s right, it’s as easy as that, and then again it’s not: separating responsibility in design is one of the most difficult things to do. Our brains are just too good at seeing a set of behaviors and grouping them together even when there are actually two or more responsibilities. The only way to succeed is to be diligent in examining your designs and to watch out for signals that a class is changing in more than one way as your system grows.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_ch09sb05"></a><h3 class="title"></h3><div class="informalfigure"><a id="part0016_med_id00486a"></a><div class="mediaobject"><a id="part0016_med_id00486"></a><img alt="image with no caption" hisrc="figs/web/348fig01.png.jpg" src="../Images/image00983.jpeg"/></div></div><p><span class="strong"><strong>Cohesion</strong></span> is a term you’ll hear used as a measure of how closely a class or a module supports a single purpose or responsibility.</p><p>We say that a module or class has <span class="emphasis"><em>high cohesion</em></span> when it is designed around a set of related functions, and we say it has <span class="emphasis"><em>low cohesion</em></span> when it is designed around a set of unrelated functions.</p><p>Cohesion is a more general concept than the Single Responsibility Principle, but the two are closely related. Classes that adhere to the principle tend to have high cohesion and are more maintainable than classes that take on multiple responsibilities and have low cohesion.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note06"></a>Brain Power</h3><p>Examine these classes and determine which ones have multiple responsibilities.</p><div class="informalfigure"><a id="part0016_med_id00487a"></a><div class="mediaobject"><a id="part0016_med_id00487"></a><img alt="image with no caption" hisrc="figs/web/349fig01.png.jpg" src="../Images/image00984.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00488a"></a><div class="mediaobject"><a id="part0016_med_id00488"></a><img alt="image with no caption" hisrc="figs/web/common15.png.jpg" src="../Images/image00985.jpeg"/><div class="caption"><p>HARD HAT AREA. WATCH OUT FOR FALLING ASSUMPTIONS</p></div></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note07"></a>Brain<sup>2</sup> Power</h3><p>Determine if these classes have low or high cohesion.</p><div class="informalfigure"><a id="part0016_med_id00489a"></a><div class="mediaobject"><a id="part0016_med_id00489"></a><img alt="image with no caption" hisrc="figs/web/349fig02.png.jpg" src="../Images/image00986.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00490a"></a><div class="mediaobject"><a id="part0016_med_id00490"></a><img alt="image with no caption" hisrc="figs/web/350fig01.png.jpg" src="../Images/image00987.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00491a"></a><div class="mediaobject"><a id="part0016_med_id00491"></a><img alt="image with no caption" hisrc="figs/web/350fig02.png.jpg" src="../Images/image00988.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_taking_a_look_at_the_cafeacute_menu" style="clear: both">Taking a look at the Café Menu</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1090"></a><a class="indexterm" id="part0016_iddle1154"></a><a class="indexterm" id="part0016_iddle1533"></a><a class="indexterm" id="part0016_iddle1794"></a><a class="indexterm" id="part0016_iddle1821"></a><a class="indexterm" id="part0016_iddle2272"></a>Here’s the café menu. It doesn’t look like too much trouble to integrate the CafeMenu class into our framework... let’s check it out.</p><div class="informalfigure"><a id="part0016_med_id00492a"></a><div class="mediaobject"><a id="part0016_med_id00492"></a><img alt="image with no caption" hisrc="figs/web/351fig01.png.jpg" src="../Images/image00989.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_sharpen_your_pencil-id00106"></a><h3 class="title">Sharpen your pencil</h3><p>Before looking at the next page, quickly jot down the three things we have to do to this code to fit it into our framework:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">_______________________________________________</li><li class="listitem">_______________________________________________</li><li class="listitem">_______________________________________________</li></ol></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_reworking_the_cafeacute_menu_code" style="clear: both">Reworking the Café Menu code</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1091"></a><a class="indexterm" id="part0016_iddle1155"></a><a class="indexterm" id="part0016_iddle1721"></a><a class="indexterm" id="part0016_iddle1795"></a><a class="indexterm" id="part0016_iddle1811"></a><a class="indexterm" id="part0016_iddle1822"></a>Integrating the CafeMenu into our framework is easy. Why? Because HashMap is one of those Java collections that supports Iterator. But it’s not quite the same as ArrayList...</p><div class="informalfigure"><a id="part0016_med_id00493a"></a><div class="mediaobject"><a id="part0016_med_id00493"></a><img alt="image with no caption" hisrc="figs/web/352fig01.png.jpg" src="../Images/image00990.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_code_up_close-id00107"></a><h3 class="title">Code Up Close</h3><p>HashMap is a little more complex than the ArrayList because it supports both keys and values, but we can still get an Iterator for the values (which are the MenuItems).</p><div class="informalfigure"><a id="part0016_med_id00494a"></a><div class="mediaobject"><a id="part0016_med_id00494"></a><img alt="image with no caption" hisrc="figs/web/352fig02.png.jpg" src="../Images/image00991.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_adding_the_cafeacute_menu_to_the_waitres" style="clear: both">Adding the Café Menu to the Waitress</h2></div></div></div><p>That was easy; how about modifying the Waitress to support our new Menu? Now that the Waitress expects Iterators, that should be easy too.</p><div class="informalfigure"><a id="part0016_med_id00495a"></a><div class="mediaobject"><a id="part0016_med_id00495"></a><img alt="image with no caption" hisrc="figs/web/353fig01.png.jpg" src="../Images/image00992.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_breakfastcomma_lunch_and_dinner" style="clear: both">Breakfast, lunch AND dinner</h2></div></div></div><p>Let’s update our test drive to make sure this all works.</p><div class="informalfigure"><a id="part0016_med_id00496a"></a><div class="mediaobject"><a id="part0016_med_id00496"></a><img alt="image with no caption" hisrc="figs/web/354fig01.png.jpg" src="../Images/image00993.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0016_hereapostrophes_the_test_runsemicolon_ch">Here’s the test run; check out the new dinner menu from the Café!</h3></div></div></div><div class="informalfigure"><a id="part0016_med_id00497a"></a><div class="mediaobject"><a id="part0016_med_id00497"></a><img alt="image with no caption" hisrc="figs/web/354fig02.png.jpg" src="../Images/image00994.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_what_did_we_doquestion_mark" style="clear: both">What did we do?</h2></div></div></div><div class="informalfigure"><a id="part0016_med_id00498a"></a><div class="mediaobject"><a id="part0016_med_id00498"></a><img alt="image with no caption" hisrc="figs/web/355fig01.png.jpg" src="../Images/image00995.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_we_decoupled_the_waitresshellipdot" style="clear: both">We decoupled the Waitress....</h2></div></div></div><div class="informalfigure"><a id="part0016_med_id00499a"></a><div class="mediaobject"><a id="part0016_med_id00499"></a><img alt="image with no caption" hisrc="figs/web/355fig02.png.jpg" src="../Images/image00996.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_hellip_and_we_made_the_waitress_more_ext" style="clear: both">... and we made the Waitress more extensible</h2></div></div></div><div class="informalfigure"><a id="part0016_med_id00500a"></a><div class="mediaobject"><a id="part0016_med_id00500"></a><img alt="image with no caption" hisrc="figs/web/356fig01.png.jpg" src="../Images/image00997.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_but_thereapostrophes_moreexclamation_mar" style="clear: both">But there’s more!</h2></div></div></div><div class="informalfigure"><a id="part0016_med_id00501a"></a><div class="mediaobject"><a id="part0016_med_id00501"></a><img alt="image with no caption" hisrc="figs/web/356fig02.png.jpg" src="../Images/image00998.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_iterators_and_collections" style="clear: both">Iterators and Collections</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1063"></a><a class="indexterm" id="part0016_iddle1367"></a><a class="indexterm" id="part0016_iddle1838"></a><a class="indexterm" id="part0016_iddle1148"></a><a class="indexterm" id="part0016_iddle1722"></a><a class="indexterm" id="part0016_iddle1885"></a><a class="indexterm" id="part0016_iddle2494"></a><a class="indexterm" id="part0016_iddle1164"></a><a class="indexterm" id="part0016_iddle1723"></a><a class="indexterm" id="part0016_iddle1813"></a><a class="indexterm" id="part0016_iddle1840"></a><a class="indexterm" id="part0016_iddle1845"></a><a class="indexterm" id="part0016_iddle1856"></a><a class="indexterm" id="part0016_iddle1862"></a>We’ve been using a couple of classes that are part of the Java Collections Framework. This “framework” is just a set of classes and interfaces, including ArrayList, which we’ve been using, and many others like Vector, LinkedList, Stack, and PriorityQueue. Each of these classes implements the java.util.Collection interface, which contains a bunch of useful methods for manipulating groups of objects.</p><div class="informalfigure"><a id="part0016_med_id00502a"></a><div class="mediaobject"><a id="part0016_med_id00502"></a><img alt="image with no caption" hisrc="figs/web/common14.png.jpg" src="../Images/image00938.jpeg"/></div></div><p>Let’s take a quick look at the interface:</p><div class="informalfigure"><a id="part0016_med_id00503a"></a><div class="mediaobject"><a id="part0016_med_id00503"></a><img alt="image with no caption" hisrc="figs/web/357fig01.png.jpg" src="../Images/image00999.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note08"></a>Watch it!</h3><p><span class="strong"><strong>Hashtable is one of a few classes that</strong></span> <span class="bolditalic">indirectly</span> <span class="strong"><strong>supports Iterator.</strong></span></p><p><span class="emphasis"><em>As you saw when we implemented the CafeMenu, you could get an Iterator from it, but only by first retrieving its Collection called values. If you think about it, this makes sense: the HashMap holds two sets of objects: keys and values. If we want to iterate over its values, we first need to retrieve them from the HashMap, and then obtain the iterator.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00504a"></a><div class="mediaobject"><a id="part0016_med_id00504"></a><img alt="image with no caption" hisrc="figs/web/357fig02.png.jpg" src="../Images/image01000.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_code_magnets-id00108"></a><h3 class="title">Code Magnets</h3><p><a class="indexterm" id="part0016_iddle1142"></a><a class="indexterm" id="part0016_iddle1505"></a>The Chefs have decided that they want to be able to alternate their lunch menu items; in other words, they will offer some items on Monday, Wednesday, Friday, and Sunday, and other items on Tuesday, Thursday, and Saturday. Someone already wrote the code for a new “Alternating” DinerMenu Iterator so that it alternates the menu items, but she scrambled it up and put it on the fridge in the Diner as a joke. Can you put it back together? Some of the curly braces fell on the floor and they were too small to pick up, so feel free to add as many of those as you need.</p><div class="informalfigure"><a id="part0016_med_id00505a"></a><div class="mediaobject"><a id="part0016_med_id00505"></a><img alt="image with no caption" hisrc="figs/web/358fig01.png.jpg" src="../Images/image01001.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_is_the_waitress_ready_for_prime_timeques" style="clear: both">Is the Waitress ready for prime time?</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1416"></a><a class="indexterm" id="part0016_iddle1812"></a><a class="indexterm" id="part0016_iddle2088"></a>The Waitress has come a long way, but you’ve gotta admit those three calls to printMenu() are looking kind of ugly.</p><p>Let’s be real — every time we add a new menu we are going to have to open up the Waitress implementation and add more code. Can you say “violating the Open Closed Principle”?</p><div class="informalfigure"><a id="part0016_med_id00506a"></a><div class="mediaobject"><a id="part0016_med_id00506"></a><img alt="image with no caption" hisrc="figs/web/359fig01.png.jpg" src="../Images/image01002.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00507a"></a><div class="mediaobject"><a id="part0016_med_id00507"></a><img alt="image with no caption" hisrc="figs/web/359fig02.png.jpg" src="../Images/image01003.jpeg"/></div></div><p>It’s not the Waitress’ fault. We have done a great job of decoupling the menu implementation and extracting the iteration into an iterator. But we still are handling the menus with separate, independent objects — we need a way to manage them together.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note09"></a>Brain Power</h3><p>The Waitress still needs to make three calls to printMenu(), one for each menu. Can you think of a way to combine the menus so that only one call needs to be made? Or perhaps so that one Iterator is passed to the Waitress to iterate over all the menus?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00508a"></a><div class="mediaobject"><a id="part0016_med_id00508"></a><img alt="image with no caption" hisrc="figs/web/360fig01.png.jpg" src="../Images/image01004.jpeg"/></div></div><p>Sounds like the chef is on to something. Let’s give it a try:</p><div class="informalfigure"><a id="part0016_med_id00509a"></a><div class="mediaobject"><a id="part0016_med_id00509"></a><img alt="image with no caption" hisrc="figs/web/360fig02.png.jpg" src="../Images/image01005.jpeg"/></div></div><p>This looks pretty good, although we’ve lost the names of the menus, but we could add the names to each menu.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_just_when_we_thought_it_was_safehellip" style="clear: both">Just when we thought it was safe...</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1228"></a><a class="indexterm" id="part0016_iddle1439"></a>Now they want to add a dessert submenu.</p><p>Okay, now what? Now we have to support not only multiple menus, but menus within menus.</p><p>It would be nice if we could just make the dessert menu an element of the DinerMenu collection, but that won’t work as it is now implemented.</p><p>What we want (something like this):</p><div class="informalfigure"><a id="part0016_med_id00510a"></a><div class="mediaobject"><a id="part0016_med_id00510"></a><img alt="image with no caption" hisrc="figs/web/361fig01.png.jpg" src="../Images/image01006.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00511a"></a><div class="mediaobject"><a id="part0016_med_id00511"></a><img alt="image with no caption" hisrc="figs/web/361fig02.png.jpg" src="../Images/image01007.jpeg"/></div></div><p><span class="strong"><strong>We can’t assign a dessert menu to a MenuItem array.</strong></span></p><p><span class="strong"><strong>Time for a change!</strong></span></p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_what_do_we_needquestion_mark" style="clear: both">What do we need?</h2></div></div></div><p><a class="indexterm" id="part0016_iddle2209"></a>The time has come to make an executive decision to rework the chef’s implementation into something that is general enough to work over all the menus (and now submenus). That’s right, we’re going to tell the chefs that the time has come for us to reimplement their menus.</p><p>The reality is that we’ve reached a level of complexity such that if we don’t rework the design now, we’re never going to have a design that can accommodate further acquisitions or submenus.</p><p>So, what is it we really need out of our new design?</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00041"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We need some kind of a tree-shaped structure that will accommodate menus, submenus, and menu items.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00042"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We need to make sure we maintain a way to traverse the items in each menu that is at least as convenient as what we are doing now with iterators.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00043"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; "><p>We may need to traverse the items in a more flexible manner. For instance, we might need to iterate over only the Diner’s dessert menu, or we might need to iterate over the Diner’s entire menu, including the dessert submenu.</p></td></tr></tbody></table></div><div class="informalfigure"><a id="part0016_med_id00512a"></a><div class="mediaobject"><a id="part0016_med_id00512"></a><img alt="image with no caption" hisrc="figs/web/362fig01.png.jpg" src="../Images/image01008.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note10"></a>Note</h3><p>Because we need to represent menus, nested submenus and menu items, we can naturally fit them in a tree-like structure.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00513a"></a><div class="mediaobject"><a id="part0016_med_id00513"></a><img alt="image with no caption" hisrc="figs/web/363fig01.png.jpg" src="../Images/image01009.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note11"></a>Brain Power</h3><p>How would you handle this new wrinkle to our design requirements? Think about it before turning the page.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_composite_pattern_defined" style="clear: both">The Composite Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1160"></a><a class="indexterm" id="part0016_iddle1227"></a><a class="indexterm" id="part0016_iddle1245"></a><a class="indexterm" id="part0016_iddle1881"></a><a class="indexterm" id="part0016_iddle1969"></a><a class="indexterm" id="part0016_iddle2096"></a><a class="indexterm" id="part0016_iddle2479"></a>That’s right; we’re going to introduce another pattern to solve this problem. We didn’t give up on Iterator — it will still be part of our solution — however, the problem of managing menus has taken on a new dimension that Iterator doesn’t solve. So, we’re going to step back and solve it with the Composite Pattern.</p><p>We’re not going to beat around the bush on this pattern; we’re going to go ahead and roll out the official definition now:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note12"></a>Note</h3><p>Here’s a tree structure.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00514a"></a><div class="mediaobject"><a id="part0016_med_id00514"></a><img alt="image with no caption" hisrc="figs/web/364fig01.png.jpg" src="../Images/image01010.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note13"></a>Note</h3><p><span class="strong"><strong>The Composite Pattern</strong></span> allows you to compose objects into tree structures to represent part-whole hierarchies. Composite lets clients treat individual objects and compositions of objects uniformly.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Let’s think about this in terms of our menus: this pattern gives us a way to create a tree structure that can handle a nested group of menus <span class="emphasis"><em>and</em></span> menu items in the same structure. By putting menus and items in the same structure we create a part-whole hierarchy; that is, a tree of objects that is made of parts (menus and menu items) but that can be treated as a whole, like one big über menu.</p><p>Once we have our über menu, we can use this pattern to treat “individual objects and compositions uniformly.” What does that mean? It means if we have a tree structure of menus, submenus, and perhaps subsubmenus along with menu items, then any menu is a “composition” because it can contain both other menus and menu items. The individual objects are just the menu items — they don’t hold other objects. As you’ll see, using a design that follows the Composite Pattern is going to allow us to write some simple code that can apply the same operation (like printing!) over the entire menu structure.</p><div class="informalfigure"><a id="part0016_med_id00515a"></a><div class="mediaobject"><a id="part0016_med_id00515"></a><img alt="image with no caption" hisrc="figs/web/364fig02.png.jpg" src="../Images/image01011.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note14"></a>Note</h3><p>We can create arbitrarily complex trees.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00516a"></a><div class="mediaobject"><a id="part0016_med_id00516"></a><img alt="image with no caption" hisrc="figs/web/365fig01.png.jpg" src="../Images/image01012.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00517a"></a><div class="mediaobject"><a id="part0016_med_id00517"></a><img alt="image with no caption" hisrc="figs/web/365fig02.png.jpg" src="../Images/image01013.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note15"></a>Note</h3><p>Operations can be applied to the whole.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00518a"></a><div class="mediaobject"><a id="part0016_med_id00518"></a><img alt="image with no caption" hisrc="figs/web/365fig03.png.jpg" src="../Images/image01014.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note15a"></a>Note</h3><p>Or the parts.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>The Composite Pattern allows us to build structures of objects in the form of trees that contain both compositions of objects and individual objects as nodes.</strong></span></div><div><span class="strong"><strong>Using a composite structure, we can apply the same operations over both composites and individual objects. In other words, in most cases we can <span class="underline">ignore</span> the differences between compositions of objects and individual objects.</strong></span></div></blockquote></div><div class="informalfigure"><a id="part0016_med_id00519a"></a><div class="mediaobject"><a id="part0016_med_id00519"></a><img alt="image with no caption" hisrc="figs/web/366fig01.png.jpg" src="../Images/image01015.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_there_are_no_dumb_questions-id00109"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa3qe1"></a><a id="part0016_ch09qa3q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Component, Composite, Trees? I’m confused.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa3q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> A composite contains components. Components come in two flavors: composites and leaf elements. Sound recursive? It is. A composite holds a set of children; those children may be other composites or leaf elements.</div><div>When you organize data in this way you end up with a tree structure (actually an upside-down tree structure) with a composite at the root and branches of composites growing up to leaf nodes.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa3qe2"></a><a id="part0016_ch09qa3q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How does this relate to iterators?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0016_ch09qa3q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Remember, we’re taking a new approach. We’re going to re-implement the menus with a new solution: the Composite Pattern. So don’t look for some magical transformation from an iterator to a composite. That said, the two work very nicely together. You’ll soon see that we can use iterators in a couple of ways in the composite implementation.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_designing_menus_with_composite" style="clear: both">Designing Menus with Composite</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1157"></a><a class="indexterm" id="part0016_iddle1229"></a><a class="indexterm" id="part0016_iddle1440"></a>So, how do we apply the Composite Pattern to our menus? To start with, we need to create a component interface; this acts as the common interface for both menus and menu items and allows us to treat them uniformly. In other words, we can call the <span class="emphasis"><em>same</em></span> method on menus or menu items.</p><p>Now, it may not make <span class="emphasis"><em>sense</em></span> to call some of the methods on a menu item or a menu, but we can deal with that, and we will in just a moment. But for now, let’s take a look at a sketch of how the menus are going to fit into a Composite Pattern structure:</p><div class="informalfigure"><a id="part0016_med_id00520a"></a><div class="mediaobject"><a id="part0016_med_id00520"></a><img alt="image with no caption" hisrc="figs/web/367fig01.png.jpg" src="../Images/image01016.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_implementing_the_menu_component" style="clear: both">Implementing the Menu Component</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1158"></a><a class="indexterm" id="part0016_iddle1231"></a><a class="indexterm" id="part0016_iddle1442"></a><a class="indexterm" id="part0016_iddle2138"></a>Okay, we’re going to start with the MenuComponent abstract class; remember, the role of the menu component is to provide an interface for the leaf nodes and the composite nodes. Now you might be asking, “Isn’t the MenuComponent playing two roles?” It might well be and we’ll come back to that point. However, for now we’re going to provide a default implementation of the methods so that if the MenuItem (the leaf) or the Menu (the composite) doesn’t want to implement some of the methods (like getChild() for a leaf node) they can fall back on some basic behavior:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note16"></a>Note</h3><p><span class="strong"><strong>All components must implement the MenuComponent interface; however, because leaves and nodes have different roles we can’t always define a default implementation for each method that makes sense. Sometimes the best you can do is throw a runtime exception.</strong></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note17"></a>Note</h3><p>Because some of these methods only make sense for MenuItems, and some only make sense for Menus, the <span class="underline">default implementation</span> is UnsupportedOperationException. That way, if MenuItem or Menu doesn’t support an operation, they don’t have to do anything; they can just <span class="underline">inherit</span> the <span class="underline">default im</span>p<span class="underline">lementation</span>.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00521a"></a><div class="mediaobject"><a id="part0016_med_id00521"></a><img alt="image with no caption" hisrc="figs/web/368fig01.png.jpg" src="../Images/image01017.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_implementing_the_menu_item" style="clear: both">Implementing the Menu Item</h2></div></div></div><p>Okay, let’s give the MenuItem class a shot. Remember, this is the leaf class in the Composite diagram and it implements the behavior of the elements of the composite.</p><div class="informalfigure"><a id="part0016_med_id00522a"></a><div class="mediaobject"><a id="part0016_med_id00522"></a><img alt="image with no caption" hisrc="figs/web/369fig01.png.jpg" src="../Images/image01018.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00523a"></a><div class="mediaobject"><a id="part0016_med_id00523"></a><img alt="image with no caption" hisrc="figs/web/369fig02.png.jpg" src="../Images/image01019.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_implementing_the_composite_menu" style="clear: both">Implementing the Composite Menu</h2></div></div></div><p>Now that we have the MenuItem, we just need the composite class, which we’re calling Menu. Remember, the composite class can hold MenuItems <span class="emphasis"><em>or</em></span> other Menus. There’s a couple of methods from MenuComponent this class doesn’t implement: getPrice() and isVegetarian(), because those don’t make a lot of sense for a Menu.</p><div class="informalfigure"><a id="part0016_med_id00524a"></a><div class="mediaobject"><a id="part0016_med_id00524"></a><img alt="image with no caption" hisrc="figs/web/370fig01.png.jpg" src="../Images/image01020.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00525a"></a><div class="mediaobject"><a id="part0016_med_id00525"></a><img alt="image with no caption" hisrc="figs/web/371fig01.png.jpg" src="../Images/image01021.jpeg"/></div></div><p>Excellent catch. Because menu is a composite and contains both MenuItems and other Menus, its print() method should print everything it contains. If it didn’t we’d have to iterate through the entire composite and print each item ourselves. That kind of defeats the purpose of having a composite structure.</p><p>As you’re going to see, implementing print() correctly is easy because we can rely on each component to be able to print itself. It’s all wonderfully recursive and groovy. Check it out:</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0016_fixing_the_printleft_parenthesisright_pa">Fixing the print() method</h3></div></div></div><div class="informalfigure"><a id="part0016_med_id00526a"></a><div class="mediaobject"><a id="part0016_med_id00526"></a><img alt="image with no caption" hisrc="figs/web/371fig02.png.jpg" src="../Images/image01022.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note18"></a>Note</h3><p>NOTE: If, during this iteration, we encounter another Menu object, its print() method will start another iteration, and so on.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_getting_ready_for_a_test_drivehellip" style="clear: both">Getting ready for a test drive...</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1159"></a><a class="indexterm" id="part0016_iddle1161"></a><a class="indexterm" id="part0016_iddle1232"></a><a class="indexterm" id="part0016_iddle1246"></a><a class="indexterm" id="part0016_iddle1443"></a><a class="indexterm" id="part0016_iddle1882"></a><a class="indexterm" id="part0016_iddle1970"></a><a class="indexterm" id="part0016_iddle2480"></a>It’s about time we took this code for a test drive, but we need to update the Waitress code before we do — after all she’s the main client of this code:</p><div class="informalfigure"><a id="part0016_med_id00527a"></a><div class="mediaobject"><a id="part0016_med_id00527"></a><img alt="image with no caption" hisrc="figs/web/372fig01.png.jpg" src="../Images/image01023.jpeg"/></div></div><p>Okay, one last thing before we write our test drive. Let’s get an idea of what the menu composite is going to look like at runtime:</p><div class="informalfigure"><a id="part0016_med_id00528a"></a><div class="mediaobject"><a id="part0016_med_id00528"></a><img alt="image with no caption" hisrc="figs/web/372fig02.png.jpg" src="../Images/image01024.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_now_for_the_test_drivehellip" style="clear: both">Now for the test drive...</h2></div></div></div><p>Okay, now we just need a test drive. Unlike our previous version, we’re going to handle all the menu creation in the test drive. We could ask each chef to give us his new menu, but let’s get it all tested first. Here’s the code:</p><div class="informalfigure"><a id="part0016_med_id00529a"></a><div class="mediaobject"><a id="part0016_med_id00529"></a><img alt="image with no caption" hisrc="figs/web/373fig01.png.jpg" src="../Images/image01025.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_getting_ready_for_a_test_drivehe-id00110" style="clear: both">Getting ready for a test drive...</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note18a"></a>Note</h3><p>NOTE: this output is based on the complete source.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0016_med_id00530a"></a><div class="mediaobject"><a id="part0016_med_id00530"></a><img alt="image with no caption" hisrc="figs/web/374fig01.png.jpg" src="../Images/image01026.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00531a"></a><div class="mediaobject"><a id="part0016_med_id00531"></a><img alt="image with no caption" hisrc="figs/web/375fig01.png.jpg" src="../Images/image01027.jpeg"/></div></div><p><a class="indexterm" id="part0016_iddle1230"></a><a class="indexterm" id="part0016_iddle1244"></a><a class="indexterm" id="part0016_iddle1413"></a><a class="indexterm" id="part0016_iddle1441"></a><a class="indexterm" id="part0016_iddle1815"></a><a class="indexterm" id="part0016_iddle2064"></a><a class="indexterm" id="part0016_iddle2478"></a>There is some truth to that observation. We could say that the Composite Pattern takes the Single Responsibility design principle and trades it for <span class="emphasis"><em>transparency</em></span>. What’s transparency? Well, by allowing the Component interface to contain the child management operations <span class="emphasis"><em>and</em></span> the leaf operations, a client can treat both composites and leaf nodes uniformly; so whether an element is a composite or leaf node becomes transparent to the client.</p><p>Now given we have both types of operations in the Component class, we lose a bit of <span class="emphasis"><em>safety</em></span> because a client might try to do something inappropriate or meaningless on an element (like try to add a menu to a menu item). This is a design decision; we could take the design in the other direction and separate out the responsibilities into interfaces. This would make our design safe, in the sense that any inappropriate calls on elements would be caught at compile time or runtime, but we’d lose transparency and our code would have to use conditionals and the <code class="literal">instanceof</code> operator.</p><p>So, to return to your question, this is a classic case of tradeoff. We are guided by design principles, but we always need to observe the effect they have on our designs. Sometimes we purposely do things in a way that seems to violate the principle. In some cases, however, this is a matter of perspective; for instance, it might seem incorrect to have child management operations in the leaf nodes (like add(), remove() and getChild()), but then again you can always shift your perspective and see a leaf as a node with zero children.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_flashback_to_iterator" style="clear: both">Flashback to Iterator</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1162"></a><a class="indexterm" id="part0016_iddle1225"></a><a class="indexterm" id="part0016_iddle1233"></a><a class="indexterm" id="part0016_iddle1241"></a><a class="indexterm" id="part0016_iddle1248"></a><a class="indexterm" id="part0016_iddle1444"></a><a class="indexterm" id="part0016_iddle1830"></a><a class="indexterm" id="part0016_iddle1852"></a><a class="indexterm" id="part0016_iddle1971"></a>We promised you a few pages back that we’d show you how to use Iterator with a Composite. You know that we are already using Iterator in our internal implementation of the print() method, but we can also allow the Waitress to iterate over an entire composite if she needs to — for instance, if she wants to go through the entire menu and pull out vegetarian items.</p><p>To implement a Composite iterator, let’s add a createIterator() method in every component. We’ll start with the abstract MenuComponent class:</p><div class="informalfigure"><a id="part0016_med_id00532a"></a><div class="mediaobject"><a id="part0016_med_id00532"></a><img alt="image with no caption" hisrc="figs/web/376fig01.png.jpg" src="../Images/image01028.jpeg"/></div></div><p>Now we need to implement this method in the Menu and MenuItem classes:</p><div class="informalfigure"><a id="part0016_med_id00533a"></a><div class="mediaobject"><a id="part0016_med_id00533"></a><img alt="image with no caption" hisrc="figs/web/376fig02.png.jpg" src="../Images/image01029.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_composite_iterator" style="clear: both">The Composite Iterator</h2></div></div></div><p>The CompositeIterator is a SERIOUS iterator. It’s got the job of iterating over the MenuItems in the component, and of making sure all the child Menus (and child child Menus, and so on) are included.</p><p>Here’s the code. Watch out. This isn’t a lot of code, but it can be a little mind bending. As you go through it just repeat to yourself “recursion is my friend, recursion is my friend.”</p><div class="informalfigure"><a id="part0016_med_id00534a"></a><div class="mediaobject"><a id="part0016_med_id00534"></a><img alt="image with no caption" hisrc="figs/web/common19.png.jpg" src="../Images/image01030.jpeg"/></div></div><p><span class="strong"><strong>W<span class="smaller">ATCH</span> O<span class="smaller">UT</span>: R<span class="smaller">ECURSION</span> Z<span class="smaller">ONE</span> A<span class="smaller">HEAD</span></strong></span></p><div class="informalfigure"><a id="part0016_med_id00535a"></a><div class="mediaobject"><a id="part0016_med_id00535"></a><img alt="image with no caption" hisrc="figs/web/377fig01.png.jpg" src="../Images/image01031.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00536a"></a><div class="mediaobject"><a id="part0016_med_id00536"></a><img alt="image with no caption" hisrc="figs/web/378fig01.png.jpg" src="../Images/image01032.jpeg"/></div></div><p><a class="indexterm" id="part0016_iddle2139"></a>When we wrote the print() method in the MenuComponent class we used an iterator to step through each item in the component, and if that item was a Menu (rather than a MenuItem), then we recursively called the print() method to handle it. In other words, the MenuComponent handled the iteration itself, <span class="emphasis"><em>internally</em></span>.</p><p>With this code we are implementing an <span class="emphasis"><em>external</em></span> iterator so there is a lot more to keep track of. For starters, an external iterator must maintain its position in the iteration so that an outside client can drive the iteration by calling hasNext() and next(). But in this case, our code also needs to maintain that position over a composite, recursive structure. That’s why we use stacks to maintain our position as we move up and down the composite hierarchy.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note19"></a>Brain Power</h3><p>Draw a diagram of the Menus and MenuItems. Then pretend you are the CompositeIterator, and your job is to handle calls to hasNext() and next(). Trace the way the CompositeIterator traverses the structure as this code is executed:</p><a id="part0016_pro_id00036"></a><pre class="programlisting"><span class="strong"><strong>public void testCompositeIterator(MenuComponent component) {</strong></span>
       <span class="strong"><strong>CompositeIterator iterator = new CompositeIterator(component.iterator);</strong></span>

       <span class="strong"><strong>while(iterator.hasNext()) {</strong></span>
              <span class="strong"><strong>MenuComponent component = iterator.next();</strong></span>
       <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_null_iterator" style="clear: both">The Null Iterator</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1831"></a><a class="indexterm" id="part0016_iddle1972"></a>Okay, now what is this Null Iterator all about? Think about it this way: a MenuItem has nothing to iterate over, right? So how do we handle the implementation of its createIterator() method? Well, we have two choices:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0016_ch09note20"></a>Note</h3><p>NOTE: Another example of the Null Object “Design Pattern.”</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Choice one:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Return null</li><li class="listitem" style="list-style-type: none">We could return null from createIterator(), but then we’d need conditional code in the client to see if null was returned or not.</li></ul></div><p><span class="strong"><strong>Choice two:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Return an iterator that always returns false when hasNext() is called</li><li class="listitem" style="list-style-type: none">This seems like a better plan. We can still return an iterator, but the client doesn’t have to worry about whether or not null is ever returned. In effect, we’re creating an iterator that is a “no op.”</li></ul></div><p>The second choice certainly seems better. Let’s call it NullIterator and implement it.</p><div class="informalfigure"><a id="part0016_med_id00537a"></a><div class="mediaobject"><a id="part0016_med_id00537"></a><img alt="image with no caption" hisrc="figs/web/380fig01.png.jpg" src="../Images/image01033.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_give_me_the_vegetarian_menu" style="clear: both">Give me the vegetarian menu</h2></div></div></div><p><a class="indexterm" id="part0016_iddle1249"></a><a class="indexterm" id="part0016_iddle2495"></a>Now we’ve got a way to iterate over every item of the Menu. Let’s take that and give our Waitress a method that can tell us exactly which items are vegetarian.</p><div class="informalfigure"><a id="part0016_med_id00538a"></a><div class="mediaobject"><a id="part0016_med_id00538"></a><img alt="image with no caption" hisrc="figs/web/381fig01.png.jpg" src="../Images/image01034.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_magic_of_iterator_ampersand_composite_to" style="clear: both">The magic of Iterator &amp; Composite together...</h2></div></div></div><p>Whooo! It’s been quite a development effort to get our code to this point. Now we’ve got a general menu structure that should last the growing Diner empire for some time. Now it’s time to sit back and order up some veggie food:</p><div class="informalfigure"><a id="part0016_med_id00539a"></a><div class="mediaobject"><a id="part0016_med_id00539"></a><img alt="image with no caption" hisrc="figs/web/382fig01.png.jpg" src="../Images/image01035.jpeg"/></div></div><div class="informalfigure"><a id="part0016_med_id00540a"></a><div class="mediaobject"><a id="part0016_med_id00540"></a><img alt="image with no caption" hisrc="figs/web/383fig01.png.jpg" src="../Images/image01036.jpeg"/></div></div><p><a class="indexterm" id="part0016_iddle1247"></a><a class="indexterm" id="part0016_iddle2481"></a>Let’s take a look at what you’re talking about:</p><div class="informalfigure"><a id="part0016_med_id00541a"></a><div class="mediaobject"><a id="part0016_med_id00541"></a><img alt="image with no caption" hisrc="figs/web/383fig02.png.jpg" src="../Images/image01037.jpeg"/></div></div><p>In general we agree; try/catch is meant for error handling, not program logic. What are our other options? We could have checked the runtime type of the menu component with instanceof to make sure it’s a MenuItem before making the call to isVegetarian(). But in the process we’d lose <span class="emphasis"><em>transparency</em></span> because we wouldn’t be treating Menus and MenuItems uniformly.</p><p>We could also change isVegetarian() in the Menus so that it returns false. This provides a simple solution and we keep our transparency.</p><p>In our solution we are going for clarity: we really want to communicate that this is an unsupported operation on the Menu (which is different than saying isVegetarian() is false). It also allows for someone to come along and actually implement a reasonable isVegetarian() method for Menu and have it work with the existing code.</p><p>That’s our story and we’re stickin’ to it.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_patterns_exposed-id00111"></a><h3 class="title">Patterns Exposed</h3><p><a class="indexterm" id="part0016_iddle1163"></a><a class="indexterm" id="part0016_iddle1242"></a><a class="indexterm" id="part0016_iddle2527"></a><span class="strong"><strong>This week’s interview: The Composite Pattern, on implementation issues</strong></span></p><p><span class="strong"><strong>HeadFirst</strong></span>: We’re here tonight speaking with the Composite Pattern. Why don’t you tell us a little about yourself, Composite?</p><p><span class="strong"><strong>Composite</strong></span>: Sure... I’m the pattern to use when you have collections of objects with whole-part relationships and you want to be able to treat those objects uniformly.</p><p><span class="strong"><strong>HeadFirst</strong></span>: Okay, let’s dive right in here... what do you mean by whole-part relationships?</p><p><span class="strong"><strong>Composite</strong></span>: Imagine a graphical user interface; there you’ll often find a top level component like a Frame or a Panel, containing other components, like menus, text panes, scrollbars and buttons. So your GUI consists of several parts, but when you display it, you generally think of it as a whole. You tell the top level component to display, and count on that component to display all its parts. We call the components that contain other components, <span class="emphasis"><em>composite objects</em></span>, and components that don’t contain other components, <span class="emphasis"><em>leaf objects</em></span>.</p><p><span class="strong"><strong>HeadFirst</strong></span>: Is that what you mean by treating the objects uniformly? Having common methods you can call on composites and leaves?</p><p><span class="strong"><strong>Composite</strong></span>: Right. I can tell a composite object to display or a leaf object to display and it will do the right thing. The composite object will display by telling all its components to display.</p><p><span class="strong"><strong>HeadFirst</strong></span>: That implies that every object has the same interface. What if you have objects in your composite that do different things?</p><p><span class="strong"><strong>Composite</strong></span>: In order for the composite to work transparently to the client, you must implement the same interface for all objects in the composite; otherwise, the client has to worry about which interface each object is implementing, which kind of defeats the purpose. Obviously that means that at times you’ll have objects for which some of the method calls don’t make sense.</p><p><span class="strong"><strong>HeadFirst</strong></span>: So how do you handle that?</p><p><span class="strong"><strong>Composite</strong></span>: Well, there are a couple of ways to handle it; sometimes you can just do nothing, or return null or false — whatever makes sense in your application. Other times you’ll want to be more proactive and throw an exception. Of course, then the client has to be willing to do a little work and make sure that the method call didn’t do something unexpected.</p><p><span class="strong"><strong>HeadFirst</strong></span>: But if the client doesn’t know which kind of object they’re dealing with, how would they ever know which calls to make without checking the type?</p><p><span class="strong"><strong>Composite</strong></span>: If you’re a little creative you can structure your methods so that the default implementations do something that does make sense. For instance, if the client is calling getChild(), on the composite this makes sense. And it makes sense on a leaf too, if you think of the leaf as an object with no children.</p><p><span class="strong"><strong>HeadFirst</strong></span>: Ah... smart. But, I’ve heard some clients are so worried about this issue, that they require separate interfaces for different objects so they aren’t allowed to make nonsensical method calls. Is that still the Composite Pattern?</p><p><span class="strong"><strong>Composite</strong></span>: Yes. It’s a much safer version of the Composite Pattern, but it requires the client to check the type of every object before making a call so the object can be cast correctly.</p><p><span class="strong"><strong>HeadFirst</strong></span>: Tell us a little more about how these composite and leaf objects are structured.</p><p><span class="strong"><strong>Composite</strong></span>: Usually it’s a tree structure, some kind of hierarchy. The root is the top-level composite, and all its children are either composites or leaf nodes.</p><p><span class="strong"><strong>HeadFirst</strong></span>: Do children ever point back up to their parents?</p><p><span class="strong"><strong>Composite</strong></span>: Yes, a component can have a pointer to a parent to make traversal of the structure easier. And, if you have a reference to a child, and you need to delete it, you’ll need to get the parent to remove the child. Having the parent reference makes that easier too.</p><p><span class="strong"><strong>HeadFirst</strong></span>: There’s really quite a lot to consider in your implementation. Are there other issues we should think about when implementing the Composite Pattern?</p><p><span class="strong"><strong>Composite</strong></span>: Actually there are... one is the ordering of children. What if you have a composite that needs to keep its children in a particular order? Then you’ll need a more sophisticated management scheme for adding and removing children, and you’ll have to be careful about how you traverse the hierarchy.</p><p><span class="strong"><strong>HeadFirst</strong></span>: A good point I hadn’t thought of.</p><p><span class="strong"><strong>Composite</strong></span>: And did you think about caching?</p><p><span class="strong"><strong>HeadFirst</strong></span>: Caching?</p><p><span class="strong"><strong>Composite</strong></span>: Yeah, caching. Sometimes, if the composite structure is complex or expensive to traverse, it’s helpful to implement caching of the composite nodes. For instance, if you are constantly traversing a composite and all its children to compute some result, you could implement a cache that stores the result temporarily to save traversals.</p><p><span class="strong"><strong>HeadFirst</strong></span>: Well, there’s a lot more to the Composite Patterns than I ever would have guessed. Before we wrap this up, one more question: what do you consider your greatest strength?</p><p><span class="strong"><strong>Composite</strong></span>: I think I’d definitely have to say simplifying life for my clients. My clients don’t have to worry about whether they’re dealing with a composite object or a leaf object, so they don’t have to write if statements everywhere to make sure they’re calling the right methods on the right objects. Often, they can make one method call and execute an operation over an entire structure.</p><p><span class="strong"><strong>HeadFirst</strong></span>: That does sound like an important benefit. There’s no doubt you’re a useful pattern to have around for collecting and managing objects. And, with that, we’re out of time... Thanks so much for joining us and come back soon for another Patterns Exposed.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_design_patterns_crossword-id00112"></a><h3 class="title">Design Patterns Crossword</h3><p>Wrap your brain around this composite crossword.</p><div class="informalfigure"><a id="part0016_med_id00542a"></a><div class="mediaobject"><a id="part0016_med_id00542"></a><img alt="image with no caption" hisrc="figs/web/386fig01.png" src="../Images/image01038.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>5. Third company acquired.</p>
<p>6. This class indirectly supports Iterator.</p>
<p>12. HashMap and ArrayList both implement this interface.</p>
<p>13. A separate object that can traverse a collection.</p>
<p>15. We deleted PancakeHouseMenuIterator because this class already provides an Iterator.</p>
<p>16. Has no children.</p>
<p>17. Name of principle that states only one responsibility per class (two words).</p>
<p>19. CompositeIterator used a lot of this.</p></td><td style="vertical-align: top; "><p>1. A class should have only one reason to do this.</p>
<p>2. We encapsulated this.</p>
<p>3. The Iterator Pattern decouples the client from the aggregate’s _________.</p>
<p>4. Merged with the Diner (two words).</p>
<p>7. User interface packages often use this pattern for their components.</p>
<p>8. Collection and Iterator are in this package.</p>
<p>9. Iterators are usually created using this pattern (two words).</p>
<p>10. A composite holds this.</p>
<p>11. We Java-enabled her.</p>
<p>14. This menu caused us to change our entire implementation.</p>
<p>18. A component can be a composite or this.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_who_does_whatquestion_mark-id00113"></a><h3 class="title">Who Does What?</h3><p><a class="indexterm" id="part0016_iddle1023"></a><a class="indexterm" id="part0016_iddle1234"></a><a class="indexterm" id="part0016_iddle1582"></a><a class="indexterm" id="part0016_iddle1607"></a><a class="indexterm" id="part0016_iddle1817"></a><a class="indexterm" id="part0016_iddle2036"></a><a class="indexterm" id="part0016_iddle2410"></a><a class="indexterm" id="part0016_iddle2519"></a>Match each pattern with its description:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Description</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Strategy</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Clients treat collections of objects and individual objects uniformly</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Adapter</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Provides a way to traverse a collection of objects without exposing the collection’s implementation</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Iterator</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Simplifies the interface of a group of classes</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Facade</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Changes the interface of one or more classes</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Composite</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Allows a group of objects to be notified when some state changes</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Observer</p></td><td style="vertical-align: top; "><p>Encapsulates interchangeable behaviors and uses delegation to decide which one to use</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0016_tools_for_your_design_toolbox-id00114" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>Two new patterns for your toolbox — two great ways to deal with collections of objects.</p><div class="informalfigure"><a id="part0016_med_id00543a"></a><div class="mediaobject"><a id="part0016_med_id00543"></a><img alt="image with no caption" hisrc="figs/web/388fig01.png.jpg" src="../Images/image01039.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_bullet_points-id00115"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">An Iterator allows access to an aggregate’s elements without exposing its internal structure.</li><li class="listitem">An Iterator takes the job of iterating over an aggregate and encapsulates it in another object.</li><li class="listitem">When using an Iterator, we relieve the aggregate of the responsibility of supporting operations for traversing its data.</li><li class="listitem">An Iterator provides a common interface for traversing the items of an aggregate, allowing you to use polymorphism when writing code that makes use of the items of the aggregate.</li><li class="listitem">We should strive to assign only one responsibility to each class.</li><li class="listitem">The Composite Pattern provides a structure to hold both individual objects and composites.</li><li class="listitem">The Composite Pattern allows clients to treat composites and individual objects uniformly.</li><li class="listitem">A Component is any object in a Composite structure. Components may be other composites or leaf nodes.</li><li class="listitem">There are many design tradeoffs in implementing Composite. You need to balance transparency and safety with your needs.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_sharpen_your_pencil_solution-id00116"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0016_iddle1534"></a><a class="indexterm" id="part0016_iddle1556"></a><a class="indexterm" id="part0016_iddle2273"></a><a class="indexterm" id="part0016_iddle2301"></a>Based on our implementation of printMenu(), which of the following apply?</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00044"></a><img alt="" hisrc="figs/web/389fig01.png.jpg" src="../Images/image01040.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We are coding to the PancakeHouseMenu and DinerMenu concrete implementations, not to an interface.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00045"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Waitress doesn’t implement the Java Waitress API and so she isn’t adhering to a standard.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00046"></a><img alt="" hisrc="figs/web/389fig02.png.jpg" src="../Images/image01041.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>If we decided to switch from using DinerMenu to another type of menu that implemented its list of menu items with a Hashtable, we’d have to modify a lot of code in the Waitress.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00047"></a><img alt="" hisrc="figs/web/389fig03.png.jpg" src="../Images/image01042.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>The Waitress needs to know how each menu represents its internal collection of menu items; this violates encapsulation.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00048"></a><img alt="" hisrc="figs/web/389fig04.png.jpg" src="../Images/image01043.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We have duplicate code: the printMenu() method needs two separate loops to iterate over the two different kinds of menus. And if we added a third menu, we’d have yet another loop.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0016_inline_id00049"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>The implementation isn’t based on MXML (Menu XML) and so isn’t as interoperable as it should be.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_sharpen_your_pencil_solution-id00117"></a><h3 class="title">Sharpen your pencil Solution</h3><p>Before looking at the next page, quickly jot down the three things we have to do to this code to fit it into our framework:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="underline">implement the Menu interface</span>_________________________________________________________</li><li class="listitem"><span class="underline">get rid of getItems()</span>____________________________________________________________________</li><li class="listitem"><span class="underline">add createIterator() and return an Iterator that can step through the Hashtable values</span>___</li></ol></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_code_magnets_solution-id00118"></a><h3 class="title">Code Magnets Solution</h3><p><a class="indexterm" id="part0016_iddle1143"></a><a class="indexterm" id="part0016_iddle1506"></a>The unscrambled “Alternating” DinerMenu Iterator.</p><div class="informalfigure"><a id="part0016_med_id00544a"></a><div class="mediaobject"><a id="part0016_med_id00544"></a><img alt="image with no caption" hisrc="figs/web/390fig01.png.jpg" src="../Images/image01044.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_who_does_whatquestion_mark_solut-id00119"></a><h3 class="title">Who Does What? Solution</h3><p><a class="indexterm" id="part0016_iddle1024"></a><a class="indexterm" id="part0016_iddle1235"></a><a class="indexterm" id="part0016_iddle1583"></a><a class="indexterm" id="part0016_iddle1608"></a><a class="indexterm" id="part0016_iddle1818"></a><a class="indexterm" id="part0016_iddle2037"></a><a class="indexterm" id="part0016_iddle2411"></a><a class="indexterm" id="part0016_iddle2520"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="part0016_med_id00545a"></a><div class="mediaobject"><a id="part0016_med_id00545"></a><img alt="image with no caption" hisrc="figs/web/391fig01.png.jpg" src="../Images/image01045.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0016_design_patterns_crossword_soluti-id00120"></a><h3 class="title">Design Patterns Crossword Solution</h3><p>Wrap your brain around this composite crossword. Here’s our solution.</p><div class="informalfigure"><a id="part0016_med_id00546a"></a><div class="mediaobject"><a id="part0016_med_id00546"></a><img alt="image with no caption" hisrc="figs/web/392fig01.png" src="../Images/image01046.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0017_state_pattern_the_state_of_things"><div class="titlepage" id="part0017_aid-G6PI2"><div><div><h2 class="title">Chapter 10. The State Pattern: The State of Things</h2></div></div></div><div class="informalfigure"><a id="part0017_med_id00547a"></a><div class="mediaobject"><a id="part0017_med_id00547"></a><img alt="image with no caption" hisrc="figs/web/393fig01.png.jpg" src="../Images/image01047.jpeg"/></div></div><p><span class="strong"><strong>A little-known fact: the Strategy and State Patterns were twins separated at birth.</strong></span> As you know, the Strategy Pattern went on to create a wildly successful business around interchangeable algorithms. State, however, took the perhaps more noble path of helping objects to control their behavior by changing their internal state. He’s often overheard telling his object clients, “Just repeat after me: I’m good enough, I’m smart enough, and doggonit...”</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_jawva_breakers" style="clear: both">Ja<span class="strikethrough">w</span>va Breakers</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1689"></a><a class="indexterm" id="part0017_iddle2377"></a>Java toasters are so ’90s. Today people are building Java into <span class="emphasis"><em>real</em></span> devices, like gumball machines. That’s right, gumball machines have gone high tech; the major manufacturers have found that by putting CPUs into their machines, they can increase sales, monitor inventory over the network and measure customer satisfaction more accurately.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0017_ch10note01"></a>Note</h3><p>At least that’s their story – we think they just got bored with the circa 1800’s technology and needed to find a way to make their jobs more exciting.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>But these manufacturers are gumball machine experts, not software developers, and they’ve asked for your help:</p><div class="informalfigure"><a id="part0017_med_id00548a"></a><div class="mediaobject"><a id="part0017_med_id00548"></a><img alt="image with no caption" hisrc="figs/web/394fig01.png.jpg" src="../Images/image01048.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00549a"></a><div class="mediaobject"><a id="part0017_med_id00549"></a><img alt="image with no caption" hisrc="figs/web/394fig02.png.jpg" src="../Images/image01049.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_cubicle_conversation-id00121" style="clear: both">Cubicle Conversation</h2></div></div></div><div class="informalfigure"><a id="part0017_med_id00550a"></a><div class="mediaobject"><a id="part0017_med_id00550"></a><img alt="image with no caption" hisrc="figs/web/395fig01.png.jpg" src="../Images/image01050.jpeg"/></div></div><p><span class="strong"><strong>Judy</strong></span>: This diagram looks like a state diagram.</p><p><span class="strong"><strong>Joe</strong></span>: Right, each of those circles is a state...</p><p><span class="strong"><strong>Judy</strong></span>: ... and each of the arrows is a state transition.</p><p><span class="strong"><strong>Frank</strong></span>: Slow down, you two, it’s been too long since I studied state diagrams. Can you remind me what they’re all about?</p><p><span class="strong"><strong>Judy</strong></span>: Sure, Frank. Look at the circles; those are states. “No Quarter” is probably the starting state for the gumball machine because it’s just sitting there waiting for you to put your quarter in. All states are just different configurations of the machine that behave in a certain way and need some action to take them to another state.</p><p><span class="strong"><strong>Joe</strong></span>: Right. See, to go to another state, you need to do something like put a quarter in the machine. See the arrow from “No Quarter” to “Has Quarter”?</p><p><span class="strong"><strong>Frank</strong></span>: Yes...</p><p><span class="strong"><strong>Joe</strong></span>: That just means that if the gumball machine is in the “No Quarter” state and you put a quarter in, it will change to the “Has Quarter” state. That’s the state transition.</p><p><span class="strong"><strong>Frank</strong></span>: Oh, I see! And if I’m in the “Has Quarter” state, I can turn the crank and change to the “Gumball Sold” state, or eject the quarter and change back to the “No Quarter” state.</p><p><span class="strong"><strong>Judy</strong></span>: You got it!</p><p><span class="strong"><strong>Frank</strong></span>: This doesn’t look too bad then. We’ve obviously got four states, and I think we also have four actions: “inserts quarter,” “ejects quarter,” “turns crank” and “dispense.” But... when we dispense, we test for zero or more gumballs in the “Gumball Sold” state, and then either go to the “Out of Gumballs” state or the “No Quarter” state. So we actually have five transitions from one state to another.</p><p><span class="strong"><strong>Judy</strong></span>: That test for zero or more gumballs also implies we’ve got to keep track of the number of gumballs too. Any time the machine gives you a gumball, it might be the last one, and if it is, we need to transition to the “Out of Gumballs” state.</p><p><span class="strong"><strong>Joe</strong></span>: Also, don’t forget that you could do nonsensical things, like try to eject the quarter when the gumball machine is in the “No Quarter” state, or insert two quarters.</p><p><span class="strong"><strong>Frank</strong></span>: Oh, I didn’t think of that; we’ll have to take care of those too.</p><p><span class="strong"><strong>Joe</strong></span>: For every possible action we’ll just have to check to see which state we’re in and act appropriately. We can do this! Let’s start mapping the state diagram to code...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_state_machines_101" style="clear: both">State machines 101</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1692"></a><a class="indexterm" id="part0017_iddle1921"></a><a class="indexterm" id="part0017_iddle2371"></a><a class="indexterm" id="part0017_iddle2380"></a><a class="indexterm" id="part0017_iddle2387"></a>How are we going to get from that state diagram to actual code? Here’s a quick introduction to implementing state machines:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① First, gather up your states:<div class="informalfigure"><a id="part0017_med_id00551a"></a><div class="mediaobject"><a id="part0017_med_id00551"></a><img alt="image with no caption" hisrc="figs/web/396fig01.png.jpg" src="../Images/image01051.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② Next, create an instance variable to hold the current state, and define values for each of the states:<div class="informalfigure"><a id="part0017_med_id00552a"></a><div class="mediaobject"><a id="part0017_med_id00552"></a><img alt="image with no caption" hisrc="figs/web/396fig02.png.jpg" src="../Images/image01052.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ Now we gather up all the actions that can happen in the system:<div class="informalfigure"><a id="part0017_med_id00553a"></a><div class="mediaobject"><a id="part0017_med_id00553"></a><img alt="image with no caption" hisrc="figs/web/396fig03.png.jpg" src="../Images/image01053.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">④ Now we create a class that acts as the state machine. For each action, we create a method that uses conditional statements to determine what behavior is appropriate in each state. For instance, for the insert quarter action, we might write a method like this:<div class="informalfigure"><a id="part0017_med_id00554a"></a><div class="mediaobject"><a id="part0017_med_id00554"></a><img alt="image with no caption" hisrc="figs/web/397fig01.png.jpg" src="../Images/image01054.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00555a"></a><div class="mediaobject"><a id="part0017_med_id00555"></a><img alt="image with no caption" hisrc="figs/web/397fig02.png.jpg" src="../Images/image01055.jpeg"/></div></div></li></ul></div><p>With that quick review, let’s go implement the Gumball Machine!</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_writing_the_code" style="clear: both">Writing the code</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1708"></a><a class="indexterm" id="part0017_iddle2385"></a>It’s time to implement the Gumball Machine. We know we’re going to have an instance variable that holds the current state. From there, we just need to handle all the actions, behaviors and state transitions that can happen. For actions, we need to implement inserting a quarter, removing a quarter, turning the crank, and dispensing a gumball; we also have the empty Gumball Machine condition to implement.</p><div class="informalfigure"><a id="part0017_med_id00556a"></a><div class="mediaobject"><a id="part0017_med_id00556"></a><img alt="image with no caption" hisrc="figs/web/398fig01.png.jpg" src="../Images/image01056.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00557a"></a><div class="mediaobject"><a id="part0017_med_id00557"></a><img alt="image with no caption" hisrc="figs/web/399fig01.png.jpg" src="../Images/image01057.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_in-house_testing" style="clear: both">In-house testing</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1707"></a><a class="indexterm" id="part0017_iddle2384"></a>That feels like a nice solid design using a well-thought-out methodology, doesn’t it? Let’s do a little in-house testing before we hand it off to Mighty Gumball to be loaded into their actual gumball machines. Here’s our test harness:</p><div class="informalfigure"><a id="part0017_med_id00558a"></a><div class="mediaobject"><a id="part0017_med_id00558"></a><img alt="image with no caption" hisrc="figs/web/400fig01.png.jpg" src="../Images/image01058.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_you_knew_it_was_cominghellip_a_change_re" style="clear: both">You knew it was coming... a change request!</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1694"></a><a class="indexterm" id="part0017_iddle2065"></a><a class="indexterm" id="part0017_iddle2388"></a><span class="strong"><strong>Mighty Gumball, Inc., has loaded your code into their newest machine and their quality assurance experts are putting it through its paces. So far, everything’s looking great from their perspective.</strong></span></p><p><span class="strong"><strong>In fact, things have gone so smoothly they’d like to take things to the next level...</strong></span></p><div class="informalfigure"><a id="part0017_med_id00559a"></a><div class="mediaobject"><a id="part0017_med_id00559"></a><img alt="image with no caption" hisrc="figs/web/402fig01.png.jpg" src="../Images/image01059.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_design_puzzle-id00122"></a><h3 class="title">Design Puzzle</h3><p><a class="indexterm" id="part0017_iddle1432"></a><a class="indexterm" id="part0017_iddle1512"></a><a class="indexterm" id="part0017_iddle1698"></a><a class="indexterm" id="part0017_iddle2069"></a><a class="indexterm" id="part0017_iddle2392"></a>Draw a state diagram for a Gumball Machine that handles the 1 in 10 contest. In this contest, 10% of the time the Sold state leads to two balls being released, not one. Check your answer with ours (at the end of the chapter) to make sure we agree before you go further...</p><div class="informalfigure"><a id="part0017_med_id00560a"></a><div class="mediaobject"><a id="part0017_med_id00560"></a><img alt="image with no caption" hisrc="figs/web/403fig01.png" src="../Images/image01060.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_messy_state_of_thingshellip" style="clear: both">The messy STATE of things...</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1417"></a><a class="indexterm" id="part0017_iddle1535"></a><a class="indexterm" id="part0017_iddle1697"></a><a class="indexterm" id="part0017_iddle2068"></a><a class="indexterm" id="part0017_iddle2089"></a><a class="indexterm" id="part0017_iddle2274"></a><a class="indexterm" id="part0017_iddle2391"></a>Just because you’ve written your gumball machine using a well-thought-out methodology doesn’t mean it’s going to be easy to extend. In fact, when you go back and look at your code and think about what you’ll have to do to modify it, well...</p><div class="informalfigure"><a id="part0017_med_id00561a"></a><div class="mediaobject"><a id="part0017_med_id00561"></a><img alt="image with no caption" hisrc="figs/web/404fig01.png.jpg" src="../Images/image01061.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil-id00123"></a><h3 class="title">Sharpen your pencil</h3><p>Which of the following describe the state of our implementation? (Choose all that apply.)</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00050"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code certainly isn’t adhering to the Open Closed Principle.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00051"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code would make a FORTRAN programmer proud.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00052"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This design isn’t even very object-oriented.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00053"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>State transitions aren’t explicit; they are buried in the middle of a bunch of conditional statements.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00054"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We haven’t encapsulated anything that varies here.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00055"></a><img alt="" hisrc="figs/web/square.png.jpg" src="../Images/image00519.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>Further additions are likely to cause bugs in working code.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0017_med_id00562a"></a><div class="mediaobject"><a id="part0017_med_id00562"></a><img alt="image with no caption" hisrc="figs/web/405fig01.png.jpg" src="../Images/image01062.jpeg"/></div></div><p><a class="indexterm" id="part0017_iddle1409"></a><a class="indexterm" id="part0017_iddle1473"></a><a class="indexterm" id="part0017_iddle1676"></a><span class="strong"><strong>Frank</strong></span>: You’re right about that! We need to refactor this code so that it’s easy to maintain and modify.</p><p><span class="strong"><strong>Judy</strong></span>: We really should try to localize the behavior for each state so that if we make changes to one state, we don’t run the risk of messing up the other code.</p><p><span class="strong"><strong>Frank</strong></span>: Right; in other words, follow that ol’ “encapsulate what varies” principle.</p><p><span class="strong"><strong>Judy</strong></span>: Exactly.</p><p><span class="strong"><strong>Frank</strong></span>: If we put each state’s behavior in its own class, then every state just implements its own actions.</p><p><span class="strong"><strong>Judy</strong></span>: Right. And maybe the Gumball Machine can just delegate to the state object that represents the current state.</p><p><span class="strong"><strong>Frank</strong></span>: Ah, you’re good: favor composition... more principles at work.</p><p><span class="strong"><strong>Judy</strong></span>: Cute. Well, I’m not 100% sure how this is going to work, but I think we’re on to something.</p><p><span class="strong"><strong>Frank</strong></span>: I wonder if this will make it easier to add new states?</p><p><span class="strong"><strong>Judy</strong></span>: I think so... We’ll still have to change code, but the changes will be much more limited in scope because adding a new state will mean we just have to add a new class and maybe change a few transitions here and there.</p><p><span class="strong"><strong>Frank</strong></span>: I like the sound of that. Let’s start hashing out this new design!</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_new_design" style="clear: both">The new design</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1703"></a><a class="indexterm" id="part0017_iddle2074"></a><a class="indexterm" id="part0017_iddle2397"></a>It looks like we’ve got a new plan: instead of maintaining our existing code, we’re going to rework it to encapsulate state objects in their own classes and then delegate to the current state when an action occurs.</p><p>We’re following our design principles here, so we should end up with a design that is easier to maintain down the road. Here’s how we’re going to do it:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① First, we’re going to define a State interface that contains a method for every action in the Gumball Machine.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Then we’re going to implement a State class for every state of the machine. These classes will be responsible for the behavior of the machine when it is in the corresponding state.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Finally, we’re going to get rid of all of our conditional code and instead delegate to the State class to do the work for us.</strong></span></li></ul></div><p>Not only are we following design principles, as you’ll see, we’re actually implementing the State Pattern. But we’ll get to all the official State Pattern stuff after we rework our code...</p><div class="informalfigure"><a id="part0017_med_id00563a"></a><div class="mediaobject"><a id="part0017_med_id00563"></a><img alt="image with no caption" hisrc="figs/web/406fig01.png.jpg" src="../Images/image01063.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_defining_the_state_interfaces_and_classe" style="clear: both">Defining the State interfaces and classes</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1122"></a>First let’s create an interface for State, which all our states implement:</p><div class="informalfigure"><a id="part0017_med_id00564a"></a><div class="mediaobject"><a id="part0017_med_id00564"></a><img alt="image with no caption" hisrc="figs/web/407fig01.png.jpg" src="../Images/image01064.jpeg"/></div></div><p>Then take each state in our design and encapsulate it in a class that implements the State interface.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil-id00124"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0017_iddle1527"></a><a class="indexterm" id="part0017_iddle1695"></a><a class="indexterm" id="part0017_iddle2066"></a><a class="indexterm" id="part0017_iddle2266"></a><a class="indexterm" id="part0017_iddle2389"></a>To implement our states, we first need to specify the behavior of the classes when each action is called. Annotate the diagram below with the behavior of each action in each class; we’ve already filled in a few for you.</p><div class="informalfigure"><a id="part0017_med_id00565a"></a><div class="mediaobject"><a id="part0017_med_id00565"></a><img alt="image with no caption" hisrc="figs/web/408fig01.png.jpg" src="../Images/image01065.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_implementing_our_state_classes" style="clear: both">Implementing our State classes</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1123"></a><a class="indexterm" id="part0017_iddle1700"></a><a class="indexterm" id="part0017_iddle2071"></a><a class="indexterm" id="part0017_iddle2394"></a>Time to implement a state: we know what behaviors we want; we just need to get it down in code. We’re going to closely follow the state machine code we wrote, but this time everything is broken out into different classes.</p><p>Let’s start with the NoQuarterState:</p><div class="informalfigure"><a id="part0017_med_id00566a"></a><div class="mediaobject"><a id="part0017_med_id00566"></a><img alt="image with no caption" hisrc="figs/web/409fig01.png.jpg" src="../Images/image01066.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00567a"></a><div class="mediaobject"><a id="part0017_med_id00567"></a><img alt="image with no caption" hisrc="figs/web/409fig02.png.jpg" src="../Images/image01067.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_reworking_the_gumball_machine" style="clear: both">Reworking the Gumball Machine</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1127"></a><a class="indexterm" id="part0017_iddle1704"></a><a class="indexterm" id="part0017_iddle2075"></a><a class="indexterm" id="part0017_iddle2398"></a>Before we finish the State classes, we’re going to rework the Gumball Machine — that way you can see how it all fits together. We’ll start with the state-related instance variables and switch the code from using integers to using state objects:</p><div class="informalfigure"><a id="part0017_med_id00568a"></a><div class="mediaobject"><a id="part0017_med_id00568"></a><img alt="image with no caption" hisrc="figs/web/410fig01.png.jpg" src="../Images/image01068.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_nowcomma_letapostrophes_look_at_the_comp" style="clear: both">Now, let’s look at the complete GumballMachine class...</h2></div></div></div><div class="informalfigure"><a id="part0017_med_id00569a"></a><div class="mediaobject"><a id="part0017_med_id00569"></a><img alt="image with no caption" hisrc="figs/web/411fig01.png.jpg" src="../Images/image01069.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_implementing_more_states" style="clear: both">Implementing more states</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1124"></a><a class="indexterm" id="part0017_iddle1701"></a><a class="indexterm" id="part0017_iddle2072"></a><a class="indexterm" id="part0017_iddle2395"></a>Now that you’re starting to get a feel for how the Gumball Machine and the states fit together, let’s implement the HasQuarterState and the SoldState classes...</p><div class="informalfigure"><a id="part0017_med_id00570a"></a><div class="mediaobject"><a id="part0017_med_id00570"></a><img alt="image with no caption" hisrc="figs/web/412fig01.png.jpg" src="../Images/image01070.jpeg"/></div></div><p>Now, let’s check out the SoldState class...</p><div class="informalfigure"><a id="part0017_med_id00571a"></a><div class="mediaobject"><a id="part0017_med_id00571"></a><img alt="image with no caption" hisrc="figs/web/413fig01.png.jpg" src="../Images/image01071.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0017_ch10note02"></a>Brain Power</h3><p>Look back at the GumballMachine implementation. If the crank is turned and not successful (say the customer didn’t insert a quarter first), we call dispense anyway, even though it’s unnecessary. How might you fix this?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil-id00125"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0017_iddle1549"></a><a class="indexterm" id="part0017_iddle2291"></a>We have one remaining class we haven’t implemented: SoldOutState. Why don’t you implement it? To do this, carefully think through how the Gumball Machine should behave in each situation. Check your answer before moving on...</p><a id="part0017_pro_id00037"></a><pre class="programlisting"><span class="strong"><strong>public class SoldOutState implements _______________ {</strong></span>
    <span class="strong"><strong>GumballMachine gumballMachine;</strong></span>

     <span class="strong"><strong>public SoldOutState(GumballMachine gumballMachine) {</strong></span>


     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void insertQuarter() {</strong></span>



     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void ejectQuarter() {</strong></span>


     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void turnCrank() {</strong></span>




     <span class="strong"><strong>}</strong></span>


     <span class="strong"><strong>public void dispense() {</strong></span>




     <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_letapostrophes_take_a_look_at_what_weapo" style="clear: both">Let’s take a look at what we’ve done so far...</h2></div></div></div><p>For starters, you now have a Gumball Machine implementation that is <span class="emphasis"><em>structurally</em></span> quite different from your first version, and yet <span class="emphasis"><em>functionally it is exactly the same</em></span>. By structurally changing the implemention, you’ve:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Localized the behavior of each state into its own class.</li><li class="listitem">Removed all the troublesome <code class="literal">if</code> statements that would have been difficult to maintain.</li><li class="listitem">Closed each state for modification, and yet left the Gumball Machine open to extension by adding new state classes (and we’ll do this in a second).</li><li class="listitem">Created a code base and class structure that maps much more closely to the Mighty Gumball diagram and is easier to read and understand.</li></ul></div><p>Now let’s look a little more at the functional aspect of what we did:</p><div class="informalfigure"><a id="part0017_med_id00572a"></a><div class="mediaobject"><a id="part0017_med_id00572"></a><img alt="image with no caption" hisrc="figs/web/415fig01.png.jpg" src="../Images/image01072.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00573a"></a><div class="mediaobject"><a id="part0017_med_id00573"></a><img alt="image with no caption" hisrc="figs/web/416fig01.png.jpg" src="../Images/image01073.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil-id00126"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0017_iddle1525"></a><a class="indexterm" id="part0017_iddle2264"></a><span class="strong"><strong>Behind the Scenes: Self-Guided Tour</strong></span></p><div class="informalfigure"><a id="part0017_med_id00574a"></a><div class="mediaobject"><a id="part0017_med_id00574"></a><img alt="image with no caption" hisrc="figs/web/common17.png.jpg" src="../Images/image00686.jpeg"/></div></div><p>Trace the steps of the Gumball Machine starting with the NoQuarter state. Also annotate the diagram with actions and output of the machine. For this exercise you can assume there are plenty of gumballs in the machine.</p><div class="informalfigure"><a id="part0017_med_id00575a"></a><div class="mediaobject"><a id="part0017_med_id00575"></a><img alt="image with no caption" hisrc="figs/web/417fig01.png.jpg" src="../Images/image01074.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_state_pattern_defined" style="clear: both">The State Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0017_iddle2372"></a><a class="indexterm" id="part0017_iddle2433"></a>Yes, it’s true, we just implemented the State Pattern! So now, let’s take a look at what it’s all about:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0017_ch10note03"></a>Note</h3><p><span class="strong"><strong>The State Pattern</strong></span> allows an object to alter its behavior when its internal state changes. The object will appear to change its class.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>The first part of this description makes a lot of sense, right? Because the pattern encapsulates state into separate classes and delegates to the object representing the current state, we know that behavior changes along with the internal state. The Gumball Machine provides a good example: when the gumball machine is in the NoQuarterState and you insert a quarter, you get different behavior (the machine accepts the quarter) than if you insert a quarter when it’s in the HasQuarterState (the machine rejects the quarter).</p><p>What about the second part of the definition? What does it mean for an object to “appear to change its class”? Think about it from the perspective of a client: if an object you’re using can completely change its behavior, then it appears to you that the object is actually instantiated from another class. In reality, however, you know that we are using composition to give the appearance of a class change by simply referencing different state objects.</p><p>Okay, now it’s time to check out the State Pattern class diagram:</p><div class="informalfigure"><a id="part0017_med_id00576a"></a><div class="mediaobject"><a id="part0017_med_id00576"></a><img alt="image with no caption" hisrc="figs/web/418fig01.png.jpg" src="../Images/image01075.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00577a"></a><div class="mediaobject"><a id="part0017_med_id00577"></a><img alt="image with no caption" hisrc="figs/web/419fig01.png.jpg" src="../Images/image01076.jpeg"/></div></div><p><a class="indexterm" id="part0017_iddle2401"></a><a class="indexterm" id="part0017_iddle2420"></a>You’ve got a good eye! Yes, the class diagrams are essentially the same, but the two patterns differ in their <span class="emphasis"><em>intent</em></span>.</p><p>With the State Pattern, we have a set of behaviors encapsulated in state objects; at any time the context is delegating to one of those states. Over time, the current state changes across the set of state objects to reflect the internal state of the context, so the context’s behavior changes over time as well. The client usually knows very little, if anything, about the state objects.</p><p>With Strategy, the client usually specifies the strategy object that the context is composed with. Now, while the pattern provides the flexibility to change the strategy object at runtime, often there is a strategy object that is most appropriate for a context object. For instance, in <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a>, some of our ducks were configured to fly with typical flying behavior (like mallard ducks), while others were configured with a fly behavior that kept them grounded (like rubber ducks and decoy ducks).</p><p>In general, think of the Strategy Pattern as a flexible alternative to subclassing; if you use inheritance to define the behavior of a class, then you’re stuck with that behavior even if you need to change it. With Strategy you can change the behavior by composing with a different object.</p><p>Think of the State Pattern as an alternative to putting lots of conditionals in your context; by encapsulating the behaviors within state objects, you can simply change the state object in context to change its behavior.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_there_are_no_dumb_questions-id00127"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1qe1"></a><a id="part0017_ch10qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a class="indexterm" id="part0017_iddle1126"></a><a class="indexterm" id="part0017_iddle1128"></a><a class="indexterm" id="part0017_iddle2021"></a><a class="indexterm" id="part0017_iddle2386"></a><a class="indexterm" id="part0017_iddle2399"></a><a class="indexterm" id="part0017_iddle2400"></a><a class="indexterm" id="part0017_iddle2403"></a><span class="strong"><strong>Q: In the GumballMachine, the states decide what the next state should be. Do the ConcreteStates always decide what state to go to next?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No, not always. The alternative is to let the Context decide on the flow of state transitions.</p><p>As a general guideline, when the state transitions are fixed they are appropriate for putting in the Context; however, when the transitions are more dynamic, they are typically placed in the state classes themselves (for instance, in the GumballMachine the choice of the transition to NoQuarter or SoldOut depended on the runtime count of gumballs).</p><p>The disadvantage of having state transitions in the state classes is that we create dependencies between the state classes. In our implementation of the GumballMachine we tried to minimize this by using getter methods on the Context, rather than hardcoding explicit concrete state classes.</p><p>Notice that by making this decision, you are making a decision as to which classes are closed for modification —  the Context or the state classes — as the system evolves.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1qe2"></a><a id="part0017_ch10qa1q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Do clients ever interact directly with the states?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No. The states are used by the Context to represent its internal state and behavior, so all requests to the states come from the Context. Clients don’t directly change the state of the Context. It is the Context’s job to oversee its state, and you don’t usually want a client changing the state of a Context without that Context’s knowledge.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1qe3"></a><a id="part0017_ch10qa1q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: If I have lots of instances of the Context in my application, is it possible to share the state objects across them?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes, absolutely, and in fact this is a very common scenario. The only requirement is that your state objects do not keep their own internal context; otherwise, you’d need a unique instance per context.</p><p>To share your states, you’ll typically assign each state to a static instance variable. If your state needs to make use of methods or instance variables in your Context, you’ll also have to give it a reference to the Context in each handler() method.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1qe4"></a><a id="part0017_ch10qa1q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: It seems like using the State Pattern always increases the number of classes in our designs. Look how many more classes our GumballMachine had than the original design!</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You’re right, by encapsulating state behavior into separate state classes, you’ll always end up with more classes in your design. That’s often the price you pay for flexibility. Unless your code is some “one off” implementation you’re going to throw away (yeah, right), consider building it with the additional classes and you’ll probably thank yourself down the road. Note that often what is important is the number of classes that you expose to your clients, and there are ways to hide these extra classes from your clients (say, by declaring them package visible).</p><p>Also, consider the alternative: if you have an application that has a lot of state and you decide not to use separate objects, you’ll instead end up with very large, monolithic conditional statements. This makes your code hard to maintain and understand. By using objects, you make states explicit and reduce the effort needed to understand and maintain your code.</p></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1qe5"></a><a id="part0017_ch10qa1q5"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: The State Pattern class diagram shows that State is an abstract class. But didn’t you use an interface in the implementation of the gumball machine’s state?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa1q5a5"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes. Given we had no common functionality to put into an abstract class, we went with an interface. In your own implementation, you might want to consider an abstract class. Doing so has the benefit of allowing you to add methods to the abstract class later, without breaking the concrete state implementations.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_we_still_need_to_finish_the_gumball_1_in" style="clear: both">We still need to finish the Gumball 1 in 10 game</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1125"></a><a class="indexterm" id="part0017_iddle1702"></a><a class="indexterm" id="part0017_iddle2073"></a><a class="indexterm" id="part0017_iddle2396"></a>Remember, we’re not done yet. We’ve got a game to implement, but now that we’ve got the State Pattern implemented, it should be a breeze. First, we need to add a state to the GumballMachine class:</p><div class="informalfigure"><a id="part0017_med_id00578a"></a><div class="mediaobject"><a id="part0017_med_id00578"></a><img alt="image with no caption" hisrc="figs/web/421fig01.png.jpg" src="../Images/image01077.jpeg"/></div></div><p>Now let’s implement the WinnerState class; it’s remarkably similar to the SoldState class:</p><div class="informalfigure"><a id="part0017_med_id00579a"></a><div class="mediaobject"><a id="part0017_med_id00579"></a><img alt="image with no caption" hisrc="figs/web/421fig02.png.jpg" src="../Images/image01078.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_finishing_the_game" style="clear: both">Finishing the game</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1693"></a><a class="indexterm" id="part0017_iddle2381"></a>We’ve just got one more change to make: we need to implement the random chance game and add a transition to the WinnerState. We’re going to add both to the HasQuarterState since that is where the customer turns the crank:</p><div class="informalfigure"><a id="part0017_med_id00580a"></a><div class="mediaobject"><a id="part0017_med_id00580"></a><img alt="image with no caption" hisrc="figs/web/422fig01.png.jpg" src="../Images/image01079.jpeg"/></div></div><p>Wow, that was pretty simple to implement! We just added a new state to the GumballMachine and then implemented it. All we had to do from there was to implement our chance game and transition to the correct state. It looks like our new code strategy is paying off...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_demo_for_the_ceo_of_mighty_gumballcomma" style="clear: both">Demo for the CEO of Mighty Gumball, Inc.</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1691"></a><a class="indexterm" id="part0017_iddle2379"></a>The CEO of Mighty Gumball has dropped by for a demo of your new gumball game code. Let’s hope those states are all in order! We’ll keep the demo short and sweet (the short attention span of CEOs is well documented), but hopefully long enough so that we’ll win at least once.</p><div class="informalfigure"><a id="part0017_med_id00581a"></a><div class="mediaobject"><a id="part0017_med_id00581"></a><img alt="image with no caption" hisrc="figs/web/423fig01.png.jpg" src="../Images/image01080.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00582a"></a><div class="mediaobject"><a id="part0017_med_id00582"></a><img alt="image with no caption" hisrc="figs/web/423fig02.png.jpg" src="../Images/image01081.jpeg"/></div></div><div class="informalfigure"><a id="part0017_med_id00583a"></a><div class="mediaobject"><a id="part0017_med_id00583"></a><img alt="image with no caption" hisrc="figs/web/424fig01.png.jpg" src="../Images/image01082.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_there_are_no_dumb_questions-id00128"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa2qe1"></a><a id="part0017_ch10qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a class="indexterm" id="part0017_iddle1706"></a><a class="indexterm" id="part0017_iddle2383"></a><span class="strong"><strong>Q: Why do we need the WinnerState? Couldn’t we just have the SoldState dispense two gumballs?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0017_ch10qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> That’s a great question. SoldState and WinnerState are almost identical, except that WinnerState dispenses two gumballs instead of one. You certainly could put the code to dispense two gumballs into the SoldState. The downside is, of course, that now you’ve got TWO states represented in one State class: the state in which you’re a winner, and the state in which you’re not. So you are sacrificing clarity in your State class to reduce code duplication. Another thing to consider is the principle you learned in the previous chapter: One class, One responsibility. By putting the WinnerState responsibility into the SoldState, you’ve just given the SoldState TWO responsibilities. What happens when the promotion ends? Or the stakes of the contest change? So, it’s a tradeoff and comes down to a design decision.</p></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0017_med_id00584a"></a><div class="mediaobject"><a id="part0017_med_id00584"></a><img alt="image with no caption" hisrc="figs/web/425fig01.png.jpg" src="../Images/image01083.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_sanity_checkhellip" style="clear: both">Sanity check...</h2></div></div></div><p><a class="indexterm" id="part0017_iddle1690"></a><a class="indexterm" id="part0017_iddle2378"></a>Yes, the CEO of Mighty Gumball probably needs a sanity check, but that’s not what we’re talking about here. Let’s think through some aspects of the GumballMachine that we might want to shore up before we ship the gold version:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">We’ve got a lot of duplicate code in the Sold and Winning states and we might want to clean those up. How would we do it? We could make State into an abstract class and build in some default behavior for the methods; after all, error messages like, “You already inserted a quarter,” aren’t going to be seen by the customer. So all “error response” behavior could be generic and inherited from the abstract State class.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0017_ch10note04"></a>Note</h3><p>Dammit Jim, I’m a gumball machine, not a computer!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem">The dispense() method always gets called, even if the crank is turned when there is no quarter. While the machine operates correctly and doesn’t dispense unless it’s in the right state, we could easily fix this by having turnCrank() return a boolean, or by introducing exceptions. Which do you think is a better solution?</li><li class="listitem">All of the intelligence for the state transitions is in the State classes. What problems might this cause? Would we want to move that logic into the Gumball Machine? What would be the advantages and disadvantages of that?</li><li class="listitem">Will you be instantiating a lot of GumballMachine objects? If so, you may want to move the state instances into static instance variables and share them. What changes would this require to the GumballMachine and the States?</li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_fireside_chats-id00129"></a><h3 class="title"><code class="literal">Fireside Chats</code></h3><p><a class="indexterm" id="part0017_iddle2402"></a><a class="indexterm" id="part0017_iddle2421"></a>Tonight’s talk: <span class="strong"><strong>A Strategy and State Pattern Reunion.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Strategy:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>State:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey bro. Did you hear I was in <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a>?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yeah, word is definitely getting around.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I was just over giving the Template Method guys a hand — they needed me to help them finish off their chapter. So, anyway, what is my noble brother up to?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Same as always — helping classes to exhibit different behaviors in different states.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I don’t know, you always sound like you’ve just copied what I do and you’re using different words to describe it. Think about it: I allow objects to incorporate different behaviors or algorithms through composition and delegation. You’re just copying me.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I admit that what we do is definitely related, but my intent is totally different than yours. And, the way I teach my clients to use composition and delegation is totally different.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Oh yeah? How so? I don’t get it.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, if you spent a little more time thinking about something other than <span class="emphasis"><em>yourself</em></span>, you might. Anyway, think about how you work: you have a class you’re instantiating and you usually give it a strategy object that implements some behavior. Like, in <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a> you were handing out quack behaviors, right? Real ducks got a real quack; rubber ducks got a quack that squeaked.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Yeah, that was some <span class="emphasis"><em>fine</em></span> work... and I’m sure you can see how that’s more powerful than inheriting your behavior, right?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yes, of course. Now, think about how I work; it’s totally different.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Sorry, you’re going to have to explain that.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, when my Context objects get created, I may tell them the state to start in, but then they change their own state over time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey, come on, I can change behavior at runtime too; that’s what composition is all about!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Sure you can, but the way I work is built around discrete states; my Context objects change state over time according to some well-defined state transitions. In other words, changing behavior is built in to my scheme — it’s how I work!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, I admit, I don’t encourage my objects to have a well-defined set of transitions between states. In fact, I typically like to control what strategy my objects are using.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Look, we’ve already said we’re alike in structure, but what we do is quite different in intent. Face it, the world has uses for both of us.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Yeah, yeah, keep living your pipe dreams, brother. You act like you’re a big pattern like me, but check it out: I’m in <a class="xref" href="#part0008_aid-7K4G2">Chapter 1</a>; they stuck you way out in <a class="xref" href="#part0017_aid-G6PI2">Chapter 10</a>. I mean, how many people are actually going to read this far?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Are you kidding? This is a Head First book and Head First readers rock. Of course they’re going to get to <a class="xref" href="#part0017_aid-G6PI2">Chapter 10</a>!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>That’s my brother, always the dreamer.</p></td><td> </td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_we_almost_forgotexclamation_mark" style="clear: both">We almost forgot!</h2></div></div></div><div class="informalfigure"><a id="part0017_med_id00585a"></a><div class="mediaobject"><a id="part0017_med_id00585"></a><img alt="image with no caption" hisrc="figs/web/428fig01.png.jpg" src="../Images/image01084.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil-id00130"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0017_iddle1705"></a><a class="indexterm" id="part0017_iddle2382"></a><a class="indexterm" id="part0017_iddle1552"></a><a class="indexterm" id="part0017_iddle2297"></a>We need you to write the refill() method for the Gumball machine. It has one argument — the number of gumballs you’re adding to the machine — and should update the gumball machine count and reset the machine’s state.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0017_med_id00586a"></a><div class="mediaobject"><a id="part0017_med_id00586"></a><img alt="image with no caption" hisrc="figs/web/429fig01.png.jpg" src="../Images/image01085.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_who_does_whatquestion_mark-id00131"></a><h3 class="title">Who Does What?</h3><p><a class="indexterm" id="part0017_iddle1584"></a><a class="indexterm" id="part0017_iddle2373"></a><a class="indexterm" id="part0017_iddle2412"></a><a class="indexterm" id="part0017_iddle2462"></a><a class="indexterm" id="part0017_iddle2521"></a>Match each pattern with its description:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Description</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>State</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Encapsulate interchangeable behaviors and use delegation to decide which behavior to use.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Strategy</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Subclasses decide how to implement steps in an algorithm.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Template Method</p></td><td style="vertical-align: top; "><p>Encapsulate state-based behavior and delegate behavior to the current state.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0017_tools_for_your_design_toolbox-id00132" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>It’s the end of another chapter; you’ve got enough patterns here to breeze through any job interview!</p><div class="informalfigure"><a id="part0017_med_id00587a"></a><div class="mediaobject"><a id="part0017_med_id00587"></a><img alt="image with no caption" hisrc="figs/web/431fig01.png.jpg" src="../Images/image01086.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_bullet_points-id00133"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The State Pattern allows an object to have many different behaviors that are based on its internal state.</li><li class="listitem">Unlike a procedural state machine, the State Pattern represents state as a full-blown class.</li><li class="listitem">The Context gets its behavior by delegating to the current state object it is composed with.</li><li class="listitem">By encapsulating each state into a class, we localize any changes that will need to be made.</li><li class="listitem">The State and Strategy Patterns have the same class diagram, but they differ in intent.</li><li class="listitem">Strategy Pattern typically configures Context classes with a behavior or algorithm.</li><li class="listitem">State Pattern allows a Context to change its behavior as the state of the Context changes.</li><li class="listitem">State transitions can be controlled by the State classes or by the Context classes.</li><li class="listitem">Using the State Pattern will typically result in a greater number of classes in your design.</li><li class="listitem">State classes may be shared among Context instances.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_design_puzzle_solution-id00134"></a><h3 class="title">Design Puzzle Solution</h3><p><a class="indexterm" id="part0017_iddle1433"></a><a class="indexterm" id="part0017_iddle1513"></a><a class="indexterm" id="part0017_iddle1699"></a><a class="indexterm" id="part0017_iddle2070"></a><a class="indexterm" id="part0017_iddle2393"></a>Draw a state diagram for a Gumball Machine that handles the 1-in-10 contest. In this contest, 10% of the time the Sold state leads to two balls being released, not one. Here’s our solution.</p><div class="informalfigure"><a id="part0017_med_id00588a"></a><div class="mediaobject"><a id="part0017_med_id00588"></a><img alt="image with no caption" hisrc="figs/web/432fig01.png.jpg" src="../Images/image01087.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil_solution-id00135"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0017_iddle1536"></a><a class="indexterm" id="part0017_iddle1550"></a><a class="indexterm" id="part0017_iddle2275"></a><a class="indexterm" id="part0017_iddle2292"></a>Which of the following describe the state of our implementation? (Choose all that apply.) Here’s our solution.</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00056"></a><img alt="" hisrc="figs/web/433fig01.png.jpg" src="../Images/image01088.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code certainly isn’t adhering to the Open Closed Principle.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00057"></a><img alt="" hisrc="figs/web/433fig02.png.jpg" src="../Images/image01089.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code would make a FORTRAN programmer proud.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00058"></a><img alt="" hisrc="figs/web/433fig03.png.jpg" src="../Images/image01090.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This design isn’t even very object-oriented.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00059"></a><img alt="" hisrc="figs/web/433fig04.png.jpg" src="../Images/image01091.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>State transitions aren’t explicit; they are buried in the middle of a bunch of conditional statements.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00060"></a><img alt="" hisrc="figs/web/433fig05.png.jpg" src="../Images/image01092.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We haven’t encapsulated anything that varies here.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0017_inline_id00061"></a><img alt="" hisrc="figs/web/433fig06.png.jpg" src="../Images/image01093.jpeg"/></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>Further additions are likely to cause bugs in working code.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil_solution-id00136"></a><h3 class="title">Sharpen your pencil Solution</h3><p>We have one remaining class we haven’t implemented: SoldOutState. Why don’t you implement it? To do this, carefully think through how the Gumball Machine should behave in each situation. Here’s our solution.</p><a id="part0017_pro_id00038"></a><pre class="programlisting"><span class="strong"><strong>public class SoldOutState implements State {</strong></span>
    <span class="strong"><strong>GumballMachine gumballMachine;</strong></span>

     <span class="strong"><strong>public SoldOutState(GumballMachine gumballMachine) {</strong></span>
         <span class="strong"><strong>this.gumballMachine = gumballMachine;</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void insertQuarter() {</strong></span>
         <span class="strong"><strong>System.out.println("You can't insert a quarter, the machine is sold out");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void ejectQuarter() {</strong></span>
         <span class="strong"><strong>System.out.println("You can't eject, you haven't inserted a quarter yet");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void turnCrank() {</strong></span>
         <span class="strong"><strong>System.out.println("You turned, but there are no gumballs");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void dispense() {</strong></span>
         <span class="strong"><strong>System.out.println("No gumball dispensed");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public String toString() {</strong></span>
         <span class="strong"><strong>return "sold out";</strong></span>
     <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0017_ch10note04a"></a>Note</h3><p>In the Sold Out state, we really can’t do anything until someone refills the Gumball Machine.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil_solution-id00137"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0017_iddle1528"></a><a class="indexterm" id="part0017_iddle1696"></a><a class="indexterm" id="part0017_iddle2067"></a><a class="indexterm" id="part0017_iddle2267"></a><a class="indexterm" id="part0017_iddle2390"></a>To implement the states, we first need to define what the behavior will be when the corresponding action is called. Annotate the diagram below with the behavior of each action in each class; here’s our solution.</p><div class="informalfigure"><a id="part0017_med_id00589a"></a><div class="mediaobject"><a id="part0017_med_id00589"></a><img alt="image with no caption" hisrc="figs/web/434fig01.png.jpg" src="../Images/image01094.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_behind_the_scenes_self-guided_tour_solut"></a><h3 class="title">Behind the Scenes: Self-Guided Tour Solution</h3><div class="informalfigure"><a id="part0017_med_id00590a"></a><div class="mediaobject"><a id="part0017_med_id00590"></a><img alt="image with no caption" hisrc="figs/web/435fig01.png.jpg" src="../Images/image01095.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_who_does_whatquestion_mark_solut-id00138"></a><h3 class="title">Who Does What? Solution</h3><p><a class="indexterm" id="part0017_iddle1526"></a><a class="indexterm" id="part0017_iddle2265"></a><a class="indexterm" id="part0017_iddle1553"></a><a class="indexterm" id="part0017_iddle1585"></a><a class="indexterm" id="part0017_iddle2298"></a><a class="indexterm" id="part0017_iddle2374"></a><a class="indexterm" id="part0017_iddle2413"></a><a class="indexterm" id="part0017_iddle2463"></a><a class="indexterm" id="part0017_iddle2522"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="part0017_med_id00591a"></a><div class="mediaobject"><a id="part0017_med_id00591"></a><img alt="image with no caption" hisrc="figs/web/436fig01.png.jpg" src="../Images/image01096.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0017_sharpen_your_pencil_solution-id00139"></a><h3 class="title">Sharpen your pencil Solution</h3><p>To refill the Gumball Machine, we add a refill() method to the State interface, which each State must implement. In every state except the SoldOutState, the method does nothing. In SoldOutState, refill() transitions to NoQuarterState. We also add a refill() method to GumballMachine that adds to the count of gumballs, and then calls the current state’s refill() method.</p><div class="informalfigure"><a id="part0017_med_id00592a"></a><div class="mediaobject"><a id="part0017_med_id00592"></a><img alt="image with no caption" hisrc="figs/web/436fig02.png.jpg" src="../Images/image01097.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0018_proxy_pattern_controlling_object_access"><div class="titlepage" id="part0018_aid-H5A42"><div><div><h2 class="title">Chapter 11. The Proxy Pattern: Controlling Object Access</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00593a"></a><div class="mediaobject"><a id="part0018_med_id00593"></a><img alt="image with no caption" hisrc="figs/web/437fig01.png.jpg" src="../Images/image01098.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle2154"></a><span class="strong"><strong>Ever play good cop, bad cop?</strong></span> You’re the good cop and you provide all your services in a nice and friendly manner, but you don’t want everyone asking you for services, so you have the bad cop control access to you. That’s what proxies do: control and manage access. As you’re going to see, there are lots of ways in which proxies stand in for the objects they proxy. Proxies have been known to haul entire method calls over the Internet for their proxied objects; they’ve also been known to patiently stand in the place for some pretty lazy objects.</p><div class="informalfigure"><a id="part0018_med_id00594a"></a><div class="mediaobject"><a id="part0018_med_id00594"></a><img alt="image with no caption" hisrc="figs/web/438fig01.png.jpg" src="../Images/image01099.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle1302"></a><a class="indexterm" id="part0018_iddle1709"></a><a class="indexterm" id="part0018_iddle1974"></a>Sounds easy enough. If you remember, we’ve already got methods in the gumball machine code for getting the count of gumballs (getCount()), and getting the current state of the machine (getState()).</p><p>All we need to do is create a report that can be printed out and sent back to the CEO. Hmmm, we should probably add a location field to each gumball machine as well; that way the CEO can keep the machines straight.</p><p>Let’s just jump in and code this. We’ll impress the CEO with a very fast turnaround.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_coding_the_monitor" style="clear: both">Coding the Monitor</h2></div></div></div><p>Let’s start by adding support to the GumballMachine class so that it can handle locations:</p><div class="informalfigure"><a id="part0018_med_id00595a"></a><div class="mediaobject"><a id="part0018_med_id00595"></a><img alt="image with no caption" hisrc="figs/web/439fig01.png.jpg" src="../Images/image01100.jpeg"/></div></div><p>Now let’s create another class, GumballMonitor, that retrieves the machine’s location, inventory of gumballs, and current machine state and prints them in a nice little report:</p><div class="informalfigure"><a id="part0018_med_id00596a"></a><div class="mediaobject"><a id="part0018_med_id00596"></a><img alt="image with no caption" hisrc="figs/web/439fig02.png.jpg" src="../Images/image01101.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_testing_the_monitor" style="clear: both">Testing the Monitor</h2></div></div></div><p>We implemented that in no time. The CEO is going to be thrilled and amazed by our development skills.</p><p>Now we just need to instantiate a GumballMonitor and give it a machine to monitor:</p><div class="informalfigure"><a id="part0018_med_id00597a"></a><div class="mediaobject"><a id="part0018_med_id00597"></a><img alt="image with no caption" hisrc="figs/web/440fig01.png.jpg" src="../Images/image01102.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00598a"></a><div class="mediaobject"><a id="part0018_med_id00598"></a><img alt="image with no caption" hisrc="figs/web/441fig01.png.jpg" src="../Images/image01103.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle1314"></a><a class="indexterm" id="part0018_iddle1710"></a><a class="indexterm" id="part0018_iddle1986"></a><a class="indexterm" id="part0018_iddle2166"></a><a class="indexterm" id="part0018_iddle2223"></a><span class="strong"><strong>Frank</strong></span>: A remote what?</p><p><span class="strong"><strong>Joe</strong></span>: Remote proxy. Think about it: we’ve already got the monitor code written, right? We give the GumballMonitor a reference to a machine and it gives us a report. The problem is that the monitor runs in the same JVM as the gumball machine and the CEO wants to sit at his desk and remotely monitor the machines! So what if we left our GumballMonitor class as is, but handed it a proxy to a remote object?</p><p><span class="strong"><strong>Frank</strong></span>: I’m not sure I get it.</p><p><span class="strong"><strong>Jim</strong></span>: Me neither.</p><p><span class="strong"><strong>Joe</strong></span>: Let’s start at the beginning... a proxy is a stand in for a real object. In this case, the proxy acts just like it is a Gumball Machine object, but behind the scenes it is communicating over the network to talk to the real, remote GumballMachine.</p><p><span class="strong"><strong>Jim</strong></span>: So you’re saying we keep our code as it is, and we give the monitor a reference to a proxy version of the GumballMachine...</p><p><span class="strong"><strong>Frank</strong></span>: And this proxy pretends it’s the real object, but it’s really just communicating over the net to the real object.</p><p><span class="strong"><strong>Joe</strong></span>: Yeah, that’s pretty much the story.</p><p><span class="strong"><strong>Frank</strong></span>: It sounds like something that is easier said than done.</p><p><span class="strong"><strong>Joe</strong></span>: Perhaps, but I don’t think it’ll be that bad. We have to make sure that the gumball machine can act as a service and accept requests over the network; we also need to give our monitor a way to get a reference to a proxy object, but we’ve got some great tools already built into Java to help us. Let’s talk a little more about remote proxies first...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_role_of_the_apostropheremote_proxyapostr" style="clear: both">The role of the ‘remote proxy’</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1320"></a><a class="indexterm" id="part0018_iddle1716"></a><a class="indexterm" id="part0018_iddle1992"></a><a class="indexterm" id="part0018_iddle2172"></a><a class="indexterm" id="part0018_iddle2229"></a>A remote proxy acts as a <span class="emphasis"><em>local representative to a remote object</em></span>. What’s a “remote object”? It’s an object that lives in the heap of a different Java Virtual Machine (or more generally, a remote object that is running in a different address space). What’s a “local representative”? It’s an object that you can call local methods on and have them forwarded on to the remote object.</p><div class="informalfigure"><a id="part0018_med_id00599a"></a><div class="mediaobject"><a id="part0018_med_id00599"></a><img alt="image with no caption" hisrc="figs/web/442fig01.png.jpg" src="../Images/image01104.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>Your client object acts like it’s making remote method calls. But what it’s really doing is calling methods on a heap-local ‘proxy’ object that handles all the low-level details of network communication.</strong></span></div></blockquote></div><div class="informalfigure"><a id="part0018_med_id00600a"></a><div class="mediaobject"><a id="part0018_med_id00600"></a><img alt="image with no caption" hisrc="figs/web/443fig01.png.jpg" src="../Images/image01105.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note01"></a>Brain Power</h3><p>Before going further, think about how you’d design a system to enable remote method invocation. How would you make it easy on the developer so that she has to write as little code as possible? How would you make the remote invocation look seamless?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note02"></a>Brain Power</h3><p>Should making remote calls be totally transparent? Is that a good idea? What might be a problem with that approach?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_adding_a_remote_proxy_to_the_gumball_mac" style="clear: both">Adding a remote proxy to the Gumball Machine monitoring code</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1315"></a><a class="indexterm" id="part0018_iddle1711"></a><a class="indexterm" id="part0018_iddle1869"></a><a class="indexterm" id="part0018_iddle1987"></a><a class="indexterm" id="part0018_iddle2167"></a><a class="indexterm" id="part0018_iddle2212"></a><a class="indexterm" id="part0018_iddle2224"></a><a class="indexterm" id="part0018_iddle2239"></a>On paper this looks good, but how do we create a proxy that knows how to invoke a method on an object that lives in another JVM?</p><p>Hmmm. Well, you can’t get a reference to something on another heap, right? In other words, you can’t say:</p><a id="part0018_pro_id00039"></a><pre class="programlisting"><span class="strong"><strong>Duck d = &lt;object in another heap&gt;</strong></span></pre><p>Whatever the variable <span class="strong"><strong><code class="literal">d</code></strong></span> is referencing must be in the same heap space as the code running the statement. So how do we approach this? Well, that’s where Java’s Remote Method Invocation comes in... RMI gives us a way to find objects in a remote JVM and allows us to invoke their methods.</p><p>You may have encountered RMI in Head First Java; if not, take a slight detour and get up to speed on RMI before adding the proxy support to the Gumball Machine code.</p><p>So, here’s what we’re going to do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① First, we’re going to take the RMI Detour and check RMI out. Even if you are familiar with RMI, you might want to follow along and check out the scenery.</strong></span><div class="informalfigure"><a id="part0018_med_id00601a"></a><div class="mediaobject"><a id="part0018_med_id00601"></a><img alt="image with no caption" hisrc="figs/web/444fig01.png.jpg" src="../Images/image01106.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Then we’re going to take our GumballMachine and make it a remote service that provides a set of methods calls that can be invoked remotely.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Then, we going to create a proxy that can talk to a remote GumballMachine, again using RMI, and put the monitoring system back together so that the CEO can monitor any number of remote machines.</strong></span></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_remote_methods_101" style="clear: both">Remote methods 101</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00602a"></a><div class="mediaobject"><a id="part0018_med_id00602"></a><img alt="image with no caption" hisrc="figs/web/common20.png.jpg" src="../Images/image01107.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle1137"></a><a class="indexterm" id="part0018_iddle2253"></a>Let’s say we want to design a system that allows us to call a local object that forwards each request to a remote object. How would we design it? We’d need a couple of helper objects that actually do the communicating for us. The helpers make it possible for the client to act as though it’s calling a method on a local object (which in fact, it is). The client calls a method on the client helper, as if the client helper were the actual service. The client helper then takes care of forwarding that request for us.</p><p>In other words, the client object thinks it’s calling a method on the remote service, because the client helper is pretending to be the service object. Pretending to be the thing with the method the client wants to call.</p><p>But the client helper isn’t really the remote service. Although the client helper acts like it (because it has the same method that the service is advertising), the client helper doesn’t have any of the actual method logic the client is expecting. Instead, the client helper contacts the server, transfers information about the method call (e.g., name of the method, arguments, etc.), and waits for a return from the server.</p><p>On the server side, the service helper receives the request from the client helper (through a Socket connection), unpacks the information about the call, and then invokes the real method on the real service object. So, to the service object, the call is local. It’s coming from the service helper, not a remote client.</p><p>The service helper gets the return value from the service, packs it up, and ships it back (over a Socket’s output stream) to the client helper. The client helper unpacks the information and returns the value to the client object.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note01a"></a>Note</h3><p>This should look familiar...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0018_med_id00603a"></a><div class="mediaobject"><a id="part0018_med_id00603"></a><img alt="image with no caption" hisrc="figs/web/445fig01.png.jpg" src="../Images/image01108.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle2220"></a><a class="indexterm" id="part0018_iddle2247"></a><span class="strong"><strong>How the method call happens</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Client object calls doBigThing() on the client helper object.<div class="informalfigure"><a id="part0018_med_id00604a"></a><div class="mediaobject"><a id="part0018_med_id00604"></a><img alt="image with no caption" hisrc="figs/web/446fig01.png.jpg" src="../Images/image01109.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② Client helper packages up information about the call (arguments, method name, etc.) and ships it over the network to the service helper.<div class="informalfigure"><a id="part0018_med_id00605a"></a><div class="mediaobject"><a id="part0018_med_id00605"></a><img alt="image with no caption" hisrc="figs/web/446fig02.png.jpg" src="../Images/image01110.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ Service helper unpacks the information from the client helper, finds out which method to call (and on which object) and invokes the <span class="underline">real</span> method on the <span class="underline">real</span> service object.<div class="informalfigure"><a id="part0018_med_id00606a"></a><div class="mediaobject"><a id="part0018_med_id00606"></a><img alt="image with no caption" hisrc="figs/web/446fig03.png.jpg" src="../Images/image01111.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">④ The method is invoked on the service object, which returns some result to the service helper.<div class="informalfigure"><a id="part0018_med_id00607a"></a><div class="mediaobject"><a id="part0018_med_id00607"></a><img alt="image with no caption" hisrc="figs/web/common20.png.jpg" src="../Images/image01107.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00608a"></a><div class="mediaobject"><a id="part0018_med_id00608"></a><img alt="image with no caption" hisrc="figs/web/447fig01.png.jpg" src="../Images/image01112.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">⑤ Service helper packages up information returned from the call and ships it back over the network to the client helper.<div class="informalfigure"><a id="part0018_med_id00609a"></a><div class="mediaobject"><a id="part0018_med_id00609"></a><img alt="image with no caption" hisrc="figs/web/447fig02.png.jpg" src="../Images/image01113.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">⑥ Client helper unpackages the returned values and returns them to the client object. To the client object, this was all transparent.<div class="informalfigure"><a id="part0018_med_id00610a"></a><div class="mediaobject"><a id="part0018_med_id00610"></a><img alt="image with no caption" hisrc="figs/web/447fig03.png.jpg" src="../Images/image01114.jpeg"/></div></div></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_java_rmicomma_the_big_picture" style="clear: both">Java RMI, the Big Picture</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1138"></a><a class="indexterm" id="part0018_iddle2213"></a><a class="indexterm" id="part0018_iddle2240"></a><a class="indexterm" id="part0018_iddle2254"></a><a class="indexterm" id="part0018_iddle2347"></a><a class="indexterm" id="part0018_iddle2427"></a>Okay, you’ve got the gist of how remote methods work; now you just need to understand how to use RMI to enable remote method invocation.</p><p>What RMI does for you is build the client and service helper objects, right down to creating a client helper object with the same methods as the remote service. The nice thing about RMI is that you don’t have to write any of the networking or I/O code yourself. With your client, you call remote methods (i.e., the ones the Real Service has) just like normal method calls on objects running in the client’s own local JVM.</p><p>RMI also provides all the runtime infrastructure to make it all work, including a lookup service that the client can use to find and access the remote objects.</p><p>There is one difference between RMI calls and local (normal) method calls. Remember that even though to the client it looks like the method call is local, the client helper sends the method call across the network. So there is networking and I/O. And what do we know about networking and I/O methods?</p><p>They’re risky! They can fail! And so, they throw exceptions all over the place. As a result, the client does have to acknowledge the risk. We’ll see how in a few pages.</p><p><span class="strong"><strong>RMI Nomenclature: in RMI, the client helper is a ‘stub’ and the service helper is a ‘skeleton’.</strong></span></p><div class="informalfigure"><a id="part0018_med_id00611a"></a><div class="mediaobject"><a id="part0018_med_id00611"></a><img alt="image with no caption" hisrc="figs/web/448fig01.png.jpg" src="../Images/image01115.jpeg"/></div></div><p>Now let’s go through all the steps needed to make an object into a service that can accept remote calls and also the steps needed to allow a client to make remote calls.</p><p>You might want to make sure your seat belt is fastened; there are a lot of steps and a few bumps and curves — but nothing to be too worried about.</p><p><a class="indexterm" id="part0018_iddle2219"></a><a class="indexterm" id="part0018_iddle2246"></a><span class="strong"><strong>Making the Remote service</strong></span></p><div class="informalfigure"><a id="part0018_med_id00612a"></a><div class="mediaobject"><a id="part0018_med_id00612"></a><img alt="image with no caption" hisrc="figs/web/common20.png.jpg" src="../Images/image01107.jpeg"/></div></div><p>This is an <span class="strong"><strong>overview</strong></span> of the five steps for making the remote service. In other words, the steps needed to take an ordinary object and supercharge it so it can be called by a remote client. We’ll be doing this later to our GumballMachine. For now, let’s get the steps down and then we’ll explain each one in detail.</p><p><span class="strong"><strong>Step one:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Make a <span class="strong"><strong>Remote Interface</strong></span></li><li class="listitem" style="list-style-type: none">The remote interface defines the methods that a client can call remotely. It’s what the client will use as the class type for your service. Both the Stub and actual service will implement this!</li></ul></div><div class="informalfigure"><a id="part0018_med_id00613a"></a><div class="mediaobject"><a id="part0018_med_id00613"></a><img alt="image with no caption" hisrc="figs/web/449fig01.png.jpg" src="../Images/image01116.jpeg"/></div></div><p><span class="strong"><strong>Step two:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Make a <span class="strong"><strong>Remote Implementation</strong></span></li><li class="listitem" style="list-style-type: none">This is the class that does the Real Work. It has the real implementation of the remote methods defined in the remote interface. It’s the object that the client wants to call methods on (e.g., our GumballMachine!).</li></ul></div><div class="informalfigure"><a id="part0018_med_id00614a"></a><div class="mediaobject"><a id="part0018_med_id00614"></a><img alt="image with no caption" hisrc="figs/web/449fig02.png.jpg" src="../Images/image01117.jpeg"/></div></div><p><span class="strong"><strong>Step three:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Start the <span class="strong"><strong>RMI registry</strong></span> (rmiregistry)</li><li class="listitem" style="list-style-type: none">The <span class="emphasis"><em>rmiregistry</em></span> is like the white pages of a phone book. It’s where the client goes to get the proxy (the client stub/helper object).</li></ul></div><div class="informalfigure"><a id="part0018_med_id00615a"></a><div class="mediaobject"><a id="part0018_med_id00615"></a><img alt="image with no caption" hisrc="figs/web/449fig03.png.jpg" src="../Images/image01118.jpeg"/></div></div><p><span class="strong"><strong>Step four:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Start the <span class="strong"><strong>remote service</strong></span></li><li class="listitem" style="list-style-type: none">You have to get the service object up and running. Your service implementation class instantiates an instance of the service and registers it with the RMI registry. Registering it makes the service available for clients.<div class="informalfigure"><a id="part0018_med_id00616a"></a><div class="mediaobject"><a id="part0018_med_id00616"></a><img alt="image with no caption" hisrc="figs/web/449fig04.png.jpg" src="../Images/image01119.jpeg"/></div></div></li></ul></div><p><span class="strong"><strong>Step one: make a Remote interface</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Extend java.rmi.Remote</strong></span><br/>Remote is a ‘marker’ interface, which means it has no methods. It has special meaning for RMI, though, so you must follow this rule. Notice that we say ‘extends’ here. One interface is allowed to <span class="emphasis"><em>extend</em></span> another interface.<div class="informalfigure"><a id="part0018_med_id00617a"></a><div class="mediaobject"><a id="part0018_med_id00617"></a><img alt="image with no caption" hisrc="figs/web/450fig01.png.jpg" src="../Images/image01120.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② Declare that all methods <span class="strong"><strong>throw a RemoteException</strong></span><br/>The remote interface is the one the client uses as the type for the service. In other words, the client invokes methods on something that implements the remote interface. That something is the stub, of course, and since the stub is doing networking and I/O, all kinds of Bad Things can happen. The client has to acknowledge the risks by handling or declaring the remote exceptions. If the methods in an interface declare exceptions, any code calling methods on a reference of that type (the interface type) must handle or declare the exceptions.<div class="informalfigure"><a id="part0018_med_id00618a"></a><div class="mediaobject"><a id="part0018_med_id00618"></a><img alt="image with no caption" hisrc="figs/web/450fig02.png.jpg" src="../Images/image01121.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Be sure arguments and return values are primitives or Serializable</strong></span><br/>Arguments and return values of a remote method must be either primitive or Serializable. Think about it. Any argument to a remote method has to be packaged up and shipped across the network, and that’s done through Serialization. Same thing with return values. If you use primitives, Strings, and the majority of types in the API (including arrays and collections), you’ll be fine. If you are passing around your own types, just be sure that you make your classes implement Serializable.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note03"></a>Note</h3><p>Check out Head First Java if you need to refresh your memory on Serializable.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0018_med_id00619a"></a><div class="mediaobject"><a id="part0018_med_id00619"></a><img alt="image with no caption" hisrc="figs/web/450fig03.png.jpg" src="../Images/image01122.jpeg"/></div></div></li></ul></div><p><span class="strong"><strong>Step two: make a Remote implementation</strong></span></p><div class="informalfigure"><a id="part0018_med_id00620a"></a><div class="mediaobject"><a id="part0018_med_id00620"></a><img alt="image with no caption" hisrc="figs/web/common20.png.jpg" src="../Images/image01107.jpeg"/></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Implement the Remote interface</strong></span><br/>Your service has to implement the remote interface — the one with the methods your client is going to call.<div class="informalfigure"><a id="part0018_med_id00621a"></a><div class="mediaobject"><a id="part0018_med_id00621"></a><img alt="image with no caption" hisrc="figs/web/451fig01.png.jpg" src="../Images/image01123.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Extend UnicastRemoteObject</strong></span><br/>In order to work as a remote service object, your object needs some functionality related to ‘being remote’. The simplest way is to extend UnicastRemoteObject (from the java.rmi.server package) and let that class (your superclass) do the work for you.<div class="informalfigure"><a id="part0018_med_id00622a"></a><div class="mediaobject"><a id="part0018_med_id00622"></a><img alt="image with no caption" hisrc="figs/web/451fig02.png.jpg" src="../Images/image01124.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Write a no-arg constructor that declares a RemoteException</strong></span><br/>Your new superclass, UnicastRemoteObject, has one little problem — its constructor throws a RemoteException. The only way to deal with this is to declare a constructor for your remote implementation, just so that you have a place to declare the RemoteException. Remember, when a class is instantiated, its superclass constructor is always called. If your superclass constructor throws an exception, you have no choice but to declare that your constructor also throws an exception.<div class="informalfigure"><a id="part0018_med_id00623a"></a><div class="mediaobject"><a id="part0018_med_id00623"></a><img alt="image with no caption" hisrc="figs/web/451fig03.png.jpg" src="../Images/image01125.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Register the service with the RMI registry</strong></span><br/>Now that you’ve got a remote service, you have to make it available to remote clients. You do this by instantiating it and putting it into the RMI registry (which must be running or this line of code fails). When you register the implementation object, the RMI system actually puts the <span class="emphasis"><em>stub</em></span> in the registry, since that’s what the client really needs. Register your service using the static rebind() method of the java.rmi.Naming class.<div class="informalfigure"><a id="part0018_med_id00624a"></a><div class="mediaobject"><a id="part0018_med_id00624"></a><img alt="image with no caption" hisrc="figs/web/451fig04.png.jpg" src="../Images/image01126.jpeg"/></div></div></li></ul></div><p><a class="indexterm" id="part0018_iddle1139"></a><a class="indexterm" id="part0018_iddle1858"></a><a class="indexterm" id="part0018_iddle2175"></a><a class="indexterm" id="part0018_iddle2255"></a><a class="indexterm" id="part0018_iddle2348"></a><a class="indexterm" id="part0018_iddle2428"></a><span class="strong"><strong>Step three: run rmiregistry</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Bring up a terminal and start the rmiregistry.</strong></span><br/>Be sure you start it from a directory that has access to your classes. The simplest way is to start it from your <code class="literal">classes</code> directory.<div class="informalfigure"><a id="part0018_med_id00625a"></a><div class="mediaobject"><a id="part0018_med_id00625"></a><img alt="image with no caption" hisrc="figs/web/452fig01.png.jpg" src="../Images/image01127.jpeg"/></div></div></li></ul></div><p><span class="strong"><strong>Step four: start the service</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Bring up another terminal and start your service</strong></span><br/>This might be from a main() method in your remote implementation class, or from a separate launcher class. In this simple example, we put the starter code in the implementation class, in a main method that instantiates the object and registers it with RMI registry.<div class="informalfigure"><a id="part0018_med_id00626a"></a><div class="mediaobject"><a id="part0018_med_id00626"></a><img alt="image with no caption" hisrc="figs/web/452fig02.png.jpg" src="../Images/image01128.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note04"></a>Watch it!</h3><p><span class="strong"><strong>Before Java 5, we had to generate static stubs and skeletons using rmic. Now, we don’t have to do this anymore and in fact, we</strong></span> <span class="bolditalic">shouldn’t</span> <span class="strong"><strong>do it anymore, because</strong></span> <span class="bolditalic">static</span> <span class="strong"><strong>stubs and skeletons are deprecated.</strong></span></p><p><span class="emphasis"><em>Instead, stubs and skeletons are generated dynamically. This happens automatically when we subclass the UnicastRemoteObject (like we’re doing for the MyRemoteImpl class).</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_there_are_no_dumb_questions-id00140"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa1qe1"></a><a id="part0018_ch11qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Why are you showing stubs and skeletons in the diagrams for the RMI code? I thought we got rid of those way back.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You’re right; for the skeleton, the RMI runtime can dispatch the client calls directly to the remote service using reflection, and stubs are generated dynamically using Dynamic Proxy (which you’ll learn more about a bit later in the chapter). The remote object’s stub is a java.lang.reflect.Proxy instance (with an invocation handler) that is automatically generated to handle all the details of getting the local method calls by the client to the remote object. But we like to show both the stub and skeleton, because conceptually it helps you to understand that there is something under the covers that’s making that communication between the client stub and the remote service happen.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><a class="indexterm" id="part0018_iddle2215"></a><a class="indexterm" id="part0018_iddle2242"></a><span class="strong"><strong>Complete code for the server side</strong></span></p><div class="informalfigure"><a id="part0018_med_id00627a"></a><div class="mediaobject"><a id="part0018_med_id00627"></a><img alt="image with no caption" hisrc="figs/web/common20.png.jpg" src="../Images/image01107.jpeg"/></div></div><p><span class="strong"><strong>The Remote interface:</strong></span></p><div class="informalfigure"><a id="part0018_med_id00628a"></a><div class="mediaobject"><a id="part0018_med_id00628"></a><img alt="image with no caption" hisrc="figs/web/453fig01.png.jpg" src="../Images/image01129.jpeg"/></div></div><p><span class="strong"><strong>The Remote service (the implementation):</strong></span></p><div class="informalfigure"><a id="part0018_med_id00629a"></a><div class="mediaobject"><a id="part0018_med_id00629"></a><img alt="image with no caption" hisrc="figs/web/453fig02.png.jpg" src="../Images/image01130.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_how_does_the_client_get_the_stub_objectq" style="clear: both">How does the client get the stub <span class="underline">ob</span>j<span class="underline">ect</span>?</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1140"></a><a class="indexterm" id="part0018_iddle2214"></a><a class="indexterm" id="part0018_iddle2241"></a><a class="indexterm" id="part0018_iddle2256"></a><a class="indexterm" id="part0018_iddle2349"></a><a class="indexterm" id="part0018_iddle2429"></a>The client has to get the stub object (our proxy), since that’s the thing the client will call methods on. And that’s where the RMI registry comes in. The client does a ‘lookup’, like going to the white pages of a phone book, and essentially says, “Here’s a name, and I’d like the stub that goes with that name.”</p><p>Let’s take a look at the code we need to look-up and retrieve a stub object.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_code_up_close-id00141"></a><h3 class="title">Code Up Close</h3><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note02a"></a>Note</h3><p>Here’s how it works.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0018_med_id00630a"></a><div class="mediaobject"><a id="part0018_med_id00630"></a><img alt="image with no caption" hisrc="figs/web/454fig01.png.jpg" src="../Images/image01131.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0018_med_id00631a"></a><div class="mediaobject"><a id="part0018_med_id00631"></a><img alt="image with no caption" hisrc="figs/web/common20.png.jpg" src="../Images/image01107.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00632a"></a><div class="mediaobject"><a id="part0018_med_id00632"></a><img alt="image with no caption" hisrc="figs/web/455fig01.png.jpg" src="../Images/image01132.jpeg"/></div></div><p><span class="strong"><strong>How it works...</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Client does a lookup on the RMI registry</strong></span><a id="part0018_pro_id00040"></a><pre class="programlisting"><span class="strong"><strong>Naming.lookup("rmi://127.0.0.1/RemoteHello");</strong></span></pre></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② RMI registry returns the stub object</strong></span><br/>(as the return value of the lookup method) and RMI deserializes the stub automatically.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Client invokes a method on the stub, as if the stub IS the real service</strong></span></li></ul></div><p><a class="indexterm" id="part0018_iddle2222"></a><a class="indexterm" id="part0018_iddle2249"></a><span class="strong"><strong>Complete client code</strong></span></p><div class="informalfigure"><a id="part0018_med_id00633a"></a><div class="mediaobject"><a id="part0018_med_id00633"></a><img alt="image with no caption" hisrc="figs/web/456fig01.png.jpg" src="../Images/image01133.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note05"></a>Watch it!</h3><p><span class="strong"><strong>The things programmers do wrong with RMI are:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="emphasis"><em>Forget to start rmiregistry before starting remote service (when the service is registered using Naming.rebind(), the rmiregistry must be running!)</em></span></li><li class="listitem"><span class="emphasis"><em>Forget to make arguments and return types serializable (you won’t know until runtime; this is not something the compiler will detect.)</em></span></li></ol></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_back_to_our_gumballmachine_remote_proxy" style="clear: both">Back to our GumballMachine remote proxy</h2></div></div></div><p>Okay, now that you have the RMI basics down, you’ve got the tools you need to implement the gumball machine remote proxy. Let’s take a look at how the GumballMachine fits into this framework:</p><div class="informalfigure"><a id="part0018_med_id00634a"></a><div class="mediaobject"><a id="part0018_med_id00634"></a><img alt="image with no caption" hisrc="figs/web/457fig01.png.jpg" src="../Images/image01134.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00635a"></a><div class="mediaobject"><a id="part0018_med_id00635"></a><img alt="image with no caption" hisrc="figs/web/457fig02.png.jpg" src="../Images/image01135.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_getting_the_gumballmachine_ready_to_be_a" style="clear: both">Getting the GumballMachine ready to be a remote service</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1316"></a><a class="indexterm" id="part0018_iddle1712"></a><a class="indexterm" id="part0018_iddle1988"></a><a class="indexterm" id="part0018_iddle2168"></a><a class="indexterm" id="part0018_iddle2216"></a><a class="indexterm" id="part0018_iddle2225"></a><a class="indexterm" id="part0018_iddle2243"></a>The first step in converting our code to use the remote proxy is to enable the GumballMachine to service remote requests from clients. In other words, we’re going to make it into a service. To do that, we need to:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Create a remote interface for the GumballMachine. This will provide a set of methods that can be called remotely.</li><li class="listitem">Make sure all the return types in the interface are serializable.</li><li class="listitem">Implement the interface in a concrete class.</li></ol></div><p>We’ll start with the remote interface:</p><div class="informalfigure"><a id="part0018_med_id00636a"></a><div class="mediaobject"><a id="part0018_med_id00636"></a><img alt="image with no caption" hisrc="figs/web/458fig01.png.jpg" src="../Images/image01136.jpeg"/></div></div><p>We have one return type that isn’t Serializable: the State class. Let’s fix it up...</p><div class="informalfigure"><a id="part0018_med_id00637a"></a><div class="mediaobject"><a id="part0018_med_id00637"></a><img alt="image with no caption" hisrc="figs/web/458fig02.png.jpg" src="../Images/image01137.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle2217"></a><a class="indexterm" id="part0018_iddle2244"></a>Actually, we’re not done with Serializable yet; we have one problem with State. As you may remember, each State object maintains a reference to a gumball machine so that it can call the gumball machine’s methods and change its state. We don’t want the entire gumball machine serialized and transferred with the State object. There is an easy way to fix this:</p><div class="informalfigure"><a id="part0018_med_id00638a"></a><div class="mediaobject"><a id="part0018_med_id00638"></a><img alt="image with no caption" hisrc="figs/web/459fig01.png.jpg" src="../Images/image01138.jpeg"/></div></div><p>We’ve already implemented our GumballMachine, but we need to make sure it can act as a service and handle requests coming from over the network. To do that, we have to make sure the GumballMachine is doing everything it needs to implement the GumballMachineRemote interface.</p><p>As you’ve already seen in the RMI detour, this is quite simple; all we need to do is add a couple of things...</p><div class="informalfigure"><a id="part0018_med_id00639a"></a><div class="mediaobject"><a id="part0018_med_id00639"></a><img alt="image with no caption" hisrc="figs/web/459fig02.png.jpg" src="../Images/image01139.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_registering_with_the_rmi_registryhellip" style="clear: both">Registering with the RMI registry...</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1317"></a><a class="indexterm" id="part0018_iddle1713"></a><a class="indexterm" id="part0018_iddle1989"></a><a class="indexterm" id="part0018_iddle2169"></a><a class="indexterm" id="part0018_iddle2221"></a><a class="indexterm" id="part0018_iddle2226"></a><a class="indexterm" id="part0018_iddle2248"></a>That completes the gumball machine service. Now we just need to fire it up so it can receive requests. First, we need to make sure we register it with the RMI registry so that clients can locate it.</p><p>We’re going to add a little code to the test drive that will take care of this for us:</p><div class="informalfigure"><a id="part0018_med_id00640a"></a><div class="mediaobject"><a id="part0018_med_id00640"></a><img alt="image with no caption" hisrc="figs/web/460fig01.png.jpg" src="../Images/image01140.jpeg"/></div></div><p>Let’s go ahead and get this running...</p><div class="informalfigure"><a id="part0018_med_id00641a"></a><div class="mediaobject"><a id="part0018_med_id00641"></a><img alt="image with no caption" hisrc="figs/web/460fig02.png.jpg" src="../Images/image01141.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_now_for_the_gumballmonitor_clienthellip" style="clear: both">Now for the GumballMonitor client...</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1318"></a><a class="indexterm" id="part0018_iddle1714"></a><a class="indexterm" id="part0018_iddle1990"></a><a class="indexterm" id="part0018_iddle2170"></a><a class="indexterm" id="part0018_iddle2218"></a><a class="indexterm" id="part0018_iddle2227"></a><a class="indexterm" id="part0018_iddle2245"></a>Remember the GumballMonitor? We wanted to reuse it without having to rewrite it to work over a network. Well, we’re pretty much going to do that, but we do need to make a few changes.</p><div class="informalfigure"><a id="part0018_med_id00642a"></a><div class="mediaobject"><a id="part0018_med_id00642"></a><img alt="image with no caption" hisrc="figs/web/461fig01.png.jpg" src="../Images/image01142.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00643a"></a><div class="mediaobject"><a id="part0018_med_id00643"></a><img alt="image with no caption" hisrc="figs/web/461fig02.png.jpg" src="../Images/image01143.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_writing_the_monitor_test_drive" style="clear: both">Writing the Monitor test drive</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1321"></a><a class="indexterm" id="part0018_iddle1717"></a><a class="indexterm" id="part0018_iddle1993"></a><a class="indexterm" id="part0018_iddle2173"></a><a class="indexterm" id="part0018_iddle2230"></a>Now we’ve got all the pieces we need. We just need to write some code so the CEO can monitor a bunch of gumball machines:</p><div class="informalfigure"><a id="part0018_med_id00644a"></a><div class="mediaobject"><a id="part0018_med_id00644"></a><img alt="image with no caption" hisrc="figs/web/462fig01.png.jpg" src="../Images/image01144.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_code_up_close-id00142"></a><h3 class="title">Code Up Close</h3><div class="informalfigure"><a id="part0018_med_id00645a"></a><div class="mediaobject"><a id="part0018_med_id00645"></a><img alt="image with no caption" hisrc="figs/web/463fig01.png.jpg" src="../Images/image01145.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_another_demo_for_the_ceo_of_mighty_gumba" style="clear: both">Another demo for the CEO of Mighty Gumball...</h2></div></div></div><p>Okay, it’s time to put all this work together and give another demo. First let’s make sure a few gumball machines are running the new code:</p><div class="informalfigure"><a id="part0018_med_id00646a"></a><div class="mediaobject"><a id="part0018_med_id00646"></a><img alt="image with no caption" hisrc="figs/web/463fig02.png.jpg" src="../Images/image01146.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0018_and_now_letapostrophes_put_the_monitor_i">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</h3></div></div></div><div class="informalfigure"><a id="part0018_med_id00647a"></a><div class="mediaobject"><a id="part0018_med_id00647"></a><img alt="image with no caption" hisrc="figs/web/464fig01.png.jpg" src="../Images/image01147.jpeg"/></div></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>By invoking methods on the proxy, we make a remote call across the wire, and get back a String, an integer, and a State object. Because we are using a proxy, the GumballMonitor doesn’t know, or care, that calls are remote (other than having to worry about remote exceptions).</strong></span></div></blockquote></div><div class="informalfigure"><a id="part0018_med_id00648a"></a><div class="mediaobject"><a id="part0018_med_id00648"></a><img alt="image with no caption" hisrc="figs/web/465fig01.png.jpg" src="../Images/image01148.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_behind_the_scenes-id00143"></a><h3 class="title">Behind the Scenes</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><a class="indexterm" id="part0018_iddle1141"></a><a class="indexterm" id="part0018_iddle1319"></a><a class="indexterm" id="part0018_iddle1715"></a><a class="indexterm" id="part0018_iddle1991"></a><a class="indexterm" id="part0018_iddle2171"></a><a class="indexterm" id="part0018_iddle2228"></a><a class="indexterm" id="part0018_iddle2257"></a><a class="indexterm" id="part0018_iddle2350"></a><a class="indexterm" id="part0018_iddle2430"></a>① The CEO runs the monitor, which first grabs the proxies to the remote gumball machines and then calls getState() on each one (along with getCount() and getLocation()).<div class="informalfigure"><a id="part0018_med_id00649a"></a><div class="mediaobject"><a id="part0018_med_id00649"></a><img alt="image with no caption" hisrc="figs/web/465fig02.png.jpg" src="../Images/image01149.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② getState() is called on the proxy, which forwards the call to the remote service. The skeleton receives the request and then forwards it to the gumball machine.<div class="informalfigure"><a id="part0018_med_id00650a"></a><div class="mediaobject"><a id="part0018_med_id00650"></a><img alt="image with no caption" hisrc="figs/web/466fig01.png.jpg" src="../Images/image01150.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">③ GumballMachine returns the state to the skeleton, which serializes it and transfers it back over the wire to the proxy. The proxy deserializes it and returns it as an object to the monitor.<div class="informalfigure"><a id="part0018_med_id00651a"></a><div class="mediaobject"><a id="part0018_med_id00651"></a><img alt="image with no caption" hisrc="figs/web/466fig02.png.jpg" src="../Images/image01151.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note06"></a>Note</h3><p>We also have a small bit of code to register and locate stubs using the RMI registry. But no matter what, if we were writing something to work over the Internet, we’d need some kind of locator service.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_proxy_pattern_defined" style="clear: both">The Proxy Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0018_iddle2160"></a>We’ve already put a lot of pages behind us in this chapter; as you can see, explaining the Remote Proxy is quite involved. Despite that, you’ll see that the definition and class diagram for the Proxy Pattern is actually fairly straightforward. Note that Remote Proxy is one implementation of the general Proxy Pattern; there are actually quite a few variations of the pattern, and we’ll talk about them later. For now, let’s get the details of the general pattern down.</p><p>Here’s the Proxy Pattern definition:</p><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>Use the Proxy Pattern to create a representative object that controls access to another object, which may be remote, expensive to create, or in need of securing.</strong></span></div></blockquote></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note07"></a>Note</h3><p><span class="strong"><strong>The Proxy Pattern</strong></span> provides a surrogate or placeholder for another object to control access to it.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Well, we’ve seen how the Proxy Pattern provides a surrogate or placeholder for another object. We’ve also described the proxy as a “representative” for another object.</p><p>But what about a proxy controlling access? That sounds a little strange. No worries. In the case of the gumball machine, just think of the proxy controlling access to the remote object. The proxy needed to control access because our client, the monitor, didn’t know how to talk to a remote object. So in some sense the remote proxy controlled access so that it could handle the network details for us. As we just discussed, there are many variations of the Proxy Pattern, and the variations typically revolve around the way the proxy “controls access.” We’re going to talk more about this later, but for now here are a few ways proxies control access:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">As we know, a remote proxy controls access to a remote object.</li><li class="listitem">A virtual proxy controls access to a resource that is expensive to create.</li><li class="listitem">A protection proxy controls access to a resource based on access rights.</li></ul></div><p>Now that you’ve got the gist of the general pattern, check out the class diagram...</p><div class="informalfigure"><a id="part0018_med_id00652a"></a><div class="mediaobject"><a id="part0018_med_id00652"></a><img alt="image with no caption" hisrc="figs/web/468fig01.png.jpg" src="../Images/image01152.jpeg"/></div></div><p>Let’s step through the diagram...</p><p>First we have a Subject, which provides an interface for the RealSubject and the Proxy. By implementing the same interface, the Proxy can be substituted for the RealSubject anywhere it occurs.</p><p>The RealSubject is the object that does the real work. It’s the object that the Proxy represents and controls access to.</p><p>The Proxy holds a reference to the RealSubject. In some cases, the Proxy may be responsible for creating and destroying the RealSubject. Clients interact with the RealSubject through the Proxy. Because the Proxy and RealSubject implement the same interface (Subject), the Proxy can be substituted anywhere the subject can be used. The Proxy also controls access to the RealSubject; this control may be needed if the Subject is running on a remote machine, if the Subject is expensive to create in some way or if access to the subject needs to be protected in some way.</p><p>Now that you understand the general pattern, let’s look at some other ways of using proxy beyond the Remote Proxy...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_get_ready_for_virtual_proxy" style="clear: both">Get ready for Virtual Proxy</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1325"></a><a class="indexterm" id="part0018_iddle1997"></a><a class="indexterm" id="part0018_iddle2195"></a><a class="indexterm" id="part0018_iddle2496"></a>Okay, so far you’ve seen the definition of the Proxy Pattern and you’ve taken a look at one specific example: the <span class="emphasis"><em>Remote Proxy</em></span>. Now we’re going to take a look at a different type of proxy, the <span class="emphasis"><em>Virtual Proxy</em></span>. As you’ll discover, the Proxy Pattern can manifest itself in many forms, yet all the forms follow roughly the general proxy design. Why so many forms? Because the Proxy Pattern can be applied to a lot of different use cases. Let’s check out the Virtual Proxy and compare it to Remote Proxy:</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0018_remote_proxy">Remote Proxy</h3></div></div></div><p>With Remote Proxy, the proxy acts as a local representative for an object that lives in a different JVM. A method call on the proxy results in the call being transferred over the wire, invoked remotely, and the result being returned back to the proxy and then to the Client.</p><div class="informalfigure"><a id="part0018_med_id00653a"></a><div class="mediaobject"><a id="part0018_med_id00653"></a><img alt="image with no caption" hisrc="figs/web/469fig01.png.jpg" src="../Images/image01153.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0018_virtual_proxy">Virtual Proxy</h3></div></div></div><p>Virtual Proxy acts as a representative for an object that may be expensive to create. The Virtual Proxy often defers the creation of the object until it is needed; the Virtual Proxy also acts as a surrogate for the object before and while it is being created. After that, the proxy delegates requests directly to the RealSubject.</p><div class="informalfigure"><a id="part0018_med_id00654a"></a><div class="mediaobject"><a id="part0018_med_id00654"></a><img alt="image with no caption" hisrc="figs/web/469fig02.png.jpg" src="../Images/image01154.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_displaying_cd_covers" style="clear: both">Displaying CD covers</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1092"></a>Let’s say you want to write an application that displays your favorite compact disc covers. You might create a menu of the CD titles and then retrieve the images from an online service like Amazon.com. If you’re using Swing, you might create an Icon and ask it to load the image from the network. The only problem is, depending on the network load and the bandwidth of your connection, retrieving a CD cover might take a little time, so your application should display something while you are waiting for the image to load. We also don’t want to hang up the entire application while it’s waiting on the image. Once the image is loaded, the message should go away and you should see the image.</p><p>An easy way to achieve this is through a virtual proxy. The virtual proxy can stand in place of the icon, manage the background loading, and before the image is fully retrieved from the network, display “Loading CD cover, please wait...”. Once the image is loaded, the proxy delegates the display to the Icon.</p><div class="informalfigure"><a id="part0018_med_id00655a"></a><div class="mediaobject"><a id="part0018_med_id00655"></a><img alt="image with no caption" hisrc="figs/web/470fig01.png.jpg" src="../Images/image01155.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_designing_the_cd_cover_virtual_proxy" style="clear: both">Designing the CD cover Virtual Proxy</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1094"></a><a class="indexterm" id="part0018_iddle1326"></a><a class="indexterm" id="part0018_iddle1998"></a><a class="indexterm" id="part0018_iddle2198"></a><a class="indexterm" id="part0018_iddle2499"></a>Before writing the code for the CD Cover Viewer, let’s look at the class diagram. You’ll see this looks just like our Remote Proxy class diagram, but here the proxy is used to hide an object that is expensive to create (because we need to retrieve the data for the Icon over the network) as opposed to an object that actually lives somewhere else on the network.</p><div class="informalfigure"><a id="part0018_med_id00656a"></a><div class="mediaobject"><a id="part0018_med_id00656"></a><img alt="image with no caption" hisrc="figs/web/471fig01.png.jpg" src="../Images/image01156.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0018_how_imageproxy_is_going_to_work">How ImageProxy is going to work</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① ImageProxy first creates an ImageIcon and starts loading it from a network URL.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② While the bytes of the image are being retrieved, ImageProxy displays “Loading CD cover, please wait...”.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ When the image is fully loaded, ImageProxy delegates all method calls to the image icon, including paintIcon(), getWidth() and getHeight().</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ If the user requests a new image, we’ll create a new proxy and start the process over.</strong></span></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_writing_the_image_proxy" style="clear: both">Writing the Image Proxy</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00657a"></a><div class="mediaobject"><a id="part0018_med_id00657"></a><img alt="image with no caption" hisrc="figs/web/472fig01.png.jpg" src="../Images/image01157.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_code_up_close-id00144"></a><h3 class="title">Code Up Close</h3><div class="informalfigure"><a id="part0018_med_id00658a"></a><div class="mediaobject"><a id="part0018_med_id00658"></a><img alt="image with no caption" hisrc="figs/web/473fig01.png.jpg" src="../Images/image01158.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_code_way_up_close-id00145"></a><h3 class="title">Code Way Up Close</h3><div class="informalfigure"><a id="part0018_med_id00659a"></a><div class="mediaobject"><a id="part0018_med_id00659"></a><img alt="image with no caption" hisrc="figs/web/474fig01.png.jpg" src="../Images/image01159.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note08"></a>Note</h3><p><a class="indexterm" id="part0018_iddle1097"></a><a class="indexterm" id="part0018_iddle1329"></a><a class="indexterm" id="part0018_iddle1772"></a><a class="indexterm" id="part0018_iddle2001"></a><a class="indexterm" id="part0018_iddle2201"></a><a class="indexterm" id="part0018_iddle2502"></a>So, the next time the display is painted after the ImageIcon is instantiated, the paintIcon method will paint the image, not the loading message.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_design_puzzle-id00146"></a><h3 class="title">Design Puzzle</h3><p><a class="indexterm" id="part0018_iddle1437"></a><a class="indexterm" id="part0018_iddle1517"></a>The ImageProxy class appears to have two states that are controlled by conditional statements. Can you think of another pattern that might clean up this code? How would you redesign ImageProxy?</p><div class="informalfigure"><a id="part0018_med_id00660a"></a><div class="mediaobject"><a id="part0018_med_id00660"></a><img alt="image with no caption" hisrc="figs/web/475fig01.png.jpg" src="../Images/image01160.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_testing_the_cd_cover_viewer" style="clear: both">Testing the CD Cover Viewer</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_ready_bake_code"></a><h3 class="title">Ready Bake Code</h3><p><a class="indexterm" id="part0018_iddle1096"></a><a class="indexterm" id="part0018_iddle1328"></a><a class="indexterm" id="part0018_iddle2000"></a><a class="indexterm" id="part0018_iddle2200"></a><a class="indexterm" id="part0018_iddle2501"></a>Okay, it’s time to test out this fancy new virtual proxy. Behind the scenes we’ve been baking up a new ImageProxyTestDrive that sets up the window, creates a frame, installs the menus and creates our proxy. We don’t go through all that code in gory detail here, but you can always grab the source code and have a look, or check it out at the end of the chapter where we list all the source code for the Virtual Proxy.</p><p>Here’s a partial view of the test drive code:</p><div class="informalfigure"><a id="part0018_med_id00661a"></a><div class="mediaobject"><a id="part0018_med_id00661"></a><img alt="image with no caption" hisrc="figs/web/476fig01.png.jpg" src="../Images/image01161.jpeg"/></div></div><p>Now let’s run the test drive:</p><div class="informalfigure"><a id="part0018_med_id00662a"></a><div class="mediaobject"><a id="part0018_med_id00662"></a><img alt="image with no caption" hisrc="figs/web/476fig02.png.jpg" src="../Images/image01162.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0018_things_to_tryhellip">Things to try...</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① Use the menu to load different CD covers; watch the proxy display “loading” until the image has arrived.</li><li class="listitem" style="list-style-type: none">② Resize the window as the “loading” message is displayed. Notice that the proxy is handling the loading without hanging up the Swing window.</li><li class="listitem" style="list-style-type: none">③ Add your own favorite CDs to the ImageProxyTestDrive.</li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_what_did_we_doquestion_mark-id00147" style="clear: both">What did we do?</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_behind_the_scenes-id00148"></a><h3 class="title">Behind the Scenes</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">① <a class="indexterm" id="part0018_iddle1095"></a><a class="indexterm" id="part0018_iddle1327"></a><a class="indexterm" id="part0018_iddle1999"></a><a class="indexterm" id="part0018_iddle2199"></a><a class="indexterm" id="part0018_iddle2500"></a>We created an ImageProxy for the display. The paintIcon() method is called and ImageProxy fires off a thread to retrieve the image and create the ImageIcon.<div class="informalfigure"><a id="part0018_med_id00663a"></a><div class="mediaobject"><a id="part0018_med_id00663"></a><img alt="image with no caption" hisrc="figs/web/477fig01.png.jpg" src="../Images/image01163.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">② At some point the image is returned and the ImageIcon fully instantiated.</li><li class="listitem" style="list-style-type: none">③ After the ImageIcon is created, the next time paintIcon() is called, the proxy delegates to the ImageIcon.<div class="informalfigure"><a id="part0018_med_id00664a"></a><div class="mediaobject"><a id="part0018_med_id00664"></a><img alt="image with no caption" hisrc="figs/web/477fig02.png.jpg" src="../Images/image01164.jpeg"/></div></div></li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_there_are_no_dumb_questions-id00149"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2qe1"></a><a id="part0018_ch11qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0018_iddle1033"></a><a class="indexterm" id="part0018_iddle1088"></a><a class="indexterm" id="part0018_iddle1303"></a><a class="indexterm" id="part0018_iddle1354"></a><a class="indexterm" id="part0018_iddle1975"></a><a class="indexterm" id="part0018_iddle2150"></a><a class="indexterm" id="part0018_iddle2156"></a><a class="indexterm" id="part0018_iddle2159"></a><a class="indexterm" id="part0018_iddle2179"></a><a class="indexterm" id="part0018_iddle2185"></a><a class="indexterm" id="part0018_iddle2187"></a><a class="indexterm" id="part0018_iddle2193"></a><a class="indexterm" id="part0018_iddle2196"></a><a class="indexterm" id="part0018_iddle2204"></a><a class="indexterm" id="part0018_iddle2206"></a><a class="indexterm" id="part0018_iddle2497"></a><span class="strong"><strong>Q: The Remote Proxy and Virtual Proxy seem so different to me; are they really ONE pattern?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You’ll find a lot of variants of the Proxy Pattern in the real world; what they all have in common is that they intercept a method invocation that the client is making on the subject. This level of indirection allows us to do many things, including dispatching requests to a remote subject, providing a representative for an expensive object as it is created, or, as you’ll see, providing some level of protection that can determine which clients should be calling which methods. That’s just the beginning; the general Proxy Pattern can be applied in many different ways, and we’ll cover some of the other ways at the end of the chapter.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2qe2"></a><a id="part0018_ch11qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: ImageProxy seems just like a Decorator to me. I mean, we are basically wrapping one object with another and then delegating the calls to the ImageIcon. What am I missing?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Sometimes Proxy and Decorator look very similar, but their purposes are different: a decorator adds behavior to a class, while a proxy controls access to it. You might ask, “Isn’t the loading message adding behavior?” In some ways it is; however, more importantly, the ImageProxy is controlling access to an ImageIcon. How does it control access? Well, think about it this way: the proxy is decoupling the client from the ImageIcon. If they were coupled the client would have to wait until each image is retrieved before it could paint its entire interface. The proxy controls access to the ImageIcon so that before it is fully created, the proxy provides another on screen representation. Once the ImageIcon is created the proxy allows access.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2qe3"></a><a id="part0018_ch11qa2q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How do I make clients use the Proxy rather than the Real Subject?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Good question. One common technique is to provide a factory that instantiates and returns the subject. Because this happens in a factory method we can then wrap the subject with a proxy before returning it. The client never knows or cares that it’s using a proxy instead of the real thing.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2qe4"></a><a id="part0018_ch11qa2q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I noticed in the ImageProxy example, you always create a new ImageIcon to get the image, even if the image has already been retrieved. Could you implement something similar to the ImageProxy that caches past retrievals?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You are talking about a specialized form of a Virtual Proxy called a Caching Proxy. A caching proxy maintains a cache of previously created objects and when a request is made it returns cached object, if possible.</div><div>We’re going to look at this and at several other variants of the Proxy Pattern at the end of the chapter.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2qe5"></a><a id="part0018_ch11qa2q5"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I see how Decorator and Proxy relate, but what about Adapter? An adapter seems very similar as well.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa2q5a5"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Both Proxy and Adapter sit in front of other objects and forward requests to them. Remember that Adapter changes the interface of the objects it adapts, while the Proxy implements the same interface.</div><div>There is one additional similarity that relates to the Protection Proxy. A Protection Proxy may allow or disallow a client access to particular methods in an object based on the role of the client. In this way a Protection Proxy may only provide a partial interface to a client, which is quite similar to some Adapters. We are going to take a look at Protection Proxy in a few pages.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_fireside_chats-id00150"></a><h3 class="title"><code class="literal">Fireside Chats</code></h3><p>Tonight’s talk: <span class="strong"><strong>Proxy and Decorator get intentional.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Proxy:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Decorator:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hello, Decorator. I presume you’re here because people sometimes get us confused?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, I think the reason people get us confused is that you go around pretending to be an entirely different pattern, when in fact, you’re just a Decorator in disguise. I really don’t think you should be copying all my ideas.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="emphasis"><em>Me</em></span> copying <span class="emphasis"><em>your</em></span> ideas? Please. I control access to objects. You just decorate them. My job is so much more important than yours it’s just not even funny.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>“Just” decorate? You think decorating is some frivolous, unimportant pattern? Let me tell you buddy, I add <span class="emphasis"><em>behavior</em></span>. That’s the most important thing about objects — what they do!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Fine, so maybe you’re not entirely frivolous... but I still don’t get why you think I’m copying all your ideas. I’m all about representing my subjects, not decorating them.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>You can call it “representation” but if it looks like a duck and walks like a duck... I mean, just look at your Virtual Proxy; it’s just another way of adding behavior to do something while some big expensive object is loading, and your Remote Proxy is a way of talking to remote objects so your clients don’t have to bother with that themselves. It’s all about behavior, just like I said.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I don’t think you get it, Decorator. I stand in for my Subjects; I don’t just add behavior. Clients use me as a surrogate of a Real Subject, because I can protect them from unwanted access, or keep their GUIs from hanging up while they’re waiting for big objects to load, or hide the fact that their Subjects are running on remote machines. I’d say that’s a very different intent from yours!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Call it what you want. I implement the same interface as the objects I wrap; so do you.<a class="indexterm" id="part0018_iddle1322"></a><a class="indexterm" id="part0018_iddle1718"></a><a class="indexterm" id="part0018_iddle1994"></a><a class="indexterm" id="part0018_iddle2174"></a><a class="indexterm" id="part0018_iddle2231"></a><a class="indexterm" id="part0018_iddle2533"></a></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Okay, let’s review that statement. You wrap an object. While sometimes we informally say a proxy wraps its Subject, that’s not really an accurate term.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Oh yeah? Why not?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Think about a remote proxy... what object am I wrapping? The object I’m representing and controlling access to lives on another machine! Let’s see you do that.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, but we all know remote proxies are kinda weird. Got a second example? I doubt it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Sure, okay, take a virtual proxy... think about the CD viewer example. When the client first uses me as a proxy the subject doesn’t even exist! So what am I wrapping there?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Uh huh, and the next thing you’ll be saying is that you actually get to create objects.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I never knew decorators were so dumb! Of course I sometimes create objects. How do you think a virtual proxy gets its subject?! Okay, you just pointed out a big difference between us: we both know decorators only add window dressing; they never get to instantiate anything.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Oh yeah? Instantiate this!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey, after this conversation I’m convinced you’re just a dumb proxy!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Dumb proxy? I’d like to see you recursively wrap an object with 10 decorators and keep your head straight at the same time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Very seldom will you ever see a proxy get into wrapping a subject multiple times; in fact, if you’re wrapping something 10 times, you better go back reexamine your design.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; "> </td><td style="vertical-align: top; "><p>Just like a proxy, acting all real when in fact you just stand in for the objects doing the real work. You know, I actually feel sorry for you.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_using_the_java_apiapostrophes_proxy_to_c" style="clear: both">Using the Java API’s Proxy to create a protection proxy</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1308"></a><a class="indexterm" id="part0018_iddle1313"></a><a class="indexterm" id="part0018_iddle1468"></a><a class="indexterm" id="part0018_iddle1859"></a><a class="indexterm" id="part0018_iddle1980"></a><a class="indexterm" id="part0018_iddle1985"></a><a class="indexterm" id="part0018_iddle2146"></a><a class="indexterm" id="part0018_iddle2152"></a><a class="indexterm" id="part0018_iddle2176"></a><a class="indexterm" id="part0018_iddle2178"></a><a class="indexterm" id="part0018_iddle2184"></a>Java’s got its own proxy support right in the java.lang.reflect package. With this package, Java lets you create a proxy class <span class="emphasis"><em>on the fly</em></span> that implements one or more interfaces and forwards method invocations to a class that you specify. Because the actual proxy class is created at runtime, we refer to this Java technology as a <span class="emphasis"><em>dynamic proxy</em></span>.</p><div class="informalfigure"><a id="part0018_med_id00665a"></a><div class="mediaobject"><a id="part0018_med_id00665"></a><img alt="image with no caption" hisrc="figs/web/481fig00.png.jpg" src="../Images/image01165.jpeg"/></div></div><p>We’re going to use Java’s dynamic proxy to create our next proxy implementation (a protection proxy), but before we do that, let’s quickly look at a class diagram that shows how dynamic proxies are put together. Like most things in the real world, it differs slightly from the classic definition of the pattern:</p><div class="informalfigure"><a id="part0018_med_id00666a"></a><div class="mediaobject"><a id="part0018_med_id00666"></a><img alt="image with no caption" hisrc="figs/web/481fig01.png.jpg" src="../Images/image01166.jpeg"/></div></div><p>Because Java creates the Proxy class <span class="emphasis"><em>for you</em></span>, you need a way to tell the Proxy class what to do. You can’t put that code into the Proxy class like we did before, because you’re not implementing one directly. So, if you can’t put this code in the Proxy class, where do you put it? In an InvocationHandler. The job of the InvocationHandler is to respond to any method calls on the proxy. Think of the InvocationHandler as the object the Proxy asks to do all the real work after it’s received the method calls.</p><p>Okay, let’s step through how to use the dynamic proxy...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_matchmaking_in_objectville" style="clear: both">Matchmaking in Objectville</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00667a"></a><div class="mediaobject"><a id="part0018_med_id00667"></a><img alt="image with no caption" hisrc="figs/web/482fig01.png.jpg" src="../Images/image01167.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle1898"></a>Every town needs a matchmaking service, right? You’ve risen to the task and implemented a dating service for Objectville. You’ve also tried to be innovative by including a “Hot or Not” feature in the service where participants can rate each other — you figure this keeps your customers engaged and looking through possible matches; it also makes things a lot more fun.</p><p>Your service revolves around a PersonBean that allows you to set and get information about a person:</p><div class="informalfigure"><a id="part0018_med_id00668a"></a><div class="mediaobject"><a id="part0018_med_id00668"></a><img alt="image with no caption" hisrc="figs/web/482fig02.png.jpg" src="../Images/image01168.jpeg"/></div></div><p>Now let’s check out the implementation...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_personbean_implementation" style="clear: both">The PersonBean implementation</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00669a"></a><div class="mediaobject"><a id="part0018_med_id00669"></a><img alt="image with no caption" hisrc="figs/web/483fig01.png.jpg" src="../Images/image01169.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00670a"></a><div class="mediaobject"><a id="part0018_med_id00670"></a><img alt="image with no caption" hisrc="figs/web/484fig01.png.jpg" src="../Images/image01170.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle1310"></a><a class="indexterm" id="part0018_iddle1900"></a><a class="indexterm" id="part0018_iddle1982"></a><a class="indexterm" id="part0018_iddle2148"></a><a class="indexterm" id="part0018_iddle2181"></a>While we suspect other factors may be keeping Elroy from getting dates, he is right: you shouldn’t be able to vote for yourself or to change another customer’s data. The way our PersonBean is defined, any client can call any of the methods.</p><p>This is a perfect example of where we might be able to use a Protection Proxy. What’s a Protection Proxy? It’s a proxy that controls access to an object based on access rights. For instance, if we had an employee object, a Protection Proxy might allow the employee to call certain methods on the object, a manager to call additional methods (like setSalary()), and a human resources employee to call any method on the object.</p><p>In our dating service we want to make sure that a customer can set his own information while preventing others from altering it. We also want to allow just the opposite with the HotOrNot ratings: we want the other customers to be able to set the rating, but not that particular customer. We also have a number of getter methods in the PersonBean, and because none of these return private information, any customer should be able to call them.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_five-minute_drama_protecting_subjects" style="clear: both">Five-minute drama: protecting subjects</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00671a"></a><div class="mediaobject"><a id="part0018_med_id00671"></a><img alt="image with no caption" hisrc="figs/web/common21.png.jpg" src="../Images/image01171.jpeg"/></div></div><p><a class="indexterm" id="part0018_iddle1311"></a><a class="indexterm" id="part0018_iddle1901"></a><a class="indexterm" id="part0018_iddle1983"></a><a class="indexterm" id="part0018_iddle2149"></a><a class="indexterm" id="part0018_iddle2182"></a>The Internet bubble seems a distant memory; those were the days when all you needed to do to find a better, higher-paying job was to walk across the street. Even agents for software developers were in vogue...</p><div class="informalfigure"><a id="part0018_med_id00672a"></a><div class="mediaobject"><a id="part0018_med_id00672"></a><img alt="image with no caption" hisrc="figs/web/485fig01.png.jpg" src="../Images/image01172.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_big_picture_creating_a_dynamic_proxy_for" style="clear: both">Big Picture: creating a Dynamic Proxy for the PersonBean</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1309"></a><a class="indexterm" id="part0018_iddle1467"></a><a class="indexterm" id="part0018_iddle1899"></a><a class="indexterm" id="part0018_iddle1981"></a><a class="indexterm" id="part0018_iddle2147"></a><a class="indexterm" id="part0018_iddle2180"></a>We have a couple of problems to fix: customers shouldn’t be changing their own HotOrNot rating and customers shouldn’t be able to change other customers’ personal information. To fix these problems we’re going to create two proxies: one for accessing your own PersonBean object and one for accessing another customer’s PersonBean object. That way, the proxies can control what requests can be made in each circumstance.</p><p>To create these proxies we’re going to use the Java API’s dynamic proxy that you saw a few pages back. Java will create two proxies for us; all we need to do is supply the handlers that know what to do when a method is invoked on the proxy.</p><div class="informalfigure"><a id="part0018_med_id00673a"></a><div class="mediaobject"><a id="part0018_med_id00673"></a><img alt="image with no caption" hisrc="figs/web/486fig01.png.jpg" src="../Images/image01173.jpeg"/></div></div><p><span class="strong"><strong>Step one:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Create two <span class="strong"><strong>InvocationHandlers.</strong></span></li><li class="listitem" style="list-style-type: none">InvocationHandlers implement the behavior of the proxy. As you’ll see, Java will take care of creating the actual proxy class and object; we just need to supply a handler that knows what to do when a method is called on it.</li></ul></div><p><span class="strong"><strong>Step two:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Write the code that creates the dynamic proxies.</li><li class="listitem" style="list-style-type: none">We need to write a little bit of code to generate the proxy class and instantiate it. We’ll step through this code in just a bit.</li></ul></div><p><span class="strong"><strong>Step three:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Wrap any PersonBean object with the appropriate proxy.</li><li class="listitem" style="list-style-type: none">When we need to use a PersonBean object, either it’s the object of the customer himself (in that case, will call him the “owner”), or it’s another user of the service that the customer is checking out (in that case we’ll call him “non-owner”).</li><li class="listitem" style="list-style-type: none">In either case, we create the appropriate proxy for the PersonBean.</li></ul></div><div class="informalfigure"><a id="part0018_med_id00674a"></a><div class="mediaobject"><a id="part0018_med_id00674"></a><img alt="image with no caption" hisrc="figs/web/486fig02.png.jpg" src="../Images/image01174.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_step_one_creating_invocation_handlers" style="clear: both">Step one: creating Invocation Handlers</h2></div></div></div><p><a class="indexterm" id="part0018_iddle2186"></a><a class="indexterm" id="part0018_iddle2205"></a>We know we need to write two invocation handlers, one for the owner and one for the non-owner. But what are invocation handlers? Here’s the way to think about them: when a method call is made on the proxy, the proxy forwards that call to your invocation handler, but not by calling the invocation handler’s corresponding method. So, what does it call? Have a look at the InvocationHandler interface:</p><div class="informalfigure"><a id="part0018_med_id00675a"></a><div class="mediaobject"><a id="part0018_med_id00675"></a><img alt="image with no caption" hisrc="figs/web/487fig01.png.jpg" src="../Images/image01175.jpeg"/></div></div><p>There’s only one method, invoke(), and no matter what methods get called on the proxy, the invoke() method is what gets called on the handler. Let’s see how this works:</p><div class="informalfigure"><a id="part0018_med_id00676a"></a><div class="mediaobject"><a id="part0018_med_id00676"></a><img alt="image with no caption" hisrc="figs/web/487fig02.png.jpg" src="../Images/image01176.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_creating_invocation_handlers_continuedhe" style="clear: both">Creating Invocation Handlers continued...</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1860"></a><a class="indexterm" id="part0018_iddle2177"></a><a class="indexterm" id="part0018_iddle2188"></a><a class="indexterm" id="part0018_iddle2207"></a>When invoke() is called by the proxy, how do you know what to do with the call? Typically, you’ll examine the method that was called on the proxy and make decisions based on the method’s name and possibly its arguments. Let’s implement the OwnerInvocationHandler to see how this works:</p><div class="informalfigure"><a id="part0018_med_id00677a"></a><div class="mediaobject"><a id="part0018_med_id00677"></a><img alt="image with no caption" hisrc="figs/web/488fig01.png.jpg" src="../Images/image01177.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_exercise-id00151"></a><h3 class="title">Exercise</h3><p><a class="indexterm" id="part0018_iddle1592"></a>The NonOwnerInvocationHandler works just like the OwnerInvocationHandler except that it <span class="emphasis"><em>allows</em></span> calls to setHotOrNotRating() and it <span class="emphasis"><em>disallows</em></span> calls to any other set method. Go ahead and write this handler yourself:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_step_two_creating_the_proxy_class_and_in" style="clear: both">Step two: creating the Proxy class and instantiating the Proxy object</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1570"></a><a class="indexterm" id="part0018_iddle2189"></a><a class="indexterm" id="part0018_iddle2208"></a><a class="indexterm" id="part0018_iddle2315"></a>Now, all we have left is to dynamically create the Proxy class and instantiate the proxy object. Let’s start by writing a method that takes a PersonBean and knows how to create an owner proxy for it. That is, we’re going to create the kind of proxy that forwards its method calls to the OwnerInvocationHandler. Here’s the code:</p><div class="informalfigure"><a id="part0018_med_id00678a"></a><div class="mediaobject"><a id="part0018_med_id00678"></a><img alt="image with no caption" hisrc="figs/web/490fig01.png.jpg" src="../Images/image01178.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_sharpen_your_pencil-id00152"></a><h3 class="title">Sharpen your pencil</h3><p>While it is a little complicated, there isn’t much to creating a dynamic proxy. Why don’t you write getNonOwnerProxy(), which returns a proxy for the NonOwnerInvocationHandler:</p><p>Take it further: can you write one method getProxy() that takes a handler and a person and returns a proxy that uses that handler?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_testing_the_matchmaking_service" style="clear: both">Testing the matchmaking service</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1312"></a><a class="indexterm" id="part0018_iddle1902"></a><a class="indexterm" id="part0018_iddle1984"></a><a class="indexterm" id="part0018_iddle2151"></a><a class="indexterm" id="part0018_iddle2183"></a>Let’s give the matchmaking service a test run and see how it controls access to the setter methods based on the proxy that is used.</p><div class="informalfigure"><a id="part0018_med_id00679a"></a><div class="mediaobject"><a id="part0018_med_id00679"></a><img alt="image with no caption" hisrc="figs/web/491fig01.png.jpg" src="../Images/image01179.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_running_the_codehellip" style="clear: both">Running the code...</h2></div></div></div><div class="informalfigure"><a id="part0018_med_id00680a"></a><div class="mediaobject"><a id="part0018_med_id00680"></a><img alt="image with no caption" hisrc="figs/web/492fig01.png.jpg" src="../Images/image01180.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_there_are_no_dumb_questions-id00153"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3qe1"></a><a id="part0018_ch11qa3q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0018_iddle1120"></a><a class="indexterm" id="part0018_iddle1466"></a><a class="indexterm" id="part0018_iddle2155"></a><a class="indexterm" id="part0018_iddle2161"></a><a class="indexterm" id="part0018_iddle2190"></a><span class="strong"><strong>Q: So what exactly is the “dynamic” aspect of dynamic proxies? Is it that I’m instantiating the proxy and setting it to a handler at runtime?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No, the proxy is dynamic because its class is created at runtime. Think about it: before your code runs there is no proxy class; it is created on demand from the set of interfaces you pass it.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3qe2"></a><a id="part0018_ch11qa3q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: My InvocationHandler seems like a very strange proxy, it doesn’t implement any of the methods of the class it’s proxying.</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> That is because the InvocationHandler isn’t a proxy — it is a class that the proxy dispatches to for handling method calls. The proxy itself is created dynamically at runtime by the static Proxy.newProxyInstance() method.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3qe3"></a><a id="part0018_ch11qa3q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Is there any way to tell if a class is a Proxy class?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes. The Proxy class has a static method called isProxyClass(). Calling this method with a class will return true if the class is a dynamic proxy class. Other than that, the proxy class will act like any other class that implements a particular set of interfaces.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3qe4"></a><a id="part0018_ch11qa3q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Are there any restrictions on the types of interfaces I can pass into newProxyInstance()?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0018_ch11qa3q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes, there are a few. First, it is worth pointing out that we always pass newProxyInstance() an array of interfaces — only interfaces are allowed, no classes. The major restrictions are that all non-public interfaces need to be from the same package. You also can’t have interfaces with clashing method names (that is, two interfaces with a method with the same signature). There are a few other minor nuances as well, so at some point you should take a look at the fine print on dynamic proxies in the javadoc.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_who_does_whatquestion_mark-id00154"></a><h3 class="title">Who Does What?</h3><p><a class="indexterm" id="part0018_iddle1025"></a><a class="indexterm" id="part0018_iddle1347"></a><a class="indexterm" id="part0018_iddle1586"></a><a class="indexterm" id="part0018_iddle1609"></a><a class="indexterm" id="part0018_iddle2162"></a><a class="indexterm" id="part0018_iddle2523"></a>Match each pattern with its description:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Description</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Decorator</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wraps another object and provides a different interface to it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Facade</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wraps another object and provides additional behavior for it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Proxy</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wraps another object to control access to it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Adapter</p></td><td style="vertical-align: top; "><p>Wraps a bunch of objects to simplify their interface.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_proxy_zoo" style="clear: both">The Proxy Zoo</h2></div></div></div><p><a class="indexterm" id="part0018_iddle1089"></a><a class="indexterm" id="part0018_iddle1304"></a><a class="indexterm" id="part0018_iddle1307"></a><a class="indexterm" id="part0018_iddle1323"></a><a class="indexterm" id="part0018_iddle1677"></a><a class="indexterm" id="part0018_iddle1976"></a><a class="indexterm" id="part0018_iddle1979"></a><a class="indexterm" id="part0018_iddle1995"></a><a class="indexterm" id="part0018_iddle2165"></a><a class="indexterm" id="part0018_iddle2191"></a><a class="indexterm" id="part0018_iddle2194"></a><a class="indexterm" id="part0018_iddle2197"></a><a class="indexterm" id="part0018_iddle2352"></a><a class="indexterm" id="part0018_iddle2498"></a>Welcome to the Objectville Zoo!</p><div class="informalfigure"><a id="part0018_med_id00681a"></a><div class="mediaobject"><a id="part0018_med_id00681"></a><img alt="image with no caption" hisrc="figs/web/494fig01.png.jpg" src="../Images/image01181.jpeg"/></div></div><p>You now know about the remote, virtual and protection proxies, but out in the wild you’re going to see lots of mutations of this pattern. Over here in the Proxy corner of the zoo we’ve got a nice collection of wild proxy patterns that we’ve captured for your study.</p><p>Our job isn’t done; we are sure you’re going to see more variations of this pattern in the real world, so give us a hand in cataloging more proxies. Let’s take a look at the existing collection:</p><div class="informalfigure"><a id="part0018_med_id00682a"></a><div class="mediaobject"><a id="part0018_med_id00682"></a><img alt="image with no caption" hisrc="figs/web/494fig02.png.jpg" src="../Images/image01182.jpeg"/></div></div><div class="informalfigure"><a id="part0018_med_id00683a"></a><div class="mediaobject"><a id="part0018_med_id00683"></a><img alt="image with no caption" hisrc="figs/web/495fig01.png.jpg" src="../Images/image01183.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0018_ch11note09"></a>Note</h3><p><a class="indexterm" id="part0018_iddle1223"></a><a class="indexterm" id="part0018_iddle1305"></a><a class="indexterm" id="part0018_iddle1306"></a><a class="indexterm" id="part0018_iddle1324"></a><a class="indexterm" id="part0018_iddle1330"></a><a class="indexterm" id="part0018_iddle1605"></a><a class="indexterm" id="part0018_iddle1977"></a><a class="indexterm" id="part0018_iddle1978"></a><a class="indexterm" id="part0018_iddle1996"></a><a class="indexterm" id="part0018_iddle2157"></a><a class="indexterm" id="part0018_iddle2158"></a><a class="indexterm" id="part0018_iddle2192"></a><a class="indexterm" id="part0018_iddle2451"></a>Field Notes: please add your observations of other proxies in the wild here:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>____________________________________________________</p><p>____________________________________________________</p><p>____________________________________________________</p><p>____________________________________________________</p><p>____________________________________________________</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_design_patterns_crossword-id00155"></a><h3 class="title">Design Patterns Crossword</h3><p>It’s been a LONG chapter. Why not unwind by doing a crossword puzzle before it ends?</p><div class="informalfigure"><a id="part0018_med_id00684a"></a><div class="mediaobject"><a id="part0018_med_id00684"></a><img alt="image with no caption" hisrc="figs/web/496fig01.png" src="../Images/image01184.gif"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. Our first mistake: the gumball machine reporting was not _________.</p>
<p>5. Commonly used proxy for web services (two words).</p>
<p>7. Objectville matchmaking gimmick (three words).</p>
<p>11. A _______ proxy class is created at runtime.</p>
<p>13. Java’s dynamic proxy forwards all requests to this (two words).</p>
<p>16. In RMI, the object that takes the network requests on the service side.</p>
<p>17. The CD viewer used this kind of proxy.</p></td><td style="vertical-align: top; "><p>2. Remote _________ was used to implement the gumball machine monitor (two words).</p>
<p>3. Similar to proxy, but with a different purpose.</p>
<p>4. Place to learn about the many proxy variants.</p>
<p>6. Proxy that protects method calls from unauthorized callers.</p>
<p>8. This utility acts as a lookup service for RMI.</p>
<p>9. Why Elroy couldn’t get dates.</p>
<p>10. Software developer agent was being this kind of proxy.</p>
<p>12. In RMI, the proxy is called this.</p>
<p>14. Proxy that stands in for expensive objects.</p>
<p>15. We took one of these to learn RMI.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_tools_for_your_design_toolbox-id00156" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>Your design toolbox is almost full; you’re prepared for almost any design problem that comes your way.</p><div class="informalfigure"><a id="part0018_med_id00685a"></a><div class="mediaobject"><a id="part0018_med_id00685"></a><img alt="image with no caption" hisrc="figs/web/497fig01.png.jpg" src="../Images/image01185.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_bullet_points-id00157"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Proxy Pattern provides a representative for another object in order to control the client’s access to it. There are a number of ways it can manage that access.</li><li class="listitem">A Remote Proxy manages interaction between a client and a remote object.</li><li class="listitem">A Virtual Proxy controls access to an object that is expensive to instantiate.</li><li class="listitem">A Protection Proxy controls access to the methods of an object based on the caller.</li><li class="listitem">Many other variants of the Proxy Pattern exist including caching proxies, synchronization proxies, firewall proxies, copy-on-write proxies, and so on.</li><li class="listitem">Proxy is structurally similar to Decorator, but the two differ in their purpose.</li><li class="listitem">The Decorator Pattern adds behavior to an object, while a Proxy controls access.</li><li class="listitem">Java’s built-in support for Proxy can build a dynamic proxy class on demand and dispatch all calls on it to a handler of your choosing.</li><li class="listitem">Like any wrapper, proxies will increase the number of classes and objects in your designs.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_exercise_solution-id00158"></a><h3 class="title">Exercise Solution</h3><p><a class="indexterm" id="part0018_iddle1438"></a><a class="indexterm" id="part0018_iddle1518"></a><a class="indexterm" id="part0018_iddle1593"></a>The NonOwnerInvocationHandler works just like the OwnerInvocationHandler except that it <span class="emphasis"><em>allows</em></span> calls to setHotOrNotRating() and it <span class="emphasis"><em>disallows</em></span> calls to any other set method. Here’s our solution:</p><a id="part0018_pro_id00041"></a><pre class="programlisting"><span class="strong"><strong>import java.lang.reflect.*;</strong></span>

<span class="strong"><strong>public class NonOwnerInvocationHandler implements InvocationHandler {</strong></span>
    <span class="strong"><strong>PersonBean person;</strong></span>

    <span class="strong"><strong>public NonOwnerInvocationHandler(PersonBean person) {</strong></span>
        <span class="strong"><strong>this.person = person;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Object invoke(Object proxy, Method method, Object[] args)</strong></span>
            <span class="strong"><strong>throws IllegalAccessException {</strong></span>

        <span class="strong"><strong>try {</strong></span>
            <span class="strong"><strong>if (method.getName().startsWith("get")) {</strong></span>
                <span class="strong"><strong>return method.invoke(person, args);</strong></span>
            <span class="strong"><strong>} else if (method.getName().equals("setHotOrNotRating")) {</strong></span>
                <span class="strong"><strong>return method.invoke(person, args);</strong></span>
            <span class="strong"><strong>} else if (method.getName().startsWith("set")) {</strong></span>
                <span class="strong"><strong>throw new IllegalAccessException();</strong></span>
            <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>} catch (InvocationTargetException e) {</strong></span>
            <span class="strong"><strong>e.printStackTrace();</strong></span>
        <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>return null;</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_design_puzzle_solution-id00159"></a><h3 class="title">Design Puzzle Solution</h3><p>The ImageProxy class appears to have two states that are controlled by conditional statements. Can you think of another pattern that might clean up this code? How would you redesign ImageProxy?</p><p>Use State Pattern: implement two states, ImageLoaded and ImageNotLoaded. Then put the code from the if statements into their respective states. Start in the ImageNotLoaded state and then transition to the ImageLoaded state once the ImageIcon had been retrieved.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_sharpen_your_pencil_solution-id00160"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0018_iddle1571"></a><a class="indexterm" id="part0018_iddle2316"></a>While it is a little complicated, there isn’t much to creating a dynamic proxy. Why don’t you write getNonOwnerProxy(), which returns a proxy for the NonOwnerInvocationHandler. Here’s our solution:</p><a id="part0018_pro_id00042"></a><pre class="programlisting"><span class="strong"><strong>PersonBean getNonOwnerProxy(PersonBean person) {</strong></span>

    <span class="strong"><strong>return (PersonBean) Proxy.newProxyInstance(</strong></span>
            <span class="strong"><strong>person.getClass().getClassLoader(),</strong></span>
            <span class="strong"><strong>person.getClass().getInterfaces(),</strong></span>
            <span class="strong"><strong>new NonOwnerInvocationHandler(person));</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_design_patterns_crossword_soluti-id00161"></a><h3 class="title">Design Patterns Crossword Solution</h3><div class="informalfigure"><a id="part0018_med_id00686a"></a><div class="mediaobject"><a id="part0018_med_id00686"></a><img alt="image with no caption" hisrc="figs/web/499fig01.png" src="../Images/image01186.gif"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_who_does_whatquestion_mark_solut-id00162"></a><h3 class="title">Who Does What? Solution</h3><p><a class="indexterm" id="part0018_iddle1587"></a><a class="indexterm" id="part0018_iddle2524"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="part0018_med_id00687a"></a><div class="mediaobject"><a id="part0018_med_id00687"></a><img alt="image with no caption" hisrc="figs/web/500fig01.png.jpg" src="../Images/image01187.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0018_code_for_the_cd_cover_viewer" style="clear: both">The code for the CD Cover Viewer</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0018_ready_bake_code-id00163"></a><h3 class="title">Ready Bake Code</h3><a id="part0018_pro_id00043"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.proxy.virtualproxy;</strong></span>

<span class="strong"><strong>import java.net.*;</strong></span>
<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import java.awt.event.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>
<span class="strong"><strong>import java.util.*;</strong></span>
<span class="strong"><strong>public class ImageProxyTestDrive {</strong></span>
    <span class="strong"><strong>ImageComponent imageComponent;</strong></span>
    <span class="strong"><strong>JFrame frame = new JFrame("CD Cover Viewer");</strong></span>
    <span class="strong"><strong>JMenuBar menuBar;</strong></span>
    <span class="strong"><strong>JMenu menu;</strong></span>
    <span class="strong"><strong>Hashtable&lt;String, String&gt; cds = new Hashtable&lt;String, String&gt;();</strong></span>

    <span class="strong"><strong>public static void main (String[] args) throws Exception {</strong></span>
        <span class="strong"><strong>ImageProxyTestDrive testDrive = new ImageProxyTestDrive();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public ImageProxyTestDrive() throws Exception{</strong></span>
        <span class="strong"><strong>cds.put("Buddha Bar","http://images.amazon.com/images/P/B00009XBYK.01.LZZZZZZZ.</strong></span>
<span class="strong"><strong>jpg");</strong></span>
        <span class="strong"><strong>cds.put("Ima","http://images.amazon.com/images/P/B000005IRM.01.LZZZZZZZ.jpg");</strong></span>
        <span class="strong"><strong>cds.put("Karma","http://images.amazon.com/images/P/B000005DCB.01.LZZZZZZZ.gif");</strong></span>
        <span class="strong"><strong>cds.put("MCMXC A.D.","http://images.amazon.com/images/P/B000002URV.01.LZZZZZZZ.</strong></span>
<span class="strong"><strong>jpg");</strong></span>
        <span class="strong"><strong>cds.put("Northern Exposure","http://images.amazon.com/images/P/B000003SFN.01.</strong></span>
<span class="strong"><strong>LZZZZZZZ.jpg");</strong></span>
        <span class="strong"><strong>cds.put("Selected Ambient Works, Vol. 2","http://images.amazon.com/images/P/</strong></span>
<span class="strong"><strong>B000002MNZ.01.LZZZZZZZ.jpg");</strong></span>

        <span class="strong"><strong>URL initialURL = new URL((String)cds.get("Selected Ambient Works, Vol. 2"));</strong></span>
        <span class="strong"><strong>menuBar = new JMenuBar();</strong></span>
        <span class="strong"><strong>menu = new JMenu("Favorite CDs");</strong></span>
        <span class="strong"><strong>menuBar.add(menu);</strong></span>
        <span class="strong"><strong>frame.setJMenuBar(menuBar);</strong></span>
        <span class="strong"><strong>for(Enumeration e = cds.keys(); e.hasMoreElements();) {</strong></span>
            <span class="strong"><strong>String name = (String)e.nextElement();</strong></span>
            <span class="strong"><strong>JMenuItem menuItem = new JMenuItem(name);</strong></span>
            <span class="strong"><strong>menu.add(menuItem);</strong></span>
            <span class="strong"><strong>menuItem.addActionListener(event -&gt; {</strong></span>
                <span class="strong"><strong>imageComponent.setIcon(new ImageProxy(getCDUrl(event.getActionCommand())));</strong></span>
                <span class="strong"><strong>frame.repaint();</strong></span>
            <span class="strong"><strong>});</strong></span>
        <span class="strong"><strong>}</strong></span>

        <span class="strong"><strong>// set up frame and menus</strong></span>

        <span class="strong"><strong>Icon icon = new ImageProxy(initialURL);</strong></span>
        <span class="strong"><strong>imageComponent = new ImageComponent(icon);</strong></span>
        <span class="strong"><strong>frame.getContentPane().add(imageComponent);</strong></span>
        <span class="strong"><strong>frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</strong></span>
        <span class="strong"><strong>frame.setSize(800,600);</strong></span>
        <span class="strong"><strong>frame.setVisible(true);</strong></span>

    <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>URL getCDUrl(String name) {</strong></span>
        <span class="strong"><strong>try {</strong></span>
            <span class="strong"><strong>return new URL((String)cds.get(name));</strong></span>
        <span class="strong"><strong>} catch (MalformedURLException e) {</strong></span>
            <span class="strong"><strong>e.printStackTrace();</strong></span>
            <span class="strong"><strong>return null;</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>package headfirst.designpatterns.proxy.virtualproxy;</strong></span>

<span class="strong"><strong>import java.net.*;</strong></span>
<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>

<span class="strong"><strong>class ImageProxy implements Icon {</strong></span>
    <span class="strong"><strong>volatile ImageIcon imageIcon;</strong></span>
    <span class="strong"><strong>final URL imageURL;</strong></span>
    <span class="strong"><strong>Thread retrievalThread;</strong></span>
    <span class="strong"><strong>boolean retrieving = false;</strong></span>

    <span class="strong"><strong>public ImageProxy(URL url) { imageURL = url; }</strong></span>

    <span class="strong"><strong>public int getIconWidth() {</strong></span>
        <span class="strong"><strong>if (imageIcon != null) {</strong></span>
            <span class="strong"><strong>return imageIcon.getIconWidth();</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>return 800;</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public int getIconHeight() {</strong></span>
        <span class="strong"><strong>if (imageIcon != null) {</strong></span>
            <span class="strong"><strong>return imageIcon.getIconHeight();</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>return 600;</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>synchronized void setImageIcon(ImageIcon imageIcon) {</strong></span>
        <span class="strong"><strong>this.imageIcon = imageIcon;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void paintIcon(final Component c, Graphics g, int x, int y) {</strong></span>
        <span class="strong"><strong>if (imageIcon != null) {</strong></span>
            <span class="strong"><strong>imageIcon.paintIcon(c, g, x, y);</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>g.drawString("Loading CD cover, please wait...", x+300, y+190);</strong></span>
            <span class="strong"><strong>if (!retrieving) {</strong></span>
                <span class="strong"><strong>retrieving = true;</strong></span>
                <span class="strong"><strong>retrievalThread = new Thread(new Runnable() {</strong></span>
                    <span class="strong"><strong>public void run() {</strong></span>
                        <span class="strong"><strong>try {</strong></span>
                            <span class="strong"><strong>setImageIcon(new ImageIcon(imageURL, "CD Cover"));</strong></span>
                            <span class="strong"><strong>c.repaint();</strong></span>
                        <span class="strong"><strong>} catch (Exception e) {</strong></span>
                            <span class="strong"><strong>e.printStackTrace();</strong></span>
                        <span class="strong"><strong>}</strong></span>
                    <span class="strong"><strong>}</strong></span>
                <span class="strong"><strong>});</strong></span>
                <span class="strong"><strong>retrievalThread.start();</strong></span>
            <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>package headfirst.designpatterns.proxy.virtualproxy;</strong></span>

<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>

<span class="strong"><strong>class ImageComponent extends JComponent {</strong></span>
    <span class="strong"><strong>private Icon icon;</strong></span>

    <span class="strong"><strong>public ImageComponent(Icon icon) {</strong></span>
        <span class="strong"><strong>this.icon = icon;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void setIcon(Icon icon) {</strong></span>
        <span class="strong"><strong>this.icon = icon;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void paintComponent(Graphics g) {</strong></span>
        <span class="strong"><strong>super.paintComponent(g);</strong></span>
        <span class="strong"><strong>int w = icon.getIconWidth();</strong></span>
        <span class="strong"><strong>int h = icon.getIconHeight();</strong></span>
        <span class="strong"><strong>int x = (800 - w)/2;</strong></span>
        <span class="strong"><strong>int y = (600 - h)/2;</strong></span>
        <span class="strong"><strong>icon.paintIcon(this, g, x, y);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0019_compound_patterns_patterns_of_patterns"><div class="titlepage" id="part0019_aid-I3QM2"><div><div><h2 class="title">Chapter 12. Compound Patterns: Patterns of Patterns</h2></div></div></div><div class="informalfigure"><a id="part0019_med_id00688a"></a><div class="mediaobject"><a id="part0019_med_id00688"></a><img alt="image with no caption" hisrc="figs/web/505fig01.png.jpg" src="../Images/image01188.jpeg"/></div></div><p><a class="indexterm" id="part0019_iddle1093"></a><a class="indexterm" id="part0019_iddle1255"></a><a class="indexterm" id="part0019_iddle1951"></a><a class="indexterm" id="part0019_iddle2099"></a><a class="indexterm" id="part0019_iddle2102"></a><a class="indexterm" id="part0019_iddle2103"></a><span class="strong"><strong>Who would have ever guessed that Patterns could work together?</strong></span> You’ve already witnessed the acrimonious Fireside Chats (and you haven’t even seen the Pattern Death Match pages that the editor forced us to remove from the book<sup>[<a class="footnote" epub:type="noteref" href="#part0019_ftn.ch12fn01" id="part0019_ch12fn01">2</a>]</sup>), so who would have thought patterns can actually get along well together? Well, believe it or not, some of the most powerful OO designs use several patterns together. Get ready to take your pattern skills to the next level; it’s time for compound patterns.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_working_together" style="clear: both">Working together</h2></div></div></div><p>One of the best ways to use patterns is to get them out of the house so they can interact with other patterns. The more you use patterns the more you’re going to see them showing up together in your designs. We have a special name for a set of patterns that work together in a design that can be applied over many problems: a <span class="emphasis"><em>compound pattern</em></span>. That’s right, we are now talking about patterns made of patterns!</p><div class="informalfigure"><a id="part0019_med_id00689a"></a><div class="mediaobject"><a id="part0019_med_id00689"></a><img alt="image with no caption" hisrc="figs/web/506fig01.png.jpg" src="../Images/image01189.jpeg"/></div></div><p>You’ll find a lot of compound patterns in use in the real world. Now that you’ve got patterns in your brain, you’ll see that they are really just patterns working together, and that makes them easier to understand.</p><p>We’re going to start this chapter by revisiting our friendly ducks in the SimUDuck duck simulator. It’s only fitting that the ducks should be here when we combine patterns; after all, they’ve been with us throughout the entire book and they’ve been good sports about taking part in lots of patterns. The ducks are going to help you understand how patterns can work together in the same solution. But just because we’ve combined some patterns doesn’t mean we have a solution that qualifies as a compound pattern. For that, it has to be a general-purpose solution that can be applied to many problems. So, in the second half of the chapter we’ll visit a <span class="emphasis"><em>real</em></span> compound pattern: that’s right, Mr. Model-View-Controller himself. If you haven’t heard of him, you will, and you’ll find this compound pattern is one of the most powerful patterns in your design toolbox.</p><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>Patterns are often used together and combined within the same design solution.</strong></span></div><div><span class="strong"><strong>A compound pattern combines two or more patterns into a solution that solves a recurring or general problem.</strong></span></div></blockquote></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_duck_reunion" style="clear: both">Duck reunion</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1456"></a><a class="indexterm" id="part0019_iddle1952"></a><a class="indexterm" id="part0019_iddle2104"></a>As you’ve already heard, we’re going to get to work with the ducks again. This time the ducks are going to show you how patterns can coexist and even cooperate within the same solution.</p><p>We’re going to rebuild our duck simulator from scratch and give it some interesting capabilities by using a bunch of patterns. Okay, let’s get started...</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① First, we’ll create a Quackable interface.</strong></span><br/>Like we said, we’re starting from scratch. This time around, the Ducks are going to implement a Quackable interface. That way we’ll know what things in the simulator can quack() — like Mallard Ducks, Redhead Ducks, Duck Calls, and we might even see the Rubber Duck sneak back in.<div class="informalfigure"><a id="part0019_med_id00690a"></a><div class="mediaobject"><a id="part0019_med_id00690"></a><img alt="image with no caption" hisrc="figs/web/507fig01.png.jpg" src="../Images/image01190.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Now, some Ducks that implement Quackable</strong></span><br/>What good is an interface without some classes to implement it? Time to create some concrete ducks (but not the “lawn art” kind, if you know what we mean).<div class="informalfigure"><a id="part0019_med_id00691a"></a><div class="mediaobject"><a id="part0019_med_id00691"></a><img alt="image with no caption" hisrc="figs/web/507fig02.png.jpg" src="../Images/image01191.jpeg"/></div></div><br/><span class="strong"><strong>This wouldn’t be much fun if we didn’t add other kinds of Ducks too.</strong></span><br/>Remember last time? We had duck calls (those things hunters use — they are definitely quackable) and rubber ducks.<div class="informalfigure"><a id="part0019_med_id00692a"></a><div class="mediaobject"><a id="part0019_med_id00692"></a><img alt="image with no caption" hisrc="figs/web/508fig01.png.jpg" src="../Images/image01192.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Okay, we’ve got our ducks; now all we need is a simulator.</strong></span><br/>Let’s cook up a simulator that creates a few ducks and makes sure their quackers are working...<div class="informalfigure"><a id="part0019_med_id00693a"></a><div class="mediaobject"><a id="part0019_med_id00693"></a><img alt="image with no caption" hisrc="figs/web/508fig02.png.jpg" src="../Images/image01193.jpeg"/></div></div><div class="informalfigure"><a id="part0019_med_id00694a"></a><div class="mediaobject"><a id="part0019_med_id00694"></a><img alt="image with no caption" hisrc="figs/web/509fig01.png.jpg" src="../Images/image01194.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note01a"></a>Note</h3><p>They all implement the same Quackable interface, but their implementations allow them to quack in their own way.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><br/>It looks like everything is working; so far, so good.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ When ducks are around, geese can’t be far.</strong></span><br/>Where there is one waterfowl, there are probably two. Here’s a Goose class that has been hanging around the simulator.<div class="informalfigure"><a id="part0019_med_id00695a"></a><div class="mediaobject"><a id="part0019_med_id00695"></a><img alt="image with no caption" hisrc="figs/web/509fig02.png.jpg" src="../Images/image01195.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note01"></a>Brain Power</h3><p>Let’s say we wanted to be able to use a Goose anywhere we’d want to use a Duck. After all, geese make noise; geese fly; geese swim. Why can’t we have Geese in the simulator?</p><p>What pattern would allow Geese to easily intermingle with Ducks?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none">⑤ <a class="indexterm" id="part0019_iddle1018"></a><a class="indexterm" id="part0019_iddle1166"></a><a class="indexterm" id="part0019_iddle1459"></a><a class="indexterm" id="part0019_iddle1955"></a><a class="indexterm" id="part0019_iddle2107"></a><span class="strong"><strong>We need a goose adapter.</strong></span><br/>Our simulator expects to see Quackable interfaces. Since geese aren’t quackers (they’re honkers), we can use an adapter to adapt a goose to a duck.<div class="informalfigure"><a id="part0019_med_id00696a"></a><div class="mediaobject"><a id="part0019_med_id00696"></a><img alt="image with no caption" hisrc="figs/web/510fig01.png.jpg" src="../Images/image01196.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑥ Now geese should be able to play in the simulator, too.</strong></span><br/>All we need to do is create a Goose, wrap it in an adapter that implements Quackable, and we should be good to go.<div class="informalfigure"><a id="part0019_med_id00697a"></a><div class="mediaobject"><a id="part0019_med_id00697"></a><img alt="image with no caption" hisrc="figs/web/510fig02.png.jpg" src="../Images/image01197.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑦ Now let’s give this a quick run....</strong></span><br/>This time when we run the simulator, the list of objects passed to the simulate() method includes a Goose wrapped in a duck adapter. The result? We should see some honking!</li></ul></div><div class="informalfigure"><a id="part0019_med_id00698a"></a><div class="mediaobject"><a id="part0019_med_id00698"></a><img alt="image with no caption" hisrc="figs/web/511fig01.png.jpg" src="../Images/image01198.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_quackology"></a><h3 class="title">Quackology</h3><p>Quackologists are fascinated by all aspects of Quackable behavior. One thing Quackologists have always wanted to study is the total number of quacks made by a flock of ducks.</p><p>How can we add the ability to count duck quacks without having to change the duck classes?</p><p>Can you think of a pattern that would help?</p><div class="informalfigure"><a id="part0019_med_id00699a"></a><div class="mediaobject"><a id="part0019_med_id00699"></a><img alt="image with no caption" hisrc="figs/web/511fig02.png.jpg" src="../Images/image01199.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">⑧ <a class="indexterm" id="part0019_iddle1169"></a><a class="indexterm" id="part0019_iddle1344"></a><a class="indexterm" id="part0019_iddle1461"></a><a class="indexterm" id="part0019_iddle1957"></a><a class="indexterm" id="part0019_iddle2109"></a><span class="strong"><strong>We’re going to make those Quackologists happy and give them some quack counts.</strong></span><br/>How? Let’s create a decorator that gives the ducks some new behavior (the behavior of counting) by wrapping them with a decorator object. We won’t have to change the Duck code at all.<div class="informalfigure"><a id="part0019_med_id00700a"></a><div class="mediaobject"><a id="part0019_med_id00700"></a><img alt="image with no caption" hisrc="figs/web/512fig01.png.jpg" src="../Images/image01200.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑨ We need to update the simulator to create decorated ducks.</strong></span><br/>Now, we must wrap each Quackable object we instantiate in a QuackCounter decorator. If we don’t, we’ll have ducks running around making uncounted quacks.<div class="informalfigure"><a id="part0019_med_id00701a"></a><div class="mediaobject"><a id="part0019_med_id00701"></a><img alt="image with no caption" hisrc="figs/web/513fig01.png.jpg" src="../Images/image01201.jpeg"/></div></div><div class="informalfigure"><a id="part0019_med_id00702a"></a><div class="mediaobject"><a id="part0019_med_id00702"></a><img alt="image with no caption" hisrc="figs/web/514fig01.png.jpg" src="../Images/image01202.jpeg"/></div></div><br/><a class="indexterm" id="part0019_iddle1007"></a><a class="indexterm" id="part0019_iddle1165"></a><a class="indexterm" id="part0019_iddle1457"></a><a class="indexterm" id="part0019_iddle1640"></a><a class="indexterm" id="part0019_iddle1953"></a><a class="indexterm" id="part0019_iddle2028"></a><a class="indexterm" id="part0019_iddle2105"></a><a class="indexterm" id="part0019_iddle2534"></a><span class="strong"><strong>You have to decorate objects to get decorated behavior.</strong></span><br/>He’s right, that’s the problem with wrapping objects: you have to make sure they get wrapped or they don’t get the decorated behavior.<br/>Why don’t we take the creation of ducks and localize it in one place; in other words, let’s take the duck creation and decorating and encapsulate it.<br/>What pattern does that sound like?</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑩ We need a factory to produce ducks!</strong></span><br/>Okay, we need some quality control to make sure our ducks get wrapped. We’re going to build an entire factory just to produce them. The factory should produce a family of products that consists of different types of ducks, so we’re going to use the Abstract Factory Pattern.<br/>Let’s start with the definition of the AbstractDuckFactory:<div class="informalfigure"><a id="part0019_med_id00703a"></a><div class="mediaobject"><a id="part0019_med_id00703"></a><img alt="image with no caption" hisrc="figs/web/514fig02.png.jpg" src="../Images/image01203.jpeg"/></div></div><br/>Let’s start by creating a factory that creates ducks without decorators, just to get the hang of the factory:<div class="informalfigure"><a id="part0019_med_id00704a"></a><div class="mediaobject"><a id="part0019_med_id00704"></a><img alt="image with no caption" hisrc="figs/web/515fig01.png.jpg" src="../Images/image01204.jpeg"/></div></div><br/>Now let’s create the factory we really want, the CountingDuckFactory:<div class="informalfigure"><a id="part0019_med_id00705a"></a><div class="mediaobject"><a id="part0019_med_id00705"></a><img alt="image with no caption" hisrc="figs/web/515fig02.png.jpg" src="../Images/image01205.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑪ Let’s set up the simulator to use the factory.</strong></span><br/>Remember how Abstract Factory works? We create a polymorphic method that takes a factory and uses it to create objects. By passing in different factories, we get to use different product families in the method.<br/>We’re going to alter the simulate() method so that it takes a factory and uses it to create ducks.<div class="informalfigure"><a id="part0019_med_id00706a"></a><div class="mediaobject"><a id="part0019_med_id00706"></a><img alt="image with no caption" hisrc="figs/web/516fig01.png.jpg" src="../Images/image01206.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note02a"></a>Note</h3><p><a class="indexterm" id="part0019_iddle1566"></a><a class="indexterm" id="part0019_iddle2311"></a>Here’s the output using the factory...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0019_med_id00707a"></a><div class="mediaobject"><a id="part0019_med_id00707"></a><img alt="image with no caption" hisrc="figs/web/517fig01.png.jpg" src="../Images/image01207.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_sharpen_your_pencil-id00164"></a><h3 class="title">Sharpen your pencil</h3><p>We’re still directly instantiating Geese by relying on concrete classes. Can you write an Abstract Factory for Geese? How should it handle creating “goose ducks”?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0019_med_id00708a"></a><div class="mediaobject"><a id="part0019_med_id00708"></a><img alt="image with no caption" hisrc="figs/web/518fig01.png.jpg" src="../Images/image01208.jpeg"/></div></div><p><span class="strong"><strong>Ah, he wants to manage a flock of ducks.</strong></span></p><p>Here’s another good question from Ranger Brewer: Why are we managing ducks individually?</p><div class="informalfigure"><a id="part0019_med_id00709a"></a><div class="mediaobject"><a id="part0019_med_id00709"></a><img alt="image with no caption" hisrc="figs/web/518fig02.png.jpg" src="../Images/image01209.jpeg"/></div></div><p>What we need is a way to talk about collections of ducks and even sub-collections of ducks (to deal with the family request from Ranger Brewer). It would also be nice if we could apply operations across the whole set of ducks.</p><p>What pattern can help us?</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">⑫ <a class="indexterm" id="part0019_iddle1168"></a><a class="indexterm" id="part0019_iddle1170"></a><a class="indexterm" id="part0019_iddle1226"></a><a class="indexterm" id="part0019_iddle1460"></a><a class="indexterm" id="part0019_iddle1462"></a><a class="indexterm" id="part0019_iddle1814"></a><a class="indexterm" id="part0019_iddle1956"></a><a class="indexterm" id="part0019_iddle1958"></a><a class="indexterm" id="part0019_iddle2108"></a><a class="indexterm" id="part0019_iddle2110"></a><span class="strong"><strong>Let’s create a flock of ducks (well, actually a flock of Quackables).</strong></span><br/>Remember the Composite Pattern that allows us to treat a collection of objects in the same way as individual objects? What better composite than a flock of Quackables!<br/>Let’s step through how this is going to work:<div class="informalfigure"><a id="part0019_med_id00710a"></a><div class="mediaobject"><a id="part0019_med_id00710"></a><img alt="image with no caption" hisrc="figs/web/519fig01.png.jpg" src="../Images/image01210.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_code_up_close-id00165"></a><h3 class="title">Code Up Close</h3><p>Did you notice that we tried to sneak a Design Pattern by you without mentioning it?</p><div class="informalfigure"><a id="part0019_med_id00711a"></a><div class="mediaobject"><a id="part0019_med_id00711"></a><img alt="image with no caption" hisrc="figs/web/519fig02.png.jpg" src="../Images/image01211.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑬ Now we need to alter the simulator.</strong></span><br/>Our composite is ready; we just need some code to round up the ducks into the composite structure.<div class="informalfigure"><a id="part0019_med_id00712a"></a><div class="mediaobject"><a id="part0019_med_id00712"></a><img alt="image with no caption" hisrc="figs/web/520fig01.png.jpg" src="../Images/image01212.jpeg"/></div></div></li></ul></div><p><a class="indexterm" id="part0019_iddle1243"></a>Let’s give it a spin...</p><div class="informalfigure"><a id="part0019_med_id00713a"></a><div class="mediaobject"><a id="part0019_med_id00713"></a><img alt="image with no caption" hisrc="figs/web/521fig01.png.jpg" src="../Images/image01213.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_safety_versus_transparency"></a><h3 class="title">Safety versus transparency</h3><p>You might remember that in the Composite Pattern chapter the composites (the Menus) and the leaf nodes (the MenuItems) had the <span class="emphasis"><em>same</em></span> exact set of methods, including the add() method. Because they had the same set of methods, we could call methods on MenuItems that didn’t really make sense (like trying to add something to a MenuItem by calling add()). The benefit of this was that the distinction between leaves and composites was <span class="emphasis"><em>transparent</em></span>: the client didn’t have to know whether it was dealing with a leaf or a composite; it just called the same methods on both.</p><p>Here, we’ve decided to keep the composite’s child maintenance methods separate from the leaf nodes: that is, only Flocks have the add() method. We know it doesn’t make sense to try to add something to a Duck, and in this implementation, you can’t. You can only add() to a Flock. So this design is <span class="emphasis"><em>safer</em></span> — you can’t call methods that don’t make sense on components — but it’s less transparent. Now the client has to know that a Quackable is a Flock in order to add Quackables to it.</p><p>As always, there are trade-offs when you do OO design and you need to consider them as you create your own composites.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0019_med_id00714a"></a><div class="mediaobject"><a id="part0019_med_id00714"></a><img alt="image with no caption" hisrc="figs/web/522fig01.png.jpg" src="../Images/image01214.jpeg"/></div></div><p><a class="indexterm" id="part0019_iddle1171"></a><a class="indexterm" id="part0019_iddle1463"></a><a class="indexterm" id="part0019_iddle1959"></a><a class="indexterm" id="part0019_iddle2033"></a><a class="indexterm" id="part0019_iddle2111"></a><span class="strong"><strong>Can you say “observer”?</strong></span></p><p>It sounds like the Quackologist would like to observe individual duck behavior. That leads us right to a pattern made for observing the behavior of objects: the Observer Pattern.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑭ First we need an Observable interface.</strong></span><br/>Remember that an Observable is the object being observed. An Observable needs methods for registering and notifying observers. We could also have a method for removing observers, but we’ll keep the implementation simple here and leave that out.<div class="informalfigure"><a id="part0019_med_id00715a"></a><div class="mediaobject"><a id="part0019_med_id00715"></a><img alt="image with no caption" hisrc="figs/web/522fig02.png.jpg" src="../Images/image01215.jpeg"/></div></div><br/>Now we need to make sure all Quackables implement this interface...<div class="informalfigure"><a id="part0019_med_id00716a"></a><div class="mediaobject"><a id="part0019_med_id00716"></a><img alt="image with no caption" hisrc="figs/web/522fig03.png.jpg" src="../Images/image01216.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑮ Now, we need to make sure all the concrete classes that implement Quackable can handle being a QuackObservable.</strong></span><br/>We could approach this by implementing registration and notification in each and every class (like we did in <a class="xref" href="#part0009_aid-8IL22">Chapter 2</a>). But we’re going to do it a little differently this time: we’re going to encapsulate the registration and notification code in another class, call it Observable, and compose it with a QuackObservable. That way, we only write the real code once and the QuackObservable just needs enough code to delegate to the helper class Observable.<br/>Let’s begin with the Observable helper class.<div class="informalfigure"><a id="part0019_med_id00717a"></a><div class="mediaobject"><a id="part0019_med_id00717"></a><img alt="image with no caption" hisrc="figs/web/523fig01.png.jpg" src="../Images/image01217.jpeg"/></div></div><div class="informalfigure"><a id="part0019_med_id00718a"></a><div class="mediaobject"><a id="part0019_med_id00718"></a><img alt="image with no caption" hisrc="figs/web/523fig02.png.jpg" src="../Images/image01218.jpeg"/></div></div></li><li class="listitem" style="list-style-type: none">⑯ <a class="indexterm" id="part0019_iddle1531"></a><a class="indexterm" id="part0019_iddle2270"></a><span class="strong"><strong>Integrate the helper Observable with the Quackable classes.</strong></span><br/>This shouldn’t be too bad. All we need to do is make sure the Quackable classes are composed with an Observable and that they know how to delegate to it. After that, they’re ready to be Observables. Here’s the implementation of MallardDuck; the other ducks are the same.<div class="informalfigure"><a id="part0019_med_id00719a"></a><div class="mediaobject"><a id="part0019_med_id00719"></a><img alt="image with no caption" hisrc="figs/web/524fig01.png.jpg" src="../Images/image01219.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_sharpen_your_pencil-id00166"></a><h3 class="title">Sharpen your pencil</h3><p>We haven’t changed the implementation of one Quackable, the QuackCounter decorator. We need to make it an Observable too. Why don’t you write that one:</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑰ We’re almost there! We just need to work on the Observer side of the pattern.</strong></span><br/>We’ve implemented everything we need for the Observables; now we need some Observers. We’ll start with the Observer interface:<div class="informalfigure"><a id="part0019_med_id00720a"></a><div class="mediaobject"><a id="part0019_med_id00720"></a><img alt="image with no caption" hisrc="figs/web/525fig01.png.jpg" src="../Images/image01220.jpeg"/></div></div><br/>Now we need an Observer: where are those Quackologists?!<div class="informalfigure"><a id="part0019_med_id00721a"></a><div class="mediaobject"><a id="part0019_med_id00721"></a><img alt="image with no caption" hisrc="figs/web/525fig02.png.jpg" src="../Images/image01221.jpeg"/></div></div></li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_sharpen_your_pencil-id00167"></a><h3 class="title">Sharpen your pencil</h3><p><a class="indexterm" id="part0019_iddle1572"></a><a class="indexterm" id="part0019_iddle2317"></a>What if a Quackologist wants to observe an entire flock? What does that mean anyway? Think about it like this: if we observe a composite, then we’re observing everything in the composite. So, when you register with a flock, the flock composite makes sure you get registered with all its children (sorry, all its little quackers), which may include other flocks.</p><p>Go ahead and write the Flock observer code before we go any further.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑱ We’re ready to observe. Let’s update the simulator and give it a try:</strong></span><div class="informalfigure"><a id="part0019_med_id00722a"></a><div class="mediaobject"><a id="part0019_med_id00722"></a><img alt="image with no caption" hisrc="figs/web/527fig01.png.jpg" src="../Images/image01222.jpeg"/></div></div></li></ul></div><p><a class="indexterm" id="part0019_iddle1288"></a>This is the big finale. Five, no, six patterns have come together to create this amazing Duck Simulator. Without further ado, we present the DuckSimulator!</p><div class="informalfigure"><a id="part0019_med_id00723a"></a><div class="mediaobject"><a id="part0019_med_id00723"></a><img alt="image with no caption" hisrc="figs/web/528fig01.png.jpg" src="../Images/image01223.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_there_are_no_dumb_questions-id00168"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa1qe1"></a><a id="part0019_ch12qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: So this was a compound pattern?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No, this was just a set of patterns working together. A compound pattern is a set of a few patterns that are combined to solve a general problem. We’re just about to take a look at the Model-View-Controller compound pattern; it’s a collection of a few patterns that has been used over and over in many design solutions.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa1qe2"></a><a id="part0019_ch12qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: So the real beauty of Design Patterns is that I can take a problem, and start applying patterns to it until I have a solution. Right?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Wrong. We went through this exercise with Ducks to show you how patterns <span class="emphasis"><em>can</em></span> work together. You’d never actually want to approach a design like we just did. In fact, there may be solutions to parts of the Duck Simulator for which some of these patterns were big time overkill. Sometimes just using good OO design principles can solve a problem well enough on its own.</div><div>We’re going to talk more about this in the next chapter, but you only want to apply patterns when and where they make sense. You never want to start out with the intention of using patterns just for the sake of it. You should consider the design of the Duck Simulator to be forced and artificial. But hey, it was fun and gave us a good idea of how several patterns can fit into a solution.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_what_did_we_doquestion_mark-id00169" style="clear: both">What did we do?</h2></div></div></div><p><span class="strong"><strong>We started with a bunch of Quackables...</strong></span></p><p><span class="strong"><strong>A goose came along and wanted to act like a Quackable too.</strong></span> So we used the <span class="emphasis"><em>Adapter Pattern</em></span> to adapt the goose to a Quackable. Now, you can call quack() on a goose wrapped in the adapter and it will honk!</p><p><span class="strong"><strong>Then, the Quackologists decided they wanted to count quacks.</strong></span> So we used the <span class="emphasis"><em>Decorator Pattern</em></span> to add a QuackCounter decorator that keeps track of the number of times quack() is called, and then delegates the quack to the Quackable it’s wrapping.</p><p><span class="strong"><strong>But the Quackologists were worried they’d forget to add the QuackCounter decorator.</strong></span> So we used the <span class="emphasis"><em>Abstract Factory Pattern</em></span> to create ducks for them. Now, whenever they want a duck, they ask the factory for one, and it hands back a decorated duck. (And don’t forget, they can also use another duck factory if they want an un-decorated duck!)</p><p><span class="strong"><strong>We had management problems keeping track of all those ducks and geese and quackables.</strong></span> So we used the <span class="emphasis"><em>Composite Pattern</em></span> to group Quackables into Flocks. The pattern also allows the Quackologist to create sub-Flocks to manage duck families. We used the <span class="emphasis"><em>Iterator Pattern</em></span> in our implementation by using java.util’s iterator in ArrayList.</p><p><span class="strong"><strong>The Quackologists also wanted to be notified when any Quackable quacked.</strong></span> So we used the <span class="emphasis"><em>Observer Pattern</em></span> to let the Quackologists register as Quackable Observers. Now they’re notified every time any Quackable quacks. We used iterator again in this implementation. The Quackologists can even use the Observer Pattern with their composites.</p><div class="informalfigure"><a id="part0019_med_id00724a"></a><div class="mediaobject"><a id="part0019_med_id00724"></a><img alt="image with no caption" hisrc="figs/web/529fig01.png.jpg" src="../Images/image01224.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_duckapostrophes_eye_view_the_class_diagr" style="clear: both">A duck’s eye view: the class diagram</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1167"></a><a class="indexterm" id="part0019_iddle1464"></a><a class="indexterm" id="part0019_iddle1960"></a><a class="indexterm" id="part0019_iddle2112"></a>We’ve packed a lot of patterns into one small duck simulator! Here’s the big picture of what we did:</p><div class="informalfigure"><a id="part0019_med_id00725a"></a><div class="mediaobject"><a id="part0019_med_id00725"></a><img alt="image with no caption" hisrc="figs/web/530fig02.png.jpg" src="../Images/image01225.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_king_of_compound_patterns" style="clear: both">The King of Compound Patterns</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_if_elvis_were_a_compound_patterncomma_hi">If Elvis were a compound pattern, his name would be Model-View-Controller, and he’d be singing a little song like this...</h3></div></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><a class="indexterm" id="part0019_iddle1261"></a><a class="indexterm" id="part0019_iddle1280"></a><a class="indexterm" id="part0019_iddle1922"></a><a class="indexterm" id="part0019_iddle1941"></a>Model, View, Controller</p>
<p>Lyrics and music by James Dempsey.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Model a bottle of fine Chardonnay</p>
<p>Model all the glottal stops people say</p>
<p>Model the coddling of boiling eggs</p>
<p>You can model the waddle in Hexley’s legs</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>MVC’s a paradigm for factoring your code into functional segments, so your brain does not explode.</p>
<p>To achieve reusability, you gotta keep those boundaries clean</p>
<p>Model on the one side, View on the other, the Controller’s in between.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Model View, you can model all the models that pose for GQ</p>
<p>Model View Controller</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0019_inline_id00726a"></a><img alt="" hisrc="figs/web/532fig01.png.jpg" src="../Images/image01226.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note02"></a>Note</h3><p>So does Java!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div>
<p>View objects tend to be controls used to display and edit</p>
<p>Cocoa’s got a lot of those, well written to its credit.</p>
<p>Take an NSTextView, hand it any old Unicode string</p>
<p>The user can interact with it, it can hold most anything</p>
<p>But the view don’t know about the Model</p>
<p>That string could be a phone number or the works of Aristotle</p>
<p>Keep the coupling loose and so achieve a massive level of reuse</p>
<p>So does Java!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Model View, it’s got three layers like Oreos do</p>
<p>Model View Controller</p>
<p>Model View, Model View, Model View Controller</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Model View, all rendered very nicely in Aqua blue</p>
<p>Model View Controller</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Model objects represent your application’s raison d’être</p>
<p>Custom objects that contain data, logic, and et cetera</p>
<p>You create custom classes, in your app’s problem domain you can choose to reuse them with all the views but the model objects stay the same.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>You’re probably wondering now</p>
<p>You’re probably wondering how</p>
<p>Data flows between Model and View</p>
<p>The Controller has to mediate</p>
<p>Between each layer’s changing state</p>
<p>To synchronize the data of the two</p>
<p>It pulls and pushes every changed value</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>You can model a throttle and a manifold</p>
<p>Model the toddle of a two year old</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Model View, mad props to the smalltalk crew!</p>
<p>Model View Controller</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Model View, it’s pronounced Oh Oh not Ooo Ooo</p>
<p>Model View Controller</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Model View</p>
<p>How we gonna deep six all that glue</p>
<p>Model View Controller</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>There’s a little left to this story</p>
<p>A few more miles upon this road</p>
<p>Nobody seems to get much glory</p>
<p>From writing the controller code</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Controllers know the Model and View very intimately</p>
<p>They often use hardcoding which can be foreboding for reusability</p>
<p>But now you can connect each model key that you select to any view property</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well the model’s mission critical</p>
<p>And gorgeous is the view</p>
<p>I might be lazy, but sometimes it’s just crazy</p>
<p>How much code I write is just glue</p>
<p>And it wouldn’t be so tragic</p>
<p>But the code ain’t doing magic</p>
<p>It’s just moving values through</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>And once you start binding</p>
<p>I think you’ll be finding less code in your source tree</p>
<p>Yeah I know I was elated by the stuff they’ve automated and the things you get for free</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>And I don’t mean to be vicious</p>
<p>But it gets repetitious</p>
<p>Doing all the things controllers do</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>And I think it bears repeating all the code you won’t be needing when you hook it up in <span class="inlinemediaobject"><a id="part0019_inline_id00063"></a><img alt="" hisrc="figs/web/533fig01.png.jpg" src="../Images/image01227.jpeg"/></span></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>And I wish I had a dime</p>
<p>For every single time</p>
<p>I sent a TextField StringValue.</p></td><td style="vertical-align: top; "><p>Model View, even handles multiple selections too</p>
<p>Model View Controller</p>
<p>Model View, bet I ship my application before you</p>
<p>Model View Controller</p></td></tr></tbody></table></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note03"></a>Ear Power</h3><p>Don’t just read! After all, this is a Head First book... grab your iPod, hit this URL:</p><p><span class="emphasis"><em><a class="ulink" href="http://www.youtube.com/watch?v=YYvOGPMLVDo" target="_top">http://www.youtube.com/watch?v=YYvOGPMLVDo</a></em></span></p><p>Sit back and give it a listen.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0019_med_id00727a"></a><div class="mediaobject"><a id="part0019_med_id00727"></a><img alt="image with no caption" hisrc="figs/web/534fig01.png.jpg" src="../Images/image01228.jpeg"/></div></div><p><span class="strong"><strong>No. Design Patterns are your key to the MVC.</strong></span></p><p>We were just trying to whet your appetite. Tell you what, after you finish reading this chapter, go back and listen to the song again — you’ll have even more fun.</p><p>It sounds like you’ve had a bad run-in with MVC before? Most of us have. You’ve probably had other developers tell you it’s changed their lives and could possibly create world peace. It’s a powerful compound pattern, for sure, and while we can’t claim it will create world peace, it will save you hours of writing code once you know it.</p><p>But first you have to learn it, right? Well, there’s going to be a big difference this time around because <span class="emphasis"><em>now you know patterns!</em></span></p><p>That’s right, patterns are the key to MVC. Learning MVC from the top down is difficult; not many developers succeed. Here’s the secret to learning MVC: <span class="emphasis"><em>it’s just a few patterns put together.</em></span> When you approach learning MVC by looking at the patterns, all of a sudden it starts to make sense.</p><p>Let’s get started. This time around you’re going to nail MVC!</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_meet_the_model-view-controller" style="clear: both">Meet the Model-View-Controller</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1262"></a><a class="indexterm" id="part0019_iddle1923"></a>Imagine you’re using your favorite MP3 player, like iTunes. You can use its interface to add new songs, manage playlists and rename tracks. The player takes care of maintaining a little database of all your songs along with their associated names and data. It also takes care of playing the songs and, as it does, the user interface is constantly updated with the current song title, the running time, and so on.</p><p>Well, underneath it all sits the Model-View-Controller...</p><div class="informalfigure"><a id="part0019_med_id00728a"></a><div class="mediaobject"><a id="part0019_med_id00728"></a><img alt="image with no caption" hisrc="figs/web/535fig01.png.jpg" src="../Images/image01229.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_closer_lookhellip" style="clear: both">A closer look...</h2></div></div></div><p>The MP3 player description gives us a high-level view of MVC, but it really doesn’t help you understand the nitty gritty of how the compound pattern works, how you’d build one yourself, or why it’s such a good thing. Let’s start by stepping through the relationships among the model, view and controller, and then we’ll take second look from the perspective of Design Patterns.</p><div class="informalfigure"><a id="part0019_med_id00729a"></a><div class="mediaobject"><a id="part0019_med_id00729"></a><img alt="image with no caption" hisrc="figs/web/536fig01.png.jpg" src="../Images/image01230.jpeg"/></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① You’re the user — you interact with the view.</strong></span><br/>The view is your window to the model. When you do something to the view (like click the Play button) then the view tells the controller what you did. It’s the controller’s job to handle that.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② The controller asks the model to change its state.</strong></span><br/>The controller takes your actions and interprets them. If you click on a button, it’s the controller’s job to figure out what that means and how the model should be manipulated based on that action.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ The controller may also ask the view to change.</strong></span><br/>When the controller receives an action from the view, it may need to tell the view to change as a result. For example, the controller could enable or disable certain buttons or menu items in the interface.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ The model notifies the view when its state has changed.</strong></span><br/>When something changes in the model, based either on some action you took (like clicking a button) or some other internal change (like the next song in the playlist has started), the model notifies the view that its state has changed.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ The view asks the model for state.</strong></span><br/>The view gets the state it displays directly from the model. For instance, when the model notifies the view that a new song has started playing, the view requests the song name from the model and displays it. The view might also ask the model for state as the result of the controller requesting some change in the view.</li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_there_are_no_dumb_questions-id00170"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa2qe1"></a><a id="part0019_ch12qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does the controller ever become an observer of the model?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Sure. In some designs the controller registers with the model and is notified of changes. This can be the case when something in the model directly affects the user interface controls. For instance, certain states in the model may dictate that some interface items be enabled or disabled. If so, it is really controller’s job to ask the view to update its display accordingly.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa2qe2"></a><a id="part0019_ch12qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: All the controller does is take user input from the view and send it to the model, correct? Why have it at all if that is all it does? Why not just have the code in the view itself? In most cases isn’t the controller just calling a method on the model?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The controller does more than just “send it to the model”; it is responsible for interpreting the input and manipulating the model based on that input. But your real question is probably “why can’t I just do that in the view code?”</div><div>You could; however, you don’t want to for two reasons. First, you’ll complicate your view code because it now has two responsibilities: managing the user interface and dealing with the logic of how to control the model. Second, you’re tightly coupling your view to the model. If you want to reuse the view with another model, forget it. The controller separates the logic of control from the view and decouples the view from the model. By keeping the view and controller loosely coupled, you are building a more flexible and extensible design, one that can more easily accommodate change down the road.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_looking_at_mvc_through_patterns-colored" style="clear: both">Looking at MVC through patterns-colored glasses</h2></div></div></div><div class="informalfigure"><a id="part0019_med_id00730a"></a><div class="mediaobject"><a id="part0019_med_id00730"></a><img alt="image with no caption" hisrc="figs/web/538fig01.png.jpg" src="../Images/image01231.jpeg"/></div></div><p><a class="indexterm" id="part0019_iddle1239"></a><a class="indexterm" id="part0019_iddle1266"></a><a class="indexterm" id="part0019_iddle1278"></a><a class="indexterm" id="part0019_iddle1282"></a><a class="indexterm" id="part0019_iddle1927"></a><a class="indexterm" id="part0019_iddle1939"></a><a class="indexterm" id="part0019_iddle1943"></a><a class="indexterm" id="part0019_iddle2041"></a><a class="indexterm" id="part0019_iddle2417"></a>We’ve already told you the best path to learning the MVC is to see it for what it is: a set of patterns working together in the same design.</p><p>Let’s start with the model. As you might have guessed, the model uses Observer to keep the views and controllers updated on the latest state changes. The view and the controller, on the other hand, implement the Strategy Pattern. The controller is the behavior of the view, and it can be easily exchanged with another controller if you want different behavior. The view itself also uses a pattern internally to manage the windows, buttons and other components of the display: the Composite Pattern.</p><p>Let’s take a closer look:</p><div class="informalfigure"><a id="part0019_med_id00731a"></a><div class="mediaobject"><a id="part0019_med_id00731"></a><img alt="image with no caption" hisrc="figs/web/538fig02.png.jpg" src="../Images/image01232.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_observer">Observer</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00732a"></a><div class="mediaobject"><a id="part0019_med_id00732"></a><img alt="image with no caption" hisrc="figs/web/539fig01.png.jpg" src="../Images/image01233.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_strategy">Strategy</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00733a"></a><div class="mediaobject"><a id="part0019_med_id00733"></a><img alt="image with no caption" hisrc="figs/web/539fig02.png.jpg" src="../Images/image01234.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note04a"></a>Note</h3><p>The view only worries about presentation. The controller worries about translating user input to actions on the model.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_composite">Composite</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00734a"></a><div class="mediaobject"><a id="part0019_med_id00734"></a><img alt="image with no caption" hisrc="figs/web/539fig03.png.jpg" src="../Images/image01235.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_using_mvc_to_control_the_beathellip" style="clear: both">Using MVC to control the beat...</h2></div></div></div><div class="informalfigure"><a id="part0019_med_id00735a"></a><div class="mediaobject"><a id="part0019_med_id00735"></a><img alt="image with no caption" hisrc="figs/web/540fig01.png.jpg" src="../Images/image01236.jpeg"/></div></div><p><a class="indexterm" id="part0019_iddle1274"></a><a class="indexterm" id="part0019_iddle1451"></a><a class="indexterm" id="part0019_iddle1935"></a>It’s your time to be the DJ. When you’re a DJ it’s all about the beat. You might start your mix with a slowed, downtempo groove at 95 beats per minute (BPM) and then bring the crowd up to a frenzied 140 BPM of trance techno. You’ll finish off your set with a mellow 80 BPM ambient mix.</p><p>How are you going to do that? You have to control the beat and you’re going to build the tool to get you there.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_meet_the_java_dj_view">Meet the Java DJ View</h3></div></div></div><p>Let’s start with the <span class="strong"><strong>view</strong></span> of the tool. The view allows you to create a driving drum beat and tune its beats per minute...</p><div class="informalfigure"><a id="part0019_med_id00736a"></a><div class="mediaobject"><a id="part0019_med_id00736"></a><img alt="image with no caption" hisrc="figs/web/540fig02.png.jpg" src="../Images/image01237.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note04"></a>Note</h3><p><a class="indexterm" id="part0019_iddle1264"></a><a class="indexterm" id="part0019_iddle1925"></a>Here are a few more ways to control the DJ View...</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0019_med_id00737a"></a><div class="mediaobject"><a id="part0019_med_id00737"></a><img alt="image with no caption" hisrc="figs/web/541fig01.png.jpg" src="../Images/image01238.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_controller_is_in_the_middlehellip">The controller is in the middle...</h3></div></div></div><p>The <span class="strong"><strong>controller</strong></span> sits between the view and model. It takes your input, like selecting “Start” from the DJ Control menu, and turns it into an action on the model to start the beat generation.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_letapostrophes_not_forget_about_the_mode">Let’s not forget about the model underneath it all...</h3></div></div></div><p>You can’t see the <span class="strong"><strong>model</strong></span>, but you can hear it. The model sits underneath everything else, managing the beat and driving the speakers with MIDI.</p><div class="informalfigure"><a id="part0019_med_id00738a"></a><div class="mediaobject"><a id="part0019_med_id00738"></a><img alt="image with no caption" hisrc="figs/web/541fig02.png.jpg" src="../Images/image01239.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_putting_the_pieces_together" style="clear: both">Putting the pieces together</h2></div></div></div><div class="informalfigure"><a id="part0019_med_id00739a"></a><div class="mediaobject"><a id="part0019_med_id00739"></a><img alt="image with no caption" hisrc="figs/web/542fig01.png.jpg" src="../Images/image01240.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_building_the_pieces" style="clear: both">Building the pieces</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1279"></a><a class="indexterm" id="part0019_iddle1940"></a><a class="indexterm" id="part0019_iddle2042"></a>Okay, you know the model is responsible for maintaining all the data, state and any application logic. So what’s the BeatModel got in it? Its main job is managing the beat, so it has state that maintains the current beats per minute and lots of code that generates MIDI events to create the beat that we hear. It also exposes an interface that lets the controller manipulate the beat and lets the view and controller obtain the model’s state. Also, don’t forget that the model uses the Observer Pattern, so we also need some methods to let objects register as observers and send out notifications.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_letapostrophes_check_out_the_beatmodelin">Let’s check out the BeatModelInterface before looking at the implementation</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00740a"></a><div class="mediaobject"><a id="part0019_med_id00740"></a><img alt="image with no caption" hisrc="figs/web/543fig01.png.jpg" src="../Images/image01241.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_now_letapostrophes_have_a_look_at_the_co" style="clear: both">Now let’s have a look at the concrete BeatModel class</h2></div></div></div><div class="informalfigure"><a id="part0019_med_id00741a"></a><div class="mediaobject"><a id="part0019_med_id00741"></a><img alt="image with no caption" hisrc="figs/web/544fig01.png.jpg" src="../Images/image01242.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_ready_bake_code-id00171"></a><h3 class="title">Ready Bake Code</h3><p>This model uses Java’s MIDI support to generate beats. You can check out the complete implementation of all the DJ classes in the Java source files available on the wickedlysmart.com site, or look at the code at the end of the chapter.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_view" style="clear: both">The View</h2></div></div></div><p>Now the fun starts; we get to hook up a view and visualize the BeatModel!</p><p>The first thing to notice about the view is that we’ve implemented it so that it is displayed in two separate windows. One window contains the current BPM and the pulse; the other contains the interface controls. Why? We wanted to emphasize the difference between the interface that contains the view of the model and the rest of the interface that contains the set of user controls. Let’s take a closer look at the two parts of the view:</p><div class="informalfigure"><a id="part0019_med_id00742a"></a><div class="mediaobject"><a id="part0019_med_id00742"></a><img alt="image with no caption" hisrc="figs/web/545fig01.png.jpg" src="../Images/image01243.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note05"></a>Brain Power</h3><p>Our BeatModel makes no assumptions about the view. The model is implemented using the Observer Pattern, so it just notifies any view registered as an observer when its state changes. The view uses the model’s API to get access to the state. We’ve implemented one type of view; can you think of other views that could make use of the notifications and state in the BeatModel?</p><p><span class="underline">A lightshow that is based on the real-time beat.</span>_____________________________________________</p><p><span class="underline">A textual view that displays a music genre based on the BPM (ambient, downbeat, techno, etc</span>.).</p><p>____________________________________________________________________________________________</p><p>____________________________________________________________________________________________</p><p>____________________________________________________________________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_implementing_the_view" style="clear: both">Implementing the View</h2></div></div></div><p>The two parts of the view — the view of the model, and the view with the user interface controls — are displayed in two windows, but live together in one Java class. We’ll first show you just the code that creates the view of the model, which displays the current BPM and the beat bar. Then we’ll come back on the next page and show you just the code that creates the user interface controls, which displays the BPM text entry field, and the buttons.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note06"></a>Watch it!</h3><p><span class="strong"><strong>The code on these two pages is just an outline!</strong></span></p><p><span class="emphasis"><em>What we’ve done here is split ONE class into TWO, showing you one part of the view on this page, and the other part on the next page. All this code is really in ONE class — DJView.java. It’s all listed at the end of the chapter.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0019_med_id00743a"></a><div class="mediaobject"><a id="part0019_med_id00743"></a><img alt="image with no caption" hisrc="figs/web/546fig01.png.jpg" src="../Images/image01244.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_implementing_the_viewcomma_continuedhell" style="clear: both">Implementing the View, continued...</h2></div></div></div><p>Now, we’ll look at the code for the user interface controls part of the view. This view lets you control the model by telling the controller what to do, which in turn, tells the model what to do. Remember, this code is in the same class file as the other view code.</p><div class="informalfigure"><a id="part0019_med_id00744a"></a><div class="mediaobject"><a id="part0019_med_id00744"></a><img alt="image with no caption" hisrc="figs/web/547fig01.png.jpg" src="../Images/image01245.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_now_for_the_controller" style="clear: both">Now for the Controller</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1273"></a><a class="indexterm" id="part0019_iddle1283"></a><a class="indexterm" id="part0019_iddle1428"></a><a class="indexterm" id="part0019_iddle1510"></a><a class="indexterm" id="part0019_iddle1933"></a><a class="indexterm" id="part0019_iddle1944"></a><a class="indexterm" id="part0019_iddle2418"></a>It’s time to write the missing piece: the controller. Remember the controller is the strategy that we plug into the view to give it some smarts.</p><p>Because we are implementing the Strategy Pattern, we need to start with an interface for any Strategy that might be plugged into the DJ View. We’re going to call it ControllerInterface.</p><div class="informalfigure"><a id="part0019_med_id00745a"></a><div class="mediaobject"><a id="part0019_med_id00745"></a><img alt="image with no caption" hisrc="figs/web/548fig01.png.jpg" src="../Images/image01246.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_design_puzzle-id00172"></a><h3 class="title">Design Puzzle</h3><p>You’ve seen that the view and controller together make use of the Strategy Pattern. Can you draw a class diagram of the two that represents this pattern?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_and_hereapostrophes_the_implementation_o">And here’s the implementation of the controller</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00746a"></a><div class="mediaobject"><a id="part0019_med_id00746"></a><img alt="image with no caption" hisrc="figs/web/549fig01.png.jpg" src="../Images/image01247.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_putting_it_all_togetherhellip" style="clear: both">Putting it all together...</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1285"></a><a class="indexterm" id="part0019_iddle1947"></a>We’ve got everything we need: a model, a view, and a controller. Now it’s time to put them all together into a MVC! We’re going to see and hear how well they work together.</p><div class="informalfigure"><a id="part0019_med_id00747a"></a><div class="mediaobject"><a id="part0019_med_id00747"></a><img alt="image with no caption" hisrc="figs/web/550fig01.png.jpg" src="../Images/image01248.jpeg"/></div></div><p>All we need is a little code to get things started; it won’t take much:</p><div class="informalfigure"><a id="part0019_med_id00748a"></a><div class="mediaobject"><a id="part0019_med_id00748"></a><img alt="image with no caption" hisrc="figs/web/550fig02.png.jpg" src="../Images/image01249.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_and_now_for_a_test_runhellip">And now for a test run...</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00749a"></a><div class="mediaobject"><a id="part0019_med_id00749"></a><img alt="image with no caption" hisrc="figs/web/550fig03.png.jpg" src="../Images/image01250.jpeg"/></div></div><div class="informalfigure"><a id="part0019_med_id00750a"></a><div class="mediaobject"><a id="part0019_med_id00750"></a><img alt="image with no caption" hisrc="figs/web/550fig04.png.jpg" src="../Images/image01251.jpeg"/></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_things_to_do">Things to do</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Start the beat generation with the Start menu item; notice the controller disables the item afterwards.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Use the text entry along with the increase and decrease buttons to change the BPM. Notice how the view display reflects the changes despite the fact that it has no logical link to the controls.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Notice how the beat bar always keeps up with the beat since it’s an observer of the model.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Put on your favorite song and see if you can beat match the beat by using the increase and decrease controls.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ Stop the generator. Notice how the controller disables the Stop menu item and enables the Start menu item.</strong></span></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_exploring_strategy" style="clear: both">Exploring Strategy</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1263"></a><a class="indexterm" id="part0019_iddle1271"></a><a class="indexterm" id="part0019_iddle1284"></a><a class="indexterm" id="part0019_iddle1932"></a><a class="indexterm" id="part0019_iddle1945"></a><a class="indexterm" id="part0019_iddle2419"></a>Let’s take the Strategy Pattern just a little further to get a better feel for how it is used in MVC. We’re going to see another friendly pattern pop up too — a pattern you’ll often see hanging around the MVC trio: the Adapter Pattern.</p><div class="informalfigure"><a id="part0019_med_id00751a"></a><div class="mediaobject"><a id="part0019_med_id00751"></a><img alt="image with no caption" hisrc="figs/web/551fig01.png.jpg" src="../Images/image01252.jpeg"/></div></div><p>Think for a second about what the DJ View does: it displays a beat rate and a pulse. Does that sound like something else? How about a heartbeat? It just so happens that we have a heart monitor class; here’s the class diagram:</p><div class="informalfigure"><a id="part0019_med_id00752a"></a><div class="mediaobject"><a id="part0019_med_id00752"></a><img alt="image with no caption" hisrc="figs/web/551fig02.png.jpg" src="../Images/image01253.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note07"></a>Brain Power</h3><p>It certainly would be nice to reuse our current view with the HeartModel, but we need a controller that works with this model. Also, the interface of the HeartModel doesn’t match what the view expects because it has a getHeartRate() method rather than a getBPM(). How would you design a set of classes to allow the view to be reused with the new model? Jot down your class design ideas below.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_adapting_the_model" style="clear: both">Adapting the Model</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1031"></a><a class="indexterm" id="part0019_iddle1924"></a>For starters, we’re going to need to adapt the HeartModel to a BeatModel. If we don’t, the view won’t be able to work with the model, because the view only knows how to getBPM(), and the equivalent heart model method is getHeartRate(). How are we going to do this? We’re going to use the Adapter Pattern, of course! It turns out that this is a common technique when working with the MVC: use an adapter to adapt a model to work with existing controllers and views.</p><p>Here’s the code to adapt a HeartModel to a BeatModel:</p><div class="informalfigure"><a id="part0019_med_id00753a"></a><div class="mediaobject"><a id="part0019_med_id00753"></a><img alt="image with no caption" hisrc="figs/web/552fig01.png.jpg" src="../Images/image01254.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_now_weapostrophere_ready_for_a_heartcont" style="clear: both">Now we’re ready for a HeartController</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1269"></a><a class="indexterm" id="part0019_iddle1930"></a>With our HeartAdapter in hand we should be ready to create a controller and get the view running with the HeartModel. Talk about reuse!</p><div class="informalfigure"><a id="part0019_med_id00754a"></a><div class="mediaobject"><a id="part0019_med_id00754"></a><img alt="image with no caption" hisrc="figs/web/553fig01.png.jpg" src="../Images/image01255.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_and_thatapostrophes_itexclamation_mark_n">And that’s it! Now it’s time for some test code...</h3></div></div></div><div class="informalfigure"><a id="part0019_med_id00755a"></a><div class="mediaobject"><a id="part0019_med_id00755"></a><img alt="image with no caption" hisrc="figs/web/553fig02.png.jpg" src="../Images/image01256.jpeg"/></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_and_now_for_a_test_runhellip-id00173" style="clear: both">And now for a test run...</h2></div></div></div><div class="informalfigure"><a id="part0019_med_id00756a"></a><div class="mediaobject"><a id="part0019_med_id00756"></a><img alt="image with no caption" hisrc="figs/web/554fig01.png.jpg" src="../Images/image01257.jpeg"/></div></div><div class="informalfigure"><a id="part0019_med_id00757a"></a><div class="mediaobject"><a id="part0019_med_id00757"></a><img alt="image with no caption" hisrc="figs/web/554fig02.png.jpg" src="../Images/image01258.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_things_to_do-id00174">Things to do</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Notice that the display works great with a heart! The beat bar looks just like a pulse. Because the HeartModel also supports BPM and Beat Observers we can get beat updates just like with the DJ beats.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② As the heartbeat has natural variation, notice the display is updated with the new beats per minute.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Each time we get a BPM update the adapter is doing its job of translating getBPM() calls to getHeartRate() calls.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ The Start and Stop menu items are not enabled because the controller disabled them.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ The other buttons still work but have no effect because the controller implements no ops for them. The view could be changed to support the disabling of these items.</strong></span></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_mvc_and_the_web" style="clear: both">MVC and the Web</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1256"></a><a class="indexterm" id="part0019_iddle1287"></a><a class="indexterm" id="part0019_iddle1916"></a><a class="indexterm" id="part0019_iddle1949"></a><a class="indexterm" id="part0019_iddle2513"></a>It wasn’t long after the Web was spun that developers started adapting the MVC to fit the browser/server model. The prevailing adaptation is known simply as “Model 2” and uses a combination of servlet and JSP technology to achieve the same separation of model, view and controller that we see in conventional GUIs.</p><p>Let’s check out how Model 2 works:</p><div class="informalfigure"><a id="part0019_med_id00758a"></a><div class="mediaobject"><a id="part0019_med_id00758"></a><img alt="image with no caption" hisrc="figs/web/555fig01.png.jpg" src="../Images/image01259.jpeg"/></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>①</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>You make an HTTP request, which is received by a servlet.</strong></span></p>
<p>Using your web browser you make an HTTP request. This typically involves sending along some form data, like your username and password. A servlet receives this form data and parses it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>②</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>The servlet acts as the controller.</strong></span></p>
<p>The servlet plays the role of the controller and processes your request, most likely making requests on the model (usually a database). The result of processing the request is usually bundled up in the form of a JavaBean.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>③</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>The controller forwards control to the view.</strong></span></p>
<p>The View is represented by a JSP. The JSP’s only job is to generate the page representing the view of model (❹ which it obtains via the JavaBean) along with any controls needed for further actions.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>④</p></td><td style="vertical-align: top; "><p><span class="strong"><strong>The view returns a page to the browser via HTTP.</strong></span></p>
<p>A page is returned to the browser, where it is displayed as the view. The user submits further requests, which are processed in the same fashion.</p></td></tr></tbody></table></div><div class="informalfigure"><a id="part0019_med_id00759a"></a><div class="mediaobject"><a id="part0019_med_id00759"></a><img alt="image with no caption" hisrc="figs/web/556fig01.png.jpg" src="../Images/image01260.jpeg"/></div></div><p><span class="strong"><strong>Model 2 is more than just a clean design.</strong></span></p><p>The benefits of the separation of the view, model and controller are pretty clear to you now. But you need to know the “rest of the story” with Model 2 — that it saved many web shops from sinking into chaos.</p><p>How? Well, Model 2 not only provides a separation of components in terms of design, it also provides a separation in <span class="emphasis"><em>production responsibilities</em></span>. Let’s face it, in the old days, anyone with access to your JSPs could get in and write any Java code they wanted, right? And that included a lot of people who didn’t know a jar file from a jar of peanut butter. The reality is that most web producers <span class="emphasis"><em>know about content and HTML, not software</em></span>.</p><p>Luckily Model 2 came to the rescue. With Model 2 we can leave the developer jobs to the men &amp; women who know their servlets and let the web producers loose on simple Model 2-style JSPs where all the producers have access to is HTML and simple JavaBeans.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_model_2_djapostropheing_from_a_cell_phon" style="clear: both">Model 2: DJ’ing from a cell phone</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1069"></a><a class="indexterm" id="part0019_iddle1082"></a><a class="indexterm" id="part0019_iddle1258"></a><a class="indexterm" id="part0019_iddle1727"></a><a class="indexterm" id="part0019_iddle1874"></a><a class="indexterm" id="part0019_iddle1918"></a><a class="indexterm" id="part0019_iddle2258"></a>You didn’t think we’d try to skip out without moving that great BeatModel over to the Web, did you? Just think, you can control your entire DJ session through a web page on your cellular phone. So now you can get out of that DJ booth and get down in the crowd. What are you waiting for? Let’s write that code!</p><div class="informalfigure"><a id="part0019_med_id00760a"></a><div class="mediaobject"><a id="part0019_med_id00760"></a><img alt="image with no caption" hisrc="figs/web/557fig01.png.jpg" src="../Images/image01261.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_plan">The plan</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① Fix up the model.</strong></span><br/>Well, actually, we don’t have to fix the model; it’s fine just like it is!</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Create a servlet controller</strong></span><br/>We need a simple servlet that can receive our HTTP requests and perform a few operations on the model. All it needs to do is stop, start and change the beats per minute.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Create a HTML view.</strong></span><br/>We’ll create a simple view with a JSP. It’s going to receive a JavaBean from the controller that will tell it everything it needs to display. The JSP will then generate an HTML interface.</li></ul></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note08"></a>Geek Bits</h3><p><span class="strong"><strong>Setting up your servlet environment</strong></span></p><p>Showing you how to set up your servlet environment is a little bit off topic for a book on Design Patterns, at least if you don’t want the book to weigh more than you do!</p><p>Fire up your web browser and head straight to <a class="ulink" href="http://jakarta.apache.org/tomcat/" target="_top">http://jakarta.apache.org/tomcat/</a> for the Apache Jakarta Project’s Tomcat Servlet Container. You’ll find everything you need there to get you up and running.</p><p>You’ll also want to check out <span class="emphasis"><em>Head First Servlets &amp; JSP</em></span> by Bryan Basham, Kathy Sierra and Bert Bates.</p><div class="informalfigure"><a id="part0019_med_id00761a"></a><div class="mediaobject"><a id="part0019_med_id00761"></a><img alt="image with no caption" hisrc="figs/web/557fig02.png.jpg" src="../Images/image01262.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_step_one_the_model" style="clear: both">Step one: the model</h2></div></div></div><p>Remember that in MVC, the model doesn’t know anything about the views or controllers. In other words, it is totally decoupled. All it knows is that it may have observers it needs to notify. That’s the beauty of the Observer Pattern. It also provides an interface the views and controllers can use to get and set its state.</p><p>Now all we need to do is adapt it to work in the web environment, but, given that it doesn’t depend on any outside classes, there is really no work to be done. We can use our BeatModel off the shelf without changes. So, let’s be productive and move on to step two!</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_step_two_the_controller_servlet" style="clear: both">Step two: the controller servlet</h2></div></div></div><p>Remember, the servlet is going to act as our controller; it will receive web browser input in a HTTP request and translate it into actions that can be applied to the model.</p><p>Then, given the way the Web works, we need to return a view to the browser. To do this we’ll pass control to the view, which takes the form of a JSP. We’ll get to that in step three.</p><p>Here’s the outline of the servlet; on the next page, we’ll look at the full implementation.</p><div class="informalfigure"><a id="part0019_med_id00762a"></a><div class="mediaobject"><a id="part0019_med_id00762"></a><img alt="image with no caption" hisrc="figs/web/558fig01.png.jpg" src="../Images/image01263.jpeg"/></div></div><p>Here’s the implementation of the doGet() method from the page before:</p><div class="informalfigure"><a id="part0019_med_id00763a"></a><div class="mediaobject"><a id="part0019_med_id00763"></a><img alt="image with no caption" hisrc="figs/web/559fig01.png.jpg" src="../Images/image01264.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_now_we_need_a_viewhellip" style="clear: both">Now we need a view...</h2></div></div></div><p>All we need is a view and we’ve got our browser-based beat generator ready to go! In Model 2, the view is just a JSP. All the JSP knows about is the bean it receives from the controller. In our case, that bean is just the model and the JSP is only going to use its BPM property to extract the current beats per minute. With that data in hand, it creates the view and also the user interface controls.</p><div class="informalfigure"><a id="part0019_med_id00764a"></a><div class="mediaobject"><a id="part0019_med_id00764"></a><img alt="image with no caption" hisrc="figs/web/560fig01.png.jpg" src="../Images/image01265.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note08a"></a>Note</h3><p>NOTICE that just like MVC, in Model 2 the view doesn’t alter the model (that’s the controller’s job); all it does is use its state!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_putting_model_2_to_the_testhellip" style="clear: both">Putting Model 2 to the test...</h2></div></div></div><p>It’s time to start your web browser, hit the DJView Servlet and give the system a spin...</p><div class="informalfigure"><a id="part0019_med_id00765a"></a><div class="mediaobject"><a id="part0019_med_id00765"></a><img alt="image with no caption" hisrc="figs/web/561fig01.png.jpg" src="../Images/image01266.jpeg"/></div></div><div class="informalfigure"><a id="part0019_med_id00766a"></a><div class="mediaobject"><a id="part0019_med_id00766"></a><img alt="image with no caption" hisrc="figs/web/562fig01.png.jpg" src="../Images/image01267.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_things_to_do-id00175">Things to do</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>① First, hit the web page; you’ll see the beats per minute at 0. Go ahead and click the “on” button.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>② Now you should see the beats per minute at the default setting: 90 BPM. You should also hear a beat on the machine the server is running on.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>③ Enter a specific beat, say, 120, and click the “set” button. The page should refresh with a beats per minute of 120 (and you should hear the beat increase).</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>④ Now play with the increase/decrease buttons to adjust the beat up and down.</strong></span></li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>⑤ Think about how each step of the system works. The HTML interface makes a request to the servlet (the controller); the servlet parses the user input and then makes requests to the model. The servlet then passes control to the JSP (the view), which creates the HTML view that is returned and displayed.</strong></span></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_design_patterns_and_model_2" style="clear: both">Design Patterns and Model 2</h2></div></div></div><p><a class="indexterm" id="part0019_iddle1259"></a><a class="indexterm" id="part0019_iddle1919"></a><a class="indexterm" id="part0019_iddle2040"></a>After implementing the DJ control for the Web using Model 2, you might be wondering where the patterns went. We have a view created in HTML from a JSP, but the view is no longer a listener of the model. We have a controller that’s a servlet that receives HTTP requests, but are we still using the Strategy Pattern? And what about Composite? We have a view that is made from HTML and displayed in a web browser. Is that still the Composite Pattern?</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_model_2_is_an_adaptation_of_mvc_to_the_w">Model 2 is an adaptation of MVC to the Web</h3></div></div></div><p>Even though Model 2 doesn’t look exactly like “textbook” MVC, all the parts are still there; they’ve just been adapted to reflect the idiosyncrasies of the web browser model. Let’s take another look...</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_observer-id00176" style="clear: both">Observer</h2></div></div></div><p>The view is no longer an observer of the model in the classic sense; that is, it doesn’t register with the model to receive state change notifications.</p><p>However, the view does receive the equivalent of notifications indirectly from the controller when the model has been changed. The controller even passes the view a bean that allows the view to retrieve the model’s state.</p><p>If you think about the browser model, the view only needs an update of state information when an HTTP response is returned to the browser; notifications at any other time would be pointless. Only when a page is being created and returned does it make sense to create the view and incorporate the model’s state.</p><div class="informalfigure"><a id="part0019_med_id00767a"></a><div class="mediaobject"><a id="part0019_med_id00767"></a><img alt="image with no caption" hisrc="figs/web/563fig01.png.jpg" src="../Images/image01268.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_strategy-id00177">Strategy</h3></div></div></div><p><a class="indexterm" id="part0019_iddle1238"></a><a class="indexterm" id="part0019_iddle1257"></a><a class="indexterm" id="part0019_iddle1260"></a><a class="indexterm" id="part0019_iddle1917"></a><a class="indexterm" id="part0019_iddle1920"></a><a class="indexterm" id="part0019_iddle2416"></a>In Model 2, the Strategy object is still the controller servlet; however, it’s not directly composed with the view in the classic manner. That said, it is an object that implements behavior for the view, and we can swap it out for another controller if we want different behavior.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0019_composite-id00178">Composite</h3></div></div></div><p>Like our Swing GUI, the view is ultimately made up of a nested set of graphical components. In this case, they are rendered by a web browser from an HTML description; however, underneath there is an object system that most likely forms a composite.</p><div class="informalfigure"><a id="part0019_med_id00768a"></a><div class="mediaobject"><a id="part0019_med_id00768"></a><img alt="image with no caption" hisrc="figs/web/564fig01.png.jpg" src="../Images/image01269.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0019_ch12note09a"></a>Note</h3><p>The controller still provides the view behavior, even if it isn’t composed with the view using object composition.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_there_are_no_dumb_questions-id00179"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe1"></a><a id="part0019_ch12qa3q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0019_iddle1240"></a><a class="indexterm" id="part0019_iddle1267"></a><a class="indexterm" id="part0019_iddle1268"></a><a class="indexterm" id="part0019_iddle1276"></a><a class="indexterm" id="part0019_iddle1277"></a><a class="indexterm" id="part0019_iddle1281"></a><a class="indexterm" id="part0019_iddle1286"></a><a class="indexterm" id="part0019_iddle1903"></a><a class="indexterm" id="part0019_iddle1928"></a><a class="indexterm" id="part0019_iddle1929"></a><a class="indexterm" id="part0019_iddle1937"></a><a class="indexterm" id="part0019_iddle1938"></a><a class="indexterm" id="part0019_iddle1942"></a><a class="indexterm" id="part0019_iddle1948"></a><a class="indexterm" id="part0019_iddle2447"></a><span class="strong"><strong>Q: It seems like you are really hand-waving the fact that the Composite Pattern is really in MVC. Is it really there?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes, Virginia, there really is a Composite Pattern in MVC. But, actually, this is a very good question. Today GUI packages, like Swing, have become so sophisticated that we hardly notice the internal structure and the use of Composite in the building and update of the display. It’s even harder to see when we have web browsers that can take markup language and convert it into a user interface.</div><div>Back when MVC was first discovered, creating GUIs required a lot more manual intervention and the pattern was more obviously part of the MVC.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe2"></a><a id="part0019_ch12qa3q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does the controller ever implement any application logic?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No, the controller implements behavior for the view. It is the smarts that translates the actions from the view to actions on the model. The model takes those actions and implements the application logic to decide what to do in response to those actions. The controller might have to do a little work to determine what method calls to make on the model, but that’s not considered the “application logic.” The application logic is the code that manages and manipulates your data and it lives in your model.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe3"></a><a id="part0019_ch12qa3q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I’ve always found the word “model” hard to wrap my head around. I now get that it’s the guts of the application, but why was such a vague, hard-to-understand word used to describe this aspect of the MVC?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> When MVC was named they needed a word that began with a “M” or otherwise they couldn’t have called it MVC.</div><div>But seriously, we agree with you. Everyone scratches their head and wonders what a model is. But then everyone comes to the realization that they can’t think of a better word either.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe4"></a><a id="part0019_ch12qa3q4"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: You’ve talked a lot about the state of the model. Does this mean it has the State Pattern in it?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q4a4"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No, we mean the general idea of state. But certainly some models do use the State Pattern to manage their internal states.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe5"></a><a id="part0019_ch12qa3q5"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I’ve seen descriptions of the MVC where the controller is described as a “mediator” between the view and the model. Is the controller implementing the Mediator Pattern?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q5a5"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> We haven’t covered the Mediator Pattern (although you’ll find a summary of the pattern in the appendix), so we won’t go into too much detail here, but the intent of the mediator is to encapsulate how objects interact and promote loose coupling by keeping two objects from referring to each other explicitly. So, to some degree, the controller can be seen as a mediator, since the view never sets state directly on the model, but rather always goes through the controller. Remember, however, that the view does have a reference to the model to access its state. If the controller were truly a mediator, the view would have to go through the controller to get the state of the model as well.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe6"></a><a id="part0019_ch12qa3q6"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does the view always have to ask the model for its state? Couldn’t we use the push model and send the model’s state with the update notification?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q6a6"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes, the model could certainly send its state with the notification, and in fact, if you look again at the JSP/HTML view, that’s exactly what we’re doing. We’re sending the entire model in a bean, which the view uses to access the state it needs using the bean properties. We could do something similar with the BeatModel by sending just the state that the view is interested in. If you remember the Observer Pattern chapter, however, you’ll also remember that there’s a couple of disadvantages to this. If you don’t, go back and have a second look.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe7"></a><a id="part0019_ch12qa3q7"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: If I have more than one view, do I always need more than one controller?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q7a7"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Typically, you need one controller per view at runtime; however, the same controller class can easily manage many views.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3qe8"></a><a id="part0019_ch12qa3q8"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: The view is not supposed to manipulate the model; however, I noticed in your implementation that the view has full access to the methods that change the model’s state. Is this dangerous?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0019_ch12qa3q8a8"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> You are correct; we gave the view full access to the model’s set of methods. We did this to keep things simple, but there may be circumstances where you want to give the view access to only part of your model’s API. There’s a great design pattern that allows you to adapt an interface to only provide a subset. Can you think of it?</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_tools_for_your_design_toolbox-id00180" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>You could impress anyone with your design toolbox. Wow, look at all those principles, patterns and now, compound patterns!</p><div class="informalfigure"><a id="part0019_med_id00769a"></a><div class="mediaobject"><a id="part0019_med_id00769"></a><img alt="image with no caption" hisrc="figs/web/566fig01.png.jpg" src="../Images/image01270.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_bullet_points-id00181"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Model View Controller Pattern (MVC) is a compound pattern consisting of the Observer, Strategy and Composite patterns.</li><li class="listitem">The model makes use of the Observer Pattern so that it can keep observers updated yet stay decoupled from them.</li><li class="listitem">The controller is the strategy for the view. The view can use different implementations of the controller to get different behavior.</li><li class="listitem">The view uses the Composite Pattern to implement the user interface, which usually consists of nested components like panels, frames and buttons.</li><li class="listitem">These patterns work together to decouple the three players in the MVC model, which keeps designs clear and flexible.</li><li class="listitem">The Adapter Pattern can be used to adapt a new model to an existing view and controller.</li><li class="listitem">Model 2 is an adaptation of MVC for web applications.</li><li class="listitem">In Model 2, the controller is implemented as a servlet and JSP &amp; HTML implement the view.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0019_exercise_solutions" style="clear: both">Exercise Solutions</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_sharpen_your_pencil_solution-id00182"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0019_iddle1532"></a><a class="indexterm" id="part0019_iddle2271"></a>The QuackCounter is a Quackable too. When we change Quackable to extend QuackObservable, we have to change every class that implements Quackable, including QuackCounter:</p><div class="informalfigure"><a id="part0019_med_id00770a"></a><div class="mediaobject"><a id="part0019_med_id00770"></a><img alt="image with no caption" hisrc="figs/web/567fig01.png.jpg" src="../Images/image01271.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_sharpen_your_pencil_solution-id00183"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0019_iddle1573"></a><a class="indexterm" id="part0019_iddle2318"></a>What if our Quackologist wants to observe an entire flock? What does that mean anyway? Think about it like this: if we observe a composite, then we’re observing everything in the composite. So, when you register with a flock, the flock composite makes sure you get registered with all its children, which may include other flocks.</p><div class="informalfigure"><a id="part0019_med_id00771a"></a><div class="mediaobject"><a id="part0019_med_id00771"></a><img alt="image with no caption" hisrc="figs/web/568fig01.png.jpg" src="../Images/image01272.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_sharpen_your_pencil_solution-id00184"></a><h3 class="title">Sharpen your pencil Solution</h3><p><a class="indexterm" id="part0019_iddle1008"></a><a class="indexterm" id="part0019_iddle1429"></a><a class="indexterm" id="part0019_iddle1458"></a><a class="indexterm" id="part0019_iddle1511"></a><a class="indexterm" id="part0019_iddle1567"></a><a class="indexterm" id="part0019_iddle1641"></a><a class="indexterm" id="part0019_iddle1954"></a><a class="indexterm" id="part0019_iddle2106"></a><a class="indexterm" id="part0019_iddle2312"></a>We’re still directly instantiating Geese by relying on concrete classes. Can you write an Abstract Factory for Geese? How should it handle creating “goose ducks”?</p><div class="blockquote"><blockquote class="blockquote"><div>You could add a createGooseDuck() method to the existing Duck Factories. Or, you could create a completely separate Factory for creating families of Geese.</div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_design_puzzle_solution-id00185"></a><h3 class="title">Design Puzzle Solution</h3><p>You’ve seen that the view and controller together make use of the Strategy Pattern. Can you draw a class diagram of the two that represents this pattern?</p><div class="informalfigure"><a id="part0019_med_id00772a"></a><div class="mediaobject"><a id="part0019_med_id00772"></a><img alt="image with no caption" hisrc="figs/web/569fig01.png.jpg" src="../Images/image01273.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0019_ready_bake_code-id00186"></a><h3 class="title">Ready Bake Code</h3><p><a class="indexterm" id="part0019_iddle1265"></a><a class="indexterm" id="part0019_iddle1452"></a><a class="indexterm" id="part0019_iddle1926"></a>Here’s the complete implementation of the DJView. It shows all the MIDI code to generate the sound, and all the Swing components to create the view. You can also download this code at <a class="ulink" href="http://www.wickedlysmart.com" target="_top">http://www.wickedlysmart.com</a>. Have fun!</p><a id="part0019_pro_id00044"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public class DJTestDrive {</strong></span>

    <span class="strong"><strong>public static void main (String[] args) {</strong></span>
        <span class="strong"><strong>BeatModelInterface model = new BeatModel();</strong></span>
        <span class="strong"><strong>ControllerInterface controller = new BeatController(model);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p><span class="strong"><strong>The Beat Model</strong></span></p><a id="part0019_pro_id00045"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public interface BeatModelInterface {</strong></span>
    <span class="strong"><strong>void initialize();</strong></span>

    <span class="strong"><strong>void on();</strong></span>

    <span class="strong"><strong>void off();</strong></span>

    <span class="strong"><strong>void setBPM(int bpm);</strong></span>

    <span class="strong"><strong>int getBPM();</strong></span>

    <span class="strong"><strong>void registerObserver(BeatObserver o);</strong></span>

    <span class="strong"><strong>void removeObserver(BeatObserver o);</strong></span>

    <span class="strong"><strong>void registerObserver(BPMObserver o);</strong></span>

    <span class="strong"><strong>void removeObserver(BPMObserver o);</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>import javax.sound.midi.*;</strong></span>

<span class="strong"><strong>import java.util.*;</strong></span>

<span class="strong"><strong>public class BeatModel implements BeatModelInterface, MetaEventListener {</strong></span>
       <span class="strong"><strong>Sequencer sequencer;</strong></span>
       <span class="strong"><strong>ArrayList&lt;BeatObserver&gt; beatObservers = new ArrayList&lt;BeatObserver&gt;();</strong></span>
       <span class="strong"><strong>ArrayList&lt;BPMObserver&gt; bpmObservers = new ArrayList&lt;BPMObserver&gt;();</strong></span>
       <span class="strong"><strong>int bpm = 90;</strong></span>
       <span class="strong"><strong>Sequence sequence;</strong></span>
       <span class="strong"><strong>Track track;</strong></span>

       <span class="strong"><strong>public void initialize() {</strong></span>
              <span class="strong"><strong>setUpMidi();</strong></span>
              <span class="strong"><strong>buildTrackAndStart();</strong></span>
       <span class="strong"><strong>}</strong></span>

       <span class="strong"><strong>public void on() {</strong></span>
              <span class="strong"><strong>System.out.println("Starting the sequencer");</strong></span>
              <span class="strong"><strong>sequencer.start();</strong></span>
              <span class="strong"><strong>setBPM(90);</strong></span>
       <span class="strong"><strong>}</strong></span>

       <span class="strong"><strong>public void off() {</strong></span>
              <span class="strong"><strong>setBPM(0);</strong></span>
              <span class="strong"><strong>sequencer.stop();</strong></span>
       <span class="strong"><strong>}</strong></span>

       <span class="strong"><strong>public void setBPM(int bpm) {</strong></span>
              <span class="strong"><strong>this.bpm = bpm;</strong></span>
              <span class="strong"><strong>sequencer.setTempoInBPM(getBPM());</strong></span>
              <span class="strong"><strong>notifyBPMObservers();</strong></span>
       <span class="strong"><strong>}</strong></span>

       <span class="strong"><strong>public int getBPM() {</strong></span>
              <span class="strong"><strong>return bpm;</strong></span>
       <span class="strong"><strong>}</strong></span>

       <span class="strong"><strong>void beatEvent() {</strong></span>
              <span class="strong"><strong>notifyBeatObservers();</strong></span>
       <span class="strong"><strong>}</strong></span>

       <span class="strong"><strong>public void registerObserver(BeatObserver o) {</strong></span>
              <span class="strong"><strong>beatObservers.add(o);</strong></span>
       <span class="strong"><strong>}</strong></span></pre><a id="part0019_pro_id00046"></a><pre class="programlisting">      <span class="strong"><strong>public void notifyBeatObservers() {</strong></span>
             <span class="strong"><strong>for(int i = 0; i &lt; beatObservers.size(); i++) {</strong></span>
                   <span class="strong"><strong>BeatObserver observer = (BeatObserver)beatObservers.get(i);</strong></span>
                   <span class="strong"><strong>observer.updateBeat();</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void registerObserver(BPMObserver o) {</strong></span>
             <span class="strong"><strong>bpmObservers.add(o);</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void notifyBPMObservers() {</strong></span>
             <span class="strong"><strong>for(int i = 0; i &lt; bpmObservers.size(); i++) {</strong></span>
                 <span class="strong"><strong>BPMObserver observer = (BPMObserver)bpmObservers.get(i);</strong></span>
                 <span class="strong"><strong>observer.updateBPM();</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void removeObserver(BeatObserver o) {</strong></span>
             <span class="strong"><strong>int i = beatObservers.indexOf(o);</strong></span>
             <span class="strong"><strong>if (i &gt;= 0) {</strong></span>
                 <span class="strong"><strong>beatObservers.remove(i);</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void removeObserver(BPMObserver o) {</strong></span>
             <span class="strong"><strong>int i = bpmObservers.indexOf(o);</strong></span>
             <span class="strong"><strong>if (i &gt;= 0) {</strong></span>
                 <span class="strong"><strong>bpmObservers.remove(i);</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void meta(MetaMessage message) {</strong></span>
             <span class="strong"><strong>if (message.getType() == 47) {</strong></span>
                 <span class="strong"><strong>beatEvent();</strong></span>
                 <span class="strong"><strong>sequencer.start();</strong></span>
                 <span class="strong"><strong>setBPM(getBPM());</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void setUpMidi() {</strong></span>
             <span class="strong"><strong>try {</strong></span>
                   <span class="strong"><strong>sequencer = MidiSystem.getSequencer();</strong></span>
                   <span class="strong"><strong>sequencer.open();</strong></span>
                   <span class="strong"><strong>sequencer.addMetaEventListener(this);</strong></span>
                   <span class="strong"><strong>sequence = new Sequence(Sequence.PPQ,4);</strong></span>
                   <span class="strong"><strong>track = sequence.createTrack();</strong></span>
                   <span class="strong"><strong>sequencer.setTempoInBPM(getBPM());</strong></span>
                   <span class="strong"><strong>sequencer.setLoopCount(Sequencer.LOOP_CONTINUOUSLY);</strong></span>
             <span class="strong"><strong>} catch(Exception e) {</strong></span>
                   <span class="strong"><strong>e.printStackTrace();</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void buildTrackAndStart() {</strong></span>
             <span class="strong"><strong>int[] trackList = {35, 0, 46, 0};</strong></span>

             <span class="strong"><strong>sequence.deleteTrack(null);</strong></span>
             <span class="strong"><strong>track = sequence.createTrack();</strong></span>

             <span class="strong"><strong>makeTracks(trackList);</strong></span>
             <span class="strong"><strong>track.add(makeEvent(192,9,1,0,4));</strong></span>
             <span class="strong"><strong>try {</strong></span>
                   <span class="strong"><strong>sequencer.setSequence(sequence);</strong></span>
             <span class="strong"><strong>} catch(Exception e) {</strong></span>
                   <span class="strong"><strong>e.printStackTrace();</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public void makeTracks(int[] list) {</strong></span>

             <span class="strong"><strong>for (int i = 0; i &lt; list.length; i++) {</strong></span>
                    <span class="strong"><strong>int key = list[i];</strong></span>

                    <span class="strong"><strong>if (key != 0) {</strong></span>
                           <span class="strong"><strong>track.add(makeEvent(144,9,key, 100, i));</strong></span>
                           <span class="strong"><strong>track.add(makeEvent(128,9,key, 100, i+1));</strong></span>
                    <span class="strong"><strong>}</strong></span>
             <span class="strong"><strong>}</strong></span>
      <span class="strong"><strong>}</strong></span>

      <span class="strong"><strong>public MidiEvent makeEvent(int comd, int chan, int one, int two, int tick) {</strong></span>
            <span class="strong"><strong>MidiEvent event = null;</strong></span>
            <span class="strong"><strong>try {</strong></span>
                   <span class="strong"><strong>ShortMessage a = new ShortMessage();</strong></span>
                   <span class="strong"><strong>a.setMessage(comd, chan, one, two);</strong></span>
                   <span class="strong"><strong>event = new MidiEvent(a, tick);</strong></span>

            <span class="strong"><strong>} catch(Exception e) {</strong></span>
                   <span class="strong"><strong>e.printStackTrace();</strong></span>
            <span class="strong"><strong>}</strong></span>
            <span class="strong"><strong>return event;</strong></span>
      <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p><a class="indexterm" id="part0019_iddle1275"></a><a class="indexterm" id="part0019_iddle1936"></a><span class="strong"><strong>The View</strong></span></p><a id="part0019_pro_id00047"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public interface BeatObserver {</strong></span>
    <span class="strong"><strong>void updateBeat();</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public interface BPMObserver {</strong></span>
    <span class="strong"><strong>void updateBPM();</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import java.awt.event.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>

<span class="strong"><strong>public class DJView implements ActionListener, BeatObserver, BPMObserver {</strong></span>
    <span class="strong"><strong>BeatModelInterface model;</strong></span>
    <span class="strong"><strong>ControllerInterface controller;</strong></span>
    <span class="strong"><strong>JFrame viewFrame;</strong></span>
    <span class="strong"><strong>JPanel viewPanel;</strong></span>
    <span class="strong"><strong>BeatBar beatBar;</strong></span>
    <span class="strong"><strong>JLabel bpmOutputLabel;</strong></span>
    <span class="strong"><strong>JFrame controlFrame;</strong></span>
    <span class="strong"><strong>JPanel controlPanel;</strong></span>
    <span class="strong"><strong>JLabel bpmLabel;</strong></span>
    <span class="strong"><strong>JTextField bpmTextField;</strong></span>
    <span class="strong"><strong>JButton setBPMButton;</strong></span>
    <span class="strong"><strong>JButton increaseBPMButton;</strong></span>
    <span class="strong"><strong>JButton decreaseBPMButton;</strong></span>
    <span class="strong"><strong>JMenuBar menuBar;</strong></span>
    <span class="strong"><strong>JMenu menu;</strong></span>
    <span class="strong"><strong>JMenuItem startMenuItem;</strong></span>
    <span class="strong"><strong>JMenuItem stopMenuItem;</strong></span>

    <span class="strong"><strong>public DJView(ControllerInterface controller, BeatModelInterface model) {</strong></span>
        <span class="strong"><strong>this.controller = controller;</strong></span>
        <span class="strong"><strong>this.model = model;</strong></span>
        <span class="strong"><strong>model.registerObserver((BeatObserver)this);</strong></span>
        <span class="strong"><strong>model.registerObserver((BPMObserver)this);</strong></span>
    <span class="strong"><strong>}</strong></span>

<span class="strong"><strong>public void createView() {</strong></span>
    <span class="strong"><strong>// Create all Swing components here</strong></span>
    <span class="strong"><strong>viewPanel = new JPanel(new GridLayout(1, 2));</strong></span>
    <span class="strong"><strong>viewFrame = new JFrame("View");</strong></span>
    <span class="strong"><strong>viewFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</strong></span>
    <span class="strong"><strong>viewFrame.setSize(new Dimension(100, 80));</strong></span>
    <span class="strong"><strong>bpmOutputLabel = new JLabel("offline", SwingConstants.CENTER);</strong></span>
    <span class="strong"><strong>beatBar = new BeatBar();</strong></span>
    <span class="strong"><strong>beatBar.setValue(0);</strong></span>
    <span class="strong"><strong>JPanel bpmPanel = new JPanel(new GridLayout(2, 1));</strong></span>
    <span class="strong"><strong>bpmPanel.add(beatBar);</strong></span>
    <span class="strong"><strong>bpmPanel.add(bpmOutputLabel);</strong></span>
    <span class="strong"><strong>viewPanel.add(bpmPanel);</strong></span>
    <span class="strong"><strong>viewFrame.getContentPane().add(viewPanel, BorderLayout.CENTER);</strong></span>
    <span class="strong"><strong>viewFrame.pack();</strong></span>
    <span class="strong"><strong>viewFrame.setVisible(true);</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>public void createControls() {</strong></span>
    <span class="strong"><strong>// Create all Swing components here</strong></span>
    <span class="strong"><strong>JFrame.setDefaultLookAndFeelDecorated(true);</strong></span>
    <span class="strong"><strong>controlFrame = new JFrame("Control");</strong></span>
    <span class="strong"><strong>controlFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</strong></span>
    <span class="strong"><strong>controlFrame.setSize(new Dimension(100, 80));</strong></span>

    <span class="strong"><strong>controlPanel = new JPanel(new GridLayout(1, 2));</strong></span>

    <span class="strong"><strong>menuBar = new JMenuBar();</strong></span>
    <span class="strong"><strong>menu = new JMenu("DJ Control");</strong></span>
    <span class="strong"><strong>startMenuItem = new JMenuItem("Start");</strong></span>
    <span class="strong"><strong>menu.add(startMenuItem);</strong></span>
    <span class="strong"><strong>startMenuItem.addActionListener(new ActionListener() {</strong></span>
        <span class="strong"><strong>public void actionPerformed(ActionEvent event) {</strong></span>
            <span class="strong"><strong>controller.start();</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>});</strong></span>
    <span class="strong"><strong>stopMenuItem = new JMenuItem("Stop");</strong></span>
    <span class="strong"><strong>menu.add(stopMenuItem);</strong></span>
    <span class="strong"><strong>stopMenuItem.addActionListener(new ActionListener() {</strong></span>
        <span class="strong"><strong>public void actionPerformed(ActionEvent event) {</strong></span>
            <span class="strong"><strong>controller.stop();</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>});</strong></span>
    <span class="strong"><strong>JMenuItem exit = new JMenuItem("Quit");</strong></span>
    <span class="strong"><strong>exit.addActionListener(new ActionListener() {</strong></span>
        <span class="strong"><strong>public void actionPerformed(ActionEvent event) {</strong></span>
            <span class="strong"><strong>System.exit(0);</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>});</strong></span></pre><a id="part0019_pro_id00048"></a><pre class="programlisting">        <span class="strong"><strong>menu.add(exit);</strong></span>
        <span class="strong"><strong>menuBar.add(menu);</strong></span>
        <span class="strong"><strong>controlFrame.setJMenuBar(menuBar);</strong></span>

        <span class="strong"><strong>bpmTextField = new JTextField(2);</strong></span>
        <span class="strong"><strong>bpmLabel = new JLabel("Enter BPM:", SwingConstants.RIGHT);</strong></span>
        <span class="strong"><strong>setBPMButton = new JButton("Set");</strong></span>
        <span class="strong"><strong>setBPMButton.setSize(new Dimension(10,40));</strong></span>
        <span class="strong"><strong>increaseBPMButton = new JButton("&gt;&gt;");</strong></span>
        <span class="strong"><strong>decreaseBPMButton = new JButton("&lt;&lt;");</strong></span>
        <span class="strong"><strong>setBPMButton.addActionListener(this);</strong></span>
        <span class="strong"><strong>increaseBPMButton.addActionListener(this);</strong></span>
        <span class="strong"><strong>decreaseBPMButton.addActionListener(this);</strong></span>

        <span class="strong"><strong>JPanel buttonPanel = new JPanel(new GridLayout(1, 2));</strong></span>

        <span class="strong"><strong>buttonPanel.add(decreaseBPMButton);</strong></span>
        <span class="strong"><strong>buttonPanel.add(increaseBPMButton);</strong></span>

        <span class="strong"><strong>JPanel enterPanel = new JPanel(new GridLayout(1, 2));</strong></span>
        <span class="strong"><strong>enterPanel.add(bpmLabel);</strong></span>
        <span class="strong"><strong>enterPanel.add(bpmTextField);</strong></span>
        <span class="strong"><strong>JPanel insideControlPanel = new JPanel(new GridLayout(3, 1));</strong></span>
        <span class="strong"><strong>insideControlPanel.add(enterPanel);</strong></span>
        <span class="strong"><strong>insideControlPanel.add(setBPMButton);</strong></span>
        <span class="strong"><strong>insideControlPanel.add(buttonPanel);</strong></span>
        <span class="strong"><strong>controlPanel.add(insideControlPanel);</strong></span>

        <span class="strong"><strong>bpmLabel.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));</strong></span>
        <span class="strong"><strong>bpmOutputLabel.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));</strong></span>

        <span class="strong"><strong>controlFrame.getRootPane().setDefaultButton(setBPMButton);</strong></span>
        <span class="strong"><strong>controlFrame.getContentPane().add(controlPanel, BorderLayout.CENTER);</strong></span>

        <span class="strong"><strong>controlFrame.pack();</strong></span>
        <span class="strong"><strong>controlFrame.setVisible(true);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void enableStopMenuItem() {</strong></span>
        <span class="strong"><strong>stopMenuItem.setEnabled(true);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void disableStopMenuItem() {</strong></span>
        <span class="strong"><strong>stopMenuItem.setEnabled(false);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void enableStartMenuItem() {</strong></span>
        <span class="strong"><strong>startMenuItem.setEnabled(true);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void disableStartMenuItem() {</strong></span>
        <span class="strong"><strong>startMenuItem.setEnabled(false);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void actionPerformed(ActionEvent event) {</strong></span>
        <span class="strong"><strong>if (event.getSource() == setBPMButton) {</strong></span>
            <span class="strong"><strong>int bpm = Integer.parseInt(bpmTextField.getText());</strong></span>
            <span class="strong"><strong>controller.setBPM(bpm);</strong></span>
        <span class="strong"><strong>} else if (event.getSource() == increaseBPMButton) {</strong></span>
            <span class="strong"><strong>controller.increaseBPM();</strong></span>
        <span class="strong"><strong>} else if (event.getSource() == decreaseBPMButton) {</strong></span>
            <span class="strong"><strong>controller.decreaseBPM();</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void updateBPM() {</strong></span>
        <span class="strong"><strong>int bpm = model.getBPM();</strong></span>
        <span class="strong"><strong>if (bpm == 0) {</strong></span>
            <span class="strong"><strong>bpmOutputLabel.setText("offline");</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>bpmOutputLabel.setText("Current BPM: " + model.getBPM());</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void updateBeat() {</strong></span>
        <span class="strong"><strong>beatBar.setValue(100);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p><a class="indexterm" id="part0019_iddle1934"></a><span class="strong"><strong>The Controller</strong></span></p><a id="part0019_pro_id00049"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public interface ControllerInterface {</strong></span>
    <span class="strong"><strong>void start();</strong></span>
    <span class="strong"><strong>void stop();</strong></span>
    <span class="strong"><strong>void increaseBPM();</strong></span>
    <span class="strong"><strong>void decreaseBPM();</strong></span>
    <span class="strong"><strong>void setBPM(int bpm);</strong></span>
<span class="strong"><strong>}</strong></span></pre><a id="part0019_pro_id00050"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public class BeatController implements ControllerInterface {</strong></span>
    <span class="strong"><strong>BeatModelInterface model;</strong></span>
    <span class="strong"><strong>DJView view;</strong></span>

    <span class="strong"><strong>public BeatController(BeatModelInterface model) {</strong></span>
        <span class="strong"><strong>this.model = model;</strong></span>
        <span class="strong"><strong>view = new DJView(this, model);</strong></span>
        <span class="strong"><strong>view.createView();</strong></span>
        <span class="strong"><strong>view.createControls();</strong></span>
        <span class="strong"><strong>view.disableStopMenuItem();</strong></span>
        <span class="strong"><strong>view.enableStartMenuItem();</strong></span>
        <span class="strong"><strong>model.initialize();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void start() {</strong></span>
        <span class="strong"><strong>model.on();</strong></span>
        <span class="strong"><strong>view.disableStartMenuItem();</strong></span>
        <span class="strong"><strong>view.enableStopMenuItem();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void stop() {</strong></span>
        <span class="strong"><strong>model.off();</strong></span>
        <span class="strong"><strong>view.disableStopMenuItem();</strong></span>
        <span class="strong"><strong>view.enableStartMenuItem();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void increaseBPM() {</strong></span>
        <span class="strong"><strong>int bpm = model.getBPM();</strong></span>
        <span class="strong"><strong>model.setBPM(bpm + 1);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void decreaseBPM() {</strong></span>
        <span class="strong"><strong>int bpm = model.getBPM();</strong></span>
        <span class="strong"><strong>model.setBPM(bpm - 1);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void setBPM(int bpm) {</strong></span>
        <span class="strong"><strong>model.setBPM(bpm);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p><a class="indexterm" id="part0019_iddle1272"></a><a class="indexterm" id="part0019_iddle1946"></a><span class="strong"><strong>The Heart Model</strong></span></p><a id="part0019_pro_id00051"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public class HeartTestDrive {</strong></span>

    <span class="strong"><strong>public static void main (String[] args) {</strong></span>
        <span class="strong"><strong>HeartModel heartModel = new HeartModel();</strong></span>
        <span class="strong"><strong>ControllerInterface model = new HeartController(heartModel);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public interface HeartModelInterface {</strong></span>
    <span class="strong"><strong>int getHeartRate();</strong></span>
    <span class="strong"><strong>void registerObserver(BeatObserver o);</strong></span>
    <span class="strong"><strong>void removeObserver(BeatObserver o);</strong></span>
    <span class="strong"><strong>void registerObserver(BPMObserver o);</strong></span>
    <span class="strong"><strong>void removeObserver(BPMObserver o);</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>import java.util.*;</strong></span>

<span class="strong"><strong>public class HeartModel implements HeartModelInterface, Runnable {</strong></span>
    <span class="strong"><strong>ArrayList&lt;BeatObserver&gt; beatObservers = new ArrayList&lt;BeatObserver&gt;();</strong></span>
    <span class="strong"><strong>ArrayList&lt;BPMObserver&gt; bpmObservers = new ArrayList&lt;BPMObserver&gt;();</strong></span>
    <span class="strong"><strong>int time = 1000;</strong></span>
    <span class="strong"><strong>int bpm = 90;</strong></span>
    <span class="strong"><strong>Random random = new Random(System.currentTimeMillis());</strong></span>
    <span class="strong"><strong>Thread thread;</strong></span>

    <span class="strong"><strong>public HeartModel() {</strong></span>
        <span class="strong"><strong>thread = new Thread(this);</strong></span>
        <span class="strong"><strong>thread.start();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void run() {</strong></span>
        <span class="strong"><strong>int lastrate = -1;</strong></span>

        <span class="strong"><strong>for(;;) {</strong></span>
            <span class="strong"><strong>int change = random.nextInt(10);</strong></span>
            <span class="strong"><strong>if (random.nextInt(2) == 0) {</strong></span>
                <span class="strong"><strong>change = 0 - change;</strong></span>
            <span class="strong"><strong>}</strong></span>
            <span class="strong"><strong>int rate = 60000/(time + change);</strong></span>
            <span class="strong"><strong>if (rate &lt; 120 &amp;&amp; rate &gt; 50) {</strong></span>
                <span class="strong"><strong>time += change;</strong></span>
                <span class="strong"><strong>notifyBeatObservers();</strong></span>
                <span class="strong"><strong>if (rate != lastrate) {</strong></span>
                    <span class="strong"><strong>lastrate = rate;</strong></span>
                    <span class="strong"><strong>notifyBPMObservers();</strong></span>
                <span class="strong"><strong>}</strong></span>
            <span class="strong"><strong>}</strong></span>
            <span class="strong"><strong>try {</strong></span>
                <span class="strong"><strong>Thread.sleep(time);</strong></span>
            <span class="strong"><strong>} catch (Exception e) {}</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public int getHeartRate() {</strong></span>
        <span class="strong"><strong>return 60000/time;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void registerObserver(BeatObserver o) {</strong></span>
        <span class="strong"><strong>beatObservers.add(o);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void removeObserver(BeatObserver o) {</strong></span>
        <span class="strong"><strong>int i = beatObservers.indexOf(o);</strong></span>
            <span class="strong"><strong>if (i &gt;= 0) {</strong></span>
            <span class="strong"><strong>beatObservers.remove(i);</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void notifyBeatObservers() {</strong></span>
        <span class="strong"><strong>for(int i = 0; i &lt; beatObservers.size(); i++) {</strong></span>
            <span class="strong"><strong>BeatObserver observer = (BeatObserver)beatObservers.get(i);</strong></span>
            <span class="strong"><strong>observer.updateBeat();</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void registerObserver(BPMObserver o) {</strong></span>
        <span class="strong"><strong>bpmObservers.add(o);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void removeObserver(BPMObserver o) {</strong></span>
        <span class="strong"><strong>int i = bpmObservers.indexOf(o);</strong></span>
        <span class="strong"><strong>if (i &gt;= 0) {</strong></span>
            <span class="strong"><strong>bpmObservers.remove(i);</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void notifyBPMObservers() {</strong></span>
        <span class="strong"><strong>for(int i = 0; i &lt; bpmObservers.size(); i++) {</strong></span>
            <span class="strong"><strong>BPMObserver observer = (BPMObserver)bpmObservers.get(i);</strong></span>
            <span class="strong"><strong>observer.updateBPM();</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p><span class="strong"><strong>The Heart Adapter</strong></span></p><a id="part0019_pro_id00052"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public class HeartAdapter implements BeatModelInterface {</strong></span>
    <span class="strong"><strong>HeartModelInterface heart;</strong></span>

    <span class="strong"><strong>public HeartAdapter(HeartModelInterface heart) {</strong></span>
        <span class="strong"><strong>this.heart = heart;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void initialize() {}</strong></span>

    <span class="strong"><strong>public void on() {}</strong></span>

    <span class="strong"><strong>public void off() {}</strong></span>

    <span class="strong"><strong>public int getBPM() {</strong></span>
        <span class="strong"><strong>return heart.getHeartRate();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void setBPM(int bpm) {}</strong></span>

    <span class="strong"><strong>public void registerObserver(BeatObserver o) {</strong></span>
        <span class="strong"><strong>heart.registerObserver(o);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void removeObserver(BeatObserver o) {</strong></span>
        <span class="strong"><strong>heart.removeObserver(o);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void registerObserver(BPMObserver o) {</strong></span>
        <span class="strong"><strong>heart.registerObserver(o);</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void removeObserver(BPMObserver o) {</strong></span>
        <span class="strong"><strong>heart.removeObserver(o);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><p><a class="indexterm" id="part0019_iddle1270"></a><a class="indexterm" id="part0019_iddle1931"></a><span class="strong"><strong>The Controller</strong></span></p><a id="part0019_pro_id00053"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.combined.djview;</strong></span>

<span class="strong"><strong>public class HeartController implements ControllerInterface {</strong></span>
    <span class="strong"><strong>HeartModelInterface model;</strong></span>
    <span class="strong"><strong>DJView view;</strong></span>

    <span class="strong"><strong>public HeartController(HeartModelInterface model) {</strong></span>
        <span class="strong"><strong>this.model = model;</strong></span>
        <span class="strong"><strong>view = new DJView(this, new HeartAdapter(model));</strong></span>
        <span class="strong"><strong>view.createView();</strong></span>
        <span class="strong"><strong>view.createControls();</strong></span>
        <span class="strong"><strong>view.disableStopMenuItem();</strong></span>
        <span class="strong"><strong>view.disableStartMenuItem();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void start() {}</strong></span>

    <span class="strong"><strong>public void stop() {}</strong></span>

    <span class="strong"><strong>public void increaseBPM() {}</strong></span>

    <span class="strong"><strong>public void decreaseBPM() {}</strong></span>

    <span class="strong"><strong>public void setBPM(int bpm) {}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="footnotes" epub:type="footnotes"><br/><hr data-amznremoved-m8="true" style="width: 100; align: left;"/><div class="footnote" epub:type="footnote" id="part0019_ftn.ch12fn01"><p><sup>[<a class="para" href="#part0019_ch12fn01">2</a>] </sup><span class="strong"><strong>send us email for a copy.</strong></span></p></div></div></section></body><body><section class="chapter" epub:type="chapter" id="part0020_better_living_with_patterns_patterns_in"><div class="titlepage" id="part0020_aid-J2B82"><div><div><h2 class="title">Chapter 13. Better Living with Patterns: Patterns in the Real World</h2></div></div></div><div class="informalfigure"><a id="part0020_med_id00773a"></a><div class="mediaobject"><a id="part0020_med_id00773"></a><img alt="image with no caption" hisrc="figs/web/583fig01.png.jpg" src="../Images/image01274.jpeg"/></div></div><p><span class="strong"><strong>Ahhhh, now you’re ready for a bright new world filled with Design Patterns.</strong></span> But, before you go opening all those new doors of opportunity, we need to cover a few details that you’ll encounter out in the real world — that’s right, things get a little more complex than they are here in Objectville. Come along, we’ve got a nice guide to help you through the transition on the next page...</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_objectville_guide_to_better_living_with"></a><h3 class="title">The Objectville Guide to Better Living with Design Patterns</h3><div class="informalfigure"><a id="part0020_med_id00774a"></a><div class="mediaobject"><a id="part0020_med_id00774"></a><img alt="image with no caption" hisrc="figs/web/584fig01.png.jpg" src="../Images/image01275.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1384"></a><a class="indexterm" id="part0020_iddle1688"></a>Please accept our handy guide with tips &amp; tricks for living with patterns in the real world. In this guide you will:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00064"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Learn the all too common misconceptions about the definition of a “Design Pattern.”</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00065"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Discover those nifty Design Patterns catalogs and why you just have to get one.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00066"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Avoid the embarrassment of using a Design Pattern at the wrong time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00067"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Learn how to keep patterns in classifications where they belong.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00068"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>See that discovering patterns isn’t just for the gurus; read our quick How To and become a patterns writer too.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00069"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Be there when the true identity of the mysterious Gang of Four is revealed.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00070"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Keep up with the neighbors — the coffee table books any patterns user must own.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00071"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Learn to train your mind like a Zen master.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="part0020_inline_id00072"></a><img alt="" hisrc="figs/web/common16.png.jpg" src="../Images/image01276.jpeg"/></span></p></td><td style="vertical-align: top; "><p>Win friends and influence developers by improving your patterns vocabulary.</p></td></tr></tbody></table></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_design_pattern_defined" style="clear: both">Design Pattern defined</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1380"></a>We bet you’ve got a pretty good idea of what a pattern is after reading this book. But we’ve never really given a definition for a Design Pattern. Well, you might be a bit surprised by the definition that is in common use:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note01"></a>Note</h3><p><span class="strong"><strong>A Pattern</strong></span> is a solution to a problem in a context.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>That’s not the most revealing definition is it? But don’t worry, we’re going to step through each of these parts: context, problem and solution:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">The <span class="strong"><strong>context</strong></span> is the situation in which the pattern applies. This should be a recurring situation.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note02"></a>Note</h3><p>Example: You have a collection of objects.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none">The <span class="strong"><strong>problem</strong></span> refers to the goal you are trying to achieve in this context, but it also refers to any constraints that occur in the context.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note03"></a>Note</h3><p>You need to step through the objects without exposing the collection’s implementation.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li><li class="listitem" style="list-style-type: none">The <span class="strong"><strong>solution</strong></span> is what you’re after: a general design that anyone can apply which resolves the goal and set of constraints.<div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note04"></a>Note</h3><p>Encapsulate the iteration into a separate class.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></li></ul></div><p>This is one of those definitions that takes a while to sink in, but take it one step at a time. Here’s a little mnemonic you can repeat to yourself to remember it:</p><div class="blockquote"><blockquote class="blockquote"><div>“If you find yourself in a context with a problem that has a goal that is affected by a set of constraints, then you can apply a design that resolves the goal and constraints and leads to a solution.”</div></blockquote></div><p>Now, this seems like a lot of work just to figure out what a Design Pattern is. After all, you already know that a Design Pattern gives you a solution to a common recurring design problem. What is all this formality getting you? Well, you’re going to see that by having a formal way of describing patterns we can create a catalog of patterns, which has all kinds of benefits.</p><div class="informalfigure"><a id="part0020_med_id00775a"></a><div class="mediaobject"><a id="part0020_med_id00775"></a><img alt="image with no caption" hisrc="figs/web/586fig01.png.jpg" src="../Images/image01277.jpeg"/></div></div><p>You might be right; let’s think about this a bit... We need a <span class="emphasis"><em>problem</em></span>, a <span class="emphasis"><em>solution</em></span> and a <span class="emphasis"><em>context</em></span>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><span class="strong"><strong>Problem</strong></span>: How do I get to work on time?</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>Context</strong></span>: I’ve locked my keys in the car.</li><li class="listitem" style="list-style-type: none"><span class="strong"><strong>Solution</strong></span>: Break the window, get in the car, start the engine and drive to work.</li></ul></div><p>We have all the components of the definition: we have a problem, which includes the goal of getting to work, and the constraints of time, distance and probably some other factors. We also have a context in which the keys to the car are inaccessible. And we have a solution that gets us to the keys and resolves both the time and distance constraints. We must have a pattern now! Right?</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note05"></a>Brain Power</h3><p>We followed the Design Pattern definition and defined a problem, a context, and a solution (which works!). Is this a pattern? If not, how did it fail? Could we fail the same way when defining an OO Design Pattern?</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_looking_more_closely_at_the_design_patte" style="clear: both">Looking more closely at the Design Pattern definition</h2></div></div></div><p><a class="indexterm" id="part0020_iddle2097"></a>Our example does seem to match the Design Pattern definition, but it isn’t a true pattern. Why? For starters, we know that a pattern needs to apply to a recurring problem. While an absent-minded person might lock his keys in the car often, breaking the car window doesn’t qualify as a solution that can be applied over and over (or at least isn’t likely to if we balance the goal with another constraint: cost).</p><p>It also fails in a couple of other ways: first, it isn’t easy to take this description, hand it to someone and have him apply it to his own unique problem. Second, we’ve violated an important but simple aspect of a pattern: we haven’t even given it a name! Without a name, the pattern doesn’t become part of a vocabulary that can be shared with other developers.</p><p>Luckily, patterns are not described and documented as a simple problem, context and solution; we have much better ways of describing patterns and collecting them together into <span class="emphasis"><em>patterns catalogs</em></span>.</p><div class="informalfigure"><a id="part0020_med_id00776a"></a><div class="mediaobject"><a id="part0020_med_id00776"></a><img alt="image with no caption" hisrc="figs/web/587fig01.png.jpg" src="../Images/image01278.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_there_are_no_dumb_questions-id00187"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa1qe1"></a><a id="part0020_ch13qa1q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Am I going to see pattern descriptions that are stated as a problem, a context and a solution?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa1q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Pattern descriptions, which you’ll typically find in pattern catalogs, are usually a bit more revealing than that. We’re going to look at patterns catalogs in detail in just a minute; they describe a lot more about a pattern’s intent and motivation and where it might apply, along with the solution design and the consequences (good and bad) of using it.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa1qe2"></a><a id="part0020_ch13qa1q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Is it okay to slightly alter a pattern’s structure to fit my design? Or am I going to have to go by the strict definition?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa1q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Of course you can alter it. Like design principles, patterns are not meant to be laws or rules; they are guidelines that you can alter to fit your needs. As you’ve seen, a lot of real-world examples don’t fit the classic pattern designs.</div><div>However, when you adapt patterns, it never hurts to document how your pattern differs from the classic design — that way, other developers can quickly recognize the patterns you’re using and any differences between your pattern and the classic pattern.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa1qe3"></a><a id="part0020_ch13qa1q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Where can I get a patterns catalog?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa1q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> The first and most definitive patterns catalog is <span class="emphasis"><em>Design Patterns: Elements of Reusable Object-Oriented Software</em></span>, by Gamma, Helm, Johnson &amp; Vlissides (Addison Wesley). This catalog lays out 23 fundamental patterns. We’ll talk a little more about this book in a few pages.</div><div>Many other patterns catalogs are starting to be published in various domain areas such as enterprise software, concurrent systems and business systems.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note06"></a>Geek Bits</h3><p><a class="indexterm" id="part0020_iddle1679"></a><span class="strong"><strong>May the force be with you</strong></span></p><p>The Design Pattern definition tells us that the <span class="emphasis"><em>problem</em></span> consists of a <span class="emphasis"><em>goal</em></span> and a <span class="emphasis"><em>set of constraints</em></span>. Patterns gurus have a term for these: they call them <span class="underline">forces</span>. Why? Well, we’re sure they have their own reasons, but if you remember the movie, the force “shapes and controls the Universe.” Likewise, the forces in the pattern definition shape and control the solution. Only when a solution balances both sides of the force (the light side: your goal, and the dark side: the constraints) do we have a useful pattern.</p><p>This “force” terminology can be quite confusing when you first see it in pattern discussions, but just remember that there are two sides of the force (goals and constraints) and that they need to be balanced or resolved to create a pattern solution. Don’t let the lingo get in your way and may the force be with you!</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0020_med_id00777a"></a><div class="mediaobject"><a id="part0020_med_id00777"></a><img alt="image with no caption" hisrc="figs/web/589fig01.png.jpg" src="../Images/image01279.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1682"></a><a class="indexterm" id="part0020_iddle1684"></a><a class="indexterm" id="part0020_iddle2098"></a><span class="strong"><strong>Frank</strong></span>: Fill us in, Jim. I’ve just been learning patterns by reading a few articles here and there.</p><p><span class="strong"><strong>Jim</strong></span>: Sure, each patterns catalog takes a set of patterns and describes each in detail along with its relationship to the other patterns.</p><p><span class="strong"><strong>Joe</strong></span>: Are you saying there is more than one patterns catalog?</p><p><span class="strong"><strong>Jim</strong></span>: Of course; there are catalogs for fundamental Design Patterns and there are also catalogs on domain-specific patterns, like EJB patterns.</p><p><span class="strong"><strong>Frank</strong></span>: Which catalog are you looking at?</p><p><span class="strong"><strong>Jim</strong></span>: This is the classic GoF catalog; it contains 23 fundamental Design Patterns.</p><p><span class="strong"><strong>Frank</strong></span>: GoF?</p><p><span class="strong"><strong>Jim</strong></span>: Right, that stands for the Gang of Four. The Gang of Four are the guys that put together the first patterns catalog.</p><p><span class="strong"><strong>Joe</strong></span>: What’s in the catalog?</p><p><span class="strong"><strong>Jim</strong></span>: There is a set of related patterns. For each pattern there is a description that follows a template and spells out a lot of details of the pattern. For instance, each pattern has a <span class="emphasis"><em>name</em></span>.</p><p><span class="strong"><strong>Frank</strong></span>: Wow, that’s earth-shattering — a name! Imagine that.</p><p><span class="strong"><strong>Jim</strong></span>: Hold on, Frank; actually, the name is really important. When we have a name for a pattern, it gives us a way to talk about the pattern; you know, that whole shared vocabulary thing.</p><p><span class="strong"><strong>Frank</strong></span>: Okay, okay. I was just kidding. Go on, what else is there?</p><p><span class="strong"><strong>Jim</strong></span>: Well, like I was saying, every pattern follows a template. For each pattern we have a name and a few sections that tell us more about the pattern. For instance, there is an Intent section that describes what the pattern is, kind of like a definition. Then there are Motivation and Applicability sections that describe when and where the pattern might be used.</p><p><span class="strong"><strong>Joe</strong></span>: What about the design itself?</p><p><span class="strong"><strong>Jim</strong></span>: There are several sections that describe the class design along with all the classes that make it up and what their roles are. There is also a section that describes how to implement the pattern and often sample code to show you how.</p><p><span class="strong"><strong>Frank</strong></span>: It sounds like they’ve thought of everything.</p><p><span class="strong"><strong>Jim</strong></span>: There’s more. There are also examples of where the pattern has been used in real systems, as well as what I think is one of the most useful sections: how the pattern relates to other patterns.</p><p><span class="strong"><strong>Frank</strong></span>: Oh, you mean they tell you things like how state and strategy differ?</p><p><span class="strong"><strong>Jim</strong></span>: Exactly!</p><p><span class="strong"><strong>Joe</strong></span>: So Jim, how are you actually using the catalog? When you have a problem, do you go fishing in the catalog for a solution?</p><p><span class="strong"><strong>Jim</strong></span>: I try to get familiar with all the patterns and their relationships first. Then, when I need a pattern, I have some idea of what it is. I go back and look at the Motivation and Applicability sections to make sure I’ve got it right. There is also another really important section: Consequences. I review that to make sure there won’t be some unintended effect on my design.</p><p><span class="strong"><strong>Frank</strong></span>: That makes sense. So once you know the pattern is right, how do you approach working it into your design and implementing it?</p><p><span class="strong"><strong>Jim</strong></span>: That’s where the class diagram comes in. I first read over the Structure section to review the diagram and then over the Participants section to make sure I understand each class’s role. From there, I work it into my design, making any alterations I need to make it fit. Then I review the Implementation and Sample code sections to make sure I know about any good implementation techniques or gotchas I might encounter.</p><p><span class="strong"><strong>Joe</strong></span>: I can see how a catalog is really going to accelerate my use of patterns!</p><p><span class="strong"><strong>Frank</strong></span>: Totally. Jim, can you walk us through a pattern description?</p><div class="informalfigure"><a id="part0020_med_id00778a"></a><div class="mediaobject"><a id="part0020_med_id00778"></a><img alt="image with no caption" hisrc="figs/web/591fig01.png.jpg" src="../Images/image01280.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_there_are_no_dumb_questions-id00188"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa2qe1"></a><a id="part0020_ch13qa2q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><a class="indexterm" id="part0020_iddle1059"></a><a class="indexterm" id="part0020_iddle1134"></a><a class="indexterm" id="part0020_iddle1147"></a><a class="indexterm" id="part0020_iddle1300"></a><a class="indexterm" id="part0020_iddle1775"></a><a class="indexterm" id="part0020_iddle1796"></a><a class="indexterm" id="part0020_iddle1876"></a><a class="indexterm" id="part0020_iddle1950"></a><a class="indexterm" id="part0020_iddle1963"></a><a class="indexterm" id="part0020_iddle2095"></a><a class="indexterm" id="part0020_iddle2211"></a><a class="indexterm" id="part0020_iddle2252"></a><a class="indexterm" id="part0020_iddle2426"></a><a class="indexterm" id="part0020_iddle1381"></a><span class="strong"><strong>Q: Is it possible to create your own Design Patterns? Or is that something you have to be a “patterns guru” to do?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa2q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> First, remember that patterns are discovered, not created. So, anyone can discover a Design Pattern and then author its description; however, it’s not easy and doesn’t happen quickly, nor often. Being a “patterns writer” takes commitment.</div><div>You should first think about why you’d want to — the majority of people don’t author patterns; they just use them. However, you might work in a specialized domain for which you think new patterns would be helpful, or you might have come across a solution to what you think is a recurring problem, or you may just want to get involved in the patterns community and contribute to the growing body of work.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa2qe2"></a><a id="part0020_ch13qa2q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: I’m game; how do I get started?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa2q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> As with any discipline, the more you know the better. Studying existing patterns, what they do, and how they relate to other patterns is crucial. Not only does it make you familiar with how patterns are crafted, it also prevents you from reinventing the wheel. From there you’ll want to start writing your patterns on paper, so you can communicate them to other developers; we’re going to talk more about how to communicate your patterns in a bit. If you’re really interested, you’ll want to read the section that follows these Q&amp;As.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa2qe3"></a><a id="part0020_ch13qa2q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: How do I know when I really have a pattern?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa2q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> That’s a very good question: you don’t have a pattern until others have used it and found it to work. In general, you don’t have a pattern until it passes the “Rule of Three.” This rule states that a pattern can be called a pattern only if it has been applied in a real-world solution at least three times.</div></td></tr></tbody></table></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>So you wanna be a design patterns star?</strong></span></div><div><span class="strong"><strong>Well, listen now to what I tell.</strong></span></div><div><span class="strong"><strong>Get yourself a patterns catalog,</strong></span></div><div><span class="strong"><strong>Then take some time and learn it well.</strong></span></div><div><span class="strong"><strong>And when you’ve got your description right,</strong></span></div><div><span class="strong"><strong>And three developers agree without a fight,</strong></span></div><div><span class="strong"><strong>Then you’ll know it’s a pattern alright.</strong></span></div></blockquote></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note07"></a>Note</h3><p>To the tune of “So you wanna be a Rock’n Roll Star.”</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_so_you_wanna_be_a_design_patterns_writer" style="clear: both">So you wanna be a Design Patterns writer</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1373"></a><a class="indexterm" id="part0020_iddle1391"></a><a class="indexterm" id="part0020_iddle2113"></a><a class="indexterm" id="part0020_iddle2250"></a><span class="strong"><strong>Do your homework.</strong></span> You need to be well versed in the existing patterns before you can create a new one. Most patterns that appear to be new, are, in fact, just variants of existing patterns. By studying patterns, you become better at recognizing them, and you learn to relate them to other patterns.</p><p><span class="strong"><strong>Take time to reflect, evaluate.</strong></span> Your experience — the problems you’ve encountered, and the solutions you’ve used — are where ideas for patterns are born. So take some time to reflect on your experiences and comb them for novel designs that recur. Remember that most designs are variations on existing patterns and not new patterns. And when you do find what looks like a new pattern, its applicability may be too narrow to qualify as a real pattern.</p><p><span class="strong"><strong>Get your ideas down on paper in a way others can understand.</strong></span> Locating new patterns isn’t of much use if others can’t make use of your find; you need to document your pattern candidates so that others can read, understand, and apply them to their own solution and then supply you with feedback. Luckily, you don’t need to invent your own method of documenting your patterns. As you’ve already seen with the GoF template, a lot of thought has already gone into how to describe patterns and their characteristics.</p><p><span class="strong"><strong>Have others try your patterns; then refine and refine some more.</strong></span> Don’t expect to get your pattern right the first time. Think of your pattern as a work in progress that will improve over time. Have other developers review your candidate pattern, try it out, and give you feedback. Incorporate that feedback into your description and try again. Your description will never be perfect, but at some point it should be solid enough that other developers can read and understand it.</p><p><span class="strong"><strong>Don’t forget the Rule of Three.</strong></span> Remember, unless your pattern has been successfully applied in three real-world solutions, it can’t qualify as a pattern. That’s another good reason to get your pattern into the hands of others so they can try it, give feedback, and allow you to converge on a working pattern.</p><div class="informalfigure"><a id="part0020_med_id00779a"></a><div class="mediaobject"><a id="part0020_med_id00779"></a><img alt="image with no caption" hisrc="figs/web/593fig01.png.jpg" src="../Images/image01281.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_who_does_whatquestion_mark-id00189"></a><h3 class="title">Who Does What?</h3><p><a class="indexterm" id="part0020_iddle1010"></a><a class="indexterm" id="part0020_iddle1026"></a><a class="indexterm" id="part0020_iddle1187"></a><a class="indexterm" id="part0020_iddle1236"></a><a class="indexterm" id="part0020_iddle1348"></a><a class="indexterm" id="part0020_iddle1588"></a><a class="indexterm" id="part0020_iddle1610"></a><a class="indexterm" id="part0020_iddle1631"></a><a class="indexterm" id="part0020_iddle1643"></a><a class="indexterm" id="part0020_iddle1661"></a><a class="indexterm" id="part0020_iddle1819"></a><a class="indexterm" id="part0020_iddle2032"></a><a class="indexterm" id="part0020_iddle2163"></a><a class="indexterm" id="part0020_iddle2341"></a><a class="indexterm" id="part0020_iddle2375"></a><a class="indexterm" id="part0020_iddle2414"></a><a class="indexterm" id="part0020_iddle2464"></a><a class="indexterm" id="part0020_iddle2525"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="part0020_med_id00780a"></a><div class="mediaobject"><a id="part0020_med_id00780"></a><img alt="image with no caption" hisrc="figs/web/594fig01.png.jpg" src="../Images/image01282.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_organizing_design_patterns" style="clear: both">Organizing Design Patterns</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1388"></a><a class="indexterm" id="part0020_iddle1551"></a><a class="indexterm" id="part0020_iddle2295"></a><a class="indexterm" id="part0020_iddle2296"></a>As the number of discovered Design Patterns grows, it makes sense to partition them into classifications so that we can organize them, narrow our searches to a subset of all Design Patterns, and make comparisons within a group of patterns.</p><p>In most catalogs, you’ll find patterns grouped into one of a few classification schemes. The most well-known scheme was used by the first patterns catalog and partitions patterns into three distinct categories based on their purposes: Creational, Behavioral, and Structural.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_sharpen_your_pencil-id00190"></a><h3 class="title">Sharpen your pencil</h3><div class="informalfigure"><a id="part0020_med_id00781a"></a><div class="mediaobject"><a id="part0020_med_id00781"></a><img alt="image with no caption" hisrc="figs/web/595fig01.png.jpg" src="../Images/image01283.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_pattern_categories" style="clear: both">Pattern Categories</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1070"></a><a class="indexterm" id="part0020_iddle1335"></a><a class="indexterm" id="part0020_iddle1374"></a><a class="indexterm" id="part0020_iddle1376"></a><a class="indexterm" id="part0020_iddle1378"></a><a class="indexterm" id="part0020_iddle1392"></a><a class="indexterm" id="part0020_iddle2424"></a><span class="strong"><strong>Sharpen your pencil Solution</strong></span></p><p>Here’s the grouping of patterns into categories. You probably found the exercise difficult, because many of the patterns seem like they could fit into more than one category. Don’t worry, everyone has trouble figuring out the right categories for the patterns.</p><div class="informalfigure"><a id="part0020_med_id00783a"></a><div class="mediaobject"><a id="part0020_med_id00783"></a><img alt="image with no caption" hisrc="figs/web/596fig01.png.jpg" src="../Images/image01284.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1136"></a><a class="indexterm" id="part0020_iddle1353"></a><a class="indexterm" id="part0020_iddle1377"></a><a class="indexterm" id="part0020_iddle1387"></a><a class="indexterm" id="part0020_iddle2017"></a>Patterns are often classified by a second attribute: whether or not the pattern deals with classes or objects:</p><div class="informalfigure"><a id="part0020_med_id00784a"></a><div class="mediaobject"><a id="part0020_med_id00784"></a><img alt="image with no caption" hisrc="figs/web/597fig01.png.jpg" src="../Images/image01285.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_there_are_no_dumb_questions-id00191"></a><h3 class="title">There Are No Dumb Questions</h3><div class="blockquote"><blockquote class="blockquote"><div class="qandaset"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "/><col/></colgroup><tbody><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa3qe1"></a><a id="part0020_ch13qa3q1"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Are these the only classification schemes?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa3q1a1"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> No, other schemes have been proposed. Some other schemes start with the three categories and then add subcategories, like “Decoupling Patterns.” You’ll want to be familiar with the most common schemes for organizing patterns, but also feel free to create your own, if it helps you to understand the patterns better.</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa3qe2"></a><a id="part0020_ch13qa3q2"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Does organizing patterns into categories really help you remember them?</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa3q2a2"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> It certainly gives you a framework for the sake of comparison. But many people are confused by the creational, structural and behavioral categories; often a pattern seems to fit into more than one category. The most important thing is to know the patterns and the relationships among them. When categories help, use them!</div></td></tr><tr class="question"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa3qe3"></a><a id="part0020_ch13qa3q3"></a><div><strong>Q:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>Q: Why is the Decorator Pattern in the structural category? I would have thought of that as a behavioral pattern; after all, it adds behavior!</strong></span></div></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="part0020_ch13qa3q3a3"></a><div><strong>A:</strong></div></td><td style="text-align: left; vertical-align: top; "><div><span class="strong"><strong>A:</strong></span> Yes, lots of developers say that! Here’s the thinking behind the Gang of Four classification: structural patterns describe how classes and objects are composed to create new structures or new functionality. The Decorator Pattern allows you to compose objects by wrapping one object with another to provide new functionality. So the focus is on how you compose the objects dynamically to gain functionality, rather than on the communication and interconnection between objects, which is the purpose of behavioral patterns. But remember, the intent of these patterns is different, and that’s often the key to understanding which category a pattern belongs to.</div></td></tr></tbody></table></div></blockquote></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_master_and_studenthellip-id00192"></a><h3 class="title">Master and Student...</h3><p><a class="indexterm" id="part0020_iddle1071"></a><a class="indexterm" id="part0020_iddle1336"></a><a class="indexterm" id="part0020_iddle1375"></a><a class="indexterm" id="part0020_iddle1379"></a><a class="indexterm" id="part0020_iddle1393"></a><a class="indexterm" id="part0020_iddle2425"></a><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, you look troubled.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Yes, I’ve just learned about pattern classification and I’m confused.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, continue...</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>After learning much about patterns, I’ve just been told that each pattern fits into one of three classifications: structural, behavioral, or creational. Why do we need these classifications?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, whenever we have a large collection of anything, we naturally find categories to fit those things into. It helps us to think of the items at a more abstract level.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master; can you give me an example?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Of course. Take automobiles; there are many different models of automobiles and we naturally put them into categories like economy cars, sports cars, SUVs, trucks, and luxury car categories.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, you look shocked; does this not make sense?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Master, it makes a lot of sense, but I am shocked you know so much about cars!</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, I can’t relate</em></span> <span class="bolditalic">everything</span> <span class="emphasis"><em>to lotus flowers or rice bowls. Now, may I continue?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Yes, yes, I’m sorry, please continue.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Once you have classifications or categories you can easily talk about the different groupings: “If you’re doing the mountain drive from Silicon Valley to Santa Cruz, a sports car with good handling is the best option.” Or, “With the worsening oil situation, you really want to buy a economy car; they’re more fuel-efficient.”</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>So by having categories we can talk about a set of patterns as a group. We might know we need a creational pattern, without knowing exactly which one, but we can still talk about creational patterns.</em></span></p><p><span class="bolditalic">Master</span><span class="emphasis"><em>: Yes, and it also gives us a way to compare a member to the rest of the category. For example, “the Mini really is the most stylish compact car around,” or to narrow our search, “I need a fuel-efficient car.”</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>I see. So I might say that the Adapter Pattern is the best structural pattern for changing an object’s interface.</em></span></p><p><span class="bolditalic">Master</span>: <span class="emphasis"><em>Yes. We also can use categories for one more purpose: to launch into new territory. For instance, “we really want to deliver a sports car with Ferrari performance at Miata prices.”</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>That sounds like a death trap.</em></span></p><p><span class="bolditalic">Master</span>: <span class="emphasis"><em>I’m sorry, I did not hear you Grasshopper.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Uh, I said “I see that.”</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>So categories give us a way to think about the way groups of patterns relate and how patterns within a group relate to one another. They also give us a way to extrapolate to new patterns. But why are there three categories and not four, or five?</em></span></p><p><span class="bolditalic">Master</span>: <span class="emphasis"><em>Ah, like stars in the night sky, there are as many categories as you want to see. Three is a convenient number and a number that many people have decided makes for a nice grouping of patterns. But others have suggested four, five or more.</em></span></p><div class="informalfigure"><a id="part0020_med_id00785a"></a><div class="mediaobject"><a id="part0020_med_id00785"></a><img alt="image with no caption" hisrc="figs/web/599fig01.png.jpg" src="../Images/image01286.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_thinking_in_patterns" style="clear: both">Thinking in Patterns</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1394"></a><a class="indexterm" id="part0020_iddle1875"></a><a class="indexterm" id="part0020_iddle1896"></a><a class="indexterm" id="part0020_iddle2475"></a>Contexts, constraints, forces, catalogs, classifications... boy, this is starting to sound mighty academic. Okay, all that stuff is important and knowledge is power. But, let’s face it, if you understand the academic stuff and don’t have the <span class="emphasis"><em>experience</em></span> and practice using patterns, then it’s not going to make much difference in your life.</p><p>Here’s a quick guide to help you start to <span class="emphasis"><em>think in patterns.</em></span> What do we mean by that? We mean being able to look at a design and see where patterns naturally fit and where they don’t.</p><div class="informalfigure"><a id="part0020_med_id00786a"></a><div class="mediaobject"><a id="part0020_med_id00786"></a><img alt="image with no caption" hisrc="figs/web/600fig01.png.jpg" src="../Images/image01287.jpeg"/></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0020_keep_it_simple_left_parenthesiskissright">Keep it simple (KISS)</h3></div></div></div><p>First of all, when you design, solve things in the simplest way possible. Your goal should be simplicity, not “how can I apply a pattern to this problem?” Don’t feel like you aren’t a sophisticated developer if you don’t use a pattern to solve a problem. Other developers will appreciate and admire the simplicity of your design. That said, sometimes the best way to keep your design simple and flexible is to use a pattern.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0020_design_patterns_arenapostrophet_a_magic">Design Patterns aren’t a magic bullet; in fact, they’re not even a bullet!</h3></div></div></div><p>Patterns, as you know, are general solutions to recurring problems. Patterns also have the benefit of being well tested by lots of developers. So, when you see a need for one, you can sleep well knowing many developers have been there before and solved the problem using similar techniques.</p><p>However, patterns aren’t a magic bullet. You can’t plug one in, compile and then take an early lunch. To use patterns, you also need to think through the consequences for the rest of your design.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0020_you_know_you_need_a_pattern_whenhellip">You know you need a pattern when...</h3></div></div></div><p>Ah... the most important question: when do you use a pattern? As you approach your design, introduce a pattern when you’re sure it addresses a problem in your design. If a simpler solution might work, give that consideration before you commit to using a pattern.</p><p><span class="emphasis"><em>Knowing</em></span> when a pattern applies is where your experience and knowledge come in. Once you’re sure a simple solution will not meet your needs, you should consider the problem along with the set of constraints under which the solution will need to operate — these will help you match your problem to a pattern. If you’ve got a good knowledge of patterns, you may know of a pattern that is a good match. Otherwise, survey patterns that look like they might solve the problem. The intent and applicability sections of the patterns catalogs are particularly useful for this. Once you’ve found a pattern that appears to be a good match, make sure it has a set of consequences you can live with and study its effect on the rest of your design. If everything looks good, go for it!</p><p><a class="indexterm" id="part0020_iddle2210"></a>There is one situation in which you’ll want to use a pattern even if a simpler solution would work: when you expect aspects of your system to vary. As we’ve seen, identifying areas of change in your design is usually a good sign that a pattern is needed. Just make sure you are adding patterns to deal with <span class="emphasis"><em>practical change</em></span> that is likely to happen, not <span class="emphasis"><em>hypothetical change</em></span> that may happen.</p><p>Design time isn’t the only time you want to consider introducing patterns; you’ll also want to do so at refactoring time.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0020_refactoring_time_is_patterns_timeexclama">Refactoring time is Patterns time!</h3></div></div></div><p>Refactoring is the process of making changes to your code to improve the way it is organized. The goal is to improve its structure, not change its behavior. This is a great time to reexamine your design to see if it might be better structured with patterns. For instance, code that is full of conditional statements might signal the need for the State Pattern. Or, it may be time to clean up concrete dependencies with a Factory. Entire books have been written on the topic of refactoring with patterns, and as your skills grow, you’ll want to study this area more.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0020_take_out_what_you_donapostrophet_really">Take out what you don’t really need. Don’t be afraid to remove a Design Pattern from your design.</h3></div></div></div><p>No one ever talks about when to remove a pattern. You’d think it was blasphemy! Nah, we’re all adults here; we can take it.</p><p>So when do you remove a pattern? When your system has become complex and the flexibility you planned for isn’t needed. In other words, when a simpler solution without the pattern would be better.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="part0020_if_you_donapostrophet_need_it_nowcomma_d">If you don’t need it now, don’t do it now.</h3></div></div></div><p>Design Patterns are powerful, and it’s easy to see all kinds of ways they can be used in your current designs. Developers naturally love to create beautiful architectures that are ready to take on change from any direction.</p><p>Resist the temptation. If you have a practical need to support change in a design today, go ahead and employ a pattern to handle that change. However, if the reason is only hypothetical, don’t add the pattern; it is only going to add complexity to your system, and you might never need it!</p><div class="informalfigure"><a id="part0020_med_id00787a"></a><div class="mediaobject"><a id="part0020_med_id00787"></a><img alt="image with no caption" hisrc="figs/web/601fig01.png.jpg" src="../Images/image01288.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_master_and_studenthellip-id00193"></a><h3 class="title">Master and Student...</h3><div class="informalfigure"><a id="part0020_med_id00788a"></a><div class="mediaobject"><a id="part0020_med_id00788"></a><img alt="image with no caption" hisrc="figs/web/602fig01.png.jpg" src="../Images/image01289.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1396"></a><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, your initial training is almost complete. What are your plans?</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>I’m going to Disneyland! And, then I’m going to start creating lots of code with patterns!</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Whoa, hold on. Never use your big guns unless you have to.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>What do you mean, Master? Now that I’ve learned design patterns shouldn’t I be using them in all my designs to achieve maximum power, flexibility and manageability?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>No; patterns are a tool, and a tool that should only be used when needed. You’ve also spent a lot of time learning design principles. Always start from your principles and create the simplest code you can that does the job. However, if you see the need for a pattern emerge, then use it.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>So I shouldn’t build my designs from patterns?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>That should not be your goal when beginning a design. Let patterns emerge naturally as your design progresses.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>If patterns are so great, why should I be so careful about using them?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Patterns can introduce complexity, and we never want complexity where it is not needed. But patterns are powerful when used where they are needed. As you already know, patterns are proven design experience that can be used to avoid common mistakes. They’re also a shared vocabulary for communicating our design to others.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Well, when do we know it’s okay to introduce design patterns?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Introduce a pattern when you are sure it’s necessary to solve a problem in your design, or when you are quite sure that it is needed to deal with a future change in the requirements of your application.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>I guess my learning is going to continue even though I already understand a lot of patterns.</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Yes, grasshopper; learning to manage the complexity and change in software is a life-long pursuit. But now that you know a good set of patterns, the time has come to apply them where needed in your design and to continue learning more patterns.</em></span></p><p><span class="bolditalic">Student:</span> <span class="emphasis"><em>Wait a minute, you mean I don’t know them ALL?</em></span></p><p><span class="bolditalic">Master:</span> <span class="emphasis"><em>Grasshopper, you’ve learned the fundamental patterns; you’re going to find there are many more, including patterns that just apply to particular domains such as concurrent systems and enterprise systems. But now that you know the basics, you’re in good shape to learn them.</em></span></p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_your_mind_on_patterns" style="clear: both">Your Mind on Patterns</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1398"></a><a class="indexterm" id="part0020_iddle2535"></a><span class="strong"><strong>The Beginner uses patterns everywhere.</strong></span> This is good: the beginner gets lots of experience with and practice using patterns. The beginner also thinks, “The more patterns I use, the better the design.” The beginner will learn this is not so, that all designs should be as simple as possible. Complexity and patterns should only be used where they are needed for practical extensibility.</p><div class="informalfigure"><a id="part0020_med_id00789a"></a><div class="mediaobject"><a id="part0020_med_id00789"></a><img alt="image with no caption" hisrc="figs/web/603fig01.png.jpg" src="../Images/image01290.jpeg"/><div class="caption"><p>“I need a pattern for Hello World.”</p></div></div></div><p><span class="strong"><strong>As learning progresses, the Intermediate mind starts to see where patterns are needed and where they aren’t.</strong></span> The intermediate mind still tries to fit too many square patterns into round holes, but also begins to see that patterns can be adapted to fit situations where the canonical pattern doesn’t fit.</p><div class="informalfigure"><a id="part0020_med_id00790a"></a><div class="mediaobject"><a id="part0020_med_id00790"></a><img alt="image with no caption" hisrc="figs/web/603fig02.png.jpg" src="../Images/image01291.jpeg"/><div class="caption"><p>“Maybe I need a Singleton here.”</p></div></div></div><p><span class="strong"><strong>The Zen mind is able to see patterns where they fit naturally.</strong></span> The Zen mind is not obsessed with using patterns; rather it looks for simple solutions that best solve the problem. The Zen mind thinks in terms of the object principles and their trade-offs. When a need for a pattern naturally arises, the Zen mind applies it knowing well that it may require adaptation. The Zen mind also sees relationships to similar patterns and understands the subtleties of differences in the intent of related patterns. <span class="emphasis"><em>The Zen mind is also a Beginner mind</em></span> — it doesn’t let all that pattern knowledge overly influence design decisions.</p><div class="informalfigure"><a id="part0020_med_id00791a"></a><div class="mediaobject"><a id="part0020_med_id00791"></a><img alt="image with no caption" hisrc="figs/web/603fig03.png.jpg" src="../Images/image01292.jpeg"/><div class="caption"><p>“This is a natural place for Decorator.”</p></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note08"></a>Note</h3><p><a class="indexterm" id="part0020_iddle1389"></a><a class="indexterm" id="part0020_iddle1397"></a><a class="indexterm" id="part0020_iddle2092"></a>WARNING: Overuse of design patterns can lead to code that is downright over-engineered. Always go with the simplest solution that does the job and introduce patterns where the need emerges.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0020_med_id00792a"></a><div class="mediaobject"><a id="part0020_med_id00792"></a><img alt="image with no caption" hisrc="figs/web/604fig01.png.jpg" src="../Images/image01293.jpeg"/></div></div><p><span class="strong"><strong>Of course we want you to use Design Patterns!</strong></span></p><p>But we want you to be a good OO designer even more.</p><p>When a design solution calls for a pattern, you get the benefits of using a solution that has been time-tested by lots of developers. You’re also using a solution that is well documented and that other developers are going to recognize (you know, that whole shared vocabulary thing).</p><p>However, when you use Design Patterns, there can also be a downside. Design Patterns often introduce additional classes and objects, and so they can increase the complexity of your designs. Design Patterns can also add more layers to your design, which adds not only complexity, but also inefficiency.</p><p>Also, using a Design Pattern can sometimes be outright overkill. Many times you can fall back on your design principles and find a much simpler solution to solve the same problem. If that happens, don’t fight it. Use the simpler solution.</p><p>Don’t let us discourage you, though. When a Design Pattern is the right tool for the job, the advantages are many.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_donapostrophet_forget_the_power_of_the_s" style="clear: both">Don’t forget the power of the shared vocabulary</h2></div></div></div><p><a class="indexterm" id="part0020_iddle2261"></a>We’ve spent so much time in this book discussing OO nuts and bolts that it’s easy to forget the human side of Design Patterns — they don’t just help load your brain with solutions, they also give you a shared vocabulary with other developers. Don’t underestimate the power of a shared vocabulary, it’s one of the <span class="emphasis"><em>biggest benefits</em></span> of Design Patterns.</p><p>Just think, something has changed since the last time we talked about shared vocabularies; you’ve now started to build up quite a vocabulary of your own! Not to mention, you have also learned a full set of OO design principles from which you can easily understand the motivation and workings of any new patterns you encounter.</p><p>Now that you’ve got the Design Pattern basics down, it’s time for you to go out and spread the word to others. Why? Because when your fellow developers know patterns and use a shared vocabulary as well, it leads to better designs, better communication, and, best of all, it’ll save you a lot of time that you can spend on cooler things.</p><div class="informalfigure"><a id="part0020_med_id00793a"></a><div class="mediaobject"><a id="part0020_med_id00793"></a><img alt="image with no caption" hisrc="figs/web/605fig01.png.jpg" src="../Images/image01294.jpeg"/></div></div><p><span class="strong"><strong>Top five ways to share your vocabulary</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="strong"><strong>In design meetings:</strong></span> When you meet with your team to discuss a software design, use design patterns to help stay “in the design” longer. Discussing designs from the perspective of Design Patterns and OO principles keeps your team from getting bogged down in implementation details and prevent many misunderstandings.</li><li class="listitem"><span class="strong"><strong>With other developers:</strong></span> Use patterns in your discussions with other developers. This helps other developers learn about new patterns and builds a community. The best part about sharing what you’ve learned is that great feeling when someone else “gets it”!</li><li class="listitem"><span class="strong"><strong>In architecture documentation:</strong></span> When you write architectural documentation, using patterns will reduce the amount of documentation you need to write and gives the reader a clearer picture of the design.</li><li class="listitem"><span class="strong"><strong>In code comments and naming conventions:</strong></span> When you’re writing code, clearly identify the patterns you’re using in comments. Also, choose class and method names that reveal any patterns underneath. Other developers who have to read your code will thank you for allowing them to quickly understand your implementation.</li><li class="listitem"><span class="strong"><strong>To groups of interested developers:</strong></span> Share your knowledge. Many developers have heard about patterns but don’t have a good understanding of what they are. Volunteer to give a brown-bag lunch on patterns or a talk at your local user group.<div class="informalfigure"><a id="part0020_med_id00794a"></a><div class="mediaobject"><a id="part0020_med_id00794"></a><img alt="image with no caption" hisrc="figs/web/606fig01.png.jpg" src="../Images/image01295.jpeg"/></div></div></li></ol></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_cruisinapostrophe_objectville_with_the_g" style="clear: both">Cruisin’ Objectville with the Gang of Four</h2></div></div></div><div class="informalfigure"><a id="part0020_med_id00795a"></a><div class="mediaobject"><a id="part0020_med_id00795"></a><img alt="image with no caption" hisrc="figs/web/607fig01.png.jpg" src="../Images/image01296.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1681"></a><a class="indexterm" id="part0020_iddle1683"></a><a class="indexterm" id="part0020_iddle1728"></a><a class="indexterm" id="part0020_iddle1873"></a><a class="indexterm" id="part0020_iddle2504"></a>You won’t find the Jets or Sharks hanging around Objectville, but you will find the Gang of Four. As you’ve probably noticed, you can’t get far in the World of Patterns without running into them. So, who is this mysterious gang?</p><p>Put simply, “the GoF,” which includes Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides, is the group of guys who put together the first patterns catalog and in the process, started an entire movement in the software field!</p><p>How did they get that name? No one knows for sure; it’s just a name that stuck. But think about it: if you’re going to have a “gang element” running around Objectville, could you think of a nicer bunch of guys? In fact, they’ve even agreed to pay us a visit...</p><div class="informalfigure"><a id="part0020_med_id00796a"></a><div class="mediaobject"><a id="part0020_med_id00796"></a><img alt="image with no caption" hisrc="figs/web/607fig02.png.jpg" src="../Images/image01297.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_your_journey_has_just_begunhellip" style="clear: both">Your journey has just begun...</h2></div></div></div><p><a class="indexterm" id="part0020_iddle1043"></a><a class="indexterm" id="part0020_iddle1044"></a><a class="indexterm" id="part0020_iddle1390"></a><a class="indexterm" id="part0020_iddle1399"></a><a class="indexterm" id="part0020_iddle2100"></a><a class="indexterm" id="part0020_iddle2236"></a><a class="indexterm" id="part0020_iddle2477"></a>Now that you’re on top of Design Patterns and ready to dig deeper, we’ve got three definitive texts that you need to add to your bookshelf...</p><p><span class="strong"><strong>The definitive Design Patterns text</strong></span></p><p>This is the book that kicked off the entire field of Design Patterns when it was released in 1995. You’ll find all the fundamental patterns here. In fact, this book is the basis for the set of patterns we used in <span class="emphasis"><em>Head First Design Patterns</em></span>.</p><p>You won’t find this book to be the last word on Design Patterns — the field has grown substantially since its publication — but it is the first and most definitive.</p><p>Picking up a copy of <span class="emphasis"><em>Design Patterns</em></span> is a great way to start exploring patterns after Head First.</p><div class="informalfigure"><a id="part0020_med_id00797a"></a><div class="mediaobject"><a id="part0020_med_id00797"></a><img alt="image with no caption" hisrc="figs/web/608fig01.png.jpg" src="../Images/image01298.jpeg"/></div></div><p><span class="strong"><strong>The definitive Patterns texts</strong></span></p><p>Patterns didn’t start with the GoF; they started with Christopher Alexander, a professor of architecture at Berkeley — that’s right, Alexander is an <span class="emphasis"><em>architect</em></span>, not a computer scientist. Alexander invented patterns for building living architectures (like houses, towns and cities).</p><p>The next time you’re in the mood for some deep, engaging reading, pick up <span class="emphasis"><em>The Timeless Way of Building</em></span> and <span class="emphasis"><em>A Pattern Language</em></span>. You’ll see the true beginnings of Design Patterns and recognize the direct analogies between creating “living architecture” and flexible, extensible software.</p><p>So grab a cup of Starbuzz Coffee, sit back, and enjoy...</p><div class="informalfigure"><a id="part0020_med_id00798a"></a><div class="mediaobject"><a id="part0020_med_id00798"></a><img alt="image with no caption" hisrc="figs/web/608fig02.png.jpg" src="../Images/image01299.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1015"></a><a class="indexterm" id="part0020_iddle1340"></a><a class="indexterm" id="part0020_iddle1730"></a><a class="indexterm" id="part0020_iddle2016"></a><a class="indexterm" id="part0020_iddle2087"></a><a class="indexterm" id="part0020_iddle2101"></a><a class="indexterm" id="part0020_iddle2132"></a><span class="strong"><strong>Other Design Patterns resources</strong></span></p><p>You’re going to find there is a vibrant, friendly community of patterns users and writers out there and they’re glad to have you join them. Here are a few resources to get you started...</p><p><span class="strong"><strong><span class="gray-background">Websites</span></strong></span></p><p><span class="strong"><strong>The Portland Patterns Repository</strong></span>, run by Ward Cunningham, is a wiki devoted to all things related to patterns. Anyone can participate. You’ll find threads of discussion on every topic you can think of related to patterns and OO systems.</p><a id="part0020_pro_id00054"></a><pre class="programlisting">http://c2.com/cgi/wiki?WelcomeVisitors</pre><p>The <span class="strong"><strong>Hillside Group</strong></span> fosters common programming and design practices and provides a central resource for patterns work. The site includes information on many patterns-related resources such as articles, books, mailing lists and tools.</p><a id="part0020_pro_id00055"></a><pre class="programlisting">http://hillside.net/</pre><div class="informalfigure"><a id="part0020_med_id00799a"></a><div class="mediaobject"><a id="part0020_med_id00799"></a><img alt="image with no caption" hisrc="figs/web/609fig01.png.jpg" src="../Images/image01300.jpeg"/></div></div><p><span class="strong"><strong><span class="gray-background">Conferences and Workshops</span></strong></span></p><p>And if you’d like to get some face-to-face time with the patterns community, be sure to check out the many patterns-related conferences and workshops. The Hillside site maintains a complete list. At the least you’ll want to check out Pattern Languages of Programs (PLoP), and the ACM Conference on Object-Oriented Systems, Languages and Applications (OOPSLA).</p><div class="informalfigure"><a id="part0020_med_id00800a"></a><div class="mediaobject"><a id="part0020_med_id00800"></a><img alt="image with no caption" hisrc="figs/web/609fig02.png.jpg" src="../Images/image01301.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_patterns_zoo" style="clear: both">The Patterns Zoo</h2></div></div></div><div class="informalfigure"><a id="part0020_med_id00801a"></a><div class="mediaobject"><a id="part0020_med_id00801"></a><img alt="image with no caption" hisrc="figs/web/610fig01.png.jpg" src="../Images/image01302.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1060"></a><a class="indexterm" id="part0020_iddle1061"></a><a class="indexterm" id="part0020_iddle1453"></a>As you’ve just seen, patterns didn’t start with software; they started with the architecture of buildings and towns. In fact, the patterns concept can be applied in many different domains. Take a walk around the Patterns Zoo to see a few...</p><div class="informalfigure"><a id="part0020_med_id00802a"></a><div class="mediaobject"><a id="part0020_med_id00802"></a><img alt="image with no caption" hisrc="figs/web/610fig02.png.jpg" src="../Images/image01303.jpeg"/></div></div><p><span class="strong"><strong>Architectural Patterns</strong></span> are used to create the living, vibrant architecture of buildings, towns, and cities. This is where patterns got their start.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note09"></a>Note</h3><p>Habitat: found in buildings you like to live in, look at and visit.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0020_med_id00803a"></a><div class="mediaobject"><a id="part0020_med_id00803"></a><img alt="image with no caption" hisrc="figs/web/610fig03.png.jpg" src="../Images/image01304.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note10"></a>Note</h3><p>Habitat: seen hanging around 3-tier architectures, client-server systems and the web.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Application Patterns</strong></span> are patterns for creating system-level architecture. Many multi-tier architectures fall into this category.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note11"></a>Note</h3><p>Field note: MVC has been known to pass for an application pattern.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0020_med_id00804a"></a><div class="mediaobject"><a id="part0020_med_id00804"></a><img alt="image with no caption" hisrc="figs/web/610fig04.png.jpg" src="../Images/image01305.jpeg"/></div></div><p><span class="strong"><strong>Domain-Specific Patterns</strong></span> are patterns that concern problems in specific domains, like concurrent systems or real-time systems.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note12"></a>Note</h3><p><span class="underline">Help find a habitat</span>___________________</p><p>_____<span class="underline">J2EE</span>________________________</p><p>__________________________________</p><p>__________________________________</p><p>__________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0020_med_id00805a"></a><div class="mediaobject"><a id="part0020_med_id00805"></a><img alt="image with no caption" hisrc="figs/web/611fig01.png.jpg" src="../Images/image01306.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1087"></a><a class="indexterm" id="part0020_iddle2091"></a><a class="indexterm" id="part0020_iddle2491"></a><span class="strong"><strong>Business Process Patterns</strong></span> describe the interaction between businesses, customers and data, and can be applied to problems such as how to effectively make and communicate decisions.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note13"></a>Note</h3><p><span class="underline">Help find a habitat</span>__________</p><p><span class="underline">Development team</span>_____________</p><p><span class="underline">Customer support team</span>________</p><p>__________________________________</p><p>__________________________________</p><p>__________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0020_med_id00806a"></a><div class="mediaobject"><a id="part0020_med_id00806"></a><img alt="image with no caption" hisrc="figs/web/611fig02.png.jpg" src="../Images/image01307.jpeg"/></div></div><p><span class="strong"><strong>Organizational Patterns</strong></span> describe the structures and practices of human organizations. Most efforts to date have focused on organizations that produce and/or support software.</p><div class="informalfigure"><a id="part0020_med_id00807a"></a><div class="mediaobject"><a id="part0020_med_id00807"></a><img alt="image with no caption" hisrc="figs/web/611fig03.png.jpg" src="../Images/image01308.jpeg"/></div></div><p><span class="strong"><strong>User Interface Design Patterns</strong></span> address the problems of how to design interactive software programs.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note14"></a>Note</h3><p>Habitat: seen in the vicinity of video game designers, GUI builders, and producers.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note15"></a>Note</h3><p>Field notes: please add your observations of pattern domains here:</p><p>___________________________________________________________</p><p>___________________________________________________________</p><p>___________________________________________________________</p><p>___________________________________________________________</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_annihilating_evil_with_anti-patterns" style="clear: both">Annihilating evil with Anti-Patterns</h2></div></div></div><div class="informalfigure"><a id="part0020_med_id00808a"></a><div class="mediaobject"><a id="part0020_med_id00808"></a><img alt="image with no caption" hisrc="figs/web/612fig01.png.jpg" src="../Images/image01309.jpeg"/></div></div><p><a class="indexterm" id="part0020_iddle1057"></a>The Universe just wouldn’t be complete if we had patterns and no anti-patterns, now would it?</p><p>If a Design Pattern gives you a general solution to a recurring problem in a particular context, then what does an anti-pattern give you?</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note16"></a>Note</h3><p>An <span class="strong"><strong>Anti-Pattern</strong></span> tells you how to go from a problem to a BAD solution.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>You’re probably asking yourself, “Why on earth would anyone waste their time documenting bad solutions?”</p><p>Think about it like this: if there is a recurring bad solution to a common problem, then by documenting it we can prevent other developers from making the same mistake. After all, avoiding bad solutions can be just as valuable as finding good ones!</p><p>Let’s look at the elements of an anti-pattern:</p><p><span class="strong"><strong>An anti-pattern tells you why a bad solution is attractive.</strong></span> Let’s face it, no one would choose a bad solution if there wasn’t something about it that seemed attractive up front. One of the biggest jobs of the anti-pattern is to alert you to the seductive aspect of the solution.</p><p><span class="strong"><strong>An anti-pattern tells you why that solution in the long term is bad.</strong></span> In order to understand why it’s an anti-pattern, you’ve got to understand how it’s going to have a negative effect down the road. The anti-pattern describes where you’ll get into trouble using the solution.</p><p><span class="strong"><strong>An anti-pattern suggests other patterns that are applicable which may provide good solutions.</strong></span> To be truly helpful, an anti-pattern needs to point you in the right direction; it should suggest other possibilities that may lead to good solutions.</p><p>Let’s have a look at an anti-pattern.</p><div class="blockquote"><blockquote class="blockquote"><div><span class="strong"><strong>An anti-pattern always looks like a good solution, but then turns out to be a bad solution when it is applied.</strong></span></div><div><span class="strong"><strong>By documenting anti-patterns we help others to recognize bad solutions before they implement them.</strong></span></div><div><span class="strong"><strong>Like patterns, there are many types of anti-patterns including development, OO, organizational, and domain-specific anti-patterns.</strong></span></div></blockquote></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note17"></a>Note</h3><p>Here’s an example of a software development anti-pattern.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_anti-pattern"></a><h3 class="title">Anti-Pattern</h3><p><span class="strong"><strong>Name</strong></span>: Golden Hammer</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note18"></a>Note</h3><p>Just like a Design Pattern, an anti-pattern has a name so we can create a shared vocabulary.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Problem</strong></span>: You need to choose technologies for your development and you believe that exactly one technology must dominate the architecture.</p><p><span class="strong"><strong>Context</strong></span>: You need to develop some new system or piece of software that doesn’t fit well with the technology that the development team is familiar with.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note19"></a>Note</h3><p>The problem and context, just like a Design Pattern description.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Forces</strong></span>:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note20"></a>Note</h3><p>Tells you why the solution is attractive.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The development team is committed to the technology they know.</li><li class="listitem">The development team is not familiar with other technologies.</li><li class="listitem">Unfamiliar technologies are seen as risky.</li><li class="listitem">It is easy to plan and estimate for development using the familiar technology.</li></ul></div><p><span class="strong"><strong>Supposed Solution</strong></span>: Use the familiar technology anyway. The technology is applied obsessively to many problems, including places where it is clearly inappropriate.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note21"></a>Note</h3><p>The bad, yet attractive, solution.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Refactored Solution</strong></span>: Expanding the knowledge of developers through education, training, and book study groups that expose developers to new solutions.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note22"></a>Note</h3><p>How to get to a good solution.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p><span class="strong"><strong>Examples</strong></span>:</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note23"></a>Note</h3><p>Example of where this anti-pattern has been observed.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Web companies keep using and maintaining their internal homegrown caching systems when open source alternatives are in use.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0020_ch13note24"></a>Note</h3><p>Adapted from the Portland Pattern Repository’s WIKI at <a class="ulink" href="http://c2.com/" target="_top">http://c2.com/</a> where you’ll find many anti patterns and discussions.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_tools_for_your_design_toolbox-id00194" style="clear: both">Tools for your Design Toolbox</h2></div></div></div><p>You’ve reached that point where you’ve outgrown us. Now’s the time to go out in the world and explore patterns on your own...</p><div class="informalfigure"><a id="part0020_med_id00809a"></a><div class="mediaobject"><a id="part0020_med_id00809"></a><img alt="image with no caption" hisrc="figs/web/614fig01.png.jpg" src="../Images/image01310.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_bullet_points-id00195"></a><h3 class="title">Bullet Points</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Let Design Patterns emerge in your designs; don’t force them in just for the sake of using a pattern.</li><li class="listitem">Design Patterns aren’t set in stone; adapt and tweak them to meet your needs.</li><li class="listitem">Always use the simplest solution that meets your needs, even if it doesn’t include a pattern.</li><li class="listitem">Study Design Patterns catalogs to familiarize yourself with patterns and the relationships among them.</li><li class="listitem">Pattern classifications (or categories) provide groupings for patterns. When they help, use them.</li><li class="listitem">You need to be committed to be a patterns writer: it takes time and patience, and you have to be willing to do lots of refinement.</li><li class="listitem">Remember, most patterns you encounter will be adaptations of existing patterns, not new patterns.</li><li class="listitem">Build your team’s shared vocabulary. This is one of the most powerful benefits of using patterns.</li><li class="listitem">Like any community, the patterns community has its own lingo. Don’t let that hold you back. Having read this book, you now know most of it.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_leaving_objectvillehellip" style="clear: both">Leaving Objectville...</h2></div></div></div><div class="informalfigure"><a id="part0020_med_id00810a"></a><div class="mediaobject"><a id="part0020_med_id00810"></a><img alt="image with no caption" hisrc="figs/web/615fig01.png.jpg" src="../Images/image01311.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0020_boycomma_itapostrophes_been_great_having" style="clear: both">Boy, it’s been great having you in Objectville.</h2></div></div></div><p>We’re going to miss you, for sure. But don’t worry — before you know it, the next Head First book will be out and you can visit again. What’s the next book, you ask? Hmmm, good question! Why don’t you help us decide? Send email to <span class="email"><a class="email" href="mailto:booksuggestions@wickedlysmart.com">booksuggestions@wickedlysmart.com</a></span>.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="sidebar"><a id="part0020_who_does_whatquestion_mark_solut-id00196"></a><h3 class="title">Who Does What? Solution</h3><p><a class="indexterm" id="part0020_iddle1011"></a><a class="indexterm" id="part0020_iddle1027"></a><a class="indexterm" id="part0020_iddle1188"></a><a class="indexterm" id="part0020_iddle1237"></a><a class="indexterm" id="part0020_iddle1349"></a><a class="indexterm" id="part0020_iddle1382"></a><a class="indexterm" id="part0020_iddle1589"></a><a class="indexterm" id="part0020_iddle1611"></a><a class="indexterm" id="part0020_iddle1632"></a><a class="indexterm" id="part0020_iddle1644"></a><a class="indexterm" id="part0020_iddle1662"></a><a class="indexterm" id="part0020_iddle1820"></a><a class="indexterm" id="part0020_iddle2038"></a><a class="indexterm" id="part0020_iddle2164"></a><a class="indexterm" id="part0020_iddle2376"></a><a class="indexterm" id="part0020_iddle2415"></a><a class="indexterm" id="part0020_iddle2465"></a><a class="indexterm" id="part0020_iddle2526"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="part0020_med_id00811a"></a><div class="mediaobject"><a id="part0020_med_id00811"></a><img alt="image with no caption" hisrc="figs/web/616fig01.png.jpg" src="../Images/image01312.jpeg"/></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="appendix" epub:type="appendix" id="part0021_leftover_patterns"><div class="titlepage" id="part0021_aid-K0RQ2"><div><div><h2 class="title">Appendix A. Leftover Patterns</h2></div></div></div><div class="informalfigure"><a id="part0021_med_id00812a"></a><div class="mediaobject"><a id="part0021_med_id00812"></a><img alt="image with no caption" hisrc="figs/web/617fig01.png.jpg" src="../Images/image01313.jpeg"/></div></div><p><span class="strong"><strong>Not everyone can be the most popular.</strong></span> A lot has changed in the last 20 years. Since <span class="emphasis"><em>Design Patterns: Elements of Reusable Object-Oriented Software</em></span> first came out, developers have applied these patterns thousands of times. The patterns we summarize in this appendix are full-fledged, card-carrying, official GoF patterns, but aren’t used as often as the patterns we’ve explored so far. But these patterns are awesome in their own right, and if your situation calls for them, you should apply them with your head held high. Our goal in this appendix is to give you a high-level idea of what these patterns are all about.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_bridge" style="clear: both">Bridge</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1085"></a><span class="strong"><strong>Use the Bridge Pattern to vary not only your implementations, but also your abstractions.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Imagine you’re going to revolutionize “extreme lounging.” You’re writing the code for a new ergonomic and user-friendly remote control for TVs. You already know that you’ve got to use good OO techniques because while the remote is based on the same <span class="emphasis"><em>abstraction</em></span>, there will be lots of <span class="emphasis"><em>implementations</em></span> — one for each model of TV.</p><div class="informalfigure"><a id="part0021_med_id00813a"></a><div class="mediaobject"><a id="part0021_med_id00813"></a><img alt="image with no caption" hisrc="figs/web/618fig01.png.jpg" src="../Images/image01314.jpeg"/></div></div><p><span class="strong"><strong>Your dilemma</strong></span></p><p>You know that the remote’s user interface won’t be right the first time. In fact, you expect that the product will be refined many times as usability data is collected on the remote control.</p><p>So your dilemma is that the remotes are going to change and the TVs are going to change. You’ve already <span class="emphasis"><em>abstracted</em></span> the user interface so that you can vary the <span class="emphasis"><em>implementation</em></span> over the many TVs your customers will own. But you are also going to need to <span class="emphasis"><em>vary the abstraction</em></span> because it is going to change over time as the remote is improved based on the user feedback.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note01"></a>Note</h3><p>Using this design we can vary <span class="underline">only</span> the TV implementation, not the user interface.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>So how are you going to create an OO design that allows you to vary the implementation <span class="emphasis"><em>and</em></span> the abstraction?</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_why_use_the_bridge_patternquestion_mark" style="clear: both">Why use the Bridge Pattern?</h2></div></div></div><p>The Bridge Pattern allows you to vary the implementation <span class="emphasis"><em>and</em></span> the abstraction by placing the two in separate class hierarchies.</p><div class="informalfigure"><a id="part0021_med_id00814a"></a><div class="mediaobject"><a id="part0021_med_id00814"></a><img alt="image with no caption" hisrc="figs/web/619fig01.png.jpg" src="../Images/image01315.jpeg"/></div></div><p>Now you have two hierarchies, one for the remotes and a separate one for platform-specific TV implementations. The bridge allows you to vary either side of the two hierarchies independently.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note02"></a>Bridge Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Decouples an implementation so that it is not bound permanently to an interface.</li><li class="listitem">Abstraction and implementation can be extended independently.</li><li class="listitem">Changes to the concrete abstraction classes don’t affect the client.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note03"></a>Bridge Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Useful in graphics and windowing systems that need to run over multiple platforms.</li><li class="listitem">Useful any time you need to vary an interface and an implementation in different ways.</li><li class="listitem">Increases complexity.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_builder" style="clear: both">Builder</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1086"></a><a class="indexterm" id="part0021_iddle1493"></a><a class="indexterm" id="part0021_iddle2003"></a><span class="strong"><strong>Use the Builder Pattern to encapsulate the construction of a product and allow it to be constructed in steps.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>You’ve just been asked to build a vacation planner for Patternsland, a new theme park just outside of Objectville. Park guests can choose a hotel and various types of admission tickets, make restaurant reservations, and even book special events. To create a vacation planner, you need to be able to create structures like this:</p><div class="informalfigure"><a id="part0021_med_id00815a"></a><div class="mediaobject"><a id="part0021_med_id00815"></a><img alt="image with no caption" hisrc="figs/web/620fig01.png.jpg" src="../Images/image01316.jpeg"/></div></div><p><span class="strong"><strong>You need a flexible design</strong></span></p><p>Each guest’s planner can vary in the number of days and types of activities it includes. For instance, a local resident might not need a hotel, but wants to make dinner and special event reservations. Another guest might be flying into Objectville and needs a hotel, dinner reservations, and admission tickets.</p><p>So, you need a flexible data structure that can represent guest planners and all their variations; you also need to follow a sequence of potentially complex steps to create the planner. How can you provide a way to create the complex structure without mixing it with the steps for creating it?</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_why_use_the_builder_patternquestion_mark" style="clear: both">Why use the Builder Pattern?</h2></div></div></div><p>Remember Iterator? We encapsulated the iteration into a separate object and hid the internal representation of the collection from the client. It’s the same idea here: we encapsulate the creation of the trip planner in an object (let’s call it a builder), and have our client ask the builder to construct the trip planner structure for it.</p><div class="informalfigure"><a id="part0021_med_id00816a"></a><div class="mediaobject"><a id="part0021_med_id00816"></a><img alt="image with no caption" hisrc="figs/web/621fig01.png.jpg" src="../Images/image01317.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note04"></a>Builder Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Encapsulates the way a complex object is constructed.</li><li class="listitem">Allows objects to be constructed in a multistep and varying process (as opposed to one-step factories).</li><li class="listitem">Hides the internal representation of the product from the client.</li><li class="listitem">Product implementations can be swapped in and out because the client only sees an abstract interface.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note05"></a>Builder Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Often used for building composite structures.</li><li class="listitem">Constructing objects requires more domain knowledge of the client than when using a Factory.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_chain_of_responsibility" style="clear: both">Chain of Responsibility</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1098"></a><span class="strong"><strong>Use the Chain of Responsibility Pattern when you want to give more than one object a chance to handle a request.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Mighty Gumball has been getting more email than they can handle since the release of the Java-powered Gumball Machine. From their own analysis they get four kinds of email: fan mail from customers that love the new 1-in-10 game, complaints from parents whose kids are addicted to the game, and requests to put machines in new locations. They also get a fair amount of spam.</p><p>All fan mail should go straight to the CEO, all complaints should go to the legal department and all requests for new machines should go to business development. Spam should be deleted.</p><p><span class="strong"><strong>Your task</strong></span></p><p>Mighty Gumball has already written some AI detectors that can tell if an email is spam, fan mail, a complaint, or a request, but they need you to create a design that can use the detectors to handle incoming email.</p><div class="informalfigure"><a id="part0021_med_id00817a"></a><div class="mediaobject"><a id="part0021_med_id00817"></a><img alt="image with no caption" hisrc="figs/web/622fig01.png.jpg" src="../Images/image01318.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_how_to_use_the_chain_of_responsibility_p" style="clear: both">How to use the Chain of Responsibility Pattern</h2></div></div></div><p>With the Chain of Responsibility Pattern, you create a chain of objects to examine requests. Each object in turn examines a request and either handles it, or passes it on to the next object in the chain.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note05a"></a>Note</h3><p>Each object in the chain acts as a handler and has a successor object. If it can handle the request, it does; otherwise, it forwards the request to its successor.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="informalfigure"><a id="part0021_med_id00818a"></a><div class="mediaobject"><a id="part0021_med_id00818"></a><img alt="image with no caption" hisrc="figs/web/623fig01.png.jpg" src="../Images/image01319.jpeg"/></div></div><p>As email is received, it is passed to the first handler: the SpamHandler. If the SpamHandler can’t handle the request, it is passed on to the FanHandler. And so on...</p><div class="informalfigure"><a id="part0021_med_id00819a"></a><div class="mediaobject"><a id="part0021_med_id00819"></a><img alt="image with no caption" hisrc="figs/web/623fig02.png.jpg" src="../Images/image01320.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note06"></a>Chain of Responsibility Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Decouples the sender of the request and its receivers.</li><li class="listitem">Simplifies your object because it doesn’t have to know the chain’s structure and keep direct references to its members.</li><li class="listitem">Allows you to add or remove responsibilities dynamically by changing the members or order of the chain.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note07"></a>Chain of Responsibility Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Commonly used in windows systems to handle events like mouse clicks and keyboard events.</li><li class="listitem">Execution of the request isn’t guaranteed; it may fall off the end of the chain if no object handles it (this can be an advantage or a disadvantage).</li><li class="listitem">Can be hard to observe and debug at runtime.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_flyweight" style="clear: both">Flyweight</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1678"></a><span class="strong"><strong>Use the Flyweight Pattern when one instance of a class can be used to provide many “virtual instances.”</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>You want to add trees as objects in your hot new landscape design application. In your application, trees don’t really do very much; they have an X-Y location, and they can draw themselves dynamically, depending on how old they are. The thing is, a user might want to have lots and lots of trees in one of their home landscape designs. It might look something like this:</p><div class="informalfigure"><a id="part0021_med_id00820a"></a><div class="mediaobject"><a id="part0021_med_id00820"></a><img alt="image with no caption" hisrc="figs/web/624fig01.png.jpg" src="../Images/image01321.jpeg"/></div></div><p><span class="strong"><strong>Your big client’s dilemma</strong></span></p><p>You’ve just landed your “reference account.” That key client you’ve been pitching for months. They’re going to buy 1,000 seats of your application, and they’re using your software to do the landscape design for huge planned communities. After using your software for a week, your client is complaining that when they create large groves of trees, the app starts getting sluggish...</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_why_use_the_flyweight_patternquestion_ma" style="clear: both">Why use the Flyweight Pattern?</h2></div></div></div><p>What if, instead of having thousands of Tree objects, you could redesign your system so that you’ve got only one instance of Tree, and a client object that maintains the state of ALL your trees? That’s the Flyweight!</p><div class="informalfigure"><a id="part0021_med_id00821a"></a><div class="mediaobject"><a id="part0021_med_id00821"></a><img alt="image with no caption" hisrc="figs/web/625fig01.png.jpg" src="../Images/image01322.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note08"></a>Flyweight Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Reduces the number of object instances at runtime, saving memory.</li><li class="listitem">Centralizes state for many “virtual” objects into a single location.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note09"></a>Flyweight Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Flyweight is used when a class has many instances, and they can all be controlled identically.</li><li class="listitem">A drawback of the Flyweight pattern is that once you’ve implemented it, single, logical instances of the class will not be able to behave independently from the other instances.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_interpreter" style="clear: both">Interpreter</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1803"></a><span class="strong"><strong>Use the Interpreter Pattern to build an interpreter for a language.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Remember the Duck Simulator? You have a hunch it would also make a great educational tool for children to learn programming. Using the simulator, each child gets to control one duck with a simple language. Here’s an example of the language:</p><div class="informalfigure"><a id="part0021_med_id00822a"></a><div class="mediaobject"><a id="part0021_med_id00822"></a><img alt="image with no caption" hisrc="figs/web/626fig01.png.jpg" src="../Images/image01323.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note10"></a>Relax</h3><p><span class="strong"><strong>The Interpreter Pattern requires some knowledge of formal grammars.</strong></span></p><p>If you’ve never studied formal grammars, go ahead and read through the pattern; you’ll still get the gist of it.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><p>Now, remembering how to create grammars from one of your old introductory programming classes, you write out the grammar:</p><div class="informalfigure"><a id="part0021_med_id00823a"></a><div class="mediaobject"><a id="part0021_med_id00823"></a><img alt="image with no caption" hisrc="figs/web/626fig02.png.jpg" src="../Images/image01324.jpeg"/></div></div><p><span class="strong"><strong>Now what?</strong></span></p><p>You’ve got a grammar; now all you need is a way to represent and interpret sentences in the grammar so that the students can see the effects of their programming on the simulated ducks.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_how_to_implement_an_interpreter" style="clear: both">How to implement an interpreter</h2></div></div></div><p>When you need to implement a simple language, the Interpreter Pattern defines a class-based representation for its grammar along with an interpreter to interpret its sentences. To represent the language, you use a class to represent each rule in the language. Here’s the duck language translated into classes. Notice the direct mapping to the grammar.</p><div class="informalfigure"><a id="part0021_med_id00824a"></a><div class="mediaobject"><a id="part0021_med_id00824"></a><img alt="image with no caption" hisrc="figs/web/627fig01.png.jpg" src="../Images/image01325.jpeg"/></div></div><p>To interpret the language, call the interpret() method on each expression type. This method is passed a context — which contains the input stream of the program we’re parsing — and matches the input and evaluates it.</p><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note11"></a>Interpreter Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Representing each grammar rule in a class makes the language easy to implement.</li><li class="listitem">Because the grammar is represented by classes, you can easily change or extend the language.</li><li class="listitem">By adding methods to the class structure, you can add new behaviors beyond interpretation, like pretty printing and more sophisticated program validation.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note12"></a>Interpreter Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Use interpreter when you need to implement a simple language.</li><li class="listitem">Appropriate when you have a simple grammar and simplicity is more important than efficiency.</li><li class="listitem">Used for scripting and programming languages.</li><li class="listitem">This pattern can become cumbersome when the number of grammar rules is large. In these cases a parser/compiler generator may be more appropriate.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_mediator" style="clear: both">Mediator</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1904"></a><span class="strong"><strong>Use the Mediator Pattern to centralize complex communications and control between related objects.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Bob has a Java-enabled auto-house, thanks to the good folks at HouseOfTheFuture. All of his appliances are designed to make his life easier. When Bob stops hitting the snooze button, his alarm clock tells the coffee maker to start brewing. Even though life is good for Bob, he and other clients are always asking for lots of new features: No coffee on the weekends... Turn off the sprinkler 15 minutes before a shower is scheduled... Set the alarm early on trash days...</p><div class="informalfigure"><a id="part0021_med_id00825a"></a><div class="mediaobject"><a id="part0021_med_id00825"></a><img alt="image with no caption" hisrc="figs/web/628fig01.png.jpg" src="../Images/image01326.jpeg"/></div></div><p><span class="strong"><strong>HouseOfTheFuture’s dilemma</strong></span></p><p>It’s getting really hard to keep track of which rules reside in which objects, and how the various objects should relate to each other.</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_mediator_in_actionhellip" style="clear: both">Mediator in action...</h2></div></div></div><p>With a Mediator added to the system, all of the appliance objects can be greatly simplified:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">They tell the Mediator when their state changes.</li><li class="listitem">They respond to requests from the Mediator.</li></ul></div><p>Before we added the Mediator, all of the appliance objects needed to know about each other... they were all tightly coupled. With the Mediator in place, the appliance objects are all completely decoupled from each other.</p><p>The Mediator contains all of the control logic for the entire system. When an existing appliance needs a new rule, or a new appliance is added to the system, you’ll know that all of the necessary logic will be added to the Mediator.</p><div class="informalfigure"><a id="part0021_med_id00826a"></a><div class="mediaobject"><a id="part0021_med_id00826"></a><img alt="image with no caption" hisrc="figs/web/629fig01.png.jpg" src="../Images/image01327.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note13"></a>Mediator Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Increases the reusability of the objects supported by the Mediator by decoupling them from the system.</li><li class="listitem">Simplifies maintenance of the system by centralizing control logic.</li><li class="listitem">Simplifies and reduces the variety of messages sent between objects in the system.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note14"></a>Mediator Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Mediator is commonly used to coordinate related GUI components.</li><li class="listitem">A drawback of the Mediator Pattern is that without proper design, the Mediator object itself can become overly complex.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_memento" style="clear: both">Memento</h2></div></div></div><p><a class="indexterm" id="part0021_iddle1905"></a><span class="strong"><strong>Use the Memento Pattern when you need to be able to return an object to one of its previous states; for instance, if your user requests an “undo.”</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Your interactive role playing game is hugely successful, and has created a legion of addicts, all trying to get to the fabled “level 13.” As users progress to more challenging game levels, the odds of encountering a game-ending situation increase. Fans who have spent days progressing to an advanced level are understandably miffed when their character gets snuffed, and they have to start all over. The cry goes out for a “save progress” command, so that players can store their game progress and at least recover most of their efforts when their character is unfairly extinguished. The “save progress” function needs to be designed to return a resurrected player to the last level she completed successfully.</p><div class="informalfigure"><a id="part0021_med_id00827a"></a><div class="mediaobject"><a id="part0021_med_id00827"></a><img alt="image with no caption" hisrc="figs/web/630fig01.png.jpg" src="../Images/image01328.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_memento_at_work" style="clear: both">The Memento at work</h2></div></div></div><p>The Memento has two goals:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Saving the important state of a system’s key object.</li><li class="listitem">Maintaining the key object’s encapsulation.</li></ul></div><p>Keeping the single responsibility principle in mind, it’s also a good idea to keep the state that you’re saving separate from the key object. This separate object that holds the state is known as the Memento object.</p><div class="informalfigure"><a id="part0021_med_id00828a"></a><div class="mediaobject"><a id="part0021_med_id00828"></a><img alt="image with no caption" hisrc="figs/web/631fig01.png.jpg" src="../Images/image01329.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note15"></a>Memento Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Keeping the saved state external from the key object helps to maintain cohesion.</li><li class="listitem">Keeps the key object’s data encapsulated.</li><li class="listitem">Provides easy-to-implement recovery capability.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note16"></a>Memento Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Memento is used to save state.</li><li class="listitem">A drawback to using Memento is that saving and restoring state can be time consuming.</li><li class="listitem">In Java systems, consider using Serialization to save a system’s state.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_prototype" style="clear: both">Prototype</h2></div></div></div><p><a class="indexterm" id="part0021_iddle2153"></a><span class="strong"><strong>Use the Prototype Pattern when creating an instance of a given class is either expensive or complicated.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Your interactive role playing game has an insatiable appetite for monsters. As your heroes make their journey through a dynamically created landscape, they encounter an endless chain of foes that must be subdued. You’d like the monster’s characteristics to evolve with the changing landscape. It doesn’t make a lot of sense for bird-like monsters to follow your characters into underseas realms. Finally, you’d like to allow advanced players to create their own custom monsters.</p><div class="informalfigure"><a id="part0021_med_id00829a"></a><div class="mediaobject"><a id="part0021_med_id00829"></a><img alt="image with no caption" hisrc="figs/web/632fig01.png.jpg" src="../Images/image01330.jpeg"/></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_prototype_to_the_rescue" style="clear: both">Prototype to the rescue</h2></div></div></div><p>The Prototype Pattern allows you to make new instances by copying existing instances. (In Java this typically means using the clone() method, or de-serialization when you need deep copies.) A key aspect of this pattern is that the client code can make new instances without knowing which specific class is being instantiated.</p><div class="informalfigure"><a id="part0021_med_id00830a"></a><div class="mediaobject"><a id="part0021_med_id00830"></a><img alt="image with no caption" hisrc="figs/web/633fig01.png.jpg" src="../Images/image01331.jpeg"/></div></div><div class="informalfigure"><a id="part0021_med_id00831a"></a><div class="mediaobject"><a id="part0021_med_id00831"></a><img alt="image with no caption" hisrc="figs/web/633fig02.png.jpg" src="../Images/image01332.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note17"></a>Prototype Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Hides the complexities of making new instances from the client.</li><li class="listitem">Provides the option for the client to generate objects whose type is not known.</li><li class="listitem">In some circumstances, copying an object can be more efficient than creating a new object.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note18"></a>Prototype Uses and Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Prototype should be considered when a system must create new objects of many types in a complex class hierarchy.</li><li class="listitem">A drawback to using the Prototype is that making a copy of an object can sometimes be complicated.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_visitor" style="clear: both">Visitor</h2></div></div></div><p><a class="indexterm" id="part0021_iddle2503"></a><span class="strong"><strong>Use the Visitor Pattern when you want to add capabilities to a composite of objects and encapsulation is not important.</strong></span></p><p><span class="strong"><strong>A scenario</strong></span></p><p>Customers who frequent the Objectville Diner and Objectville Pancake House have recently become more health conscious. They are asking for nutritional information before ordering their meals. Because both establishments are so willing to create special orders, some customers are even asking for nutritional information on a per ingredient basis.</p><p><span class="strong"><strong>Lou’s proposed solution:</strong></span></p><div class="informalfigure"><a id="part0021_med_id00832a"></a><div class="mediaobject"><a id="part0021_med_id00832"></a><img alt="image with no caption" hisrc="figs/web/634fig01.png.jpg" src="../Images/image01333.jpeg"/></div></div><p><span class="strong"><strong>Mel’s concerns...</strong></span></p><p>“Boy, it seems like we’re opening Pandora’s box. Who knows what new method we’re going to have to add next, and every time we add a new method we have to do it in two places. Plus, what if we want to enhance the base application with, say, a recipes class? Then we’ll have to make these changes in three different places...”</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" id="part0021_visitor_drops_by" style="clear: both">The Visitor drops by</h2></div></div></div><p>The Visitor works hand in hand with a Traverser. The Traverser knows how to navigate to all of the objects in a Composite. The Traverser guides the Visitor through the Composite so that the Visitor can collect state as it goes. Once state has been gathered, the Client can have the Visitor perform various operations on the state. When new functionality is required, only the Visitor must be enhanced.</p><div class="informalfigure"><a id="part0021_med_id00833a"></a><div class="mediaobject"><a id="part0021_med_id00833"></a><img alt="image with no caption" hisrc="figs/web/635fig01.png.jpg" src="../Images/image01334.jpeg"/></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note19"></a>Visitor Benefits</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Allows you to add operations to a Composite structure without changing the structure itself.</li><li class="listitem">Adding new operations is relatively easy.</li><li class="listitem">The code for operations performed by the Visitor is centralized.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title"><a id="part0021_app01note20"></a>Visitor Drawbacks</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The Composite classes’ encapsulation is broken when the Visitor is used.</li><li class="listitem">Because the traversal function is involved, changes to the Composite structure are more difficult.</li></ul></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div></div></section></body><body><section class="appendix" epub:type="appendix" id="part0022_app02"><div class="titlepage"><div><div><h2 class="title">Appendix B.  </h2></div></div></div><div class="informalfigure"><a id="part0022_med_id00834a"></a><div class="mediaobject"><a id="part0022_med_id00834"></a><img alt="image with no caption" hisrc="figs/web/655fig02.png.jpg" src="../Images/image01335.jpeg"/></div></div><p>And now, a final word from the Head First Institute...</p><p>Our world class researchers are working day and night in a mad race to uncover the mysteries of Life, the Universe and Everything–before it’s too late. Never before has a research team with such noble and daunting goals been assembled. Currently, we are focusing our collective energy and brain power on creating the ultimate learning machine. Once perfected, you and others will join us in our quest!</p><p>You’re fortunate to be holding one of our first prototypes in your hands. But only through constant refinement can our goal be achieved. We ask you, a pioneer user of the technology, to send us periodic field reports of your progress, at <span class="email"><a class="email" href="mailto:fieldreports@wickedlysmart.com">fieldreports@wickedlysmart.com</a></span></p><div class="informalfigure"><a id="part0022_med_id00835a"></a><div class="mediaobject"><a id="part0022_med_id00835"></a><img alt="image with no caption" hisrc="figs/web/655fig01.png.jpg" src="../Images/image01336.jpeg"/></div></div></section></body><body><section class="appendix" epub:type="appendix" id="part0023_mighty_gumball"><div class="titlepage"><div><div><h2 class="title">Appendix C. Mighty Gumball</h2></div></div></div><div class="informalfigure"><a id="part0023_med_id00836a"></a><div class="mediaobject"><a id="part0023_med_id00836"></a><img alt="image with no caption" hisrc="figs/web/656fig01.png.jpg" src="../Images/image01337.jpeg"/></div></div><p><span class="strong"><strong>Without your help the next generation may never know the joys of the gumball machine.</strong></span> Today, inflexible, poorly designed code is putting our Java-powered machines at risk. Mighty Gumball won’t let that happen. We’re devoting ourselves to helping you improve your Java and OO design skills so that you can help us build the next generation of Mighty Gumball machines.</p><div class="informalfigure"><a id="part0023_med_id00837a"></a><div class="mediaobject"><a id="part0023_med_id00837"></a><img alt="image with no caption" hisrc="figs/web/656fig02.png.jpg" src="../Images/image01338.jpeg"/></div></div><p>Come on, Java toasters are <span class="emphasis"><em>sooo</em></span> ‘90s, visit us at <span class="emphasis"><em><a class="ulink" href="http://www.wickedlysmart.com" target="_top">http://www.wickedlysmart.com</a></em></span>.</p><div class="informalfigure"><a id="part0023_med_id00838a"></a><div class="mediaobject"><a id="part0023_med_id00838"></a><img alt="image with no caption" hisrc="figs/web/656fig03.png.jpg" src="../Images/image01339.jpeg"/></div></div></section></body><body><div class="index" epub:type="index" id="part0024_id483748"><div class="titlepage" id="part0024_aid-MSDG2"><div><div><h2 class="title">Index</h2></div></div></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="note"><h3 class="title">A note on the digital index</h3><p>A link in an index entry is displayed as the section title in which that entry appears. Because some sections have multiple index markers, it is not unusual for an entry to have several links to the same section. Clicking on any link will take you directly to the place in the text in which the marker appears.</p></div><div class="orm-notedivider"><hr data-amznremoved-m8="true"/></div><div class="index"><div class="indexdiv"><h3>A</h3><div class="variable_list_term">abstract class</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0011_iddle1001">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0015_iddle1002">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">methods in, <a class="indexterm" href="#part0015_iddle1003">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Abstract Factory Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0011_iddle1004">What have we done?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building ingredient factories, <a class="indexterm" href="#part0011_iddle1005">Building the ingredient factories</a>, <a class="indexterm" href="#part0011_iddle1006">A very dependent PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle1007">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1008">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0011_iddle1009">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle1010">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1011">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method Pattern and, <a class="indexterm" href="#part0011_iddle1012">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0011_iddle1013">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">abstract superclasses, <a class="indexterm" href="#part0008_iddle1014">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">ACM Conference, <a class="indexterm" href="#part0020_iddle1015">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle1016">The Adapter Pattern explained</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adapting to Iterator Enumeration interface, <a class="indexterm" href="#part0014_iddle1017">Adapting an Enumeration to an Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle1018">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dealing with remove() method, <a class="indexterm" href="#part0014_iddle1019">Dealing with the remove() method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Decorator Pattern vs., <a class="indexterm" href="#part0014_iddle1020">Writing the EnumerationIterator adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0014_iddle1021">Adapter Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing Adapter, <a class="indexterm" href="#part0014_iddle1022">Adapting an Enumeration to an Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0016_iddle1023">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle1024">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0018_iddle1025">Running the code...</a>, <a class="indexterm" href="#part0020_iddle1026">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1027">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching pattern with its intent, <a class="indexterm" href="#part0014_iddle1028">And now for something different...</a>, <a class="indexterm" href="#part0014_iddle1029">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Facade Pattern vs., <a class="indexterm" href="#part0014_iddle1030">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model-View-Controller, <a class="indexterm" href="#part0019_iddle1031">Adapting the Model</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object and class adapters, <a class="indexterm" href="#part0014_iddle1032">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Proxy Pattern vs., <a class="indexterm" href="#part0018_iddle1033">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">simple real world adapters, <a class="indexterm" href="#part0014_iddle1034">Real-world adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Enumeration Iterator Adapter, <a class="indexterm" href="#part0014_iddle1035">Dealing with the remove() method</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">adapters, OO (Object-Oriented)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle1036">Adapters all around us</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating Two Way Adapters, <a class="indexterm" href="#part0014_iddle1037">Here’s how the Client uses the Adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in action, <a class="indexterm" href="#part0014_iddle1038">If it walks like a duck and quacks like a duck, then it must might be a duck turkey wrapped with a duck adapter...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object and class object and class, <a class="indexterm" href="#part0014_iddle1039">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">test driving, <a class="indexterm" href="#part0014_iddle1040">Test drive the adapter</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">aggregates, <a class="indexterm" href="#part0016_iddle1041">Meet the Iterator Pattern</a>, <a class="indexterm" href="#part0016_iddle1042">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Alexander, Christopher</div><blockquote class="variable_list_definition"><div class="variable_list_term">A Pattern Language, <a class="indexterm" href="#part0020_iddle1043">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Timeless Way of Building, <a class="indexterm" href="#part0020_iddle1044">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">algorithms, encapsulating</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle1045">The Template Method Pattern: Encapsulating Algorithms</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">abstracting prepareRecipe(), <a class="indexterm" href="#part0015_iddle1046">Abstracting prepareRecipe()</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Template Method Pattern and</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle1047">Meet the Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">applets in, <a class="indexterm" href="#part0015_iddle1048">Applets</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0015_iddle1049">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0015_iddle1050">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hooks in, <a class="indexterm" href="#part0015_iddle1052">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in real world, <a class="indexterm" href="#part0015_iddle1053">Template Methods in the Wild</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sorting with, <a class="indexterm" href="#part0015_iddle1054">Sorting with Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Swing and, <a class="indexterm" href="#part0015_iddle1055">Swingin’ with Frames</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0015_iddle1056">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hollywood Principle and, <a class="indexterm" href="#part0015_iddle1051">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">Anti-Patterns, <a class="indexterm" href="#part0020_iddle1057">Annihilating evil with Anti-Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Applet, Template Method Pattern and, <a class="indexterm" href="#part0015_iddle1058">Applets</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Applicability section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1059">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Application Patterns, <a class="indexterm" href="#part0020_iddle1060">The Patterns Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Architectural Patterns, <a class="indexterm" href="#part0020_iddle1061">The Patterns Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">ArrayList, arrays and, <a class="indexterm" href="#part0016_iddle1062">Lou and Mel’s Menu implementations</a>, <a class="indexterm" href="#part0016_iddle1063">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">arrays</div><blockquote class="variable_list_definition"><div class="variable_list_term">iteration and, <a class="indexterm" href="#part0016_iddle1064">Can we encapsulate the iteration?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">iterator and hasNext() method with, <a class="indexterm" href="#part0016_iddle1065">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">iterator and next() method with, <a class="indexterm" href="#part0016_iddle1066">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">removing an element, <a class="indexterm" href="#part0016_iddle1067">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sorting with Template Method Pattern, <a class="indexterm" href="#part0015_iddle1068">Sorting with Template Method</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></div><div class="indexdiv"><h3>B</h3><div class="variable_list_term">Basham, Bryan, (Head First Servlets &amp; JSP), <a class="indexterm" href="#part0019_iddle1069">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Be the JVM solution exercises, dealing with multithreading, <a class="indexterm" href="#part0012_iddle1083">Houston, Hershey, PA we have a problem...</a>, <a class="indexterm" href="#part0012_iddle1084">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">behavior, encapsulating, <a class="indexterm" href="#part0008_iddle1072">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">behavioral patterns category, Design Patterns, <a class="indexterm" href="#part0020_iddle1070">Pattern Categories</a>, <a class="indexterm" href="#part0020_iddle1071">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">behaviors</div><blockquote class="variable_list_definition"><div class="variable_list_term">classes as, <a class="indexterm" href="#part0008_iddle1073">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">classes extended to incorporate new, <a class="indexterm" href="#part0010_iddle1074">The Open-Closed Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">declaring variables, <a class="indexterm" href="#part0008_iddle1075">Integrating the Duck Behavior</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">delegating to decorated objects while adding, <a class="indexterm" href="#part0010_iddle1076">Constructing a drink order with Decorators</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0008_iddle1077">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating, <a class="indexterm" href="#part0008_iddle1078">The Big Picture on encapsulated behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0008_iddle1079">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">integrating, <a class="indexterm" href="#part0008_iddle1080">Integrating the Duck Behavior</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">setting dynamically, <a class="indexterm" href="#part0008_iddle1081">Setting behavior dynamically</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Bert Bates, (Head First Servlets &amp; JSP), <a class="indexterm" href="#part0019_iddle1082">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Bridge Pattern, <a class="indexterm" href="#part0021_iddle1085">Bridge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Builder Pattern, <a class="indexterm" href="#part0021_iddle1086">Builder</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Business Process Patterns, <a class="indexterm" href="#part0020_iddle1087">The Patterns Zoo</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>C</h3><div class="variable_list_term">Caching Proxy, as form of Virtual Proxy, <a class="indexterm" href="#part0018_iddle1088">What did we do?</a>, <a class="indexterm" href="#part0018_iddle1089">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Cafe Menu, integrating into framework (Iterator Pattern)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1090">Taking a look at the Café Menu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking code, <a class="indexterm" href="#part0016_iddle1091">Reworking the Café Menu code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">CD covers, displaying using Proxy Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1092">Displaying CD covers</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code for, <a class="indexterm" href="#part0019_iddle1093">Compound Patterns: Patterns of Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing Virtual Proxy, <a class="indexterm" href="#part0018_iddle1094">Designing the CD cover Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle1095">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing viewer, <a class="indexterm" href="#part0018_iddle1096">Testing the CD Cover Viewer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Image Proxy, <a class="indexterm" href="#part0018_iddle1097">Writing the Image Proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Chain of Responsibility Pattern, <a class="indexterm" href="#part0021_iddle1098">Chain of Responsibility</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">change</div><blockquote class="variable_list_definition"><div class="variable_list_term">constant in software development, <a class="indexterm" href="#part0008_iddle1099">The one constant in software development</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">identifying, <a class="indexterm" href="#part0009_iddle1100">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">iteration and, <a class="indexterm" href="#part0016_iddle1101">Single Responsibility</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Chocolate Factory, using Singleton Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0012_iddle1102">The Chocolate Factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">fixing Chocolate Boiler code, <a class="indexterm" href="#part0012_iddle1103">Meanwhile, back at the Chocolate Factory...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">class adapters, object vs., <a class="indexterm" href="#part0014_iddle1104">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class design, of Observer Pattern, <a class="indexterm" href="#part0009_iddle1105">The Observer Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class hierarchies, parallel, <a class="indexterm" href="#part0011_iddle1133">Another perspective: parallel class hierarchies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class patterns, Design Patterns, <a class="indexterm" href="#part0020_iddle1136">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">classes., <a class="indexterm" href="#part0010_iddle1106">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"><div class="variable_list_term">(see also subclasses)</div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">abstract, <a class="indexterm" href="#part0011_iddle1107">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adapter, <a class="indexterm" href="#part0014_iddle1108">Here’s how the Client uses the Adapter</a>, <a class="indexterm" href="#part0014_iddle1109">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern, <a class="indexterm" href="#part0014_iddle1110">Adapter Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">altering decorator, <a class="indexterm" href="#part0010_iddle1111">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">as behaviors, <a class="indexterm" href="#part0008_iddle1112">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">command</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1113">The Command Pattern means lots of command classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">passing method references, <a class="indexterm" href="#part0013_iddle1114">Simplifying even more with method references</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using lambda expressions, <a class="indexterm" href="#part0013_iddle1115">Simplifying the Remote Control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">creating, <a class="indexterm" href="#part0008_iddle1116">Separating what changes from what stays the same</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method Pattern creator and product, <a class="indexterm" href="#part0011_iddle1117">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">having single responsibility, <a class="indexterm" href="#part0016_iddle1118">Single Responsibility</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">high-level component, <a class="indexterm" href="#part0011_iddle1119">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">identifying as Proxy class, <a class="indexterm" href="#part0018_iddle1120">Running the code...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Open-Closed Principle, <a class="indexterm" href="#part0010_iddle1121">The Open-Closed Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">state</div><blockquote class="variable_list_definition"><div class="variable_list_term">defining, <a class="indexterm" href="#part0017_iddle1122">Defining the State interfaces and classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0017_iddle1123">Implementing our State classes</a>, <a class="indexterm" href="#part0017_iddle1124">Implementing more states</a>, <a class="indexterm" href="#part0017_iddle1125">We still need to finish the Gumball 1 in 10 game</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">increasing number in design of, <a class="indexterm" href="#part0017_iddle1126">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking state classes, <a class="indexterm" href="#part0017_iddle1127">Reworking the Gumball Machine</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">state transitions in, <a class="indexterm" href="#part0017_iddle1128">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">using composition with, <a class="indexterm" href="#part0008_iddle1129">HAS-A can be better than IS-A</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using instance variables instead of, <a class="indexterm" href="#part0010_iddle1130">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using instead of Singletons static, <a class="indexterm" href="#part0012_iddle1131">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using new operator for instantiating concrete, <a class="indexterm" href="#part0011_iddle1132">The Factory Pattern: Baking with OO Goodness</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Classification section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1134">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">classloaders, using with Singletons, <a class="indexterm" href="#part0012_iddle1135">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">client heap, <a class="indexterm" href="#part0018_iddle1137">Remote methods 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">client helper (stubs), in RMI, <a class="indexterm" href="#part0018_iddle1138">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle1139">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle1140">How does the client get the stub object?</a>, <a class="indexterm" href="#part0018_iddle1141">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Code Magnets exercise</div><blockquote class="variable_list_definition"><div class="variable_list_term">for DinerMenu Iterator, <a class="indexterm" href="#part0016_iddle1142">Iterators and Collections</a>, <a class="indexterm" href="#part0016_iddle1143">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">for Observer Pattern, <a class="indexterm" href="#part0009_iddle1144">Reworking the Weather Station with the built-in support</a>, <a class="indexterm" href="#part0009_iddle1145">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">cohesion, <a class="indexterm" href="#part0016_iddle1146">Single Responsibility</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Collaborations section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1147">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">collection classes, <a class="indexterm" href="#part0016_iddle1148">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">collection of objects</div><blockquote class="variable_list_definition"><div class="variable_list_term">abstracting with Iterator Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1149">The Iterator and Composite Patterns: Well-Managed Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterators, <a class="indexterm" href="#part0016_iddle1150">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code using java.util.Iterator, <a class="indexterm" href="#part0016_iddle1151">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">remove() method in, <a class="indexterm" href="#part0016_iddle1152">Making some improvements...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">implementing Iterators for, <a class="indexterm" href="#part0016_iddle1153">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">integrating into framework</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1154">Taking a look at the Café Menu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking code, <a class="indexterm" href="#part0016_iddle1155">Reworking the Café Menu code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">meaning of, <a class="indexterm" href="#part0016_iddle1156">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Composite Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1157">Designing Menus with Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing components, <a class="indexterm" href="#part0016_iddle1158">Implementing the Menu Component</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0016_iddle1159">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">tree structure, <a class="indexterm" href="#part0016_iddle1160">The Composite Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1161">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using with Iterators, <a class="indexterm" href="#part0016_iddle1162">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">using whole-part relationships, <a class="indexterm" href="#part0016_iddle1163">The magic of Iterator &amp; Composite together...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Collections, Iterators and, <a class="indexterm" href="#part0016_iddle1164">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Combining Patterns</div><blockquote class="variable_list_definition"><div class="variable_list_term">Abstract Factory Pattern, <a class="indexterm" href="#part0019_iddle1165">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern, <a class="indexterm" href="#part0019_iddle1166">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram for, <a class="indexterm" href="#part0019_iddle1167">A duck’s eye view: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern, <a class="indexterm" href="#part0019_iddle1168">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Decorator Pattern, <a class="indexterm" href="#part0019_iddle1169">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Iterator Pattern, <a class="indexterm" href="#part0019_iddle1170">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer Pattern, <a class="indexterm" href="#part0019_iddle1171">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">command classes, in Command Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1172">The Command Pattern means lots of command classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">passing method references, <a class="indexterm" href="#part0013_iddle1173">Simplifying even more with method references</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using lambda expressions, <a class="indexterm" href="#part0013_iddle1174">Simplifying the Remote Control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">command objects</div><blockquote class="variable_list_definition"><div class="variable_list_term">encapsulating requests to do something, <a class="indexterm" href="#part0013_iddle1175">Cubicle Conversation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">mapping, <a class="indexterm" href="#part0013_iddle1176">From the Diner to the Command Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0013_iddle1177">Using the command object</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Command Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">command classes in</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1178">The Command Pattern means lots of command classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">passing method references, <a class="indexterm" href="#part0013_iddle1179">Simplifying even more with method references</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using lambda expressions, <a class="indexterm" href="#part0013_iddle1180">Simplifying the Remote Control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">command objects</div><blockquote class="variable_list_definition"><div class="variable_list_term">building, <a class="indexterm" href="#part0013_iddle1181">Our first command object</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating requests to do something, <a class="indexterm" href="#part0013_iddle1182">Cubicle Conversation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">mapping, <a class="indexterm" href="#part0013_iddle1183">From the Diner to the Command Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0013_iddle1184">Using the command object</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0013_iddle1185">The Command Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dumb and smart command objects, <a class="indexterm" href="#part0013_iddle1186">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle1187">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1188">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">home automation remote control</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1189">Taking a look at the vendor classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building, <a class="indexterm" href="#part0013_iddle1190">Our first command object</a>, <a class="indexterm" href="#part0013_iddle1191">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0013_iddle1192">The Command Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">command classes in, <a class="indexterm" href="#part0013_iddle1193">The Command Pattern means lots of command classes</a>, <a class="indexterm" href="#part0013_iddle1194">Simplifying even more with method references</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating commands to be loaded, <a class="indexterm" href="#part0013_iddle1195">The Command Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">defining, <a class="indexterm" href="#part0013_iddle1196">The Command Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0013_iddle1197">Cubicle Conversation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">display of on and off slots, <a class="indexterm" href="#part0013_iddle1198">Check out the results of all those lambda expression commands...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0013_iddle1199">Implementing the Commands</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">macro commands, <a class="indexterm" href="#part0013_iddle1200">Every remote needs a Party Mode!</a>, <a class="indexterm" href="#part0013_iddle1201">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1202">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">mapping, <a class="indexterm" href="#part0013_iddle1203">From the Diner to the Command Pattern</a>, <a class="indexterm" href="#part0013_iddle1204">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Null Object in, <a class="indexterm" href="#part0013_iddle1205">Now, let’s check out the execution of our remote control test...</a>, <a class="indexterm" href="#part0013_iddle1206">Test the remote control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0013_iddle1207">Using the command object</a>, <a class="indexterm" href="#part0013_iddle1208">Putting the Remote Control through its paces</a>, <a class="indexterm" href="#part0013_iddle1209">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1210">Test the remote control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">undo commands, <a class="indexterm" href="#part0013_iddle1211">Time to write that documentation...</a>, <a class="indexterm" href="#part0013_iddle1212">Get ready to test the ceiling fan</a>, <a class="indexterm" href="#part0013_iddle1213">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1214">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">vendor classes for, <a class="indexterm" href="#part0013_iddle1215">Taking a look at the vendor classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing documentation, <a class="indexterm" href="#part0013_iddle1216">Time to write that documentation...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">logging requests using, <a class="indexterm" href="#part0013_iddle1217">More uses of the Command Pattern: logging requests</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">mapping, <a class="indexterm" href="#part0013_iddle1218">From the Diner to the Command Pattern</a>, <a class="indexterm" href="#part0013_iddle1219">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Null Object, <a class="indexterm" href="#part0013_iddle1220">Now, let’s check out the execution of our remote control test...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">queuing requests using, <a class="indexterm" href="#part0013_iddle1221">More uses of the Command Pattern: queuing requests</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">understanding, <a class="indexterm" href="#part0013_iddle1222">Meanwhile, back at the Diner..., or, A brief introduction to the Command Pattern</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Complexity Hiding Proxy, <a class="indexterm" href="#part0018_iddle1223">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">components of object, <a class="indexterm" href="#part0014_iddle1224">The Principle of Least Knowledge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Iterator, <a class="indexterm" href="#part0016_iddle1225">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle1226">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0016_iddle1227">The Composite Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dessert submenu using</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1228">Just when we thought it was safe...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0016_iddle1229">Designing Menus with Composite</a>, <a class="indexterm" href="#part0016_iddle1230">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0016_iddle1231">Implementing the Menu Component</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0016_iddle1232">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Iterators in, <a class="indexterm" href="#part0016_iddle1233">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0016_iddle1234">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle1235">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle1236">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1237">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model 2, <a class="indexterm" href="#part0019_iddle1238">Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model-View-Controller, <a class="indexterm" href="#part0019_iddle1239">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1240">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Iterator Pattern and, <a class="indexterm" href="#part0016_iddle1241">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on implementation issues, <a class="indexterm" href="#part0016_iddle1242">The magic of Iterator &amp; Composite together...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">safety versus transparency, <a class="indexterm" href="#part0019_iddle1243">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">transparency in, <a class="indexterm" href="#part0016_iddle1244">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">tree structure of, <a class="indexterm" href="#part0016_iddle1245">The Composite Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1246">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">try/catch, using, <a class="indexterm" href="#part0016_iddle1247">The magic of Iterator &amp; Composite together...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using with Iterator, <a class="indexterm" href="#part0016_iddle1248">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">vegetarian menu using Iterators, <a class="indexterm" href="#part0016_iddle1249">Give me the vegetarian menu</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">composition</div><blockquote class="variable_list_definition"><div class="variable_list_term">adding behavior at runtime, <a class="indexterm" href="#part0010_iddle1250">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">favoring over inheritance, <a class="indexterm" href="#part0008_iddle1251">HAS-A can be better than IS-A</a>, <a class="indexterm" href="#part0010_iddle1252">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">inheritance vs., <a class="indexterm" href="#part0010_iddle1253">Cubicle Conversation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object adapters and, <a class="indexterm" href="#part0014_iddle1254">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">compound patterns, using</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1255">Compound Patterns: Patterns of Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Model 2</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1256">MVC and the Web</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern, <a class="indexterm" href="#part0019_iddle1257">Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">from cell phone, <a class="indexterm" href="#part0019_iddle1258">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer Pattern, <a class="indexterm" href="#part0019_iddle1259">Design Patterns and Model 2</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern, <a class="indexterm" href="#part0019_iddle1260">Strategy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Model-View-Controller</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1261">If Elvis were a compound pattern, his name would be Model-View-Controller, and he’d be singing a little song like this...</a>, <a class="indexterm" href="#part0019_iddle1262">Meet the Model-View-Controller</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern, <a class="indexterm" href="#part0019_iddle1263">Exploring Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Beat model, <a class="indexterm" href="#part0019_iddle1264">Meet the Java DJ View</a>, <a class="indexterm" href="#part0019_iddle1265">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern, <a class="indexterm" href="#part0019_iddle1266">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1267">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">controllers per view, <a class="indexterm" href="#part0019_iddle1268">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Heart controller, <a class="indexterm" href="#part0019_iddle1269">Now we’re ready for a HeartController</a>, <a class="indexterm" href="#part0019_iddle1270">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Heart model, <a class="indexterm" href="#part0019_iddle1271">Exploring Strategy</a>, <a class="indexterm" href="#part0019_iddle1272">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing controller, <a class="indexterm" href="#part0019_iddle1273">Now for the Controller</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing DJ View, <a class="indexterm" href="#part0019_iddle1274">Using MVC to control the beat...</a>, <a class="indexterm" href="#part0019_iddle1275">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Mediator Pattern, <a class="indexterm" href="#part0019_iddle1276">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">model in, <a class="indexterm" href="#part0019_iddle1277">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer Pattern, <a class="indexterm" href="#part0019_iddle1278">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1279">Building the pieces</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">song, <a class="indexterm" href="#part0019_iddle1280">If Elvis were a compound pattern, his name would be Model-View-Controller, and he’d be singing a little song like this...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">state of model, <a class="indexterm" href="#part0019_iddle1281">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern, <a class="indexterm" href="#part0019_iddle1282">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1283">Now for the Controller</a>, <a class="indexterm" href="#part0019_iddle1284">Exploring Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0019_iddle1285">Putting it all together...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">views accessing model state methods, <a class="indexterm" href="#part0019_iddle1286">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">web and, <a class="indexterm" href="#part0019_iddle1287">MVC and the Web</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">multiple patterns vs., <a class="indexterm" href="#part0019_iddle1288">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">concrete classes</div><blockquote class="variable_list_definition"><div class="variable_list_term">deriving from, <a class="indexterm" href="#part0011_iddle1289">A few guidelines to help you follow the Principle...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Pattern and, <a class="indexterm" href="#part0011_iddle1290">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">getting rid of, <a class="indexterm" href="#part0011_iddle1291">Reworking the PizzaStore class</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">instantiating objects and, <a class="indexterm" href="#part0011_iddle1292">Looking at object dependencies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using new operator for instantiating, <a class="indexterm" href="#part0011_iddle1293">The Factory Pattern: Baking with OO Goodness</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">variables holding reference to, <a class="indexterm" href="#part0011_iddle1294">A few guidelines to help you follow the Principle...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">concrete creators, <a class="indexterm" href="#part0011_iddle1295">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete implementation object, assigning, <a class="indexterm" href="#part0008_iddle1296">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete methods, as hooks, <a class="indexterm" href="#part0015_iddle1297">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete subclasses</div><blockquote class="variable_list_definition"><div class="variable_list_term">abstract class methods defined by, <a class="indexterm" href="#part0015_iddle1298">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Pizza Store project, <a class="indexterm" href="#part0011_iddle1299">Allowing the subclasses to decide</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Consequences section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1300">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">constant in software development, <a class="indexterm" href="#part0008_iddle1301">The one constant in software development</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">controlling object access, using Proxy Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1302">The Proxy Pattern: Controlling Object Access</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Caching Proxy, <a class="indexterm" href="#part0018_iddle1303">What did we do?</a>, <a class="indexterm" href="#part0018_iddle1304">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Complexity Hiding Proxy, <a class="indexterm" href="#part0018_iddle1305">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Copy-On-Write Proxy, <a class="indexterm" href="#part0018_iddle1306">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Firewall Proxy, <a class="indexterm" href="#part0018_iddle1307">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Protection Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1308">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating dynamic proxy, <a class="indexterm" href="#part0018_iddle1309">Big Picture: creating a Dynamic Proxy for the PersonBean</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing matchmaking service, <a class="indexterm" href="#part0018_iddle1310">The PersonBean implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">protecting subjects, <a class="indexterm" href="#part0018_iddle1311">Five-minute drama: protecting subjects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing matchmaking service, <a class="indexterm" href="#part0018_iddle1312">Testing the matchmaking service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using dynamic proxy, <a class="indexterm" href="#part0018_iddle1313">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Remote Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1314">Testing the Monitor</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding to monitoring code, <a class="indexterm" href="#part0018_iddle1315">Adding a remote proxy to the Gumball Machine monitoring code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">preparing for remote service, <a class="indexterm" href="#part0018_iddle1316">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle1317">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reusing client for, <a class="indexterm" href="#part0018_iddle1318">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle1319">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">role of, <a class="indexterm" href="#part0018_iddle1320">The role of the ‘remote proxy’</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle1321">Writing the Monitor test drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping objects and, <a class="indexterm" href="#part0018_iddle1322">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Smart Reference Proxy, <a class="indexterm" href="#part0018_iddle1323">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Synchronization Proxy, <a class="indexterm" href="#part0018_iddle1324">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Virtual Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1325">Get ready for Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing Virtual Proxy, <a class="indexterm" href="#part0018_iddle1326">Designing the CD cover Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle1327">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle1328">Testing the CD Cover Viewer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Image Proxy, <a class="indexterm" href="#part0018_iddle1329">Writing the Image Proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">Copy-On-Write Proxy, <a class="indexterm" href="#part0018_iddle1330">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">create method</div><blockquote class="variable_list_definition"><div class="variable_list_term">replacing new operator with, <a class="indexterm" href="#part0011_iddle1331">Reworking the PizzaStore class</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">static method vs., <a class="indexterm" href="#part0011_iddle1332">Building a simple pizza factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using subclasses with, <a class="indexterm" href="#part0011_iddle1333">Allowing the subclasses to decide</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">creating static classes instead of Singleton, <a class="indexterm" href="#part0012_iddle1334">Houston, Hershey, PA we have a problem...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creational patterns category, Design Patterns, <a class="indexterm" href="#part0020_iddle1335">Pattern Categories</a>, <a class="indexterm" href="#part0020_iddle1336">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creator classes, in Factory Method Pattern, <a class="indexterm" href="#part0011_iddle1337">It’s finally time to meet the Factory Method Pattern</a>, <a class="indexterm" href="#part0011_iddle1338">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">crossword puzzle, <a class="indexterm" href="#part0008_iddle1339">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Cunningham, Ward, <a class="indexterm" href="#part0020_iddle1340">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>D</h3><div class="variable_list_term">Decorator Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0010_iddle1341">Meet the Decorator Pattern</a>, <a class="indexterm" href="#part0010_iddle1342">Give it a spin</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern vs., <a class="indexterm" href="#part0014_iddle1343">Writing the EnumerationIterator adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle1344">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0010_iddle1345">The Decorator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">disadvantages of, <a class="indexterm" href="#part0010_iddle1346">Decorating the java.io classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0018_iddle1347">Running the code...</a>, <a class="indexterm" href="#part0020_iddle1348">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1349">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching pattern with its intent, <a class="indexterm" href="#part0014_iddle1350">And now for something different...</a>, <a class="indexterm" href="#part0014_iddle1351">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Java I/O, <a class="indexterm" href="#part0010_iddle1352">Real World Decorators: Java I/O</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Structural patterns category, <a class="indexterm" href="#part0020_iddle1353">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Proxy Pattern vs., <a class="indexterm" href="#part0018_iddle1354">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Starbuzz Coffee project</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0010_iddle1355">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding sizes to code, <a class="indexterm" href="#part0010_iddle1356">Serving some coffees</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">constructing drink orders, <a class="indexterm" href="#part0010_iddle1357">Constructing a drink order with Decorators</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">decorating beverages in, <a class="indexterm" href="#part0010_iddle1358">Decorating our Beverages</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing beverage order process, <a class="indexterm" href="#part0010_iddle1359">New barista training</a>, <a class="indexterm" href="#part0010_iddle1360">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing order code, <a class="indexterm" href="#part0010_iddle1361">Serving some coffees</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Java decorators, <a class="indexterm" href="#part0010_iddle1362">Real World Decorators: Java I/O</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing code, <a class="indexterm" href="#part0010_iddle1363">Writing the Starbuzz code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">decoupling, Iterator allowing, <a class="indexterm" href="#part0016_iddle1364">What we have so far...</a>, <a class="indexterm" href="#part0016_iddle1365">What does this get us?</a>, <a class="indexterm" href="#part0016_iddle1366">Iterator Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1367">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">delegation, adding behavior at runtime, <a class="indexterm" href="#part0010_iddle1368">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dependence, in Observer Pattern, <a class="indexterm" href="#part0009_iddle1369">The Observer Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle1370">The Dependency Inversion Principle</a>, <a class="indexterm" href="#part0015_iddle1371">The Hollywood Principle and Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dependency rot, <a class="indexterm" href="#part0015_iddle1372">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Design Patterns</div><blockquote class="variable_list_definition"><div class="variable_list_term">becoming writer of, <a class="indexterm" href="#part0020_iddle1373">So you wanna be a Design Patterns writer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">behavioral patterns category, <a class="indexterm" href="#part0020_iddle1374">Pattern Categories</a>, <a class="indexterm" href="#part0020_iddle1375">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">categories of, <a class="indexterm" href="#part0020_iddle1376">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class patterns, <a class="indexterm" href="#part0020_iddle1377">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creational patterns category, <a class="indexterm" href="#part0020_iddle1378">Pattern Categories</a>, <a class="indexterm" href="#part0020_iddle1379">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0020_iddle1380">Design Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">discovering own, <a class="indexterm" href="#part0020_iddle1381">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle1382">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">frameworks vs., <a class="indexterm" href="#part0008_iddle1383">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">guide to better living with, <a class="indexterm" href="#part0020_iddle1384">Better Living with Patterns: Patterns in the Real World</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implement on interface in, <a class="indexterm" href="#part0011_iddle1385">The Simple Factory defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">libraries vs., <a class="indexterm" href="#part0008_iddle1386">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object patterns, <a class="indexterm" href="#part0020_iddle1387">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">organizing, <a class="indexterm" href="#part0020_iddle1388">Organizing Design Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">overusing, <a class="indexterm" href="#part0020_iddle1389">Your Mind on Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">resources for, <a class="indexterm" href="#part0020_iddle1390">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">rule of three applied to, <a class="indexterm" href="#part0020_iddle1391">So you wanna be a Design Patterns writer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">structural patterns category, <a class="indexterm" href="#part0020_iddle1392">Pattern Categories</a>, <a class="indexterm" href="#part0020_iddle1393">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">thinking in patterns, <a class="indexterm" href="#part0020_iddle1394">Thinking in Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0008_iddle1395">How do I use Design Patterns?</a>, <a class="indexterm" href="#part0020_iddle1396">If you don’t need it now, don’t do it now.</a>, <a class="indexterm" href="#part0020_iddle1397">Your Mind on Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">your mind on patterns, <a class="indexterm" href="#part0020_iddle1398">Your Mind on Patterns</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Design Patterns: Reusable Object-Oriented Software (Gamma et al.), <a class="indexterm" href="#part0020_iddle1399">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">design principles</div><blockquote class="variable_list_definition"><div class="variable_list_term">Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle1400">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing upon abstractions, <a class="indexterm" href="#part0011_iddle1401">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulate what varies, <a class="indexterm" href="#part0008_iddle1402">Zeroing in on the problem...</a>, <a class="indexterm" href="#part0009_iddle1403">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle1404">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0011_iddle1405">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">favor composition over inheritance, <a class="indexterm" href="#part0008_iddle1406">HAS-A can be better than IS-A</a>, <a class="indexterm" href="#part0009_iddle1407">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle1408">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0017_iddle1409">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">One Class, One Responsibility Principle, <a class="indexterm" href="#part0012_iddle1411">Congratulations!</a>, <a class="indexterm" href="#part0016_iddle1412">Single Responsibility</a>, <a class="indexterm" href="#part0016_iddle1413">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">one instance. (see Singleton Pattern)</div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Open-Closed Principle, <a class="indexterm" href="#part0010_iddle1415">The Open-Closed Principle</a>, <a class="indexterm" href="#part0016_iddle1416">Is the Waitress ready for prime time?</a>, <a class="indexterm" href="#part0017_iddle1417">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Principle of Least Knowledge, <a class="indexterm" href="#part0014_iddle1418">The Principle of Least Knowledge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">program to an interface, not an implementation, <a class="indexterm" href="#part0008_iddle1419">Designing the Duck Behaviors</a>, <a class="indexterm" href="#part0009_iddle1420">The dark side of java.util.Observable</a>, <a class="indexterm" href="#part0009_iddle1421">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle1422">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0016_iddle1423">What does this get us?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Single Responsibility Principle, <a class="indexterm" href="#part0016_iddle1424">Single Responsibility</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">strive for loosely coupled designs between objects that interact, <a class="indexterm" href="#part0009_iddle1425">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hollywood Principle, <a class="indexterm" href="#part0015_iddle1410">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Observer Pattern, <a class="indexterm" href="#part0009_iddle1426">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle1427">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Design Puzzles</div><blockquote class="variable_list_definition"><div class="variable_list_term">drawing class diagram making use of view and controller, <a class="indexterm" href="#part0019_iddle1428">Now for the Controller</a>, <a class="indexterm" href="#part0019_iddle1429">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing parallel set of classes, <a class="indexterm" href="#part0011_iddle1430">Another perspective: parallel class hierarchies</a>, <a class="indexterm" href="#part0011_iddle1431">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing state diagram, <a class="indexterm" href="#part0017_iddle1432">You knew it was coming... a change request!</a>, <a class="indexterm" href="#part0017_iddle1433">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">of classes and interfaces, <a class="indexterm" href="#part0008_iddle1434">Speaking of Design Patterns...</a>, <a class="indexterm" href="#part0008_iddle1435">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">redesigning classes to remove redundancy, <a class="indexterm" href="#part0015_iddle1436">It’s time for some more caffeine</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">redesigning Image Proxy, <a class="indexterm" href="#part0018_iddle1437">Writing the Image Proxy</a>, <a class="indexterm" href="#part0018_iddle1438">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">dessert submenu, using Composite Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1439">Just when we thought it was safe...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0016_iddle1440">Designing Menus with Composite</a>, <a class="indexterm" href="#part0016_iddle1441">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0016_iddle1442">Implementing the Menu Component</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0016_iddle1443">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Iterators in, <a class="indexterm" href="#part0016_iddle1444">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">diner menus, merging (Iterator Pattern)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1445">Breaking News: Objectville Diner and Objectville Pancake House Merge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterators, <a class="indexterm" href="#part0016_iddle1446">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code using java.util.Iterator, <a class="indexterm" href="#part0016_iddle1447">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating Iterator, <a class="indexterm" href="#part0016_iddle1448">Can we encapsulate the iteration?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing Iterators for, <a class="indexterm" href="#part0016_iddle1449">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing of, <a class="indexterm" href="#part0016_iddle1450">Lou and Mel’s Menu implementations</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">DJ View, <a class="indexterm" href="#part0019_iddle1451">Using MVC to control the beat...</a>, <a class="indexterm" href="#part0019_iddle1452">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Domain-Specific Patterns, <a class="indexterm" href="#part0020_iddle1453">The Patterns Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">double-checked locking, reducing use of synchronization using, <a class="indexterm" href="#part0012_iddle1454">3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Duck Magnets exercises, object and class object and class adapters, <a class="indexterm" href="#part0014_iddle1455">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">duck simulator, rebuilding</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1456">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Abstract Factory Pattern, <a class="indexterm" href="#part0019_iddle1457">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1458">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Adapter Pattern, <a class="indexterm" href="#part0019_iddle1459">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Composite Pattern, <a class="indexterm" href="#part0019_iddle1460">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Decorator Pattern, <a class="indexterm" href="#part0019_iddle1461">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterator Pattern, <a class="indexterm" href="#part0019_iddle1462">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Observer Pattern, <a class="indexterm" href="#part0019_iddle1463">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0019_iddle1464">A duck’s eye view: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">dumb command objects, <a class="indexterm" href="#part0013_iddle1465">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dynamic aspect of dynamic proxies, <a class="indexterm" href="#part0018_iddle1466">Running the code...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dynamic proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">creating, <a class="indexterm" href="#part0018_iddle1467">Big Picture: creating a Dynamic Proxy for the PersonBean</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using to create proxy implementation, <a class="indexterm" href="#part0018_iddle1468">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></div><div class="indexdiv"><h3>E</h3><div class="variable_list_term">encapsulate what varies, <a class="indexterm" href="#part0008_iddle1469">Zeroing in on the problem...</a>, <a class="indexterm" href="#part0009_iddle1470">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle1471">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0011_iddle1472">Factory Method Pattern defined</a>, <a class="indexterm" href="#part0017_iddle1473">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating algorithms</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle1474">The Template Method Pattern: Encapsulating Algorithms</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">abstracting prepareRecipe(), <a class="indexterm" href="#part0015_iddle1475">Abstracting prepareRecipe()</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating behavior, <a class="indexterm" href="#part0008_iddle1486">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating code</div><blockquote class="variable_list_definition"><div class="variable_list_term">in behaviors, <a class="indexterm" href="#part0008_iddle1487">The Big Picture on encapsulated behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in object creation, <a class="indexterm" href="#part0011_iddle1488">Encapsulating object creation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object creation, <a class="indexterm" href="#part0011_iddle1489">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Template Method Pattern and</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle1476">Meet the Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">applets in, <a class="indexterm" href="#part0015_iddle1477">Applets</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0015_iddle1478">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0015_iddle1479">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hooks in, <a class="indexterm" href="#part0015_iddle1481">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in real world, <a class="indexterm" href="#part0015_iddle1482">Template Methods in the Wild</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sorting with, <a class="indexterm" href="#part0015_iddle1483">Sorting with Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Swing and, <a class="indexterm" href="#part0015_iddle1484">Swingin’ with Frames</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0015_iddle1485">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hollywood Principle and, <a class="indexterm" href="#part0015_iddle1480">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">encapsulating iteration, <a class="indexterm" href="#part0016_iddle1490">Can we encapsulate the iteration?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating method invocation, <a class="indexterm" href="#part0013_iddle1491">The Command Pattern: Encapsulating Invocation</a>, <a class="indexterm" href="#part0013_iddle1492">The Command Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating object construction, <a class="indexterm" href="#part0021_iddle1493">Builder</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating requests, <a class="indexterm" href="#part0013_iddle1494">The Command Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating subsystem, Facades, <a class="indexterm" href="#part0014_iddle1495">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Enumeration</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle1496">Real-world adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adapting to Iterator, <a class="indexterm" href="#part0014_iddle1497">Adapting an Enumeration to an Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">java.util.Enumeration as older implementation of Iterator, <a class="indexterm" href="#part0014_iddle1498">Real-world adapters</a>, <a class="indexterm" href="#part0016_iddle1499">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">remove() method and, <a class="indexterm" href="#part0014_iddle1500">Dealing with the remove() method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Adapter that adapts Iterator to, <a class="indexterm" href="#part0014_iddle1501">Writing the EnumerationIterator adapter</a>, <a class="indexterm" href="#part0014_iddle1502">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">exercises</div><blockquote class="variable_list_definition"><div class="variable_list_term">Be the JVM solution, dealing with multithreading, <a class="indexterm" href="#part0012_iddle1503">Houston, Hershey, PA we have a problem...</a>, <a class="indexterm" href="#part0012_iddle1504">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Code Magnets</div><blockquote class="variable_list_definition"><div class="variable_list_term">for DinerMenu Iterator, <a class="indexterm" href="#part0016_iddle1505">Iterators and Collections</a>, <a class="indexterm" href="#part0016_iddle1506">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">for Observer Pattern, <a class="indexterm" href="#part0009_iddle1507">Reworking the Weather Station with the built-in support</a>, <a class="indexterm" href="#part0009_iddle1508">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">dealing with multithreading, <a class="indexterm" href="#part0014_iddle1509">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Design Puzzles</div><blockquote class="variable_list_definition"><div class="variable_list_term">drawing class diagram making use of view and controller, <a class="indexterm" href="#part0019_iddle1510">Now for the Controller</a>, <a class="indexterm" href="#part0019_iddle1511">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing state diagram, <a class="indexterm" href="#part0017_iddle1512">You knew it was coming... a change request!</a>, <a class="indexterm" href="#part0017_iddle1513">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">of classes and interfaces, <a class="indexterm" href="#part0008_iddle1514">Speaking of Design Patterns...</a>, <a class="indexterm" href="#part0008_iddle1515">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">redesigning classes to remove redundancy, <a class="indexterm" href="#part0015_iddle1516">And now the Tea...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">redesigning Image Proxy, <a class="indexterm" href="#part0018_iddle1517">Writing the Image Proxy</a>, <a class="indexterm" href="#part0018_iddle1518">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Duck Magnets exercises, object and class object and class adapters, <a class="indexterm" href="#part0014_iddle1519">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing Iterator, <a class="indexterm" href="#part0016_iddle1520">Reworking the Diner Menu with Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing undo button for macro command, <a class="indexterm" href="#part0013_iddle1521">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1522">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Sharpen Your Pencil</div><blockquote class="variable_list_definition"><div class="variable_list_term">altering decorator classes, <a class="indexterm" href="#part0010_iddle1523">Serving some coffees</a>, <a class="indexterm" href="#part0010_iddle1524">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating Gumball Machine states, <a class="indexterm" href="#part0017_iddle1525">Let’s take a look at what we’ve done so far...</a>, <a class="indexterm" href="#part0017_iddle1526">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating state diagram, <a class="indexterm" href="#part0017_iddle1527">Defining the State interfaces and classes</a>, <a class="indexterm" href="#part0017_iddle1528">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building ingredient factory, <a class="indexterm" href="#part0011_iddle1529">Building the New York ingredient factory</a>, <a class="indexterm" href="#part0011_iddle1530">A very dependent PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing classes for Decorator Pattern, <a class="indexterm" href="#part0019_iddle1531">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1532">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing code to fit framework in Iterator Pattern, <a class="indexterm" href="#part0016_iddle1533">Taking a look at the Café Menu</a>, <a class="indexterm" href="#part0016_iddle1534">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">choosing descriptions of state of implementation, <a class="indexterm" href="#part0017_iddle1535">The messy STATE of things...</a>, <a class="indexterm" href="#part0017_iddle1536">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram for implementation of prepareRecipe(), <a class="indexterm" href="#part0015_iddle1537">Abstracting prepareRecipe()</a>, <a class="indexterm" href="#part0015_iddle1538">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating commands for off buttons, <a class="indexterm" href="#part0013_iddle1539">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1540">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">determining classes violating Principle of Least Knowledge, <a class="indexterm" href="#part0014_iddle1541">Keeping your method calls in bounds...</a>, <a class="indexterm" href="#part0014_iddle1542">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing beverage order process, <a class="indexterm" href="#part0010_iddle1543">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">fixing Chocolate Boiler code, <a class="indexterm" href="#part0012_iddle1544">Meanwhile, back at the Chocolate Factory...</a>, <a class="indexterm" href="#part0012_iddle1545">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">identifying factors influencing design, <a class="indexterm" href="#part0010_iddle1546">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing garage door command, <a class="indexterm" href="#part0013_iddle1547">Creating a simple test to use the Remote Control</a>, <a class="indexterm" href="#part0013_iddle1548">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing state classes, <a class="indexterm" href="#part0017_iddle1549">Implementing more states</a>, <a class="indexterm" href="#part0017_iddle1550">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matching patterns with categories, <a class="indexterm" href="#part0020_iddle1551">Organizing Design Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">method for refilling gumball machine, <a class="indexterm" href="#part0017_iddle1552">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle1553">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on adding behaviors, <a class="indexterm" href="#part0008_iddle1554">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on implementation of printmenu(), <a class="indexterm" href="#part0016_iddle1555">The Java-Enabled Waitress Specification</a>, <a class="indexterm" href="#part0016_iddle1556">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on inheritance, <a class="indexterm" href="#part0008_iddle1557">Joe thinks about inheritance...</a>, <a class="indexterm" href="#part0008_iddle1558">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sketching out classes, <a class="indexterm" href="#part0009_iddle1559">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">things driving change, <a class="indexterm" href="#part0008_iddle1560">The one constant in software development</a>, <a class="indexterm" href="#part0008_iddle1561">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">turning class into Singleton, <a class="indexterm" href="#part0012_iddle1562">The Chocolate Factory</a>, <a class="indexterm" href="#part0012_iddle1563">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">weather station SWAG, <a class="indexterm" href="#part0009_iddle1564">Taking a first, misguided SWAG at the Weather Station</a>, <a class="indexterm" href="#part0009_iddle1565">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Abstract Factory Pattern, <a class="indexterm" href="#part0019_iddle1566">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1567">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing classes for adapters, <a class="indexterm" href="#part0014_iddle1568">Here’s how the Client uses the Adapter</a>, <a class="indexterm" href="#part0014_iddle1569">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing dynamic proxy, <a class="indexterm" href="#part0018_iddle1570">Step two: creating the Proxy class and instantiating the Proxy object</a>, <a class="indexterm" href="#part0018_iddle1571">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Flock observer code, <a class="indexterm" href="#part0019_iddle1572">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1573">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing methods for classes, <a class="indexterm" href="#part0010_iddle1574">Welcome to Starbuzz Coffee</a>, <a class="indexterm" href="#part0010_iddle1575">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Who Does What</div><blockquote class="variable_list_definition"><div class="variable_list_term">matching objects and methods to Command Pattern, <a class="indexterm" href="#part0013_iddle1576">From the Diner to the Command Pattern</a>, <a class="indexterm" href="#part0013_iddle1577">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matching pattern with description, <a class="indexterm" href="#part0015_iddle1580">The Hollywood Principle and Template Method</a>, <a class="indexterm" href="#part0015_iddle1581">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0016_iddle1582">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle1583">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0017_iddle1584">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle1585">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0018_iddle1586">Running the code...</a>, <a class="indexterm" href="#part0018_iddle1587">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle1588">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1589">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matching patterns with its intent, <a class="indexterm" href="#part0014_iddle1578">And now for something different...</a>, <a class="indexterm" href="#part0014_iddle1579">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">writing Adapter that adapts Iterator to Enumeration, <a class="indexterm" href="#part0014_iddle1590">Writing the EnumerationIterator adapter</a>, <a class="indexterm" href="#part0014_iddle1591">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing handler for matchmaking service, <a class="indexterm" href="#part0018_iddle1592">Creating Invocation Handlers continued...</a>, <a class="indexterm" href="#part0018_iddle1593">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">external iterators, <a class="indexterm" href="#part0016_iddle1594">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>F</h3><div class="variable_list_term">Facade Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle1595">And now for something different...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern vs., <a class="indexterm" href="#part0014_iddle1596">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">advantages, <a class="indexterm" href="#part0014_iddle1597">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">benefits of, <a class="indexterm" href="#part0014_iddle1598">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building home theater system</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle1599">Home Sweet Home Theater</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">constructing Facade in, <a class="indexterm" href="#part0014_iddle1600">Constructing your home theater facade</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing Facade class, <a class="indexterm" href="#part0014_iddle1601">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing interface, <a class="indexterm" href="#part0014_iddle1602">Implementing the simplified interface</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0014_iddle1603">Time to watch a movie (the easy way)</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0014_iddle1604">Facade Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Complexity Hiding Proxy vs., <a class="indexterm" href="#part0018_iddle1605">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0014_iddle1606">Facade Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0016_iddle1607">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle1608">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0018_iddle1609">Running the code...</a>, <a class="indexterm" href="#part0020_iddle1610">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1611">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching pattern with its intent, <a class="indexterm" href="#part0014_iddle1612">And now for something different...</a>, <a class="indexterm" href="#part0014_iddle1613">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Principle of Least Knowledge and, <a class="indexterm" href="#part0014_iddle1614">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">factory method</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0011_iddle1615">Declaring a factory method</a>, <a class="indexterm" href="#part0011_iddle1616">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">as abstract, <a class="indexterm" href="#part0011_iddle1617">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">declaring, <a class="indexterm" href="#part0011_iddle1618">Declaring a factory method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">parallel class hierarchies and, <a class="indexterm" href="#part0011_iddle1619">Another perspective: parallel class hierarchies</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Factory Method Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0011_iddle1620">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">about factory objects, <a class="indexterm" href="#part0011_iddle1621">Encapsulating object creation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Abstract Factory Pattern and, <a class="indexterm" href="#part0011_iddle1622">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0011_iddle1623">Reworking the pizzas, continued...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete classes and, <a class="indexterm" href="#part0011_iddle1624">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creator classes, <a class="indexterm" href="#part0011_iddle1625">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">declaring factory method, <a class="indexterm" href="#part0011_iddle1626">Declaring a factory method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0011_iddle1627">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle1628">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing parallel set of classes, <a class="indexterm" href="#part0011_iddle1629">Another perspective: parallel class hierarchies</a>, <a class="indexterm" href="#part0011_iddle1630">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle1631">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1632">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">looking at object dependencies, <a class="indexterm" href="#part0011_iddle1633">Looking at object dependencies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">parallel class hierarchies, <a class="indexterm" href="#part0011_iddle1634">Another perspective: parallel class hierarchies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">product classes, <a class="indexterm" href="#part0011_iddle1635">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Simple Factory and, <a class="indexterm" href="#part0011_iddle1636">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Factory Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">Abstract Factory</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0011_iddle1637">What have we done?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building ingredient factories, <a class="indexterm" href="#part0011_iddle1638">Building the ingredient factories</a>, <a class="indexterm" href="#part0011_iddle1639">A very dependent PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle1640">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1641">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0011_iddle1642">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle1643">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1644">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method Pattern and, <a class="indexterm" href="#part0011_iddle1645">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0011_iddle1646">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0015_iddle1647">The Hollywood Principle and Template Method</a>, <a class="indexterm" href="#part0015_iddle1648">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0011_iddle1649">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Abstract Factory and, <a class="indexterm" href="#part0011_iddle1650">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Abstract Factory in, <a class="indexterm" href="#part0011_iddle1651">What have we done?</a>, <a class="indexterm" href="#part0011_iddle1652">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">advantages of, <a class="indexterm" href="#part0011_iddle1653">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0011_iddle1654">Reworking the pizzas, continued...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creator classes, <a class="indexterm" href="#part0011_iddle1655">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">declaring factory method, <a class="indexterm" href="#part0011_iddle1656">Declaring a factory method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0011_iddle1657">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle1658">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing parallel set of classes, <a class="indexterm" href="#part0011_iddle1659">Another perspective: parallel class hierarchies</a>, <a class="indexterm" href="#part0011_iddle1660">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle1661">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1662">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">looking at object dependencies, <a class="indexterm" href="#part0011_iddle1663">Looking at object dependencies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">parallel class hierarchies, <a class="indexterm" href="#part0011_iddle1664">Another perspective: parallel class hierarchies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">product classes, <a class="indexterm" href="#part0011_iddle1665">It’s finally time to meet the Factory Method Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Simple Factory and, <a class="indexterm" href="#part0011_iddle1666">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Simple Factory</div><blockquote class="variable_list_definition"><div class="variable_list_term">about factory objects, <a class="indexterm" href="#part0011_iddle1667">Encapsulating object creation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building factory, <a class="indexterm" href="#part0011_iddle1668">Building a simple pizza factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0011_iddle1669">The Simple Factory defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method Pattern and, <a class="indexterm" href="#part0011_iddle1670">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">pattern honorable mention, <a class="indexterm" href="#part0011_iddle1671">The Simple Factory defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using new operator for instantiating concrete classes, <a class="indexterm" href="#part0011_iddle1672">The Factory Pattern: Baking with OO Goodness</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">favor composition over inheritance, <a class="indexterm" href="#part0008_iddle1673">HAS-A can be better than IS-A</a>, <a class="indexterm" href="#part0009_iddle1674">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle1675">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0017_iddle1676">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Firewall Proxy, <a class="indexterm" href="#part0018_iddle1677">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Flyweight Pattern, <a class="indexterm" href="#part0021_iddle1678">Flyweight</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">forces, <a class="indexterm" href="#part0020_iddle1679">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">frameworks vs. libraries, <a class="indexterm" href="#part0008_iddle1680">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>G</h3><div class="variable_list_term">Gamma, Erich, <a class="indexterm" href="#part0020_iddle1681">Cruisin’ Objectville with the Gang of Four</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Gang of Four (GoF)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0020_iddle1682">Looking more closely at the Design Pattern definition</a>, <a class="indexterm" href="#part0020_iddle1683">Cruisin’ Objectville with the Gang of Four</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">catalogs, <a class="indexterm" href="#part0020_iddle1684">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">garbage collectors, <a class="indexterm" href="#part0012_iddle1685">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">global access point, <a class="indexterm" href="#part0012_iddle1686">Singleton Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">global variables vs. Singleton, <a class="indexterm" href="#part0012_iddle1687">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">guide to better living with Design Patterns, <a class="indexterm" href="#part0020_iddle1688">Better Living with Patterns: Patterns in the Real World</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">gumball machine controller implementation, using State Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0017_iddle1689">Jawva Breakers</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code, <a class="indexterm" href="#part0017_iddle1690">Sanity check...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">demonstration of, <a class="indexterm" href="#part0017_iddle1691">Demo for the CEO of Mighty Gumball, Inc.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">diagram to code, <a class="indexterm" href="#part0017_iddle1692">State machines 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">finishing, <a class="indexterm" href="#part0017_iddle1693">Finishing the game</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">one in ten contest</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0017_iddle1694">You knew it was coming... a change request!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating state diagram, <a class="indexterm" href="#part0017_iddle1695">Defining the State interfaces and classes</a>, <a class="indexterm" href="#part0017_iddle1696">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing code, <a class="indexterm" href="#part0017_iddle1697">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing state diagram, <a class="indexterm" href="#part0017_iddle1698">You knew it was coming... a change request!</a>, <a class="indexterm" href="#part0017_iddle1699">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing state classes, <a class="indexterm" href="#part0017_iddle1700">Implementing our State classes</a>, <a class="indexterm" href="#part0017_iddle1701">Implementing more states</a>, <a class="indexterm" href="#part0017_iddle1702">We still need to finish the Gumball 1 in 10 game</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">new design, <a class="indexterm" href="#part0017_iddle1703">The new design</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking state classes, <a class="indexterm" href="#part0017_iddle1704">Reworking the Gumball Machine</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">refilling gumball machine, <a class="indexterm" href="#part0017_iddle1705">We almost forgot!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">SoldState and WinnerState in, <a class="indexterm" href="#part0017_iddle1706">Demo for the CEO of Mighty Gumball, Inc.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0017_iddle1707">In-house testing</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing code, <a class="indexterm" href="#part0017_iddle1708">Writing the code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">gumball machine monitoring, using Proxy Patterns</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1709">The Proxy Pattern: Controlling Object Access</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Remote Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1710">Testing the Monitor</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding to monitoring code, <a class="indexterm" href="#part0018_iddle1711">Adding a remote proxy to the Gumball Machine monitoring code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">preparing for remote service, <a class="indexterm" href="#part0018_iddle1712">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle1713">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reusing client for, <a class="indexterm" href="#part0018_iddle1714">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle1715">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">role of, <a class="indexterm" href="#part0018_iddle1716">The role of the ‘remote proxy’</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle1717">Writing the Monitor test drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping objects and, <a class="indexterm" href="#part0018_iddle1718">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote></div><div class="indexdiv"><h3>H</h3><div class="variable_list_term">HAS-A relationships</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0008_iddle1719">HAS-A can be better than IS-A</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping components, <a class="indexterm" href="#part0010_iddle1720">The Decorator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">HashMap, <a class="indexterm" href="#part0016_iddle1721">Reworking the Café Menu code</a>, <a class="indexterm" href="#part0016_iddle1722">Iterators and Collections</a>, <a class="indexterm" href="#part0016_iddle1723">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hasNext() method</div><blockquote class="variable_list_definition"><div class="variable_list_term">in arrays, <a class="indexterm" href="#part0016_iddle1724">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in java.util.Iterator, <a class="indexterm" href="#part0016_iddle1725">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Head First learning principles, <a class="indexterm" href="#part0007_iddle1726">And we know what your brain is thinking.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Head First Servlets &amp; JSP (Basham, Sierra and Bates), <a class="indexterm" href="#part0019_iddle1727">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Helm, Richard, <a class="indexterm" href="#part0020_iddle1728">Cruisin’ Objectville with the Gang of Four</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">high-level component classes, <a class="indexterm" href="#part0011_iddle1729">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hillside Group (website), <a class="indexterm" href="#part0020_iddle1730">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hollywood Principle, <a class="indexterm" href="#part0015_iddle1731">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">home automation remote control, using Command Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1732">Taking a look at the vendor classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building, <a class="indexterm" href="#part0013_iddle1733">Our first command object</a>, <a class="indexterm" href="#part0013_iddle1734">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0013_iddle1735">The Command Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">command classes in</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1736">The Command Pattern means lots of command classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">passing method references, <a class="indexterm" href="#part0013_iddle1737">Simplifying even more with method references</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using lambda expressions, <a class="indexterm" href="#part0013_iddle1738">Simplifying the Remote Control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">creating commands to be loaded, <a class="indexterm" href="#part0013_iddle1739">The Command Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">defining, <a class="indexterm" href="#part0013_iddle1740">The Command Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0013_iddle1741">Cubicle Conversation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">display of on and off slots, <a class="indexterm" href="#part0013_iddle1742">Check out the results of all those lambda expression commands...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0013_iddle1743">Implementing the Commands</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">macro commands</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1744">Every remote needs a Party Mode!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hard coding vs., <a class="indexterm" href="#part0013_iddle1745">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">undo button, <a class="indexterm" href="#part0013_iddle1746">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1747">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0013_iddle1748">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">mapping, <a class="indexterm" href="#part0013_iddle1749">From the Diner to the Command Pattern</a>, <a class="indexterm" href="#part0013_iddle1750">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Null Object, <a class="indexterm" href="#part0013_iddle1751">Now, let’s check out the execution of our remote control test...</a>, <a class="indexterm" href="#part0013_iddle1752">Test the remote control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0013_iddle1753">Using the command object</a>, <a class="indexterm" href="#part0013_iddle1754">Putting the Remote Control through its paces</a>, <a class="indexterm" href="#part0013_iddle1755">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1756">Test the remote control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">undo commands</div><blockquote class="variable_list_definition"><div class="variable_list_term">creating, <a class="indexterm" href="#part0013_iddle1757">Time to write that documentation...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating multiple, <a class="indexterm" href="#part0013_iddle1758">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing for macro command, <a class="indexterm" href="#part0013_iddle1759">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0013_iddle1760">Time to QA that Undo button!</a>, <a class="indexterm" href="#part0013_iddle1761">Get ready to test the ceiling fan</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using state to implement, <a class="indexterm" href="#part0013_iddle1762">Using state to implement Undo</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">vendor classes for, <a class="indexterm" href="#part0013_iddle1763">Taking a look at the vendor classes</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing documentation, <a class="indexterm" href="#part0013_iddle1764">Time to write that documentation...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">home theater system, building</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle1765">Home Sweet Home Theater</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">constructing Facade in, <a class="indexterm" href="#part0014_iddle1766">Constructing your home theater facade</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing interface, <a class="indexterm" href="#part0014_iddle1767">Implementing the simplified interface</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Sharpen Your Pencil, <a class="indexterm" href="#part0014_iddle1768">Keeping your method calls in bounds...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0014_iddle1769">Time to watch a movie (the easy way)</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Facade Pattern, <a class="indexterm" href="#part0014_iddle1770">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">hooks, in Template Method Pattern, <a class="indexterm" href="#part0015_iddle1771">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>I</h3><div class="variable_list_term">Image Proxy, writing, <a class="indexterm" href="#part0018_iddle1772">Writing the Image Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implement on interface, in design patterns, <a class="indexterm" href="#part0011_iddle1777">The Simple Factory defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Implementation section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1775">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementations</div><blockquote class="variable_list_definition"><div class="variable_list_term">coding to, <a class="indexterm" href="#part0009_iddle1773">What’s wrong with our implementation?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">programming, <a class="indexterm" href="#part0008_iddle1774">More integration...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">implementing behaviors, <a class="indexterm" href="#part0008_iddle1776">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">import and package statements, <a class="indexterm" href="#part0011_iddle1778">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">inheritance</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0008_iddle1779">Joe thinks about inheritance...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">composition vs., <a class="indexterm" href="#part0010_iddle1780">Cubicle Conversation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">disadvantages, <a class="indexterm" href="#part0008_iddle1781">Joe thinks about inheritance...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">disadvantages of, <a class="indexterm" href="#part0010_iddle1782">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">favoring composition over, <a class="indexterm" href="#part0008_iddle1783">HAS-A can be better than IS-A</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">for maintenance, <a class="indexterm" href="#part0008_iddle1784">But something went horribly wrong...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">for reuse, <a class="indexterm" href="#part0008_iddle1785">But something went horribly wrong...</a>, <a class="indexterm" href="#part0008_iddle1786">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing multiple, <a class="indexterm" href="#part0014_iddle1787">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">instance variables</div><blockquote class="variable_list_definition"><div class="variable_list_term">using instead of classes, <a class="indexterm" href="#part0010_iddle1788">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping to object, <a class="indexterm" href="#part0010_iddle1789">Coding condiments</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">instantiating concrete classes</div><blockquote class="variable_list_definition"><div class="variable_list_term">in objects, <a class="indexterm" href="#part0011_iddle1790">Looking at object dependencies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using new operator for, <a class="indexterm" href="#part0011_iddle1791">The Factory Pattern: Baking with OO Goodness</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">instantiating one object, <a class="indexterm" href="#part0012_iddle1792">The Singleton Pattern: One of a Kind Objects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">integrating behaviors, <a class="indexterm" href="#part0008_iddle1793">Integrating the Duck Behavior</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">integrating Cafe Menu, using Iterator Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1794">Taking a look at the Café Menu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking code, <a class="indexterm" href="#part0016_iddle1795">Reworking the Café Menu code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Intent section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1796">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">interface</div><blockquote class="variable_list_definition"><div class="variable_list_term">coding to, <a class="indexterm" href="#part0011_iddle1797">The Factory Pattern: Baking with OO Goodness</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">programming to, <a class="indexterm" href="#part0008_iddle1798">Designing the Duck Behaviors</a>, <a class="indexterm" href="#part0009_iddle1799">The dark side of java.util.Observable</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">interface type, <a class="indexterm" href="#part0008_iddle1800">Integrating the Duck Behavior</a>, <a class="indexterm" href="#part0008_iddle1801">Testing the Duck code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">internal iterators, <a class="indexterm" href="#part0016_iddle1802">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Interpreter Pattern, <a class="indexterm" href="#part0021_iddle1803">Interpreter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">inversion, in Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle1804">Applying the Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">invoker, <a class="indexterm" href="#part0013_iddle1805">From the Diner to the Command Pattern</a>, <a class="indexterm" href="#part0013_iddle1806">The Command Pattern defined</a>, <a class="indexterm" href="#part0013_iddle1807">Assigning Commands to slots</a>, <a class="indexterm" href="#part0013_iddle1808">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Iterator Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1809">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0016_iddle1810">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close using HashMap, <a class="indexterm" href="#part0016_iddle1811">Reworking the Café Menu code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code violating Open-Closed Principle, <a class="indexterm" href="#part0016_iddle1812">Is the Waitress ready for prime time?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Collections and, <a class="indexterm" href="#part0016_iddle1813">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle1814">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern and, <a class="indexterm" href="#part0016_iddle1815">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0016_iddle1816">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0016_iddle1817">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle1818">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle1819">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle1820">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">integrating Cafe Menu</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1821">Taking a look at the Café Menu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking code, <a class="indexterm" href="#part0016_iddle1822">Reworking the Café Menu code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">java.util.Iterator, <a class="indexterm" href="#part0016_iddle1823">Making some improvements...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">merging diner menus</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1824">Breaking News: Objectville Diner and Objectville Pancake House Merge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterators, <a class="indexterm" href="#part0016_iddle1825">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code using java.util.Iterator, <a class="indexterm" href="#part0016_iddle1826">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating Iterator, <a class="indexterm" href="#part0016_iddle1827">Can we encapsulate the iteration?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing Iterators for, <a class="indexterm" href="#part0016_iddle1828">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing of, <a class="indexterm" href="#part0016_iddle1829">Lou and Mel’s Menu implementations</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Null Iterator, <a class="indexterm" href="#part0016_iddle1830">Flashback to Iterator</a>, <a class="indexterm" href="#part0016_iddle1831">The Null Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">removing objects, <a class="indexterm" href="#part0016_iddle1832">Making some improvements...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Single Responsibility Principle, <a class="indexterm" href="#part0016_iddle1833">Single Responsibility</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Iterators</div><blockquote class="variable_list_definition"><div class="variable_list_term">adding, <a class="indexterm" href="#part0016_iddle1834">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">allowing decoupling, <a class="indexterm" href="#part0016_iddle1835">What we have so far...</a>, <a class="indexterm" href="#part0016_iddle1836">What does this get us?</a>, <a class="indexterm" href="#part0016_iddle1837">Iterator Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1838">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code using java.util.Iterator, <a class="indexterm" href="#part0016_iddle1839">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Collections and, <a class="indexterm" href="#part0016_iddle1840">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating, <a class="indexterm" href="#part0016_iddle1841">Can we encapsulate the iteration?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Enumeration adapting to, <a class="indexterm" href="#part0014_iddle1842">Adapting an Enumeration to an Iterator</a>, <a class="indexterm" href="#part0016_iddle1843">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">external, <a class="indexterm" href="#part0016_iddle1844">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">HashMap and, <a class="indexterm" href="#part0016_iddle1845">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0016_iddle1846">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">internal and external, <a class="indexterm" href="#part0016_iddle1847">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">ordering of, <a class="indexterm" href="#part0016_iddle1848">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">polymorphic code using, <a class="indexterm" href="#part0016_iddle1849">Iterator Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1850">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using ListInterator, <a class="indexterm" href="#part0016_iddle1851">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using with Composite Pattern, <a class="indexterm" href="#part0016_iddle1852">Flashback to Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Adapter for Enumeration, <a class="indexterm" href="#part0014_iddle1853">Dealing with the remove() method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Adapter that adapts to Enumeration, <a class="indexterm" href="#part0014_iddle1854">Writing the EnumerationIterator adapter</a>, <a class="indexterm" href="#part0014_iddle1855">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></div><div class="indexdiv"><h3>J</h3><div class="variable_list_term">Java Collections Framework, <a class="indexterm" href="#part0016_iddle1856">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Java decorators (java.io packages), <a class="indexterm" href="#part0010_iddle1857">Real World Decorators: Java I/O</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Java Virtual Machines (JVMs)</div><blockquote class="variable_list_definition"><div class="variable_list_term">bug in garbage collector, <a class="indexterm" href="#part0012_iddle1868">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Remote Method Invocation (RMI), <a class="indexterm" href="#part0018_iddle1869">Adding a remote proxy to the Gumball Machine monitoring code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">support of volatile keyword, <a class="indexterm" href="#part0012_iddle1870">3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">java.lang.reflect package, proxy support in, <a class="indexterm" href="#part0018_iddle1858">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle1859">Using the Java API’s Proxy to create a protection proxy</a>, <a class="indexterm" href="#part0018_iddle1860">Creating Invocation Handlers continued...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">java.util, built-in Observer Pattern, <a class="indexterm" href="#part0009_iddle1861">Using Java’s built-in Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">java.util.Collection, <a class="indexterm" href="#part0016_iddle1862">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">java.util.Enumeration, as older implementation of Iterator, <a class="indexterm" href="#part0014_iddle1863">Real-world adapters</a>, <a class="indexterm" href="#part0016_iddle1864">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">java.util.Iterator</div><blockquote class="variable_list_definition"><div class="variable_list_term">cleaning up code using, <a class="indexterm" href="#part0016_iddle1865">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">interface of, <a class="indexterm" href="#part0016_iddle1866">Making some improvements...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0016_iddle1867">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">JButton, in Swing API, <a class="indexterm" href="#part0009_iddle1871">Other places you’ll find the Observer Pattern in the JDK</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">JFrames, Swing, <a class="indexterm" href="#part0015_iddle1872">Swingin’ with Frames</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Johnson, Ralph, <a class="indexterm" href="#part0020_iddle1873">Cruisin’ Objectville with the Gang of Four</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>K</h3><div class="variable_list_term">Kathy Sierra, (Head First Servlets &amp; JSP), <a class="indexterm" href="#part0019_iddle1874">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">KISS (Keep It Simple), in designing patterns, <a class="indexterm" href="#part0020_iddle1875">Thinking in Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Known Uses section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1876">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>L</h3><div class="variable_list_term">lambda expressions, <a class="indexterm" href="#part0009_iddle1877">And the code...</a>, <a class="indexterm" href="#part0013_iddle1878">Simplifying the Remote Control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Law of Demeter, <a class="indexterm" href="#part0014_iddle1879">Keeping your method calls in bounds...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">lazy instantiation, <a class="indexterm" href="#part0012_iddle1880">Singleton Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">leaves, in Composite Pattern tree structure, <a class="indexterm" href="#part0016_iddle1881">The Composite Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1882">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">libraries</div><blockquote class="variable_list_definition"><div class="variable_list_term">design patterns vs., <a class="indexterm" href="#part0008_iddle1883">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">frameworks vs., <a class="indexterm" href="#part0008_iddle1884">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">LinkedList, <a class="indexterm" href="#part0016_iddle1885">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">ListInterator, <a class="indexterm" href="#part0016_iddle1886">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">logging requests, using Command Pattern, <a class="indexterm" href="#part0013_iddle1887">More uses of the Command Pattern: logging requests</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">looping through array items, <a class="indexterm" href="#part0016_iddle1888">The Java-Enabled Waitress Specification</a>, <a class="indexterm" href="#part0016_iddle1889">What now?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">loose coupling, <a class="indexterm" href="#part0009_iddle1890">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>M</h3><div class="variable_list_term">macro commands</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0013_iddle1891">Every remote needs a Party Mode!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">macro commands</div><blockquote class="variable_list_definition"><div class="variable_list_term">hard coding vs., <a class="indexterm" href="#part0013_iddle1892">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">undo button, <a class="indexterm" href="#part0013_iddle1893">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle1894">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0013_iddle1895">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">magic bullet, Design Patterns as not, <a class="indexterm" href="#part0020_iddle1896">Thinking in Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">maintenance, inheritance for, <a class="indexterm" href="#part0008_iddle1897">But something went horribly wrong...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matchmaking service, using Proxy Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1898">Matchmaking in Objectville</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating dynamic proxy, <a class="indexterm" href="#part0018_iddle1899">Big Picture: creating a Dynamic Proxy for the PersonBean</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0018_iddle1900">The PersonBean implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">protecting subjects, <a class="indexterm" href="#part0018_iddle1901">Five-minute drama: protecting subjects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle1902">Testing the matchmaking service</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Mediator Pattern, <a class="indexterm" href="#part0019_iddle1903">Composite</a>, <a class="indexterm" href="#part0021_iddle1904">Mediator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Memento Pattern, <a class="indexterm" href="#part0021_iddle1905">Memento</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">merging diner menus (Iterator Pattern)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0016_iddle1906">Breaking News: Objectville Diner and Objectville Pancake House Merge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterators, <a class="indexterm" href="#part0016_iddle1907">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code using java.util.Iterator, <a class="indexterm" href="#part0016_iddle1908">Cleaning things up with java.util.Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating Iterator, <a class="indexterm" href="#part0016_iddle1909">Can we encapsulate the iteration?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing Iterators for, <a class="indexterm" href="#part0016_iddle1910">Meet the Iterator Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing of, <a class="indexterm" href="#part0016_iddle1911">Lou and Mel’s Menu implementations</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">method of objects, components of object vs., <a class="indexterm" href="#part0014_iddle1912">The Principle of Least Knowledge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">method references, passing, <a class="indexterm" href="#part0013_iddle1913">Simplifying even more with method references</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">methods</div><blockquote class="variable_list_definition"><div class="variable_list_term">as hooks, <a class="indexterm" href="#part0015_iddle1914">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">overriding from implemented, <a class="indexterm" href="#part0011_iddle1915">A few guidelines to help you follow the Principle...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Model 2</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1916">MVC and the Web</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern, <a class="indexterm" href="#part0019_iddle1917">Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">from cell phone, <a class="indexterm" href="#part0019_iddle1918">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer Pattern, <a class="indexterm" href="#part0019_iddle1919">Design Patterns and Model 2</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern, <a class="indexterm" href="#part0019_iddle1920">Strategy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Model-View-Controller (MVC)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1922">If Elvis were a compound pattern, his name would be Model-View-Controller, and he’d be singing a little song like this...</a>, <a class="indexterm" href="#part0019_iddle1923">Meet the Model-View-Controller</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapter Pattern, <a class="indexterm" href="#part0019_iddle1924">Adapting the Model</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Beat model, <a class="indexterm" href="#part0019_iddle1925">Meet the Java DJ View</a>, <a class="indexterm" href="#part0019_iddle1926">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Composite Pattern, <a class="indexterm" href="#part0019_iddle1927">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1928">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">controllers per view, <a class="indexterm" href="#part0019_iddle1929">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Heart controller, <a class="indexterm" href="#part0019_iddle1930">Now we’re ready for a HeartController</a>, <a class="indexterm" href="#part0019_iddle1931">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Heart model, <a class="indexterm" href="#part0019_iddle1932">Exploring Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing controller, <a class="indexterm" href="#part0019_iddle1933">Now for the Controller</a>, <a class="indexterm" href="#part0019_iddle1934">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing DJ View, <a class="indexterm" href="#part0019_iddle1935">Using MVC to control the beat...</a>, <a class="indexterm" href="#part0019_iddle1936">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Mediator Pattern, <a class="indexterm" href="#part0019_iddle1937">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">model in, <a class="indexterm" href="#part0019_iddle1938">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer Pattern, <a class="indexterm" href="#part0019_iddle1939">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1940">Building the pieces</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">song, <a class="indexterm" href="#part0019_iddle1941">If Elvis were a compound pattern, his name would be Model-View-Controller, and he’d be singing a little song like this...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">state of model, <a class="indexterm" href="#part0019_iddle1942">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern, <a class="indexterm" href="#part0019_iddle1943">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle1944">Now for the Controller</a>, <a class="indexterm" href="#part0019_iddle1945">Exploring Strategy</a>, <a class="indexterm" href="#part0019_iddle1946">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0019_iddle1947">Putting it all together...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">views accessing model state methods, <a class="indexterm" href="#part0019_iddle1948">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">web and, <a class="indexterm" href="#part0019_iddle1949">MVC and the Web</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">modeling state, <a class="indexterm" href="#part0017_iddle1921">State machines 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Motivation section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1950">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">multiple patterns, using</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle1951">Compound Patterns: Patterns of Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in duck simulator</div><blockquote class="variable_list_definition"><div class="variable_list_term">about rebuilding, <a class="indexterm" href="#part0019_iddle1952">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Abstract Factory Pattern, <a class="indexterm" href="#part0019_iddle1953">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle1954">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Adapter Pattern, <a class="indexterm" href="#part0019_iddle1955">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Composite Pattern, <a class="indexterm" href="#part0019_iddle1956">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Decorator Pattern, <a class="indexterm" href="#part0019_iddle1957">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterator Pattern, <a class="indexterm" href="#part0019_iddle1958">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Observer Pattern, <a class="indexterm" href="#part0019_iddle1959">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0019_iddle1960">A duck’s eye view: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">multithreading</div><blockquote class="variable_list_definition"><div class="variable_list_term">dealing with, <a class="indexterm" href="#part0012_iddle1961">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">improving, <a class="indexterm" href="#part0012_iddle1962">Can we improve multithreading?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></div><div class="indexdiv"><h3>N</h3><div class="variable_list_term">Name section, in pattern catalog, <a class="indexterm" href="#part0020_iddle1963">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">new operator, replacing with concrete method, <a class="indexterm" href="#part0011_iddle1964">Reworking the PizzaStore class</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">next() method</div><blockquote class="variable_list_definition"><div class="variable_list_term">in java.util.Iterator, <a class="indexterm" href="#part0016_iddle1965">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">with Iterator, arrays, <a class="indexterm" href="#part0016_iddle1966">Adding an Iterator to DinerMenu</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">NoCommand, in remote control code, <a class="indexterm" href="#part0013_iddle1967">Now, let’s check out the execution of our remote control test...</a>, <a class="indexterm" href="#part0013_iddle1968">Test the remote control with lambda expressions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">nodes, in Composite Pattern tree structure, <a class="indexterm" href="#part0016_iddle1969">The Composite Pattern defined</a>, <a class="indexterm" href="#part0016_iddle1970">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Null Iterator, <a class="indexterm" href="#part0016_iddle1971">Flashback to Iterator</a>, <a class="indexterm" href="#part0016_iddle1972">The Null Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Null Objects, <a class="indexterm" href="#part0013_iddle1973">Now, let’s check out the execution of our remote control test...</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>O</h3><div class="variable_list_term">object access, using Proxy Pattern for controlling</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1974">The Proxy Pattern: Controlling Object Access</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Caching Proxy, <a class="indexterm" href="#part0018_iddle1975">What did we do?</a>, <a class="indexterm" href="#part0018_iddle1976">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Complexity Hiding Proxy, <a class="indexterm" href="#part0018_iddle1977">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Copy-On-Write Proxy, <a class="indexterm" href="#part0018_iddle1978">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Firewall Proxy, <a class="indexterm" href="#part0018_iddle1979">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Protection Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1980">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating dynamic proxy, <a class="indexterm" href="#part0018_iddle1981">Big Picture: creating a Dynamic Proxy for the PersonBean</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing matchmaking service, <a class="indexterm" href="#part0018_iddle1982">The PersonBean implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">protecting subjects, <a class="indexterm" href="#part0018_iddle1983">Five-minute drama: protecting subjects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing matchmaking service, <a class="indexterm" href="#part0018_iddle1984">Testing the matchmaking service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using dynamic proxy, <a class="indexterm" href="#part0018_iddle1985">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Remote Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1986">Testing the Monitor</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding to monitoring code, <a class="indexterm" href="#part0018_iddle1987">Adding a remote proxy to the Gumball Machine monitoring code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">preparing for remote service, <a class="indexterm" href="#part0018_iddle1988">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle1989">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reusing client for, <a class="indexterm" href="#part0018_iddle1990">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle1991">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">role of, <a class="indexterm" href="#part0018_iddle1992">The role of the ‘remote proxy’</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle1993">Writing the Monitor test drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping objects and, <a class="indexterm" href="#part0018_iddle1994">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Smart Reference Proxy, <a class="indexterm" href="#part0018_iddle1995">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Synchronization Proxy, <a class="indexterm" href="#part0018_iddle1996">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Virtual Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle1997">Get ready for Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing Virtual Proxy, <a class="indexterm" href="#part0018_iddle1998">Designing the CD cover Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle1999">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle2000">Testing the CD Cover Viewer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Image Proxy, <a class="indexterm" href="#part0018_iddle2001">Writing the Image Proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">object adapters vs. class adapters, <a class="indexterm" href="#part0014_iddle2002">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object construction, encapsulating, <a class="indexterm" href="#part0021_iddle2003">Builder</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object creation, encapsulating, <a class="indexterm" href="#part0011_iddle2004">Encapsulating object creation</a>, <a class="indexterm" href="#part0011_iddle2005">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object patterns, Design Patterns, <a class="indexterm" href="#part0020_iddle2017">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Object-Oriented (OO) design., <a class="indexterm" href="#part0011_iddle2006">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"><div class="variable_list_term">(see also design principles)</div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adapters</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle2007">Adapters all around us</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating Two Way Adapters, <a class="indexterm" href="#part0014_iddle2008">Here’s how the Client uses the Adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in action, <a class="indexterm" href="#part0014_iddle2009">If it walks like a duck and quacks like a duck, then it must might be a duck turkey wrapped with a duck adapter...</a>, <a class="indexterm" href="#part0014_iddle2010">Test drive the adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object and class object and class, <a class="indexterm" href="#part0014_iddle2011">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">design patterns vs., <a class="indexterm" href="#part0008_iddle2012">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">extensibility and modification of code in, <a class="indexterm" href="#part0010_iddle2013">The Open-Closed Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">guidelines for avoiding violation of Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle2014">A few guidelines to help you follow the Principle...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">loosely coupled designs and, <a class="indexterm" href="#part0009_iddle2015">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Object-Oriented Systems, Languages and Applications (OOPSLA) conference, <a class="indexterm" href="#part0020_iddle2016">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">objects</div><blockquote class="variable_list_definition"><div class="variable_list_term">components of, <a class="indexterm" href="#part0014_iddle2018">The Principle of Least Knowledge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating, <a class="indexterm" href="#part0011_iddle2019">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">loosely coupled designs between, <a class="indexterm" href="#part0009_iddle2020">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sharing state, <a class="indexterm" href="#part0017_iddle2021">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Singleton, <a class="indexterm" href="#part0012_iddle2022">A small Socratic exercise in the style of The Little Lisper</a>, <a class="indexterm" href="#part0012_iddle2023">Dissecting the classic Singleton Pattern implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping, <a class="indexterm" href="#part0010_iddle2024">Meet the Decorator Pattern</a>, <a class="indexterm" href="#part0014_iddle2025">Here’s how the Client uses the Adapter</a>, <a class="indexterm" href="#part0014_iddle2026">Writing the EnumerationIterator adapter</a>, <a class="indexterm" href="#part0014_iddle2027">Lights, Camera, Facade!</a>, <a class="indexterm" href="#part0019_iddle2028">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Observer Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0009_iddle2029">The Observer Pattern: Keeping your Objects in the know</a>, <a class="indexterm" href="#part0009_iddle2030">Meet the Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class design of, <a class="indexterm" href="#part0009_iddle2031">The Observer Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class patterns category, <a class="indexterm" href="#part0020_iddle2032">So you wanna be a Design Patterns writer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">combining patterns, <a class="indexterm" href="#part0019_iddle2033">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0009_iddle2034">The Observer Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dependence in, <a class="indexterm" href="#part0009_iddle2035">The Observer Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0016_iddle2036">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle2037">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle2038">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Five Minute Drama, <a class="indexterm" href="#part0009_iddle2039">Five-minute drama: a subject for observation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model 2, <a class="indexterm" href="#part0019_iddle2040">Design Patterns and Model 2</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model-View-Controller, <a class="indexterm" href="#part0019_iddle2041">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle2042">Building the pieces</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">lambada expressions and, <a class="indexterm" href="#part0009_iddle2043">And the code...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">loose coupling in, <a class="indexterm" href="#part0009_iddle2044">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer object in, <a class="indexterm" href="#part0009_iddle2045">Publishers + Subscribers = Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">one-to-many relationships, <a class="indexterm" href="#part0009_iddle2046">The Observer Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">process, <a class="indexterm" href="#part0009_iddle2047">A day in the life of the Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Publish-Subscribe as, <a class="indexterm" href="#part0009_iddle2048">Publishers + Subscribers = Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Subject object in, <a class="indexterm" href="#part0009_iddle2049">Publishers + Subscribers = Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Swing and, <a class="indexterm" href="#part0009_iddle2050">Other places you’ll find the Observer Pattern in the JDK</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using built-in java.util, <a class="indexterm" href="#part0009_iddle2051">Using Java’s built-in Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">weather station using</div><blockquote class="variable_list_definition"><div class="variable_list_term">building display elements, <a class="indexterm" href="#part0009_iddle2052">Now, let’s build those display elements</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0009_iddle2053">Designing the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0009_iddle2054">Implementing the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">powering up, <a class="indexterm" href="#part0009_iddle2055">Power up the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">SWAG, <a class="indexterm" href="#part0009_iddle2056">Taking a first, misguided SWAG at the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">unpacking classes, <a class="indexterm" href="#part0009_iddle2057">Unpacking the WeatherData class</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using built-in Java Observer Pattern, <a class="indexterm" href="#part0009_iddle2058">Reworking the Weather Station with the built-in support</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">observers</div><blockquote class="variable_list_definition"><div class="variable_list_term">in class diagram, <a class="indexterm" href="#part0009_iddle2059">The Observer Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Five Minute Drama, <a class="indexterm" href="#part0009_iddle2060">Five-minute drama: a subject for observation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Observer Pattern, <a class="indexterm" href="#part0009_iddle2061">Publishers + Subscribers = Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">One Class, One Responsibility Principle, <a class="indexterm" href="#part0012_iddle2062">Congratulations!</a>, <a class="indexterm" href="#part0016_iddle2063">Single Responsibility</a>, <a class="indexterm" href="#part0016_iddle2064">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">one in ten contest in gumball machine, using State Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0017_iddle2065">You knew it was coming... a change request!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating state diagram, <a class="indexterm" href="#part0017_iddle2066">Defining the State interfaces and classes</a>, <a class="indexterm" href="#part0017_iddle2067">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing code, <a class="indexterm" href="#part0017_iddle2068">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing state diagram, <a class="indexterm" href="#part0017_iddle2069">You knew it was coming... a change request!</a>, <a class="indexterm" href="#part0017_iddle2070">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing state classes, <a class="indexterm" href="#part0017_iddle2071">Implementing our State classes</a>, <a class="indexterm" href="#part0017_iddle2072">Implementing more states</a>, <a class="indexterm" href="#part0017_iddle2073">We still need to finish the Gumball 1 in 10 game</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">new design, <a class="indexterm" href="#part0017_iddle2074">The new design</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking state classes, <a class="indexterm" href="#part0017_iddle2075">Reworking the Gumball Machine</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">one-to-many relationships, Observer Pattern defining, <a class="indexterm" href="#part0009_iddle2076">The Observer Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">OO (Object-Oriented) design., <a class="indexterm" href="#part0011_iddle2077">The Dependency Inversion Principle</a></div><blockquote class="variable_list_definition"><div class="variable_list_term">(see also design principles)</div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adapters</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0014_iddle2078">Adapters all around us</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating Two Way Adapters, <a class="indexterm" href="#part0014_iddle2079">Here’s how the Client uses the Adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in action, <a class="indexterm" href="#part0014_iddle2080">If it walks like a duck and quacks like a duck, then it must might be a duck turkey wrapped with a duck adapter...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">object and class object and class, <a class="indexterm" href="#part0014_iddle2081">Object and class adapters</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">test driving, <a class="indexterm" href="#part0014_iddle2082">Test drive the adapter</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">design patterns vs., <a class="indexterm" href="#part0008_iddle2083">How do I use Design Patterns?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">extensibility and modification os code in, <a class="indexterm" href="#part0010_iddle2084">The Open-Closed Principle</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">guidelines for avoiding violation of Dependency Inversion Principle, <a class="indexterm" href="#part0011_iddle2085">A few guidelines to help you follow the Principle...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">loosely coupled designs and, <a class="indexterm" href="#part0009_iddle2086">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">OOPSLA (Object-Oriented Systems, Languages and Applications) conference, <a class="indexterm" href="#part0020_iddle2087">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Open-Closed Principle</div><blockquote class="variable_list_definition"><div class="variable_list_term">code violating, <a class="indexterm" href="#part0016_iddle2088">Is the Waitress ready for prime time?</a>, <a class="indexterm" href="#part0017_iddle2089">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">effect on maintaining code, <a class="indexterm" href="#part0010_iddle2090">The Open-Closed Principle</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Organizational Patterns, <a class="indexterm" href="#part0020_iddle2091">The Patterns Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">overusing Design Patterns, <a class="indexterm" href="#part0020_iddle2092">Your Mind on Patterns</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>P</h3><div class="variable_list_term">package and import statements, <a class="indexterm" href="#part0011_iddle2093">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">parallel class hierarchies, <a class="indexterm" href="#part0011_iddle2094">Another perspective: parallel class hierarchies</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">part-whole hierarchy, <a class="indexterm" href="#part0016_iddle2096">The Composite Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Participants section, in pattern catalog, <a class="indexterm" href="#part0020_iddle2095">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">pattern catalogs, <a class="indexterm" href="#part0020_iddle2097">Looking more closely at the Design Pattern definition</a>, <a class="indexterm" href="#part0020_iddle2098">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Pattern Death Match pages, <a class="indexterm" href="#part0019_iddle2099">Compound Patterns: Patterns of Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Pattern Languages of Programs (PLoP) conference, <a class="indexterm" href="#part0020_iddle2101">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">pattern templates, uses of, <a class="indexterm" href="#part0020_iddle2113">So you wanna be a Design Patterns writer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">A Pattern Language (Alexander), <a class="indexterm" href="#part0020_iddle2100">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">patterns, using compound, <a class="indexterm" href="#part0019_iddle2102">Compound Patterns: Patterns of Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">patterns, using multiple</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0019_iddle2103">Compound Patterns: Patterns of Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in duck simulator</div><blockquote class="variable_list_definition"><div class="variable_list_term">about rebuilding, <a class="indexterm" href="#part0019_iddle2104">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Abstract Factory Pattern, <a class="indexterm" href="#part0019_iddle2105">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle2106">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Adapter Pattern, <a class="indexterm" href="#part0019_iddle2107">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Composite Pattern, <a class="indexterm" href="#part0019_iddle2108">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Decorator Pattern, <a class="indexterm" href="#part0019_iddle2109">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Iterator Pattern, <a class="indexterm" href="#part0019_iddle2110">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding Observer Pattern, <a class="indexterm" href="#part0019_iddle2111">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0019_iddle2112">A duck’s eye view: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">Pizza Store project, using Factory Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">Abstract Factory in, <a class="indexterm" href="#part0011_iddle2114">What have we done?</a>, <a class="indexterm" href="#part0011_iddle2115">Abstract Factory Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">behind the scenes, <a class="indexterm" href="#part0011_iddle2116">More pizza for Ethan and Joel...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building factory, <a class="indexterm" href="#part0011_iddle2117">Building a simple pizza factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete subclasses in, <a class="indexterm" href="#part0011_iddle2118">Allowing the subclasses to decide</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing parallel set of classes, <a class="indexterm" href="#part0011_iddle2119">Another perspective: parallel class hierarchies</a>, <a class="indexterm" href="#part0011_iddle2120">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">encapsulating object creation, <a class="indexterm" href="#part0011_iddle2121">Encapsulating object creation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">ensuring consistency in ingredients, <a class="indexterm" href="#part0011_iddle2122">Meanwhile, back at the PizzaStore...</a>, <a class="indexterm" href="#part0011_iddle2123">A very dependent PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">framework for, <a class="indexterm" href="#part0011_iddle2124">A framework for the pizza store</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">franchising store, <a class="indexterm" href="#part0011_iddle2125">Franchising the pizza store</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">identifying aspects in, <a class="indexterm" href="#part0011_iddle2126">Identifying the aspects that vary</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0011_iddle2127">Inverting your thinking...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">making pizza store in, <a class="indexterm" href="#part0011_iddle2128">Let’s make a PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">ordering pizza, <a class="indexterm" href="#part0011_iddle2129">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">referencing local ingredient factories, <a class="indexterm" href="#part0011_iddle2130">Revisiting our pizza stores</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking pizzas, <a class="indexterm" href="#part0011_iddle2131">Reworking the pizzas...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">PLoP (Pattern Languages of Programs) conference, <a class="indexterm" href="#part0020_iddle2132">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">polymorphic code, using on iterator, <a class="indexterm" href="#part0016_iddle2133">Iterator Pattern defined</a>, <a class="indexterm" href="#part0016_iddle2134">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">polymorphism, <a class="indexterm" href="#part0008_iddle2135">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">prepareRecipe(), abstracting, <a class="indexterm" href="#part0015_iddle2136">Abstracting prepareRecipe()</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Principle of Least Knowledge, <a class="indexterm" href="#part0014_iddle2137">The Principle of Least Knowledge</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">print() method, in dessert submenu using Composite Pattern, <a class="indexterm" href="#part0016_iddle2138">Implementing the Menu Component</a>, <a class="indexterm" href="#part0016_iddle2139">The Composite Iterator</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">program to an interface, not an implementation, <a class="indexterm" href="#part0008_iddle2140">Designing the Duck Behaviors</a>, <a class="indexterm" href="#part0009_iddle2141">The dark side of java.util.Observable</a>, <a class="indexterm" href="#part0009_iddle2142">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0009_iddle2143">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0016_iddle2144">What does this get us?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">program to interface vs. program to supertype, <a class="indexterm" href="#part0008_iddle2145">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Protection Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2146">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating dynamic proxy, <a class="indexterm" href="#part0018_iddle2147">Big Picture: creating a Dynamic Proxy for the PersonBean</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing matchmaking service, <a class="indexterm" href="#part0018_iddle2148">The PersonBean implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">protecting subjects, <a class="indexterm" href="#part0018_iddle2149">Five-minute drama: protecting subjects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Proxy Pattern and, <a class="indexterm" href="#part0018_iddle2150">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing matchmaking service, <a class="indexterm" href="#part0018_iddle2151">Testing the matchmaking service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using dynamic proxy, <a class="indexterm" href="#part0018_iddle2152">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Prototype Pattern, <a class="indexterm" href="#part0021_iddle2153">Prototype</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">proxies, <a class="indexterm" href="#part0018_iddle2154">The Proxy Pattern: Controlling Object Access</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Proxy class, identifying class as, <a class="indexterm" href="#part0018_iddle2155">Running the code...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Proxy Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">Adapter Pattern vs., <a class="indexterm" href="#part0018_iddle2156">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Complexity Hiding Proxy, <a class="indexterm" href="#part0018_iddle2157">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Copy-On-Write Proxy, <a class="indexterm" href="#part0018_iddle2158">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Decorator Pattern vs., <a class="indexterm" href="#part0018_iddle2159">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0018_iddle2160">The Proxy Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dynamic aspect of dynamic proxies, <a class="indexterm" href="#part0018_iddle2161">Running the code...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0018_iddle2162">Running the code...</a>, <a class="indexterm" href="#part0020_iddle2163">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle2164">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Firewall Proxy, <a class="indexterm" href="#part0018_iddle2165">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementation of Remote Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2166">Testing the Monitor</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding to monitoring code, <a class="indexterm" href="#part0018_iddle2167">Adding a remote proxy to the Gumball Machine monitoring code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">preparing for remote service, <a class="indexterm" href="#part0018_iddle2168">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle2169">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reusing client for, <a class="indexterm" href="#part0018_iddle2170">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle2171">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">role of, <a class="indexterm" href="#part0018_iddle2172">The role of the ‘remote proxy’</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle2173">Writing the Monitor test drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping objects and, <a class="indexterm" href="#part0018_iddle2174">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">java.lang.reflect package, <a class="indexterm" href="#part0018_iddle2175">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2176">Using the Java API’s Proxy to create a protection proxy</a>, <a class="indexterm" href="#part0018_iddle2177">Creating Invocation Handlers continued...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Protection Proxy and</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2178">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Adapters and, <a class="indexterm" href="#part0018_iddle2179">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating dynamic proxy, <a class="indexterm" href="#part0018_iddle2180">Big Picture: creating a Dynamic Proxy for the PersonBean</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing matchmaking service, <a class="indexterm" href="#part0018_iddle2181">The PersonBean implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">protecting subjects, <a class="indexterm" href="#part0018_iddle2182">Five-minute drama: protecting subjects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing matchmaking service, <a class="indexterm" href="#part0018_iddle2183">Testing the matchmaking service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using dynamic proxy, <a class="indexterm" href="#part0018_iddle2184">Using the Java API’s Proxy to create a protection proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Real Subject</div><blockquote class="variable_list_definition"><div class="variable_list_term">as surrogate of, <a class="indexterm" href="#part0018_iddle2185">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">invoking method on, <a class="indexterm" href="#part0018_iddle2186">Step one: creating Invocation Handlers</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">making client use Proxy instead of, <a class="indexterm" href="#part0018_iddle2187">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">passing in constructor, <a class="indexterm" href="#part0018_iddle2188">Creating Invocation Handlers continued...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">returning proxy for, <a class="indexterm" href="#part0018_iddle2189">Step two: creating the Proxy class and instantiating the Proxy object</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">restrictions on passing types of interfaces, <a class="indexterm" href="#part0018_iddle2190">Running the code...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Smart Reference Proxy, <a class="indexterm" href="#part0018_iddle2191">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Synchronization Proxy, <a class="indexterm" href="#part0018_iddle2192">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">variations, <a class="indexterm" href="#part0018_iddle2193">What did we do?</a>, <a class="indexterm" href="#part0018_iddle2194">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Virtual Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2195">Get ready for Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Caching Proxy as form of, <a class="indexterm" href="#part0018_iddle2196">What did we do?</a>, <a class="indexterm" href="#part0018_iddle2197">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing Virtual Proxy, <a class="indexterm" href="#part0018_iddle2198">Designing the CD cover Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle2199">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle2200">Testing the CD Cover Viewer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Image Proxy, <a class="indexterm" href="#part0018_iddle2201">Writing the Image Proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">Publish-Subscribe, as Observer Pattern, <a class="indexterm" href="#part0009_iddle2202">Publishers + Subscribers = Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>Q</h3><div class="variable_list_term">queuing requests, using Command Pattern, <a class="indexterm" href="#part0013_iddle2203">More uses of the Command Pattern: queuing requests</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>R</h3><div class="variable_list_term">Real Subject</div><blockquote class="variable_list_definition"><div class="variable_list_term">as surrogate of Proxy Pattern, <a class="indexterm" href="#part0018_iddle2204">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">invoking method on, <a class="indexterm" href="#part0018_iddle2205">Step one: creating Invocation Handlers</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">making client use proxy instead of, <a class="indexterm" href="#part0018_iddle2206">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">passing in constructor, <a class="indexterm" href="#part0018_iddle2207">Creating Invocation Handlers continued...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">returning proxy for, <a class="indexterm" href="#part0018_iddle2208">Step two: creating the Proxy class and instantiating the Proxy object</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">refactoring, <a class="indexterm" href="#part0016_iddle2209">What do we need?</a>, <a class="indexterm" href="#part0020_iddle2210">You know you need a pattern when...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Related patterns section, in pattern catalog, <a class="indexterm" href="#part0020_iddle2211">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Remote Method Invocation (RMI)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2212">Adding a remote proxy to the Gumball Machine monitoring code</a>, <a class="indexterm" href="#part0018_iddle2213">Java RMI, the Big Picture</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0018_iddle2214">How does the client get the stub object?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">completing code for server side, <a class="indexterm" href="#part0018_iddle2215">Java RMI, the Big Picture</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">importing java.rmi, <a class="indexterm" href="#part0018_iddle2216">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">importing packages, <a class="indexterm" href="#part0018_iddle2217">Getting the GumballMachine ready to be a remote service</a>, <a class="indexterm" href="#part0018_iddle2218">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">making remote service, <a class="indexterm" href="#part0018_iddle2219">Java RMI, the Big Picture</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">method call in, <a class="indexterm" href="#part0018_iddle2220">Remote methods 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle2221">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">things to watch out for in, <a class="indexterm" href="#part0018_iddle2222">How does the client get the stub object?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Remote proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2223">Testing the Monitor</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding to monitoring code, <a class="indexterm" href="#part0018_iddle2224">Adding a remote proxy to the Gumball Machine monitoring code</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">preparing for remote service, <a class="indexterm" href="#part0018_iddle2225">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle2226">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reusing client for, <a class="indexterm" href="#part0018_iddle2227">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle2228">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">role of, <a class="indexterm" href="#part0018_iddle2229">The role of the ‘remote proxy’</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle2230">Writing the Monitor test drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping objects and, <a class="indexterm" href="#part0018_iddle2231">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">remove() method</div><blockquote class="variable_list_definition"><div class="variable_list_term">Enumeration and, <a class="indexterm" href="#part0014_iddle2232">Dealing with the remove() method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in collection of objects, <a class="indexterm" href="#part0016_iddle2233">Making some improvements...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in java.util.Iterator, <a class="indexterm" href="#part0016_iddle2234">Iterator Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">requests, encapsulating, <a class="indexterm" href="#part0013_iddle2235">The Command Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">resources, Design Patterns, <a class="indexterm" href="#part0020_iddle2236">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reuse, <a class="indexterm" href="#part0008_iddle2237">But something went horribly wrong...</a>, <a class="indexterm" href="#part0010_iddle2238">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">RMI (Remote Method Invocation)</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2239">Adding a remote proxy to the Gumball Machine monitoring code</a>, <a class="indexterm" href="#part0018_iddle2240">Java RMI, the Big Picture</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0018_iddle2241">How does the client get the stub object?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">completing code for server side, <a class="indexterm" href="#part0018_iddle2242">Java RMI, the Big Picture</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">importing java.rmi, <a class="indexterm" href="#part0018_iddle2243">Getting the GumballMachine ready to be a remote service</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">importing packages, <a class="indexterm" href="#part0018_iddle2244">Getting the GumballMachine ready to be a remote service</a>, <a class="indexterm" href="#part0018_iddle2245">Now for the GumballMonitor client...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">making remote service, <a class="indexterm" href="#part0018_iddle2246">Java RMI, the Big Picture</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">method call in, <a class="indexterm" href="#part0018_iddle2247">Remote methods 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">registering with RMI registry, <a class="indexterm" href="#part0018_iddle2248">Registering with the RMI registry...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">things to watch out for in, <a class="indexterm" href="#part0018_iddle2249">How does the client get the stub object?</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">rule of three, applied to Design Patterns, <a class="indexterm" href="#part0020_iddle2250">So you wanna be a Design Patterns writer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">runtime errors, causes of, <a class="indexterm" href="#part0011_iddle2251">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>S</h3><div class="variable_list_term">Sample code section, in pattern catalog, <a class="indexterm" href="#part0020_iddle2252">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">server heap, <a class="indexterm" href="#part0018_iddle2253">Remote methods 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">service helper (skeletons), in RMI, <a class="indexterm" href="#part0018_iddle2254">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2255">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2256">How does the client get the stub object?</a>, <a class="indexterm" href="#part0018_iddle2257">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">servlet environment, setting up, <a class="indexterm" href="#part0019_iddle2258">Model 2: DJ’ing from a cell phone</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">shared vocabulary</div><blockquote class="variable_list_definition"><div class="variable_list_term">importance of, <a class="indexterm" href="#part0008_iddle2259">Overheard at the local diner...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">power of, <a class="indexterm" href="#part0008_iddle2260">The power of a shared pattern vocabulary</a>, <a class="indexterm" href="#part0020_iddle2261">Don’t forget the power of the shared vocabulary</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Sharpen Your Pencil</div><blockquote class="variable_list_definition"><div class="variable_list_term">altering decorator classes, <a class="indexterm" href="#part0010_iddle2262">Serving some coffees</a>, <a class="indexterm" href="#part0010_iddle2263">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating Gumball Machine States, <a class="indexterm" href="#part0017_iddle2264">Let’s take a look at what we’ve done so far...</a>, <a class="indexterm" href="#part0017_iddle2265">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating state diagram, <a class="indexterm" href="#part0017_iddle2266">Defining the State interfaces and classes</a>, <a class="indexterm" href="#part0017_iddle2267">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building ingredient factory, <a class="indexterm" href="#part0011_iddle2268">Building the New York ingredient factory</a>, <a class="indexterm" href="#part0011_iddle2269">A very dependent PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing classes for Decorator Pattern, <a class="indexterm" href="#part0019_iddle2270">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle2271">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing code to fit framework in Iterator Pattern, <a class="indexterm" href="#part0016_iddle2272">Taking a look at the Café Menu</a>, <a class="indexterm" href="#part0016_iddle2273">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">choosing descriptions of state of implementation, <a class="indexterm" href="#part0017_iddle2274">The messy STATE of things...</a>, <a class="indexterm" href="#part0017_iddle2275">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram for implementation of prepareRecipe(), <a class="indexterm" href="#part0015_iddle2276">Abstracting prepareRecipe()</a>, <a class="indexterm" href="#part0015_iddle2277">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code not using factories, <a class="indexterm" href="#part0011_iddle2278">A very dependent PizzaStore</a>, <a class="indexterm" href="#part0011_iddle2279">A very dependent PizzaStore</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating commands for off buttons, <a class="indexterm" href="#part0013_iddle2280">Using a macro command</a>, <a class="indexterm" href="#part0013_iddle2281">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating heat index, <a class="indexterm" href="#part0009_iddle2282">Power up the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">determining classes violating Principle of Least Knowledge, <a class="indexterm" href="#part0014_iddle2283">Keeping your method calls in bounds...</a>, <a class="indexterm" href="#part0014_iddle2284">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing beverage order process, <a class="indexterm" href="#part0010_iddle2285">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">fixing Chocolate Boiler code, <a class="indexterm" href="#part0012_iddle2286">Meanwhile, back at the Chocolate Factory...</a>, <a class="indexterm" href="#part0012_iddle2287">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">identifying factors influencing design, <a class="indexterm" href="#part0010_iddle2288">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing garage door command, <a class="indexterm" href="#part0013_iddle2289">Creating a simple test to use the Remote Control</a>, <a class="indexterm" href="#part0013_iddle2290">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing state classes, <a class="indexterm" href="#part0017_iddle2291">Implementing more states</a>, <a class="indexterm" href="#part0017_iddle2292">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">making pizza store, <a class="indexterm" href="#part0011_iddle2293">Let’s make a PizzaStore</a>, <a class="indexterm" href="#part0011_iddle2294">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matching patterns with categories, <a class="indexterm" href="#part0020_iddle2295">Organizing Design Patterns</a>, <a class="indexterm" href="#part0020_iddle2296">Organizing Design Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">method for refilling gumball machine, <a class="indexterm" href="#part0017_iddle2297">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle2298">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on adding behaviors, <a class="indexterm" href="#part0008_iddle2299">Implementing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on implementation of printmenu(), <a class="indexterm" href="#part0016_iddle2300">The Java-Enabled Waitress Specification</a>, <a class="indexterm" href="#part0016_iddle2301">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">on inheritance, <a class="indexterm" href="#part0008_iddle2302">Joe thinks about inheritance...</a>, <a class="indexterm" href="#part0008_iddle2303">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sketching out classes, <a class="indexterm" href="#part0009_iddle2304">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">things driving change, <a class="indexterm" href="#part0008_iddle2305">The one constant in software development</a>, <a class="indexterm" href="#part0008_iddle2306">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">turning class into Singleton, <a class="indexterm" href="#part0012_iddle2307">The Chocolate Factory</a>, <a class="indexterm" href="#part0012_iddle2308">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">weather station SWAG, <a class="indexterm" href="#part0009_iddle2309">Taking a first, misguided SWAG at the Weather Station</a>, <a class="indexterm" href="#part0009_iddle2310">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Abstract Factory Pattern, <a class="indexterm" href="#part0019_iddle2311">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle2312">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing classes for adapters, <a class="indexterm" href="#part0014_iddle2313">Here’s how the Client uses the Adapter</a>, <a class="indexterm" href="#part0014_iddle2314">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing dynamic proxy, <a class="indexterm" href="#part0018_iddle2315">Step two: creating the Proxy class and instantiating the Proxy object</a>, <a class="indexterm" href="#part0018_iddle2316">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Flock observer code, <a class="indexterm" href="#part0019_iddle2317">Duck reunion</a>, <a class="indexterm" href="#part0019_iddle2318">Exercise Solutions</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing methods for classes, <a class="indexterm" href="#part0010_iddle2319">Welcome to Starbuzz Coffee</a>, <a class="indexterm" href="#part0010_iddle2320">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Simple Factory Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about factory objects, <a class="indexterm" href="#part0011_iddle2321">Encapsulating object creation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">building factory, <a class="indexterm" href="#part0011_iddle2322">Building a simple pizza factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0011_iddle2323">The Simple Factory defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method Pattern and, <a class="indexterm" href="#part0011_iddle2324">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">pattern honorable mention, <a class="indexterm" href="#part0011_iddle2325">The Simple Factory defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using new operator for instantiating concrete classes, <a class="indexterm" href="#part0011_iddle2326">The Factory Pattern: Baking with OO Goodness</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Single Responsibility Principle, <a class="indexterm" href="#part0016_iddle2327">Single Responsibility</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Singleton objects, <a class="indexterm" href="#part0012_iddle2328">A small Socratic exercise in the style of The Little Lisper</a>, <a class="indexterm" href="#part0012_iddle2329">Dissecting the classic Singleton Pattern implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Singleton Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0012_iddle2330">The Singleton Pattern: One of a Kind Objects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">advantages of, <a class="indexterm" href="#part0012_iddle2331">The Singleton Pattern: One of a Kind Objects</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Chocolate Factory</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0012_iddle2332">The Chocolate Factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">fixing Chocolate Boiler code, <a class="indexterm" href="#part0012_iddle2333">Meanwhile, back at the Chocolate Factory...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0012_iddle2334">Singleton Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0012_iddle2335">Dissecting the classic Singleton Pattern implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">dealing with multithreading, <a class="indexterm" href="#part0012_iddle2336">Houston, Hershey, PA we have a problem...</a>, <a class="indexterm" href="#part0012_iddle2337">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0012_iddle2338">Singleton Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">disadvantages of, <a class="indexterm" href="#part0012_iddle2339">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">double-checked locking, <a class="indexterm" href="#part0012_iddle2340">3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0020_iddle2341">So you wanna be a Design Patterns writer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">global variables vs., <a class="indexterm" href="#part0012_iddle2342">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0012_iddle2343">Dissecting the classic Singleton Pattern implementation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">One Class, One Responsibility Principle and, <a class="indexterm" href="#part0012_iddle2344">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">subclasses in, <a class="indexterm" href="#part0012_iddle2345">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0012_iddle2346">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">skeletons (service helper), in RMI, <a class="indexterm" href="#part0018_iddle2347">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2348">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2349">How does the client get the stub object?</a>, <a class="indexterm" href="#part0018_iddle2350">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">smart command objects, <a class="indexterm" href="#part0013_iddle2351">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Smart Reference Proxy, <a class="indexterm" href="#part0018_iddle2352">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sorting methods, in Template Method Pattern, <a class="indexterm" href="#part0015_iddle2353">Sorting with Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Starbuzz Coffee Barista training manual project</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle2354">It’s time for some more caffeine</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">abstracting prepareRecipe(), <a class="indexterm" href="#part0015_iddle2355">Abstracting prepareRecipe()</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Template Method Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle2356">Meet the Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0015_iddle2357">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0015_iddle2358">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hooks in, <a class="indexterm" href="#part0015_iddle2360">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0015_iddle2361">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hollywood Principle and, <a class="indexterm" href="#part0015_iddle2359">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote></blockquote></blockquote><div class="variable_list_term">Starbuzz Coffee project, using Decorator Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0010_iddle2362">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">adding sizes to code, <a class="indexterm" href="#part0010_iddle2363">Serving some coffees</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">constructing drink orders, <a class="indexterm" href="#part0010_iddle2364">Constructing a drink order with Decorators</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">decorating beverages in, <a class="indexterm" href="#part0010_iddle2365">Decorating our Beverages</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing beverage order process, <a class="indexterm" href="#part0010_iddle2366">New barista training</a>, <a class="indexterm" href="#part0010_iddle2367">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing order code, <a class="indexterm" href="#part0010_iddle2368">Serving some coffees</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using Java decorators, <a class="indexterm" href="#part0010_iddle2369">Real World Decorators: Java I/O</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing code, <a class="indexterm" href="#part0010_iddle2370">Writing the Starbuzz code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">state machines, <a class="indexterm" href="#part0017_iddle2371">State machines 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">State Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">definition of, <a class="indexterm" href="#part0017_iddle2372">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0017_iddle2373">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle2374">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle2375">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle2376">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">gumball machine controller implementation</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0017_iddle2377">Jawva Breakers</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">cleaning up code, <a class="indexterm" href="#part0017_iddle2378">Sanity check...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">demonstration of, <a class="indexterm" href="#part0017_iddle2379">Demo for the CEO of Mighty Gumball, Inc.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">diagram to code, <a class="indexterm" href="#part0017_iddle2380">State machines 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">finishing, <a class="indexterm" href="#part0017_iddle2381">Finishing the game</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">refilling gumball machine, <a class="indexterm" href="#part0017_iddle2382">We almost forgot!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">SoldState and WinnerState in, <a class="indexterm" href="#part0017_iddle2383">Demo for the CEO of Mighty Gumball, Inc.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0017_iddle2384">In-house testing</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing code, <a class="indexterm" href="#part0017_iddle2385">Writing the code</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">increasing number of classes in design, <a class="indexterm" href="#part0017_iddle2386">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">modeling state, <a class="indexterm" href="#part0017_iddle2387">State machines 101</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">one in ten contest in gumball machine</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0017_iddle2388">You knew it was coming... a change request!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">annotating state diagram, <a class="indexterm" href="#part0017_iddle2389">Defining the State interfaces and classes</a>, <a class="indexterm" href="#part0017_iddle2390">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">changing code, <a class="indexterm" href="#part0017_iddle2391">The messy STATE of things...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">drawing state diagram, <a class="indexterm" href="#part0017_iddle2392">You knew it was coming... a change request!</a>, <a class="indexterm" href="#part0017_iddle2393">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing state classes, <a class="indexterm" href="#part0017_iddle2394">Implementing our State classes</a>, <a class="indexterm" href="#part0017_iddle2395">Implementing more states</a>, <a class="indexterm" href="#part0017_iddle2396">We still need to finish the Gumball 1 in 10 game</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">new design, <a class="indexterm" href="#part0017_iddle2397">The new design</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reworking state classes, <a class="indexterm" href="#part0017_iddle2398">Reworking the Gumball Machine</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">sharing state objects, <a class="indexterm" href="#part0017_iddle2399">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">state transitions in state classes, <a class="indexterm" href="#part0017_iddle2400">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern vs., <a class="indexterm" href="#part0017_iddle2401">The State Pattern defined</a>, <a class="indexterm" href="#part0017_iddle2402">Sanity check...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">state transitions, in state classes, <a class="indexterm" href="#part0017_iddle2403">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">state, using to implement undo commands, <a class="indexterm" href="#part0013_iddle2404">Using state to implement Undo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">static classes, using instead of Singletons, <a class="indexterm" href="#part0012_iddle2405">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">static method vs. create method, <a class="indexterm" href="#part0011_iddle2406">Building a simple pizza factory</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">definition of, <a class="indexterm" href="#part0008_iddle2407">Speaking of Design Patterns...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0015_iddle2408">The Hollywood Principle and Template Method</a>, <a class="indexterm" href="#part0015_iddle2409">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0016_iddle2410">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle2411">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0017_iddle2412">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle2413">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle2414">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle2415">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model 2, <a class="indexterm" href="#part0019_iddle2416">Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Model-View-Controller, <a class="indexterm" href="#part0019_iddle2417">Looking at MVC through patterns-colored glasses</a>, <a class="indexterm" href="#part0019_iddle2418">Now for the Controller</a>, <a class="indexterm" href="#part0019_iddle2419">Exploring Strategy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">State Pattern vs., <a class="indexterm" href="#part0017_iddle2420">The State Pattern defined</a>, <a class="indexterm" href="#part0017_iddle2421">Sanity check...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Template Method Pattern and, <a class="indexterm" href="#part0015_iddle2422">The making of the sorting duck machine</a>, <a class="indexterm" href="#part0015_iddle2423">Applets</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">structural patterns category, Design Patterns, <a class="indexterm" href="#part0020_iddle2424">Pattern Categories</a>, <a class="indexterm" href="#part0020_iddle2425">Pattern Categories</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Structure section, in pattern catalog, <a class="indexterm" href="#part0020_iddle2426">Looking more closely at the Design Pattern definition</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">stubs (client helper), in RMI, <a class="indexterm" href="#part0018_iddle2427">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2428">Java RMI, the Big Picture</a>, <a class="indexterm" href="#part0018_iddle2429">How does the client get the stub object?</a>, <a class="indexterm" href="#part0018_iddle2430">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">subclasses</div><blockquote class="variable_list_definition"><div class="variable_list_term">class explosion and, <a class="indexterm" href="#part0010_iddle2431">Welcome to Starbuzz Coffee</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete commands and, <a class="indexterm" href="#part0013_iddle2432">The Command Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">concrete states and, <a class="indexterm" href="#part0017_iddle2433">The State Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Factory Method and, letting subclasses decide which class to instantiate, <a class="indexterm" href="#part0011_iddle2434">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Singletons, <a class="indexterm" href="#part0012_iddle2436">Congratulations!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">inheritance gone wrong and, <a class="indexterm" href="#part0008_iddle2435">But something went horribly wrong...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Pizza Store concrete, <a class="indexterm" href="#part0011_iddle2437">Allowing the subclasses to decide</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Template Method, <a class="indexterm" href="#part0015_iddle2438">Meet the Template Method</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Subject</div><blockquote class="variable_list_definition"><div class="variable_list_term">in class diagram, <a class="indexterm" href="#part0009_iddle2439">The Observer Pattern defined: the class diagram</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Five Minute Drama, <a class="indexterm" href="#part0009_iddle2440">Five-minute drama: a subject for observation</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in Observer Pattern, <a class="indexterm" href="#part0009_iddle2441">Publishers + Subscribers = Observer Pattern</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">subsystems, Facades and, <a class="indexterm" href="#part0014_iddle2442">Lights, Camera, Facade!</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">superclasses</div><blockquote class="variable_list_definition"><div class="variable_list_term">abstract, <a class="indexterm" href="#part0008_iddle2443">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using, <a class="indexterm" href="#part0008_iddle2444">But something went horribly wrong...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">supertype (programming to interface), vs. programming to interface, <a class="indexterm" href="#part0008_iddle2445">Designing the Duck Behaviors</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">SWAG, <a class="indexterm" href="#part0009_iddle2446">Taking a first, misguided SWAG at the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Swing</div><blockquote class="variable_list_definition"><div class="variable_list_term">Composite Pattern and, <a class="indexterm" href="#part0019_iddle2447">Composite</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Observer Pattern in, <a class="indexterm" href="#part0009_iddle2448">Other places you’ll find the Observer Pattern in the JDK</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Template Method Pattern and, <a class="indexterm" href="#part0015_iddle2449">Swingin’ with Frames</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Synchronization Proxy, <a class="indexterm" href="#part0018_iddle2451">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">synchronization, as overhead, <a class="indexterm" href="#part0012_iddle2450">Dealing with multithreading</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>T</h3><div class="variable_list_term">Template Method Pattern</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0015_iddle2452">Meet the Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">abstract class in</div><blockquote class="variable_list_definition"><div class="variable_list_term">definition of, <a class="indexterm" href="#part0015_iddle2453">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hooks vs., <a class="indexterm" href="#part0015_iddle2454">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">methods in, <a class="indexterm" href="#part0015_iddle2455">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Applet and, <a class="indexterm" href="#part0015_iddle2456">Applets</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">class diagram, <a class="indexterm" href="#part0015_iddle2457">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">code up close, <a class="indexterm" href="#part0015_iddle2458">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">definition of, <a class="indexterm" href="#part0015_iddle2459">Template Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">exercise matching description of, <a class="indexterm" href="#part0015_iddle2460">The Hollywood Principle and Template Method</a>, <a class="indexterm" href="#part0015_iddle2461">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0017_iddle2462">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle2463">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle2464">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle2465">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">hooks in, <a class="indexterm" href="#part0015_iddle2467">Template Method Pattern defined</a>, <a class="indexterm" href="#part0015_iddle2468">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">in real world, <a class="indexterm" href="#part0015_iddle2469">Template Methods in the Wild</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">sorting with, <a class="indexterm" href="#part0015_iddle2470">Sorting with Template Method</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Strategy Pattern and, <a class="indexterm" href="#part0015_iddle2471">The making of the sorting duck machine</a>, <a class="indexterm" href="#part0015_iddle2472">Applets</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Swing and, <a class="indexterm" href="#part0015_iddle2473">Swingin’ with Frames</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing code, <a class="indexterm" href="#part0015_iddle2474">Let’s run the Test Drive</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">The Hollywood Principle and, <a class="indexterm" href="#part0015_iddle2466">The Hollywood Principle</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">The Timeless Way of Building (Alexander), <a class="indexterm" href="#part0020_iddle2477">Your journey has just begun...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">thinking in patterns, <a class="indexterm" href="#part0020_iddle2475">Thinking in Patterns</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">tightly coupled, <a class="indexterm" href="#part0009_iddle2476">The power of Loose Coupling</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">transparency, in Composite Pattern, <a class="indexterm" href="#part0016_iddle2478">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">tree structure, Composite Pattern, <a class="indexterm" href="#part0016_iddle2479">The Composite Pattern defined</a>, <a class="indexterm" href="#part0016_iddle2480">Getting ready for a test drive...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">try/catch, not supporting method, <a class="indexterm" href="#part0016_iddle2481">The magic of Iterator &amp; Composite together...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Two Way Adapters, creating, <a class="indexterm" href="#part0014_iddle2482">Here’s how the Client uses the Adapter</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">type safe parameters, <a class="indexterm" href="#part0011_iddle2483">Factory Method Pattern defined</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>U</h3><div class="variable_list_term">undo commands</div><blockquote class="variable_list_definition"><div class="variable_list_term">creating, <a class="indexterm" href="#part0013_iddle2484">Time to write that documentation...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">creating multiple, <a class="indexterm" href="#part0013_iddle2485">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing for macro command, <a class="indexterm" href="#part0013_iddle2486">Using a macro command</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">support of, <a class="indexterm" href="#part0013_iddle2487">Time to write that documentation...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0013_iddle2488">Time to QA that Undo button!</a>, <a class="indexterm" href="#part0013_iddle2489">Get ready to test the ceiling fan</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using state to implement, <a class="indexterm" href="#part0013_iddle2490">Using state to implement Undo</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">User Interface Design Patterns, <a class="indexterm" href="#part0020_iddle2491">The Patterns Zoo</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>V</h3><div class="variable_list_term">variables</div><blockquote class="variable_list_definition"><div class="variable_list_term">declaring behavior, <a class="indexterm" href="#part0008_iddle2492">Integrating the Duck Behavior</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">holding reference to concrete class, <a class="indexterm" href="#part0011_iddle2493">A few guidelines to help you follow the Principle...</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Vector, <a class="indexterm" href="#part0016_iddle2494">Iterators and Collections</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">vegetarian menu, using Composite Pattern, <a class="indexterm" href="#part0016_iddle2495">Give me the vegetarian menu</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Virtual Proxy</div><blockquote class="variable_list_definition"><div class="variable_list_term">about, <a class="indexterm" href="#part0018_iddle2496">Get ready for Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Caching Proxy as form of, <a class="indexterm" href="#part0018_iddle2497">What did we do?</a>, <a class="indexterm" href="#part0018_iddle2498">The Proxy Zoo</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing Virtual Proxy, <a class="indexterm" href="#part0018_iddle2499">Designing the CD cover Virtual Proxy</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">reviewing process, <a class="indexterm" href="#part0018_iddle2500">What did we do?</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">testing, <a class="indexterm" href="#part0018_iddle2501">Testing the CD Cover Viewer</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">writing Image Proxy, <a class="indexterm" href="#part0018_iddle2502">Writing the Image Proxy</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">Visitor Pattern, <a class="indexterm" href="#part0021_iddle2503">Visitor</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Vlissides, John, <a class="indexterm" href="#part0020_iddle2504">Cruisin’ Objectville with the Gang of Four</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">volatile keyword, <a class="indexterm" href="#part0012_iddle2505">3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>W</h3><div class="variable_list_term">weather station</div><blockquote class="variable_list_definition"><div class="variable_list_term">building display elements, <a class="indexterm" href="#part0009_iddle2506">Now, let’s build those display elements</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">designing, <a class="indexterm" href="#part0009_iddle2507">Designing the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">implementing, <a class="indexterm" href="#part0009_iddle2508">Implementing the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">powering up, <a class="indexterm" href="#part0009_iddle2509">Power up the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">SWAG, <a class="indexterm" href="#part0009_iddle2510">Taking a first, misguided SWAG at the Weather Station</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">unpacking classes, <a class="indexterm" href="#part0009_iddle2511">Unpacking the WeatherData class</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">using built-in Java Observer Pattern, <a class="indexterm" href="#part0009_iddle2512">Reworking the Weather Station with the built-in support</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">web, Model-View-Controller and, <a class="indexterm" href="#part0019_iddle2513">MVC and the Web</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">Who Does What exercises</div><blockquote class="variable_list_definition"><div class="variable_list_term">matching objects and methods to Command Pattern, <a class="indexterm" href="#part0013_iddle2514">From the Diner to the Command Pattern</a>, <a class="indexterm" href="#part0013_iddle2515">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matching pattern with description, <a class="indexterm" href="#part0015_iddle2517">The Hollywood Principle and Template Method</a>, <a class="indexterm" href="#part0015_iddle2518">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0016_iddle2519">The magic of Iterator &amp; Composite together...</a>, <a class="indexterm" href="#part0016_iddle2520">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0017_iddle2521">We almost forgot!</a>, <a class="indexterm" href="#part0017_iddle2522">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0018_iddle2523">Running the code...</a>, <a class="indexterm" href="#part0018_iddle2524">Tools for your Design Toolbox</a>, <a class="indexterm" href="#part0020_iddle2525">So you wanna be a Design Patterns writer</a>, <a class="indexterm" href="#part0020_iddle2526">Boy, it’s been great having you in Objectville.</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">matching patterns with its intent, <a class="indexterm" href="#part0014_iddle2516">Tools for your Design Toolbox</a></div><blockquote class="variable_list_definition"></blockquote></blockquote><div class="variable_list_term">whole-part relationships, collection of objects using, <a class="indexterm" href="#part0016_iddle2527">The magic of Iterator &amp; Composite together...</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wickedlysmart web site, <a class="indexterm" href="#part0007_iddle2528">Read Me</a></div><blockquote class="variable_list_definition"></blockquote><div class="variable_list_term">wrapping objects, <a class="indexterm" href="#part0010_iddle2529">Meet the Decorator Pattern</a>, <a class="indexterm" href="#part0014_iddle2530">Here’s how the Client uses the Adapter</a>, <a class="indexterm" href="#part0014_iddle2531">Writing the EnumerationIterator adapter</a>, <a class="indexterm" href="#part0014_iddle2532">Lights, Camera, Facade!</a>, <a class="indexterm" href="#part0018_iddle2533">What did we do?</a>, <a class="indexterm" href="#part0019_iddle2534">Duck reunion</a></div><blockquote class="variable_list_definition"></blockquote></div><div class="indexdiv"><h3>Y</h3><div class="variable_list_term">your mind on patterns, <a class="indexterm" href="#part0020_iddle2535">Your Mind on Patterns</a></div><blockquote class="variable_list_definition"></blockquote></div></div></div></body><body><div class="colophon" epub:type="colophon" id="part0025_id483756"><h2 class="title">About the Authors</h2><p>Eric Freeman recently ended nearly a decade as a media company executive, having held the position of CTO of Disney Online &amp; Disney.com at The Walt Disney Company. Eric is now devoting his time to WickedlySmart.com and lives with his wife and young daughter in Austin, TX. He holds a Ph.D. in Computer Science from Yale University.</p><p>Elisabeth Robson is co-founder of Wickedly Smart, an education company devoted to helping customers gain mastery in web technologies. She's co-author of four bestselling books, Head First Design Patterns, Head First HTML and CSS, Head First HTML5 Programming, and Head First JavaScript Programming.</p><p>Bert Bates is a 20-year software developer, a Java instructor, and a co-developer of Sun's upcoming EJB exam (Sun Certified Business Component Developer). His background features a long stint in artificial intelligence, with clients like the Weather Channel, A&amp;E Network, Rockwell, and Timken.</p><p>Kathy Sierra has been interested in learning theory since her days as a game developer (Virgin, MGM, Amblin'). More recently, she's been a master trainer for Sun Microsystems, teaching Sun's Java instructors how to teach the latest technologies to customers, and a lead developer of several Sun certification exams. Along with her partner Bert Bates, Kathy created the Head First series. She's also the original founder of the Software Development/Jolt Productivity Award-winning javaranch.com, the largest (and friendliest) all-volunteer Java community.</p></div></body><body><div class="colophon" epub:type="colophon" id="part0026_colophon"><h2 class="title">Colophon</h2><div class="informalfigure"><a id="part0026_med_id00839a"></a><div class="mediaobject"><a id="part0026_med_id00839"></a><img alt="image with no caption" hisrc="figs/web/654fig01.png.jpg" src="../Images/image01340.jpeg"/></div></div><p><span class="strong"><strong>All interior layouts were designed by Eric Freeman, Elisabeth Robson, Kathy Sierra and Bert Bates.</strong></span> Kathy and Bert created the look &amp; feel of the Head First series. The book was produced using Adobe InDesign CS (an unbelievably cool design tool that we can’t get enough of) and Adobe Photoshop CS. The book was typeset using Uncle Stinky, Mister Frisky (you think we’re kidding), Ann Satellite, Baskerville, Comic Sans, Myriad Pro, Skippy Sharp, Savoye LET, Jokerman LET, Courier New and Woodrow typefaces.</p><p>Interior design and production all happened exclusively on Apple Macintoshes — at Head First we’re all about “Think Different” (even if it isn’t grammatical). All Java code was created using James Gosling’s favorite IDE, <span class="emphasis"><em>vi</em></span>, Erich Gamma’s Eclipse.</p><p>Long days of writing were powered by the caffeine fuel of Honest Tea and Tejava, the clean Santa Fe air, and the grooving sounds of Banco de Gaia, Cocteau Twins, Buddha Bar I-VI, Delerium, Enigma, Mike Oldfield, Olive, Orb, Orbital, LTJ Bukem, Massive Attack, Steve Roach, Sasha and Digweed, Thievery Corporation, Zero 7 and Neil Finn (in all his incarnations) along with a heck of a lot of acid trance and more 80s music than you’d care to know about.</p></div></body><body><div class="colophon" epub:type="colophon" id="part0027_copyright_page_orm"><h2 class="title"></h2><div><h1 class="title">Head First: Design Patterns</h1></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Eric Freeman</span></h3></div></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Elisabeth Robson</span></h3></div></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Bert Bates</span></h3></div></div><div><div class="author"><h3 class="author" data-amznremoved-m8="true"><span class="firstname">Kathy Sierra</span></h3></div></div><div class="editor"><h4>Editor</h4><h3 class="editor"><span class="firstname">Mike Hendrickson</span></h3></div><div class="editor"><h4>Editor</h4><h3 class="editor"><span class="firstname">Mike Loukides</span></h3></div><div><p class="copyright">Copyright © 2009 O’Reilly Media, Inc., Bert Bates and Kathy Sierra</p></div><div><div class="legalnotice"><a id="part0027_id781531"></a><p><span class="strong"><strong>Head First Design Patterns</strong></span></p><p>by Eric Freeman, Elisabeth Robson, Kathy Sierra, and Bert Bates</p></div></div><div><div class="legalnotice"><a id="part0027_id456694"></a><p>All rights reserved.</p></div></div><div><div class="legalnotice"><a id="part0027_id436396"></a><p>O’Reilly Media books may be purchased for educational, business, or sales promotional use. Online editions are also available for most titles (safaribooksonline.com). For more information, contact our corporate/institutional sales department: (800) 998-9938 or <span class="email"><a class="email" href="mailto:corporate@oreilly.com">corporate@oreilly.com</a></span>.</p></div></div><div><div class="legalnotice"><a id="part0027_id458374"></a><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Editors:</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Mike Hendrickson, Mike Loukides</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Cover Designer:</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Ellie Volckhausen</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Pattern Wranglers:</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Eric Freeman, Elisabeth Freeman</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Facade Decoration:</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Elisabeth Robson</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Strategy:</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Kathy Sierra and Bert Bates</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="strong"><strong>Observer:</strong></span></p></td><td style="vertical-align: top; "><p>Oliver</p></td></tr></tbody></table></div></div></div><div><div class="legalnotice"><a id="part0027_id418543"></a><div class="informalfigure"><a id="part0027_med_id00001a"></a><div class="mediaobject"><a id="part0027_med_id00001"></a><img alt="image with no caption" hisrc="figs/web/0vifig01.png.jpg" src="../Images/image01341.jpeg"/></div></div><p><span class="strong"><strong>Printing History:</strong></span></p><p>July 2014: Second release.</p><p>October 2004: First release.</p></div></div><div><div class="legalnotice"><a id="part0027_id392896"></a><p>The O’Reilly logo is a registered trademark of O’Reilly Media, Inc. Java and all Java-based trademarks and logos are trademarks or registered trademarks of Sun Microsystems, Inc., in the United States and other countries. O’Reilly Media, Inc. is independent of Sun Microsystems.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks.</p><p>Where those designations appear in this book, and O’Reilly Media, Inc. was aware of a trademark claim, the designations have been printed in caps or initial caps.</p></div></div><div><div class="legalnotice"><a id="part0027_id431003"></a><p>While every precaution has been taken in the preparation of this book, the publisher and the authors assume no responsibility for errors or omissions, or for damages resulting from the use of the information contained herein.</p><p>In other words, if you use anything in <span class="emphasis"><em>Head First Design Patterns</em></span> to, say, run a nuclear power plant, you’re on your own. We do, however, encourage you to use the DJ View app.</p><p>No ducks were harmed in the making of this book.</p><p>The original GoF agreed to have their photos in this book. Yes, they really are that good-looking.</p></div></div><div><div class="legalnotice"><a id="part0027_id431049"></a><div class="literallayout"><p>[LSI]                                                                                                                                                           [2014-06-30]</p></div></div></div><div class="publisher"><span class="publishername">O’Reilly Media<br/></span><div class="address"><p><span class="street">1005 Gravenstein Highway North</span></p><p><span class="city">Sebastopol</span>, <span class="state">CA</span> <span class="postcode">95472</span> </p></div></div><div class="timestamp"><p>2017-09-13T12:54:18-07:00</p></div><p></p></div></body><body><h1 id="part0028_aid-QMFO1">Head First: Design Patterns</h1><div class="toc"><div class="toc-title">Table of Contents</div><nav epub:type="toc"><div><blockquote><a href="#part0001_dedication">Dedication</a></blockquote><blockquote><a href="#part0002_praise_for_head_first_design_patterns">Praise for <span class="emphasis"><em>Head First Design Patterns</em></span></a></blockquote><blockquote><a href="#part0003_more_praise_for_head_first_design_patter">More Praise for <span class="emphasis"><em>Head First Design Patterns</em></span></a></blockquote><blockquote><a href="#part0004_praise_for_other_books_by_eric_freeman_a">Praise for other books by Eric Freeman and Elisabeth Robson</a></blockquote><blockquote><a href="#part0005_authors_of_head_first_design_patterns">Authors of Head First Design Patterns</a></blockquote><blockquote><a href="#part0006_creators_of_the_head_first_series_left_p">Creators of the Head First series (and co-conspirators on this book)</a></blockquote><blockquote><a href="#part0007_aid-6LJU2">How to Use This Book: Intro</a><div><blockquote><a href="#part0007_who_is_this_book_forquestion_mark">Who is this book for?</a><div><blockquote><a href="#part0007_who_should_probably_back_away_from_this">Who should probably back away from this book?</a></blockquote></div></blockquote><blockquote><a href="#part0007_we_know_what_youapostrophere_thinkingdot">We know what you’re thinking.</a></blockquote><blockquote><a href="#part0007_and_we_know_what_your_brain_is_thinkingd">And we know what your brain is thinking.</a></blockquote><blockquote><a href="#part0007_metacognition_thinking_about_thinking">Metacognition: thinking about thinking</a></blockquote><blockquote><a href="#part0007_hereapostrophes_what_we_did">Here’s what WE did</a></blockquote><blockquote><a href="#part0007_hereapostrophes_what_you_can_do_to_bend">Here’s what YOU can do to bend your brain into submission</a></blockquote><blockquote><a href="#part0007_read_me">Read Me</a></blockquote><blockquote><a href="#part0007_tech_reviewers">Tech Reviewers</a></blockquote><blockquote><a href="#part0007_acknowledgments">Acknowledgments</a></blockquote><blockquote><a href="#part0007_even_more_peoplethe_large_number_of_ackn">Even more people</a></blockquote></div></blockquote><blockquote><a href="#part0008_aid-7K4G2">1. Intro to Design Patterns: Welcome to Design Patterns</a><div><blockquote><a href="#part0008_it_started_with_a_simple_simuduck_app">It started with a simple SimUDuck app</a></blockquote><blockquote><a href="#part0008_but_now_we_need_the_ducks_to_fly">But now we need the ducks to FLY</a></blockquote><blockquote><a href="#part0008_but_something_went_horribly_wronghellip">But something went horribly wrong...</a></blockquote><blockquote><a href="#part0008_joe_thinks_about_inheritancehellip">Joe thinks about inheritance...</a></blockquote><blockquote><a href="#part0008_how_about_an_interfacequestion_mark">How about an interface?</a></blockquote><blockquote><a href="#part0008_what_would_you_do_if_you_were_joequestio">What would you do if you were Joe?</a></blockquote><blockquote><a href="#part0008_one_constant_in_software_development">The one constant in software development</a></blockquote><blockquote><a href="#part0008_zeroing_in_on_the_problemhellip">Zeroing in on the problem...</a></blockquote><blockquote><a href="#part0008_separating_what_changes_from_what_stays">Separating what changes from what stays the same</a></blockquote><blockquote><a href="#part0008_designing_the_duck_behaviors">Designing the Duck Behaviors</a></blockquote><blockquote><a href="#part0008_implementing_the_duck_behaviors">Implementing the Duck Behaviors</a></blockquote><blockquote><a href="#part0008_integrating_the_duck_behavior">Integrating the Duck Behavior</a></blockquote><blockquote><a href="#part0008_more_integrationhellip">More integration...</a></blockquote><blockquote><a href="#part0008_testing_the_duck_code">Testing the Duck code</a></blockquote><blockquote><a href="#part0008_setting_behavior_dynamically">Setting behavior dynamically</a></blockquote><blockquote><a href="#part0008_big_picture_on_encapsulated_behaviors">The Big Picture on encapsulated behaviors</a></blockquote><blockquote><a href="#part0008_has-a_can_be_better_than_is-a">HAS-A can be better than IS-A</a></blockquote><blockquote><a href="#part0008_speaking_of_design_patternshellip">Speaking of Design Patterns...</a></blockquote><blockquote><a href="#part0008_overheard_at_the_local_dinerhellip">Overheard at the local diner...</a></blockquote><blockquote><a href="#part0008_overheard_in_the_next_cubiclehellip">Overheard in the next cubicle...</a></blockquote><blockquote><a href="#part0008_power_of_a_shared_pattern_vocabulary">The power of a shared pattern vocabulary</a></blockquote><blockquote><a href="#part0008_how_do_i_use_design_patternsquestion_mar">How do I use Design Patterns?</a></blockquote><blockquote><a href="#part0008_tools_for_your_design_toolbox">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0009_aid-8IL22">2. The Observer Pattern: Keeping your Objects in the know</a><div><blockquote><a href="#part0009_weather_monitoring_application_overview">The Weather Monitoring application overview</a></blockquote><blockquote><a href="#part0009_unpacking_the_weatherdata_class">Unpacking the WeatherData class</a></blockquote><blockquote><a href="#part0009_what_do_we_know_so_farquestion_mark">What do we know so far?</a></blockquote><blockquote><a href="#part0009_taking_a_firstcomma_misguided_swag_at_th">Taking a first, misguided SWAG at the Weather Station</a></blockquote><blockquote><a href="#part0009_whatapostrophes_wrong_with_our_implement">What’s wrong with our implementation?</a></blockquote><blockquote><a href="#part0009_meet_the_observer_pattern">Meet the Observer Pattern</a></blockquote><blockquote><a href="#part0009_publishers_plus_subscribers_equals_obser">Publishers + Subscribers = Observer Pattern</a></blockquote><blockquote><a href="#part0009_day_in_the_life_of_the_observer_pattern">A day in the life of the Observer Pattern</a></blockquote><blockquote><a href="#part0009_five-minute_drama_a_subject_for_observat">Five-minute drama: a subject for observation</a></blockquote><blockquote><a href="#part0009_two_weeks_laterhellip">Two weeks later...</a></blockquote><blockquote><a href="#part0009_observer_pattern_defined">The Observer Pattern defined</a></blockquote><blockquote><a href="#part0009_observer_pattern_defined_the_class_diagr">The Observer Pattern defined: the class diagram</a></blockquote><blockquote><a href="#part0009_power_of_loose_coupling">The power of Loose Coupling</a></blockquote><blockquote><a href="#part0009_cubicle_conversation">Cubicle conversation</a></blockquote><blockquote><a href="#part0009_designing_the_weather_station">Designing the Weather Station</a></blockquote><blockquote><a href="#part0009_implementing_the_weather_station">Implementing the Weather Station</a></blockquote><blockquote><a href="#part0009_implementing_the_subject_interface_in_we">Implementing the Subject interface in WeatherData</a></blockquote><blockquote><a href="#part0009_nowcomma_letapostrophes_build_those_disp">Now, let’s build those display elements</a></blockquote><blockquote><a href="#part0009_power_up_the_weather_station">Power up the Weather Station</a></blockquote><blockquote><a href="#part0009_using_javaapostrophes_built-in_observer">Using Java’s built-in Observer Pattern</a></blockquote><blockquote><a href="#part0009_how_javaapostrophes_built-in_observer_pa">How Java’s built-in Observer Pattern works</a></blockquote><blockquote><a href="#part0009_reworking_the_weather_station_with_the_b">Reworking the Weather Station with the built-in support</a></blockquote><blockquote><a href="#part0009_running_the_new_code">Running the new code</a></blockquote><blockquote><a href="#part0009_dark_side_of_javadotutildotobservable">The dark side of java.util.Observable</a></blockquote><blockquote><a href="#part0009_other_places_youapostrophell_find_the_ob">Other places you’ll find the Observer Pattern in the JDK</a></blockquote><blockquote><a href="#part0009_and_the_codehellip">And the code...</a><div><blockquote><a href="#part0009_updated_codecomma_using_lambda_expressio">The updated code, using lambda expressions</a></blockquote></div></blockquote><blockquote><a href="#part0009_tools_for_your_design_toolbox-id00010">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0010_aid-9H5K2">3. The Decorator Pattern: Decorating Objects</a><div><blockquote><a href="#part0010_welcome_to_starbuzz_coffee">Welcome to Starbuzz Coffee</a></blockquote><blockquote><a href="#part0010_open-closed_principle">The Open-Closed Principle</a></blockquote><blockquote><a href="#part0010_meet_the_decorator_pattern">Meet the Decorator Pattern</a></blockquote><blockquote><a href="#part0010_constructing_a_drink_order_with_decorato">Constructing a drink order with Decorators</a><div><blockquote><a href="#part0010_okaycomma_hereapostrophes_what_we_know_s">Okay, here’s what we know so far...</a></blockquote></div></blockquote><blockquote><a href="#part0010_decorator_pattern_defined">The Decorator Pattern defined</a></blockquote><blockquote><a href="#part0010_decorating_our_beverages">Decorating our Beverages</a></blockquote><blockquote><a href="#part0010_cubicle_conversation-id00019">Cubicle Conversation</a></blockquote><blockquote><a href="#part0010_new_barista_training">New barista training</a></blockquote><blockquote><a href="#part0010_writing_the_starbuzz_code">Writing the Starbuzz code</a></blockquote><blockquote><a href="#part0010_coding_beverages">Coding beverages</a></blockquote><blockquote><a href="#part0010_coding_condiments">Coding condiments</a></blockquote><blockquote><a href="#part0010_serving_some_coffees">Serving some coffees</a></blockquote><blockquote><a href="#part0010_real_world_decorators_java_isoliduso">Real World Decorators: Java I/O</a></blockquote><blockquote><a href="#part0010_decorating_the_javadotio_classes">Decorating the java.io classes</a></blockquote><blockquote><a href="#part0010_writing_your_own_java_isoliduso_decorato">Writing your own Java I/O Decorator</a></blockquote><blockquote><a href="#part0010_test_out_your_new_java_isoliduso_decorat">Test out your new Java I/O Decorator</a><div><blockquote><a href="#part0010_give_it_a_spin">Give it a spin</a></blockquote></div></blockquote><blockquote><a href="#part0010_tools_for_your_design_toolbox-id00023">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0011_aid-AFM62">4. The Factory Pattern: Baking with OO Goodness</a><div><blockquote><a href="#part0011_identifying_the_aspects_that_vary">Identifying the aspects that vary</a></blockquote><blockquote><a href="#part0011_but_the_pressure_is_on_to_add_more_pizza">But the pressure is on to add more pizza types</a></blockquote><blockquote><a href="#part0011_encapsulating_object_creation">Encapsulating object creation</a></blockquote><blockquote><a href="#part0011_building_a_simple_pizza_factory">Building a simple pizza factory</a></blockquote><blockquote><a href="#part0011_reworking_the_pizzastore_class">Reworking the PizzaStore class</a></blockquote><blockquote><a href="#part0011_simple_factory_defined">The Simple Factory defined</a></blockquote><blockquote><a href="#part0011_franchising_the_pizza_store">Franchising the pizza store</a><div><blockquote><a href="#part0011_weapostropheve_seen_one_approachhellip">We’ve seen one approach...</a></blockquote><blockquote><a href="#part0011_but_youapostrophed_like_a_little_more_qu">But you’d like a little more quality control...</a></blockquote></div></blockquote><blockquote><a href="#part0011_framework_for_the_pizza_store">A framework for the pizza store</a></blockquote><blockquote><a href="#part0011_allowing_the_subclasses_to_decide">Allowing the subclasses to decide</a></blockquote><blockquote><a href="#part0011_letapostrophes_make_a_pizzastore">Let’s make a PizzaStore</a></blockquote><blockquote><a href="#part0011_declaring_a_factory_method">Declaring a factory method</a><div><blockquote><a href="#part0011_letapostrophes_see_how_it_works_ordering">Let’s see how it works: ordering pizzas with the pizza factory method</a></blockquote><blockquote><a href="#part0011_so_how_do_they_orderquestion_mark">So how do they order?</a></blockquote><blockquote><a href="#part0011_letapostrophes_check_out_how_these_pizza">Let’s check out how these pizzas are really made to order...</a></blockquote></div></blockquote><blockquote><a href="#part0011_weapostrophere_just_missing_one_thing_pi">We’re just missing one thing: PIZZA!</a><div><blockquote><a href="#part0011_our_pizzastore_isnapostrophet_going_to_b">Our PizzaStore isn’t going to be very popular without some pizzas, so let’s implement them</a></blockquote><blockquote><a href="#part0011_now_we_just_need_some_concrete_subclasse">Now we just need some concrete subclasses... how about defining New York and Chicago style cheese pizzas?</a></blockquote></div></blockquote><blockquote><a href="#part0011_youapostropheve_waited_long_enoughdot_ti">You’ve waited long enough. Time for some pizzas!</a></blockquote><blockquote><a href="#part0011_itapostrophes_finally_time_to_meet_the_f">It’s finally time to meet the Factory Method Pattern</a><div><blockquote><a href="#part0011_creator_classes">The Creator classes</a></blockquote><blockquote><a href="#part0011_product_classes">The Product classes</a></blockquote></div></blockquote><blockquote><a href="#part0011_another_perspective_parallel_class_hiera">Another perspective: parallel class hierarchies</a></blockquote><blockquote><a href="#part0011_factory_method_pattern_defined">Factory Method Pattern defined</a></blockquote><blockquote><a href="#part0011_very_dependent_pizzastore">A very dependent PizzaStore</a></blockquote><blockquote><a href="#part0011_looking_at_object_dependencies">Looking at object dependencies</a></blockquote><blockquote><a href="#part0011_dependency_inversion_principle">The Dependency Inversion Principle</a></blockquote><blockquote><a href="#part0011_applying_the_principle">Applying the Principle</a></blockquote><blockquote><a href="#part0011_inverting_your_thinkinghellip">Inverting your thinking...</a></blockquote><blockquote><a href="#part0011_few_guidelines_to_help_you_follow_the_pr">A few guidelines to help you follow the Principle...</a></blockquote><blockquote><a href="#part0011_meanwhilecomma_back_at_the_pizzastorehel">Meanwhile, back at the PizzaStore...</a><div><blockquote><a href="#part0011_ensuring_consistency_in_your_ingredients">Ensuring consistency in your ingredients</a></blockquote></div></blockquote><blockquote><a href="#part0011_families_of_ingredientshellip">Families of ingredients...</a></blockquote><blockquote><a href="#part0011_building_the_ingredient_factories">Building the ingredient factories</a></blockquote><blockquote><a href="#part0011_building_the_new_york_ingredient_factory">Building the New York ingredient factory</a></blockquote><blockquote><a href="#part0011_reworking_the_pizzashellip">Reworking the pizzas...</a></blockquote><blockquote><a href="#part0011_reworking_the_pizzascomma_continuedhelli">Reworking the pizzas, continued...</a></blockquote><blockquote><a href="#part0011_revisiting_our_pizza_stores">Revisiting our pizza stores</a></blockquote><blockquote><a href="#part0011_what_have_we_donequestion_mark">What have we done?</a></blockquote><blockquote><a href="#part0011_more_pizza_for_ethan_and_joelhellip">More pizza for Ethan and Joel...</a><div><blockquote><a href="#part0011_from_here_things_changecomma_because_we">From here things change, because we are using an ingredient factory</a></blockquote></div></blockquote><blockquote><a href="#part0011_abstract_factory_pattern_defined">Abstract Factory Pattern defined</a></blockquote><blockquote><a href="#part0011_factory_method_and_abstract_factory_comp">Factory Method and Abstract Factory compared</a></blockquote><blockquote><a href="#part0011_tools_for_your_design_toolbox-id00037">Tools for your Design Toolbox</a></blockquote><blockquote><a href="#part0011_very_dependent_pizzastore-id00042">A very dependent PizzaStore</a></blockquote></div></blockquote><blockquote><a href="#part0012_aid-BE6O2">5. The Singleton Pattern: One of a Kind Objects</a><div><blockquote><a href="#part0012_little_singleton">The Little Singleton</a><div><blockquote><a href="#part0012_small_socratic_exercise_in_the_style_of">A small Socratic exercise in the style of The Little Lisper</a></blockquote></div></blockquote><blockquote><a href="#part0012_dissecting_the_classic_singleton_pattern">Dissecting the classic Singleton Pattern implementation</a></blockquote><blockquote><a href="#part0012_chocolate_factory">The Chocolate Factory</a></blockquote><blockquote><a href="#part0012_singleton_pattern_defined">Singleton Pattern defined</a></blockquote><blockquote><a href="#part0012_houstoncomma_hersheycomma_pa_we_have_a_p"><span class="strikethrough">Houston,</span> Hershey, PA we have a problem...</a></blockquote><blockquote><a href="#part0012_dealing_with_multithreading">Dealing with multithreading</a></blockquote><blockquote><a href="#part0012_can_we_improve_multithreadingquestion_ma">Can we improve multithreading?</a><div><blockquote><a href="#part0012_onedot_do_nothing_if_the_performance_of">1. Do nothing if the performance of getInstance() isn’t critical to your application.</a></blockquote><blockquote><a href="#part0012_twodot_move_to_an_eagerly_created_instan">2. Move to an eagerly created instance rather than a lazily created one.</a></blockquote><blockquote><a href="#part0012_threedot_use_quotation_markdouble-checke">3. Use “double-checked locking” to reduce the use of synchronization in getInstance().</a></blockquote></div></blockquote><blockquote><a href="#part0012_meanwhilecomma_back_at_the_chocolate_fac">Meanwhile, back at the Chocolate Factory...</a></blockquote><blockquote><a href="#part0012_congratulationsexclamation_mark">Congratulations!</a></blockquote><blockquote><a href="#part0012_tools_for_your_design_toolbox-id00052">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0013_aid-CCNA2">6. The Command Pattern: Encapsulating Invocation</a><div><blockquote><a href="#part0013_free_hardwareexclamation_mark_letapostro">Free hardware! Let’s check out the Remote Control...</a></blockquote><blockquote><a href="#part0013_taking_a_look_at_the_vendor_classes">Taking a look at the vendor classes</a></blockquote><blockquote><a href="#part0013_cubicle_conversation-id00058">Cubicle Conversation</a></blockquote><blockquote><a href="#part0013_meanwhilecomma_back_at_the_dinerhellipco">Meanwhile, back at the Diner..., or, A brief introduction to the Command Pattern</a></blockquote><blockquote><a href="#part0013_letapostrophes_study_the_interaction_in">Let’s study the interaction in a little more detail...</a></blockquote><blockquote><a href="#part0013_objectville_diner_roles_and_responsibili">The Objectville Diner roles and responsibilities</a></blockquote><blockquote><a href="#part0013_from_the_diner_to_the_command_pattern">From the Diner to the Command Pattern</a></blockquote><blockquote><a href="#part0013_our_first_command_object">Our first command object</a></blockquote><blockquote><a href="#part0013_using_the_command_object">Using the command object</a></blockquote><blockquote><a href="#part0013_creating_a_simple_test_to_use_the_remote">Creating a simple test to use the Remote Control</a></blockquote><blockquote><a href="#part0013_command_pattern_defined">The Command Pattern defined</a></blockquote><blockquote><a href="#part0013_command_pattern_defined_the_class_diagra">The Command Pattern defined: the class diagram</a></blockquote><blockquote><a href="#part0013_assigning_commands_to_slots">Assigning Commands to slots</a></blockquote><blockquote><a href="#part0013_implementing_the_remote_control">Implementing the Remote Control</a></blockquote><blockquote><a href="#part0013_implementing_the_commands">Implementing the Commands</a></blockquote><blockquote><a href="#part0013_putting_the_remote_control_through_its_p">Putting the Remote Control through its paces</a><div><blockquote><a href="#part0013_nowcomma_letapostrophes_check_out_the_ex">Now, let’s check out the execution of our remote control test...</a></blockquote></div></blockquote><blockquote><a href="#part0013_time_to_write_that_documentationhellip">Time to write that documentation...</a></blockquote><blockquote><a href="#part0013_what_are_we_doingquestion_mark">What are we doing?</a></blockquote><blockquote><a href="#part0013_time_to_qa_that_undo_buttonexclamation_m">Time to QA that Undo button!</a></blockquote><blockquote><a href="#part0013_using_state_to_implement_undo">Using state to implement Undo</a></blockquote><blockquote><a href="#part0013_adding_undo_to_the_ceilingfan_commands">Adding Undo to the CeilingFan commands</a></blockquote><blockquote><a href="#part0013_get_ready_to_test_the_ceiling_fan">Get ready to test the ceiling fan</a></blockquote><blockquote><a href="#part0013_testing_the_ceiling_fanhellip">Testing the ceiling fan...</a></blockquote><blockquote><a href="#part0013_every_remote_needs_a_party_modeexclamati">Every remote needs a Party Mode!</a></blockquote><blockquote><a href="#part0013_using_a_macro_command">Using a macro command</a></blockquote><blockquote><a href="#part0013_command_pattern_means_lots_of_command_cl">The Command Pattern means lots of command classes</a><div><blockquote><a href="#part0013_do_we_really_need_all_these_command_clas">Do we really need all these command classes?</a></blockquote></div></blockquote><blockquote><a href="#part0013_simplifying_the_remote_control_with_lamb">Simplifying the Remote Control with lambda expressions</a></blockquote><blockquote><a href="#part0013_simplifying_even_more_with_method_refere">Simplifying even more with method references</a><div><blockquote><a href="#part0013_what_if_we_need_to_do_more_than_one_thin">What if we need to do more than one thing in our lambda expression?</a></blockquote></div></blockquote><blockquote><a href="#part0013_test_the_remote_control_with_lambda_expr">Test the remote control with lambda expressions</a><div><blockquote><a href="#part0013_check_out_the_results_of_all_those_lambd">Check out the results of all those lambda expression commands...</a></blockquote></div></blockquote><blockquote><a href="#part0013_more_uses_of_the_command_pattern_queuing">More uses of the Command Pattern: queuing requests</a></blockquote><blockquote><a href="#part0013_more_uses_of_the_command_pattern_logging">More uses of the Command Pattern: logging requests</a></blockquote><blockquote><a href="#part0013_tools_for_your_design_toolbox-id00064">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0014_aid-DB7S2">7. The Adapter and Facade Patterns: Being Adaptive</a><div><blockquote><a href="#part0014_adapters_all_around_us">Adapters all around us</a></blockquote><blockquote><a href="#part0014_object-oriented_adapters">Object-oriented adapters</a></blockquote><blockquote><a href="#part0014_if_it_walks_like_a_duck_and_quacks_like">If it walks like a duck and quacks like a duck, then it <span class="strikethrough">must</span> might be a <span class="strikethrough">duck</span> turkey wrapped with a duck adapter...</a></blockquote><blockquote><a href="#part0014_test_drive_the_adapter">Test drive the adapter</a></blockquote><blockquote><a href="#part0014_adapter_pattern_explained">The Adapter Pattern explained</a><div><blockquote><a href="#part0014_hereapostrophes_how_the_client_uses_the">Here’s how the Client uses the Adapter</a></blockquote></div></blockquote><blockquote><a href="#part0014_adapter_pattern_defined">Adapter Pattern defined</a></blockquote><blockquote><a href="#part0014_object_and_class_adapters">Object and class adapters</a></blockquote><blockquote><a href="#part0014_real-world_adapters">Real-world adapters</a><div><blockquote><a href="#part0014_old-world_enumerators">Old-world Enumerators</a></blockquote><blockquote><a href="#part0014_new-world_iterators">New-world Iterators</a></blockquote><blockquote><a href="#part0014_and_todayhellip">And today...</a></blockquote></div></blockquote><blockquote><a href="#part0014_adapting_an_enumeration_to_an_iterator">Adapting an Enumeration to an Iterator</a><div><blockquote><a href="#part0014_designing_the_adapter">Designing the Adapter</a></blockquote><blockquote><a href="#part0014_dealing_with_the_removeleft_parenthesisr">Dealing with the remove() method</a></blockquote><blockquote><a href="#part0014_writing_the_enumerationiterator_adapter">Writing the EnumerationIterator adapter</a></blockquote></div></blockquote><blockquote><a href="#part0014_and_now_for_something_differenthellip">And now for something different...</a></blockquote><blockquote><a href="#part0014_home_sweet_home_theater">Home Sweet Home Theater</a></blockquote><blockquote><a href="#part0014_watching_a_movie_left_parenthesisthe_har">Watching a movie (the hard way)</a></blockquote><blockquote><a href="#part0014_lightscomma_cameracomma_facadeexclamatio">Lights, Camera, Facade!</a></blockquote><blockquote><a href="#part0014_constructing_your_home_theater_facade">Constructing your home theater facade</a></blockquote><blockquote><a href="#part0014_implementing_the_simplified_interface">Implementing the simplified interface</a></blockquote><blockquote><a href="#part0014_time_to_watch_a_movie_left_parenthesisth">Time to watch a movie (the easy way)</a></blockquote><blockquote><a href="#part0014_facade_pattern_defined">Facade Pattern defined</a></blockquote><blockquote><a href="#part0014_principle_of_least_knowledge">The Principle of Least Knowledge</a></blockquote><blockquote><a href="#part0014_how_not_to_win_friends_and_influence_obj">How NOT to Win Friends and Influence Objects</a><div><blockquote><a href="#part0014_keeping_your_method_calls_in_boundshelli">Keeping your method calls in bounds...</a></blockquote></div></blockquote><blockquote><a href="#part0014_facade_and_the_principle_of_least_knowle">The Facade and the Principle of Least Knowledge</a></blockquote><blockquote><a href="#part0014_tools_for_your_design_toolbox-id00079">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0015_aid-E9OE2">8. The Template Method Pattern: Encapsulating Algorithms</a><div><blockquote><a href="#part0015_itapostrophes_time_for_some_more_caffein">It’s time for some more caffeine</a></blockquote><blockquote><a href="#part0015_whipping_up_some_coffee_and_tea_classes">Whipping up some coffee and tea classes (in Java)</a></blockquote><blockquote><a href="#part0015_and_now_the_teahellip">And now the Tea...</a></blockquote><blockquote><a href="#part0015_sircomma_may_i_abstract_your_coffeecomma">Sir, may I abstract your Coffee, Tea?</a></blockquote><blockquote><a href="#part0015_taking_the_design_furtherhellip">Taking the design further...</a></blockquote><blockquote><a href="#part0015_abstracting_preparerecipeleft_parenthesi">Abstracting prepareRecipe()</a></blockquote><blockquote><a href="#part0015_what_have_we_donequestion_mark-id00089">What have we done?</a></blockquote><blockquote><a href="#part0015_meet_the_template_method">Meet the Template Method</a></blockquote><blockquote><a href="#part0015_letapostrophes_make_some_teahellip">Let’s make some tea...</a></blockquote><blockquote><a href="#part0015_what_did_the_template_method_get_usquest">What did the Template Method get us?</a></blockquote><blockquote><a href="#part0015_template_method_pattern_defined">Template Method Pattern defined</a></blockquote><blockquote><a href="#part0015_hooked_on_template_methodhellip">Hooked on Template Method...</a></blockquote><blockquote><a href="#part0015_using_the_hook">Using the hook</a></blockquote><blockquote><a href="#part0015_letapostrophes_run_the_test_drive">Let’s run the Test Drive</a></blockquote><blockquote><a href="#part0015_hollywood_principle">The Hollywood Principle</a></blockquote><blockquote><a href="#part0015_hollywood_principle_and_template_method">The Hollywood Principle and Template Method</a></blockquote><blockquote><a href="#part0015_template_methods_in_the_wild">Template Methods in the Wild</a></blockquote><blockquote><a href="#part0015_sorting_with_template_method">Sorting with Template Method</a></blockquote><blockquote><a href="#part0015_weapostropheve_got_some_ducks_to_sorthel">We’ve got some ducks to sort...</a></blockquote><blockquote><a href="#part0015_what_is_comparetoleft_parenthesisright_p">What is compareTo()?</a></blockquote><blockquote><a href="#part0015_comparing_ducks_and_ducks">Comparing Ducks and Ducks</a></blockquote><blockquote><a href="#part0015_letapostrophes_sort_some_ducks">Let’s sort some Ducks</a></blockquote><blockquote><a href="#part0015_making_of_the_sorting_duck_machine">The making of the sorting duck machine</a></blockquote><blockquote><a href="#part0015_swinginapostrophe_with_frames">Swingin’ with Frames</a></blockquote><blockquote><a href="#part0015_applets">Applets</a></blockquote><blockquote><a href="#part0015_tools_for_your_design_toolbox-id00097">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0016_aid-F8902">9. The Iterator and Composite Patterns: Well-Managed Collections</a><div><blockquote><a href="#part0016_breaking_news_objectville_diner_and_obje">Breaking News: Objectville Diner and Objectville Pancake House Merge</a></blockquote><blockquote><a href="#part0016_check_out_the_menu_items">Check out the Menu Items</a></blockquote><blockquote><a href="#part0016_lou_and_melapostrophes_menu_implementati">Lou and Mel’s Menu implementations</a></blockquote><blockquote><a href="#part0016_whatapostrophes_the_problem_with_having">What’s the problem with having two different menu representations?</a><div><blockquote><a href="#part0016_java-enabled_waitress_specification">The Java-Enabled Waitress Specification</a></blockquote></div></blockquote><blockquote><a href="#part0016_what_nowquestion_mark">What now?</a></blockquote><blockquote><a href="#part0016_can_we_encapsulate_the_iterationquestion">Can we encapsulate the iteration?</a></blockquote><blockquote><a href="#part0016_meet_the_iterator_pattern">Meet the Iterator Pattern</a></blockquote><blockquote><a href="#part0016_adding_an_iterator_to_dinermenu">Adding an Iterator to DinerMenu</a></blockquote><blockquote><a href="#part0016_reworking_the_diner_menu_with_iterator">Reworking the Diner Menu with Iterator</a></blockquote><blockquote><a href="#part0016_fixing_up_the_waitress_code">Fixing up the Waitress code</a></blockquote><blockquote><a href="#part0016_testing_our_code">Testing our code</a><div><blockquote><a href="#part0016_hereapostrophes_the_test_runhellip">Here’s the test run...</a></blockquote></div></blockquote><blockquote><a href="#part0016_what_have_we_done_so_farquestion_mark">What have we done so far?</a></blockquote><blockquote><a href="#part0016_what_we_have_so_farhellip">What we have so far...</a></blockquote><blockquote><a href="#part0016_making_some_improvementshellip">Making some improvements...</a></blockquote><blockquote><a href="#part0016_cleaning_things_up_with_javadotutildotit">Cleaning things up with java.util.Iterator</a></blockquote><blockquote><a href="#part0016_we_are_almost_therehellip">We are almost there...</a></blockquote><blockquote><a href="#part0016_what_does_this_get_usquestion_mark">What does this get us?</a></blockquote><blockquote><a href="#part0016_iterator_pattern_defined">Iterator Pattern defined</a></blockquote><blockquote><a href="#part0016_single_responsibility">Single Responsibility</a></blockquote><blockquote><a href="#part0016_taking_a_look_at_the_cafeacute_menu">Taking a look at the Café Menu</a></blockquote><blockquote><a href="#part0016_reworking_the_cafeacute_menu_code">Reworking the Café Menu code</a></blockquote><blockquote><a href="#part0016_adding_the_cafeacute_menu_to_the_waitres">Adding the Café Menu to the Waitress</a></blockquote><blockquote><a href="#part0016_breakfastcomma_lunch_and_dinner">Breakfast, lunch AND dinner</a><div><blockquote><a href="#part0016_hereapostrophes_the_test_runsemicolon_ch">Here’s the test run; check out the new dinner menu from the Café!</a></blockquote></div></blockquote><blockquote><a href="#part0016_what_did_we_doquestion_mark">What did we do?</a></blockquote><blockquote><a href="#part0016_we_decoupled_the_waitresshellipdot">We decoupled the Waitress....</a></blockquote><blockquote><a href="#part0016_hellip_and_we_made_the_waitress_more_ext">... and we made the Waitress more extensible</a></blockquote><blockquote><a href="#part0016_but_thereapostrophes_moreexclamation_mar">But there’s more!</a></blockquote><blockquote><a href="#part0016_iterators_and_collections">Iterators and Collections</a></blockquote><blockquote><a href="#part0016_is_the_waitress_ready_for_prime_timeques">Is the Waitress ready for prime time?</a></blockquote><blockquote><a href="#part0016_just_when_we_thought_it_was_safehellip">Just when we thought it was safe...</a></blockquote><blockquote><a href="#part0016_what_do_we_needquestion_mark">What do we need?</a></blockquote><blockquote><a href="#part0016_composite_pattern_defined">The Composite Pattern defined</a></blockquote><blockquote><a href="#part0016_designing_menus_with_composite">Designing Menus with Composite</a></blockquote><blockquote><a href="#part0016_implementing_the_menu_component">Implementing the Menu Component</a></blockquote><blockquote><a href="#part0016_implementing_the_menu_item">Implementing the Menu Item</a></blockquote><blockquote><a href="#part0016_implementing_the_composite_menu">Implementing the Composite Menu</a><div><blockquote><a href="#part0016_fixing_the_printleft_parenthesisright_pa">Fixing the print() method</a></blockquote></div></blockquote><blockquote><a href="#part0016_getting_ready_for_a_test_drivehellip">Getting ready for a test drive...</a></blockquote><blockquote><a href="#part0016_now_for_the_test_drivehellip">Now for the test drive...</a></blockquote><blockquote><a href="#part0016_getting_ready_for_a_test_drivehe-id00110">Getting ready for a test drive...</a></blockquote><blockquote><a href="#part0016_flashback_to_iterator">Flashback to Iterator</a></blockquote><blockquote><a href="#part0016_composite_iterator">The Composite Iterator</a></blockquote><blockquote><a href="#part0016_null_iterator">The Null Iterator</a></blockquote><blockquote><a href="#part0016_give_me_the_vegetarian_menu">Give me the vegetarian menu</a></blockquote><blockquote><a href="#part0016_magic_of_iterator_ampersand_composite_to">The magic of Iterator &amp; Composite together...</a></blockquote><blockquote><a href="#part0016_tools_for_your_design_toolbox-id00114">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0017_aid-G6PI2">10. The State Pattern: The State of Things</a><div><blockquote><a href="#part0017_jawva_breakers">Ja<span class="strikethrough">w</span>va Breakers</a></blockquote><blockquote><a href="#part0017_cubicle_conversation-id00121">Cubicle Conversation</a></blockquote><blockquote><a href="#part0017_state_machines_101">State machines 101</a></blockquote><blockquote><a href="#part0017_writing_the_code">Writing the code</a></blockquote><blockquote><a href="#part0017_in-house_testing">In-house testing</a></blockquote><blockquote><a href="#part0017_you_knew_it_was_cominghellip_a_change_re">You knew it was coming... a change request!</a></blockquote><blockquote><a href="#part0017_messy_state_of_thingshellip">The messy STATE of things...</a></blockquote><blockquote><a href="#part0017_new_design">The new design</a></blockquote><blockquote><a href="#part0017_defining_the_state_interfaces_and_classe">Defining the State interfaces and classes</a></blockquote><blockquote><a href="#part0017_implementing_our_state_classes">Implementing our State classes</a></blockquote><blockquote><a href="#part0017_reworking_the_gumball_machine">Reworking the Gumball Machine</a></blockquote><blockquote><a href="#part0017_nowcomma_letapostrophes_look_at_the_comp">Now, let’s look at the complete GumballMachine class...</a></blockquote><blockquote><a href="#part0017_implementing_more_states">Implementing more states</a></blockquote><blockquote><a href="#part0017_letapostrophes_take_a_look_at_what_weapo">Let’s take a look at what we’ve done so far...</a></blockquote><blockquote><a href="#part0017_state_pattern_defined">The State Pattern defined</a></blockquote><blockquote><a href="#part0017_we_still_need_to_finish_the_gumball_1_in">We still need to finish the Gumball 1 in 10 game</a></blockquote><blockquote><a href="#part0017_finishing_the_game">Finishing the game</a></blockquote><blockquote><a href="#part0017_demo_for_the_ceo_of_mighty_gumballcomma">Demo for the CEO of Mighty Gumball, Inc.</a></blockquote><blockquote><a href="#part0017_sanity_checkhellip">Sanity check...</a></blockquote><blockquote><a href="#part0017_we_almost_forgotexclamation_mark">We almost forgot!</a></blockquote><blockquote><a href="#part0017_tools_for_your_design_toolbox-id00132">Tools for your Design Toolbox</a></blockquote></div></blockquote><blockquote><a href="#part0018_aid-H5A42">11. The Proxy Pattern: Controlling Object Access</a><div><blockquote><a href="#part0018_coding_the_monitor">Coding the Monitor</a></blockquote><blockquote><a href="#part0018_testing_the_monitor">Testing the Monitor</a></blockquote><blockquote><a href="#part0018_role_of_the_apostropheremote_proxyapostr">The role of the ‘remote proxy’</a></blockquote><blockquote><a href="#part0018_adding_a_remote_proxy_to_the_gumball_mac">Adding a remote proxy to the Gumball Machine monitoring code</a></blockquote><blockquote><a href="#part0018_remote_methods_101">Remote methods 101</a></blockquote><blockquote><a href="#part0018_java_rmicomma_the_big_picture">Java RMI, the Big Picture</a></blockquote><blockquote><a href="#part0018_how_does_the_client_get_the_stub_objectq">How does the client get the stub <span class="underline">ob</span>j<span class="underline">ect</span>?</a></blockquote><blockquote><a href="#part0018_back_to_our_gumballmachine_remote_proxy">Back to our GumballMachine remote proxy</a></blockquote><blockquote><a href="#part0018_getting_the_gumballmachine_ready_to_be_a">Getting the GumballMachine ready to be a remote service</a></blockquote><blockquote><a href="#part0018_registering_with_the_rmi_registryhellip">Registering with the RMI registry...</a></blockquote><blockquote><a href="#part0018_now_for_the_gumballmonitor_clienthellip">Now for the GumballMonitor client...</a></blockquote><blockquote><a href="#part0018_writing_the_monitor_test_drive">Writing the Monitor test drive</a></blockquote><blockquote><a href="#part0018_another_demo_for_the_ceo_of_mighty_gumba">Another demo for the CEO of Mighty Gumball...</a><div><blockquote><a href="#part0018_and_now_letapostrophes_put_the_monitor_i">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</a></blockquote></div></blockquote><blockquote><a href="#part0018_proxy_pattern_defined">The Proxy Pattern defined</a></blockquote><blockquote><a href="#part0018_get_ready_for_virtual_proxy">Get ready for Virtual Proxy</a><div><blockquote><a href="#part0018_remote_proxy">Remote Proxy</a></blockquote><blockquote><a href="#part0018_virtual_proxy">Virtual Proxy</a></blockquote></div></blockquote><blockquote><a href="#part0018_displaying_cd_covers">Displaying CD covers</a></blockquote><blockquote><a href="#part0018_designing_the_cd_cover_virtual_proxy">Designing the CD cover Virtual Proxy</a><div><blockquote><a href="#part0018_how_imageproxy_is_going_to_work">How ImageProxy is going to work</a></blockquote></div></blockquote><blockquote><a href="#part0018_writing_the_image_proxy">Writing the Image Proxy</a></blockquote><blockquote><a href="#part0018_testing_the_cd_cover_viewer">Testing the CD Cover Viewer</a><div><blockquote><a href="#part0018_things_to_tryhellip">Things to try...</a></blockquote></div></blockquote><blockquote><a href="#part0018_what_did_we_doquestion_mark-id00147">What did we do?</a></blockquote><blockquote><a href="#part0018_using_the_java_apiapostrophes_proxy_to_c">Using the Java API’s Proxy to create a protection proxy</a></blockquote><blockquote><a href="#part0018_matchmaking_in_objectville">Matchmaking in Objectville</a></blockquote><blockquote><a href="#part0018_personbean_implementation">The PersonBean implementation</a></blockquote><blockquote><a href="#part0018_five-minute_drama_protecting_subjects">Five-minute drama: protecting subjects</a></blockquote><blockquote><a href="#part0018_big_picture_creating_a_dynamic_proxy_for">Big Picture: creating a Dynamic Proxy for the PersonBean</a></blockquote><blockquote><a href="#part0018_step_one_creating_invocation_handlers">Step one: creating Invocation Handlers</a></blockquote><blockquote><a href="#part0018_creating_invocation_handlers_continuedhe">Creating Invocation Handlers continued...</a></blockquote><blockquote><a href="#part0018_step_two_creating_the_proxy_class_and_in">Step two: creating the Proxy class and instantiating the Proxy object</a></blockquote><blockquote><a href="#part0018_testing_the_matchmaking_service">Testing the matchmaking service</a></blockquote><blockquote><a href="#part0018_running_the_codehellip">Running the code...</a></blockquote><blockquote><a href="#part0018_proxy_zoo">The Proxy Zoo</a></blockquote><blockquote><a href="#part0018_tools_for_your_design_toolbox-id00156">Tools for your Design Toolbox</a></blockquote><blockquote><a href="#part0018_code_for_the_cd_cover_viewer">The code for the CD Cover Viewer</a></blockquote></div></blockquote><blockquote><a href="#part0019_aid-I3QM2">12. Compound Patterns: Patterns of Patterns</a><div><blockquote><a href="#part0019_working_together">Working together</a></blockquote><blockquote><a href="#part0019_duck_reunion">Duck reunion</a></blockquote><blockquote><a href="#part0019_what_did_we_doquestion_mark-id00169">What did we do?</a></blockquote><blockquote><a href="#part0019_duckapostrophes_eye_view_the_class_diagr">A duck’s eye view: the class diagram</a></blockquote><blockquote><a href="#part0019_king_of_compound_patterns">The King of Compound Patterns</a><div><blockquote><a href="#part0019_if_elvis_were_a_compound_patterncomma_hi">If Elvis were a compound pattern, his name would be Model-View-Controller, and he’d be singing a little song like this...</a></blockquote></div></blockquote><blockquote><a href="#part0019_meet_the_model-view-controller">Meet the Model-View-Controller</a></blockquote><blockquote><a href="#part0019_closer_lookhellip">A closer look...</a></blockquote><blockquote><a href="#part0019_looking_at_mvc_through_patterns-colored">Looking at MVC through patterns-colored glasses</a><div><blockquote><a href="#part0019_observer">Observer</a></blockquote><blockquote><a href="#part0019_strategy">Strategy</a></blockquote><blockquote><a href="#part0019_composite">Composite</a></blockquote></div></blockquote><blockquote><a href="#part0019_using_mvc_to_control_the_beathellip">Using MVC to control the beat...</a><div><blockquote><a href="#part0019_meet_the_java_dj_view">Meet the Java DJ View</a></blockquote><blockquote><a href="#part0019_controller_is_in_the_middlehellip">The controller is in the middle...</a></blockquote><blockquote><a href="#part0019_letapostrophes_not_forget_about_the_mode">Let’s not forget about the model underneath it all...</a></blockquote></div></blockquote><blockquote><a href="#part0019_putting_the_pieces_together">Putting the pieces together</a></blockquote><blockquote><a href="#part0019_building_the_pieces">Building the pieces</a><div><blockquote><a href="#part0019_letapostrophes_check_out_the_beatmodelin">Let’s check out the BeatModelInterface before looking at the implementation</a></blockquote></div></blockquote><blockquote><a href="#part0019_now_letapostrophes_have_a_look_at_the_co">Now let’s have a look at the concrete BeatModel class</a></blockquote><blockquote><a href="#part0019_view">The View</a></blockquote><blockquote><a href="#part0019_implementing_the_view">Implementing the View</a></blockquote><blockquote><a href="#part0019_implementing_the_viewcomma_continuedhell">Implementing the View, continued...</a></blockquote><blockquote><a href="#part0019_now_for_the_controller">Now for the Controller</a><div><blockquote><a href="#part0019_and_hereapostrophes_the_implementation_o">And here’s the implementation of the controller</a></blockquote></div></blockquote><blockquote><a href="#part0019_putting_it_all_togetherhellip">Putting it all together...</a><div><blockquote><a href="#part0019_and_now_for_a_test_runhellip">And now for a test run...</a></blockquote><blockquote><a href="#part0019_things_to_do">Things to do</a></blockquote></div></blockquote><blockquote><a href="#part0019_exploring_strategy">Exploring Strategy</a></blockquote><blockquote><a href="#part0019_adapting_the_model">Adapting the Model</a></blockquote><blockquote><a href="#part0019_now_weapostrophere_ready_for_a_heartcont">Now we’re ready for a HeartController</a><div><blockquote><a href="#part0019_and_thatapostrophes_itexclamation_mark_n">And that’s it! Now it’s time for some test code...</a></blockquote></div></blockquote><blockquote><a href="#part0019_and_now_for_a_test_runhellip-id00173">And now for a test run...</a><div><blockquote><a href="#part0019_things_to_do-id00174">Things to do</a></blockquote></div></blockquote><blockquote><a href="#part0019_mvc_and_the_web">MVC and the Web</a></blockquote><blockquote><a href="#part0019_model_2_djapostropheing_from_a_cell_phon">Model 2: DJ’ing from a cell phone</a><div><blockquote><a href="#part0019_plan">The plan</a></blockquote></div></blockquote><blockquote><a href="#part0019_step_one_the_model">Step one: the model</a></blockquote><blockquote><a href="#part0019_step_two_the_controller_servlet">Step two: the controller servlet</a></blockquote><blockquote><a href="#part0019_now_we_need_a_viewhellip">Now we need a view...</a></blockquote><blockquote><a href="#part0019_putting_model_2_to_the_testhellip">Putting Model 2 to the test...</a><div><blockquote><a href="#part0019_things_to_do-id00175">Things to do</a></blockquote></div></blockquote><blockquote><a href="#part0019_design_patterns_and_model_2">Design Patterns and Model 2</a><div><blockquote><a href="#part0019_model_2_is_an_adaptation_of_mvc_to_the_w">Model 2 is an adaptation of MVC to the Web</a></blockquote></div></blockquote><blockquote><a href="#part0019_observer-id00176">Observer</a><div><blockquote><a href="#part0019_strategy-id00177">Strategy</a></blockquote><blockquote><a href="#part0019_composite-id00178">Composite</a></blockquote></div></blockquote><blockquote><a href="#part0019_tools_for_your_design_toolbox-id00180">Tools for your Design Toolbox</a></blockquote><blockquote><a href="#part0019_exercise_solutions">Exercise Solutions</a></blockquote></div></blockquote><blockquote><a href="#part0020_aid-J2B82">13. Better Living with Patterns: Patterns in the Real World</a><div><blockquote><a href="#part0020_design_pattern_defined">Design Pattern defined</a></blockquote><blockquote><a href="#part0020_looking_more_closely_at_the_design_patte">Looking more closely at the Design Pattern definition</a></blockquote><blockquote><a href="#part0020_so_you_wanna_be_a_design_patterns_writer">So you wanna be a Design Patterns writer</a></blockquote><blockquote><a href="#part0020_organizing_design_patterns">Organizing Design Patterns</a></blockquote><blockquote><a href="#part0020_pattern_categories">Pattern Categories</a></blockquote><blockquote><a href="#part0020_thinking_in_patterns">Thinking in Patterns</a><div><blockquote><a href="#part0020_keep_it_simple_left_parenthesiskissright">Keep it simple (KISS)</a></blockquote><blockquote><a href="#part0020_design_patterns_arenapostrophet_a_magic">Design Patterns aren’t a magic bullet; in fact, they’re not even a bullet!</a></blockquote><blockquote><a href="#part0020_you_know_you_need_a_pattern_whenhellip">You know you need a pattern when...</a></blockquote><blockquote><a href="#part0020_refactoring_time_is_patterns_timeexclama">Refactoring time is Patterns time!</a></blockquote><blockquote><a href="#part0020_take_out_what_you_donapostrophet_really">Take out what you don’t really need. Don’t be afraid to remove a Design Pattern from your design.</a></blockquote><blockquote><a href="#part0020_if_you_donapostrophet_need_it_nowcomma_d">If you don’t need it now, don’t do it now.</a></blockquote></div></blockquote><blockquote><a href="#part0020_your_mind_on_patterns">Your Mind on Patterns</a></blockquote><blockquote><a href="#part0020_donapostrophet_forget_the_power_of_the_s">Don’t forget the power of the shared vocabulary</a></blockquote><blockquote><a href="#part0020_cruisinapostrophe_objectville_with_the_g">Cruisin’ Objectville with the Gang of Four</a></blockquote><blockquote><a href="#part0020_your_journey_has_just_begunhellip">Your journey has just begun...</a></blockquote><blockquote><a href="#part0020_patterns_zoo">The Patterns Zoo</a></blockquote><blockquote><a href="#part0020_annihilating_evil_with_anti-patterns">Annihilating evil with Anti-Patterns</a></blockquote><blockquote><a href="#part0020_tools_for_your_design_toolbox-id00194">Tools for your Design Toolbox</a></blockquote><blockquote><a href="#part0020_leaving_objectvillehellip">Leaving Objectville...</a></blockquote><blockquote><a href="#part0020_boycomma_itapostrophes_been_great_having">Boy, it’s been great having you in Objectville.</a></blockquote></div></blockquote><blockquote><a href="#part0021_aid-K0RQ2">A. Leftover Patterns</a><div><blockquote><a href="#part0021_bridge">Bridge</a></blockquote><blockquote><a href="#part0021_why_use_the_bridge_patternquestion_mark">Why use the Bridge Pattern?</a></blockquote><blockquote><a href="#part0021_builder">Builder</a></blockquote><blockquote><a href="#part0021_why_use_the_builder_patternquestion_mark">Why use the Builder Pattern?</a></blockquote><blockquote><a href="#part0021_chain_of_responsibility">Chain of Responsibility</a></blockquote><blockquote><a href="#part0021_how_to_use_the_chain_of_responsibility_p">How to use the Chain of Responsibility Pattern</a></blockquote><blockquote><a href="#part0021_flyweight">Flyweight</a></blockquote><blockquote><a href="#part0021_why_use_the_flyweight_patternquestion_ma">Why use the Flyweight Pattern?</a></blockquote><blockquote><a href="#part0021_interpreter">Interpreter</a></blockquote><blockquote><a href="#part0021_how_to_implement_an_interpreter">How to implement an interpreter</a></blockquote><blockquote><a href="#part0021_mediator">Mediator</a></blockquote><blockquote><a href="#part0021_mediator_in_actionhellip">Mediator in action...</a></blockquote><blockquote><a href="#part0021_memento">Memento</a></blockquote><blockquote><a href="#part0021_memento_at_work">The Memento at work</a></blockquote><blockquote><a href="#part0021_prototype">Prototype</a></blockquote><blockquote><a href="#part0021_prototype_to_the_rescue">Prototype to the rescue</a></blockquote><blockquote><a href="#part0021_visitor">Visitor</a></blockquote><blockquote><a href="#part0021_visitor_drops_by">The Visitor drops by</a></blockquote></div></blockquote><blockquote><a href="#part0022_app02">B.  </a></blockquote><blockquote><a href="#part0023_mighty_gumball">C. Mighty Gumball</a></blockquote><blockquote><a href="#part0024_aid-MSDG2">Index</a></blockquote><blockquote><a href="#part0025_id483756">About the Authors</a></blockquote><blockquote><a href="#part0026_colophon">Colophon</a></blockquote><blockquote><a href="#part0027_copyright_page_orm">Copyright</a></blockquote></div></nav></div></body></body></html>